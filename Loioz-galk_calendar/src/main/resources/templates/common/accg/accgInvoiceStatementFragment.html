<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="commonLayout">
<head>
	<meta charset="utf-8" />
</head>
<body>

<!--/* 詳細データ */-->
<div th:fragment="accgInvoiceStatementDetailFragment(detailViewForm)" id="accgInvoiceStatementDetailFragment" th:object="${detailViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {

		<!--/* 定数 */-->
		const accgInvoiceStatementDetailFragment = $('#accgInvoiceStatementDetailFragment');
		
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#accgInvoiceStatementDetailFragment");
		
		<!--/* 削除ボタンをクリック */-->
		accgInvoiceStatementDetailFragment.find(".delete").on("click", function(e){
			const ankenId = /*[[*{ankenId}]]*/"";
			const personId = /*[[*{personId}]]*/"";

			const requestParam = {
					"ankenId" : ankenId,
					"personId" : personId,
			}
			
			<!--/* 削除前の確認 */-->
			deleteConfirmModalBuild(requestParam);
		});
		
	});
	</script>
	
	<!--/* ページ分割 start */-->
	<div id="accgInvoiceStatmentDetailMainWrap" class="doc_page_split">
		<!--/* 左ブロック start */-->
		<div class="doc_page_split__main">
			<!--/* 案件情報 */-->
			<div id="ankenFragmentWrap" th:insert="::ankenFragment(*{ankenForm})"></div>
			
			<!--/* 詳細 */-->
			<div class="detail_tab_select">
				<!--/* タブ */-->
				<div class="under_line_tab mt-4 ">
					<div id="docContentsFragmentWrap" th:insert="::docContentsFragment(*{docContentsForm})"></div>
				</div>
				
				<!--/* タブの内容 */-->
				<div class="tab-content">
					<!--/* 編集タブ */-->
					<div class="tab-pane fade" id="tabDetail" role="tabpanel" aria-labelledby="detail-tab"
						th:classappend="*{docContentsForm.selectedTab == T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).EDIT_TAB} ? 'show active'">
						<div id="docEditFragmentWrap" th:insert="::docEditFragment(${detailViewForm})"></div>
					</div>
					
					<!--/* 請求書タブ */-->
					<div class="tab-pane fade" id="tabInvoicePreview" role="tabpanel" aria-labelledby="invoice-preview-tab"
						th:classappend="*{docContentsForm.selectedTab == T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).INVOICE_PDF_TAB} ? 'show active'">
						<div id="docInvoicePdfFragmentWrap">
							<th:block th:if="*{docInvoicePdfViewForm} != null" th:insert="::docInvoicePdfFragment(*{docInvoicePdfViewForm})"></th:block>
						</div>
					</div>
					
					<!--/* 精算書タブ */-->
					<div class="tab-pane fade" id="tabStatementPreview" role="tabpanel" aria-labelledby="statement-preview-tab"
						th:classappend="*{docContentsForm.selectedTab == T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).STATEMENT_PDF_TAB} ? 'show active'">
						<div id="docStatementPdfFragmentWrap">
							<th:block th:if="*{docStatementPdfViewForm} != null" th:insert="::docStatementPdfFragment(*{docStatementPdfViewForm})"></th:block>
						</div>
					</div>
					
					<!--/* 実費明細書タブ */-->
					<div class="tab-pane fade" id="tabDepositRecv" role="tabpanel" aria-labelledby="depositRecv-tab">
						<div id="dipositRecordPdfFragmentWrap"><!--/* 初期表示は編集タブ、請求書タブ、精算書タブが表示される仕様なので、タブ選択時に取得 */--></div>
					</div>
					
					<!--/* 支払計画表タブ */-->
					<div class="tab-pane fade" id="tabPaymentPlan" role="tabpanel" aria-labelledby="paymentPlan-tab">
						<div id="paymentPlanFragmentWrap"><!--/* 初期表示は編集タブ、請求書タブ、精算書タブが表示される仕様なので、タブ選択時に取得 */--></div>
					</div>
				</div>
			</div>
		</div>
		<!--/* 左ブロック end */-->
		
		<!--/* 右ブロック start */-->
		<div class="doc_page_split__sub">
			<div class="text-right mb-4"> 
				<!--/* 削除処理 */-->
				<button type="button" th:if="*{accgDocType.isInvoice()}" class="btn btn-light btn-sm delete"><i class="far fa-trash-alt mr-2"></i>請求書を削除</button>
				<button type="button" th:if="*{accgDocType.isStatement()}" class="btn btn-light btn-sm delete"><i class="far fa-trash-alt mr-2"></i>精算書を削除</button>
			</div>
			
			<div class="doc_page_split__sub__inner">
				<!--/* 取引状況（共通） */-->
				<div th:insert="common/accg/accgDocSummary::accgDocSummaryFragment(*{docSummaryForm})" class="doc_summary_container docSummaryFragmentWrap"></div>
				
				<!--/* 進行状況 */-->
				<div th:insert="::docActivityFragment(*{docActivityForm})" class="doc_action_container docActivityFragmentWrap"></div>

				<!--/* 内部メモ */-->
				<div th:insert="::memoViewFragment(${detailViewForm.memoViewForm})" class="doc_memo_container mt-4 memoViewFragmentWrap"></div>

			</div>
		</div>
		<!--/* 右ブロック end */-->
	</div>
	<!--/* ページ分割 end */-->
</div>

<!--/* 案件・名簿フラグメント start */-->
<div th:fragment="ankenFragment(ankenForm)" id="ankenFragment" th:object="${ankenForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		
		<!--/* 定数 */-->
		const ankenFragment = $('#ankenFragment');
		const accgDocFileSendModal = ankenFragment.find("#accgDocFileSendModal");
		const accgDocFilePrintSendModal = ankenFragment.find("#accgDocFilePrintSendModal");
		
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#ankenFragment");
		
		<!--/* 案件IDをクリック */-->
		$('#ankenFragment').on("click", ".transitionAnkenDetail", function(e){
			e.stopPropagation();
			const ankenId = $(this).data("ankenId");
			<!--/* 案件情報画面へ遷移 */-->
			window.location.href = "/user/ankenManagement/edit/" + ankenId + "/";
		});
		
		<!--/* 名簿IDをクリック */-->
		$('#ankenFragment').on("click", ".transitionCustomer", function(e){
			e.stopPropagation();
			const personId = $(this).data("personId");
			<!--/* 顧客情報画面へ遷移 */-->
			window.location.href = "/user/personManagement/edit/" + personId + "/";
		});
		
		<!--/* 発行をクリック */-->
		$('#ankenFragment').on("click", ".issue", function(e){
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			const ankenId = /*[[*{ankenId}]]*/"";
			const personId = /*[[*{personId}]]*/"";
			let requestParam = {
				'ankenId' : ankenId,
				'personId' : personId
			}
			displayIcon($('.issueIcon'), $('.issueSpinerIcon'));
			Promise.resolve(requestParam)
				.then(issueFn)
				.then(renderAccgInvoiceStatementDetailFragment)
				.catch((errorObj) => console.log())
				.finally(() => {
					ajaxRunning = false;
					hiddenIcon($('.issueIcon'), $('.issueSpinerIcon'));
				});
		});
		
		<!--/* WEB共有をクリック */-->
		ankenFragment.find(".openAccgDocFileSendModalForWeb").on("click", function(e) {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve({"sendType" : /*[[${T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).WEB.cd}]]*/'1'})
				.then(openAccgDocFileSendModal)
				.catch((errorObj) => {/* なにもしない */})
				.finally(() => {ajaxRunning = false;});
		});
		
		<!--/* メールで送付をクリック */-->
		ankenFragment.find(".openAccgDocFileSendModalForMail").on("click", function(e) {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve({"sendType" : /*[[${T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).MAIL.cd}]]*/'2'})
				.then(openAccgDocFileSendModal)
				.catch((errorObj) => {/* なにもしない */})
				.finally(() => {ajaxRunning = false;});
		});
		
		<!--/* 送付モーダルの表示 */-->
		function openAccgDocFileSendModal(params) {
			return new Promise((resolve, reject) => {
				$.ajax({
					url : getOpenAccgDocFileSendModalRequestUri(),
					type : "GET",
					data : params,
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// HTML表示
						accgDocFileSendModal.find("#accgDocFileSendInputFragmentWrap").html(data);
						accgDocFileSendModal.modal("show");
						return resolve();
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageFadeOutForJs(errorMsg);
						return reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageFadeOutForJs(/*[[#{E00091}]]*/"error");
					return reject();
				})
			}) ;
		}
		
		<!--/* 印刷して送付モーダルの取得 */-->
		ankenFragment.find(".openAccgDocFilePrintSendModal").on("click", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			$.ajax({
				url : getContextPath() + "/getFilePrintSendViewForm",
				type : "GET",
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// HTML表示
					accgDocFilePrintSendModal.find("#accgDocFilePrintSendViewFragmentWrap").html(data);
					accgDocFilePrintSendModal.modal("show");
				} else {
					// 処理失敗
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00091}]]*/"error");
			})
			.always(function() {
				ajaxRunning = false;
			})
		});
		
		<!--/* 発行前に戻すをクリック */-->
		ankenFragment.on("click", ".changeToDraft", function(e){
			const ankenId = /*[[*{ankenId}]]*/"";
			const personId = /*[[*{personId}]]*/"";
			let requestParam = {
					'ankenId' : ankenId,
					'personId' : personId
				}
			
			<!--/* 発行前に戻す確認モーダルを表示 */-->
			changeToDraftConfirmModalBuild(requestParam);
		});
		
		<!--/* 送付入力モーダルの画面表示取得URLを取得 */-->
		function getOpenAccgDocFileSendModalRequestUri() {
			/*[# th:if="*{isInvoice()}"]*/
			const invoiceSeq = getInvoiceSeq();
			return `/user/invoiceDetail/${invoiceSeq}/getInvoiceAccgDocFileSendInputFragment`;
			/*[/]*/
			/*[# th:if="*{isStatement()}"]*/
			return getContextPath() + "/getStatementAccgDocFileSendInputFragment";
			/*[/]*/
		}

	});
	</script>
	<div class="accg_doc_main_top" th:with="isDraft=*{T(jp.loioz.common.constant.CommonConstant$IssueStatus).DRAFT.equalsByCode(issueStatus)}">
		<div class="ml-auto">
			<!--/* 発行前 */-->
			<th:block th:if="${isDraft}">
				<button type="button" class="btn btn-sm btn-primary issue mr-5">
					<i class="fas fa-file-invoice issueIcon mr-2"></i>
					<i class="fas fa-spinner faa-spin animated issueSpinerIcon mr-2 hidden"></i>発行する
				</button>
			</th:block>
			<!--/* 発行済み */-->
			<th:block th:unless="${isDraft}">
				<button type="button" class="btn btn-sm btn-secondary mr-5">
					<i class="fas fa-file-invoice mr-2"></i>発行済み
				</button>
			</th:block>
			
			<!--/* 送付処理 */-->
			<button type="button" class="btn  btn-sm mr-2" th:classAppend="${isDraft} ? 'btn-secondary' : 'btn-primary openAccgDocFileSendModalForWeb' ">Web共有</button>
			<button type="button" class="btn btn-sm mr-2" th:classAppend="${isDraft} ? 'btn-secondary' : 'btn-primary openAccgDocFileSendModalForMail' ">メール添付</button>
			<button type="button" class="btn btn-sm" th:classAppend="${isDraft} ? 'btn-secondary' : 'btn-primary openAccgDocFilePrintSendModal' " >印刷して送付</button>
			
			<!--/* 発行前に戻す */-->
			<button class="btn btn-sm btn-light fc_sub changeToDraft ml-5"
				th:unless="*{T(jp.loioz.common.constant.CommonConstant$IssueStatus).DRAFT.equalsByCode(issueStatus)}">
				<i class="fas fa-undo-alt mr-2"></i>発行前に戻す</button>
		</div>
		
	</div>
	
	<div class="bg_wrapper">
		<div class="accg_doc_container">
			<div class="accg_doc_container__header">
				<div class="accg_doc_container__header__title" th:text="*{isInvoice()} ? '請求書設定' : '精算書設定' ">請求書設定</div>
			</div>
			
			<div class="accg_doc_container__body">
				<!--/* 発行ステータス */-->
				<div th:class="|fs18 mb-3 fw600 text-center issue_status_doc_view issue_status_*{issueStatus}|" >
					<th:block th:if="${isDraft}">
						<i class="fas fa-pen-square fa-lg"></i>
					</th:block>
					<span th:text="*{T(jp.loioz.common.constant.CommonConstant$IssueStatus).of(issueStatus).getVal()}"></span>
				</div>
				
				<!--/* 名簿 */-->
				<div class="img_info_mid mb-4">
					<!--/* 名簿画像 */-->
					<div class="img_info_mid__image">
						<!--/* 名簿属性ラベル */-->
						<div th:class="|person_image_wrapper${ankenForm.personAttribute.getCd().getCd()}|">
							<!--/* 個人アイコン */-->
							<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).KOJIN.equalsByCode(ankenForm.customerType)}" 
								class="img-thumbnail" th:src="@{/img/person_kojin.svg}"
								data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="個人">
								
							<!--/* 企業・団体アイコン */-->
							<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).HOJIN.equalsByCode(ankenForm.customerType)}"
								class="img-thumbnail" th:src="@{/img/person_hojin.svg}"
								data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="企業・団体">
								
							<!--/* 弁護士アイコン */-->
							<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).LAWYER.equalsByCode(ankenForm.customerType)}"
								class="img-thumbnail" th:src="@{/img/person_bengoshi.svg}"
								data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="弁護士">
						</div>
					</div>
					<!--/* 名簿画像 end */-->
					
					<!--/* 名前 */-->
					<div class="img_info_mid__info">
						<div class="fs25 fw600" th:text="${ankenForm.personName}">山田　太郎 </div>
						<a th:href="@{/user/personManagement/edit/{personId}/(personId=${ankenForm.personId})}" class="app_id_link mr-3"
							th:text=|名簿ID：${ankenForm.personId}|
							data-boundary="window" th:data-container="${fragmentId}" data-toggle="tooltip" data-trigger="hover" title="名簿情報へ"></a>
					</div>
					<!--/* 名前 end */-->
					
				</div>
				<!--/* 名簿 end */-->
				
				<!--/* 案件 */-->
				<div class="img_info_mid">
					<!--/* 案件画像 */-->
					<div class="img_info_mid__image">
						<div th:class="|case_image_wrapper${ankenForm.ankenType?.cd}|">
							<!--/* 案件区分 */-->
							<img class="img-thumbnail"
								th:src="@{/img/case_type{typeCd}.svg?{ver}(typeCd=${ankenForm.ankenType?.cd}, ver=${@environment.getProperty('app.version')})}">
						</div>
					</div>
					<!--/* 案件画像 end */-->
					
					<!--/* 案件名 */-->
					<div class="img_info_mid__info">
						<div class="fs25 fw600" th:text="${#strings.isEmpty(ankenForm.ankenName)} ? '(案件名未入力)' : ${ankenForm.ankenName}">案件名</div>
						<!--/* 案件ID */-->
						<a th:href="@{/user/ankenManagement/edit/{ankenId}/(ankenId=${ankenForm.ankenId})}" class="app_id_link case_link mr-3"
							th:text="|案件ID：${ankenForm.ankenId}|"
							data-boundary="window" th:data-container="${fragmentId}" data-toggle="tooltip" data-trigger="hover" title="案件情報へ">案件ID</a>
	<!--/* 案件区分 */-->
	<!--/* 事務所 */-->
	<th:block th:if="${T(jp.loioz.common.constant.CommonConstant$AnkenType).JIMUSHO.equals(ankenForm.ankenType)}">
									<i class="far fa-building"></i>
	</th:block>
	<!--/* 個人 */-->
	<th:block th:if="${T(jp.loioz.common.constant.CommonConstant$AnkenType).KOJIN.equals(ankenForm.ankenType)}">
									<i class="fas fa-briefcase"></i>
	</th:block>
								<span class="fs13 fc_sub mr-2" th:text="${ankenForm.ankenType?.val}"></span>
							
						<!-- /* 契約ステータス */ -->
						<i class="fas fa-circle fa-xs" th:if="${ankenForm.ankenStatus} != null"
							th:classappend="${ankenForm.ankenStatus} ? |anken_status_${ankenForm.ankenStatus?.cd}| :_"></i>
						<span class="fs13 fc_sub" th:text="${ankenForm.ankenStatus?.val}"></span>
						
					</div>
					<!--/* 案件名 end */-->
				</div>
				<!--/* 案件 end */-->
				
				<!--/* 請求書 */-->
				<div th:insert="::settingViewFragment(${ankenForm.settingViewForm})" class="settingViewFragmentWrap"></div>
				
			</div>
			
		</div>
	</div>
	
	<!--/* 会計書類送付モーダル */-->
	<div class="modal fade" id="accgDocFileSendModal" tabindex="-1" role="dialog" aria-labelledby="accgDocFileSendModalTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal_send_mail" role="document">
			<div class="modal-content">
				<div id="accgDocFileSendInputFragmentWrap"></div>
			</div>
		</div>
	</div>
	
	<!--/* 印刷して送付モーダル */-->
	<div class="modal fade" id="accgDocFilePrintSendModal" tabindex="-1" role="dialog" aria-labelledby="accgDocFilePrintSendModal" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal_s_wide" role="document">
			<div class="modal-content">
				<div id="accgDocFilePrintSendViewFragmentWrap"></div>
			</div>
		</div>
	</div>
	
</div>
<!--/* 案件・名簿フラグメント end */-->

<!--/* 会計書類送付入力フラグメント */-->
<div th:fragment="accgDocFileSendInputFragment" th:id="${fragmentId}" class="accgDocFileSendInputFragment" th:object="${fileSendInputForm}"
	th:with="fragmentId=|id-${T(java.util.UUID).randomUUID().toString()}|">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		
		<!--/* 定数 */-->
		const fragment = $("#" + /*[[${fragmentId}]]*/'');
		
		<!--/* 初期表示時（バリデーションエラーでの初期表示を除く）、パスワード設定にチェックが有り、何も入力されていない場合パスワードを設定する */-->
		if (!($('.error_mag_point').length) && fragment.find('.passwordEnabled').prop("checked") && fragment.find(".password").val() === '') {
			fragment.find(".password").val(generatePassward());
		}
		
		<!--/* 選択テンプレート */-->
		let nowTemplateSeq = fragment.find(".templateSelect").val();
		fragment.find(".templateSelect").on("change", function(e) {
			if (ajaxRunning) {
				fragment.find(".templateSelect").val(nowTemplateSeq);
				return false;
			}
			
			const selectedVal = $(this).val();
			if (selectedVal === '' || selectedVal == $(this).data("seq")) {
				// 未選択, 変更していない場合 -> 選択中のパラメータのみ変更し、終了
				nowTemplateSeq = selectedVal;
				return false;
			}
			
			if (!confirm("選択したテンプレート情報を各項目に反映するため、入力内容が変更されます。")) {
				// テンプレートの確認後、キャンセルした場合 -> プルダウンを元に戻す
				fragment.find(".templateSelect").val(nowTemplateSeq);
				return false;
			}
			
			// 画面情報を対象テンプレートデータに再レンダリング
			const params = {
					"sendType" : fragment.find(".sendType:checked").val(),
					"mailTemplateSeq" : selectedVal,
			}
			ajaxRunning = true;
			Promise.resolve(params)
				.then(renderAccgDocFileSendFragment)
				.catch((errorObj) => {
					fragment.find(".templateSelect").val(nowTemplateSeq);
				})
				.finally(() => {ajaxRunning = false;});
		});
		
		<!--/* 送付モーダルの表示 */-->
		function renderAccgDocFileSendFragment(params) {
			return new Promise((resolve, reject) => {
				$.ajax({
					url : getOpenAccgDocFileSendModalRequestUri(),
					type : "GET",
					data : params,
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// HTML表示
						$('#accgDocFileSendInputFragmentWrap').html(data);
						return resolve();
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageFadeOutForJs(errorMsg);
						return reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageFadeOutForJs(/*[[#{E00091}]]*/"error");
					return reject();
				})
			}) ;
		}
		
		<!--/* 送付入力モーダルの画面表示取得URLを取得 */-->
		function getOpenAccgDocFileSendModalRequestUri() {
			/*[# th:if="*{isInvoice()}"]*/
			const invoiceSeq = getInvoiceSeq();
			return `/user/invoiceDetail/${invoiceSeq}/getInvoiceAccgDocFileSendInputFragment`;
			/*[/]*/
			/*[# th:if="*{isStatement()}"]*/
			return getContextPath() + "/getStatementAccgDocFileSendInputFragment";;
			/*[/]*/
		}
		
		<!--/* 種別変更 */-->
		fragment.find(".sendType").on("change", function(e) {
			let modalTitle = /*[[*{accgDocType.val}]]*/""
			if($(this).val() === /*[[${T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).WEB.cd}]]*/'1') {
				fragment.find('.passwordEnabledRow').removeClass('hidden');
				modalTitle += /*[[${T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).WEB.val}]]*/"WEB共有";
			} else if ($(this).val() === /*[[${T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).MAIL.cd}]]*/'2') {
				fragment.find('.passwordEnabledRow').addClass('hidden');
				fragment.find(".password").val('');
				modalTitle += /*[[${T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).MAIL.val}]]*/"メール添付";
			} else {
				<!--/* 想定外なのでなにもしない */-->
			}
			
			fragment.find("#accgDocFileSendModalTitle").text(modalTitle);
		});
		
		<!--/* パスワードの有効化設定 */-->
		fragment.find(".passwordEnabled").on("change", function(e) {
			if($(this).prop("checked")) {
				fragment.find('.passwordRow').removeClass('hidden');
			} else {
				fragment.find('.passwordRow').addClass('hidden');
				fragment.find(".password").val('');
			}
		});
		
		<!--/* 自動設定ボタン */-->
		fragment.find(".generatePassword").on("click", function() {
			fragment.find(".password").val(generatePassward());
		});
		
		<!--/* パスワードの自動生成 */-->
		function generatePassward() {
			const passwordBase = '1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
			let password = "";
			for (let i = 0; i < 12; i++) {
				password += passwordBase.charAt(Math.floor(Math.random() * passwordBase.length));
			}
			
			if (!password.match(/[0-9]/) || !password.match(/[a-zA-Z]/)) {
				<!--/* 英数が混在していない（数字が含まれていない、または、英字が含まれていない）場合は再実行（再帰呼び出し） */-->
				<!--/* ※サーバー側のバリデーションが英数混在を必須としているため、それに合わせている */-->
				password = generatePassward();
			}
			
			return password;
		}
		
		<!--/* 確認に進む */-->
		fragment.find("#preview").on('click', function() {
			if (ajaxRunning) {
				return false;
			}
			
			const formData = fragment.find(".accgDocFileSendForm").serializeArray();
			
			ajaxRunning = true;
			Promise.resolve(formData)
				.then(showAccgDocFileSendPreview)
				.catch((errorObj) => {/* なにもしない */})
				.finally(() => {ajaxRunning = false;});
		});
		
		<!--/* 送付モーダルの表示 */-->
		function showAccgDocFileSendPreview(params) {
			return new Promise((resolve, reject) => {
				$.ajax({
					url : getAccgDocFileSendPreviewRequestUri(),
					type : "POST",
					data : params,
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// HTML表示
						$('#accgDocFileSendInputFragmentWrap').html(data);
						return resolve();
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageFadeOutForJs(errorMsg);
						$('#accgDocFileSendInputFragmentWrap').html(data);
						return reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageFadeOutForJs(/*[[#{E00091}]]*/"error");
					return reject();
				})
			}) ;
		}
		
		<!--/* 送付入力モーダルの画面表示取得URLを取得 */-->
		function getAccgDocFileSendPreviewRequestUri() {
			/*[# th:if="*{isInvoice()}"]*/
			const invoiceSeq = getInvoiceSeq();
			return `/user/invoiceDetail/${invoiceSeq}/getInvoiceAccgDocFileSendPreviewFragment`;
			/*[/]*/
			/*[# th:if="*{isStatement()}"]*/
			return getContextPath() + "/getStatementAccgDocFileSendPreviewFragment";
			/*[/]*/
		};
		
	});
	</script>
	<div class="modal-header">
		<h2 class="modalheader_title" id="accgDocFileSendModalTitle" th:text="|*{accgDocType.val}*{T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).of(sendType).getVal()}|"></h2>
	</div>
	<div class="modal-body">
		<form class="accgDocFileSendForm" autocomplete="off">
			<input type="hidden" th:field="*{accgDocSeq}">
			
			<!--/* メール送信フォーム */-->
			<div class="modal_split">
				
				<!--/* メール送信フォーム（左） */-->
				<div class="modal_split__left">
					<div class="form-row">
						<div class="form-group col-md-12">
							<label class="input_parts_label">送付方法</label>
							<div class="mt-1">
								<label class="radio_btn" th:with="enum=${T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).WEB}">
									<input type="radio" class="radio_input sendType" th:field="*{sendType}" th:value="${enum.cd}">
									<span class="radio_txt" th:text="${enum.val}"></span>
								</label>
								<label class="radio_btn" th:with="enum=${T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).MAIL}">
									<input type="radio" class="radio_input sendType" th:field="*{sendType}" th:value="${enum.cd}">
									<span class="radio_txt" th:text="${enum.val}"></span>
								</label>
							</div>
							<div th:if="*{#fields.hasErrors('sendType')}" th:errors="*{sendType}" class="error_mag_point">error</div>
						</div>
					</div>
					<div class="form-row">
						<div class="form-group col-md-5">
							<label class="input_parts_label" th:text="|*{accgDocType.val}テンプレート|"></label>
							<select class="form-control templateSelect" th:field="*{templateSeq}" th:data-seq="*{templateSeq}">
								<option value="">-</option>
								<option th:each="option : *{templateOptions}"
									th:value="${option.value}" th:label="${option.label}" th:text="${option.label}"></option>
							</select>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group col-md-12">
							<label class="input_parts_label">宛先メールアドレス（TO）</label>
							<span class="mark_equired">必須</span>
							<input type="email" class="form-control" th:field="*{sendTo}" maxlength="256">
							<div th:if="*{#fields.hasErrors('sendTo')}" th:errors="*{sendTo}" class="error_mag_point">error</div>
						</div>
					</div>
					<div class="form-row">
						<div class="form-group col-md-12">
							<label class="input_parts_label">CC</label>
							<input type="text" class="form-control inputRemoveSpace inputCommaArray" th:field="*{sendCc}" maxlength="2000">
							<div class="sub_text mt-2">複数の宛先を指定する場合はカンマ区切りでご入力ください</div>
							<div th:if="*{#fields.hasErrors('sendCc')}" th:errors="*{sendCc}" class="error_mag_point">error</div>
						</div>
					</div>
					<div class="form-row">
						<div class="form-group col-md-12">
							<label class="input_parts_label">BCC</label>
							<input type="text" class="form-control inputRemoveSpace inputCommaArray" th:field="*{sendBcc}" maxlength="2000">
							<div class="sub_text mt-2">複数の宛先を指定する場合はカンマ区切りでご入力ください</div>
							<div th:if="*{#fields.hasErrors('sendBcc')}" th:errors="*{sendBcc}" class="error_mag_point">error</div>
						</div>
					</div>
					<div class="form-row">
						<div class="form-group col-md-12">
							<label class="input_parts_label">送信元（FROM）</label>
							<div th:text="*{sendFrom}"></div>
							<div class="sub_text mt-1">※上記のメールアドレスから送信されます</div>
						</div>
					</div>
					<div class="form-row">
						<div class="form-group col-md-12">
							<label class="input_parts_label">送信元（表示名）</label>
							<span class="mark_equired">必須</span>
							<input type="text" class="form-control" th:field="*{sendFromName}" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_FROM_OFFICE_NAME)}">
							<div th:if="*{#fields.hasErrors('sendFromName')}" th:errors="*{sendFromName}" class="error_mag_point">error</div>
						</div>
					</div>
					<div class="form-row">
						<div class="form-group col-md-12">
							<label class="input_parts_label">返信先メールアドレス（REPLY-TO）</label>
							<span class="mark_equired">必須</span>
							<input type="email" class="form-control inputRemoveSpace" th:field="*{replyTo}" maxlength="256">
							<div th:if="*{#fields.hasErrors('replyTo')}" th:errors="*{replyTo}" class="error_mag_point">error</div>
						</div>
					</div>
				</div>
				<!--/* メール送信フォーム（左） end */-->
				
				<!--/* メール送信フォーム（右） */-->
				<div class="modal_split__right">
					<div class="form-row">
						<div class="form-group col-md-12">
							<label class="input_parts_label">件名</label>
							<span class="mark_equired">必須</span>
							<input type="text" class="form-control" th:field="*{sendSubject}" maxlength="30">
							<div th:if="*{#fields.hasErrors('sendSubject')}" th:errors="*{sendSubject}" class="error_mag_point">error</div>
						</div>
					</div>
					<div class="form-row">
						<div class="form-group col-md-12">
							<label class="input_parts_label">本文</label>
							<span class="mark_equired">必須</span>
							<div class="pt-2">
								<textarea class="form-control minh200" th:field="*{sendBody}" maxlength="10000"></textarea>
								<div th:if="*{#fields.hasErrors('sendBody')}" th:errors="*{sendBody}" class="error_mag_point">error</div>
							</div>
						</div>
					</div>
					<div class="form-row">
						<div class="form-group col-md-12">
							<label class="input_parts_label">署名</label>
							<div class="pt-2">
								<textarea class="form-control minh100" th:field="*{mailSignature}" maxlength="10000"></textarea>
								<div th:if="*{#fields.hasErrors('mailSignature')}" th:errors="*{mailSignature}" class="error_mag_point">error</div>
							</div>
						</div>
					</div>
					<div class="form-row passwordEnabledRow" th:classappend="!*{T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).WEB.equalsByCode(sendType)}? 'hidden'">
						<div class="form-group col-md-12">
							<label class="input_parts_label">パスワード</label>
							<div class="mt-1">
								<label class="checkbox_btn">
									<input type="checkbox" class="checkbox_input passwordEnabled" th:field="*{DownloadViewPasswordEnabled}">
									<span class="checkbox_txt">パスワードを設定する</span>
								</label>
							</div>
						</div>
						<div class="form-group col-md-12 passwordRow" th:classappend="!*{DownloadViewPasswordEnabled}? 'hidden'">
							<div class="d-flex align-items-center">
								<input type="text" class="form-control digit10 password" th:field="*{password}" maxlength="50">
								<button type="button" class="btn btn-light ml-3 btn-sm generatePassword">自動生成</button>
							</div>
							<div th:if="*{#fields.hasErrors('password')}" th:errors="*{password}" class="error_mag_point">error</div>
						</div>
					</div>
				</div>
				<!--/* メール送信フォーム（右）end */-->
			</div>
		</form>
	</div>
	<div class="modal-footer justify-content-start">
		<div>
			<button type="button" class="btn btn-light icon_btn_close" data-dismiss="modal" name="cancel"><i class="fas fa-times"></i>閉じる</button>
		</div>
		<div class="ml-auto">
			<button type="button" id="preview" class="btn btn-primary">確認へ進む<i class="fas fa-arrow-circle-right ml-2 mr-0"></i></button>
		</div>
	</div>
</div>
<!--/* アカウント送付 */-->

<!--/* 会計書類送付入力確認フラグメント */-->
<div th:fragment="accgDocFileSendPreviewFragment" th:id="${fragmentId}" class="accgDocFileSendPreviewFragment" th:object="${fileSendInputForm}"
	th:with="fragmentId=|id-${T(java.util.UUID).randomUUID().toString()}|">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		
		<!--/* 定数 */-->
		const fragment = $("#" + /*[[${fragmentId}]]*/'');
		const modal = fragment.closest(".modal");
		
		<!--/* 戻る処理 */-->
		fragment.find('.return').on('click', function() {
			if (ajaxRunning) {
				return false;
			}
			const formData = fragment.find(".accgDocFileSendPreviewForm").serializeArray();
			
			ajaxRunning = true;
			Promise.resolve(formData)
				.then((params) => {
					return new Promise((resolve, reject) => {
						$.ajax({
							url : _getReturnAccgDocFileSendInputRequestUri(),
							type : "POST",
							data : params,
						})
						.done(function(data, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								// HTML表示
								$('#accgDocFileSendInputFragmentWrap').html(data);
								return resolve();
							} else {
								// 処理失敗
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessageFadeOutForJs(errorMsg);
								return reject();
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							showErrorMessageFadeOutForJs(/*[[#{E00091}]]*/"error");
							return reject();
						})
					});
				})
				.catch((errorObj) => {/* なにもしない */})
				.finally(() => {ajaxRunning = false;});

			<!--/* 送付入力モーダルの画面表示取得URLを取得 */-->
			function _getReturnAccgDocFileSendInputRequestUri() {
				/*[# th:if="*{isInvoice()}"]*/
				const invoiceSeq = getInvoiceSeq();
				return `/user/invoiceDetail/${invoiceSeq}/getReturnInvoiceAccgDocFileSendInputFragment`;
				/*[/]*/
				/*[# th:if="*{isStatement()}"]*/
				return getContextPath() + "/getReturnStatementAccgDocFileSendInputFragment";
				/*[/]*/
			};
		});
		
		<!--/* 保存処理 */-->
		fragment.find('.regist').on('click', function() {
			if (ajaxRunning) {
				return false;
			}
			
			const formData = fragment.find(".accgDocFileSendPreviewForm").serializeArray();
			
			ajaxRunning = true;
			Promise.resolve(formData)
				.then((params) => {
					return new Promise((resolve, reject) => {
						$.ajax({
							url : _getFileSendRequestUri(),
							type : "POST",
							data : params,
						})
						.done(function(data, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								// HTML表示
								showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR));
								return resolve();
							} else {
								if (data) {
									$('#accgDocFileSendInputFragmentWrap').html(data);
								}
								// 処理失敗
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessageFadeOutForJs(errorMsg);
								return reject();
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							showErrorMessageFadeOutForJs(/*[[#{E00091}]]*/"error");
							return reject();
						})
					});
				})
				.then(() => hideModalPromise(modal))
				.then(renderAnkenViewFragment)
				.then(renderDocActivityViewFragment)
				.catch((errorObj) => {/* なにもしない */})
				.finally(() => {ajaxRunning = false;});
			
			<!--/* 保存処理のリクエストURLを取得 */-->
			function _getFileSendRequestUri() {
				/*[# th:if="*{isInvoice()}"]*/
				const invoiceSeq = getInvoiceSeq();
				return `/user/invoiceDetail/${invoiceSeq}/accgInvoiceFileSend`;
				/*[/]*/
				/*[# th:if="*{isStatement()}"]*/
				return getContextPath() + "/accgStatementFileSend";
				/*[/]*/
			};
			
		});
		
	});
	</script>
	<div class="modal-header">
		<h2 class="modalheader_title" id="accgDocFileSendPreviewFragment" th:text="|*{accgDocType.val}*{T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).of(sendType).getVal()}|"></h2>
	</div>
	<div class="modal-body">
		<!--/* 入力内容を保持 */-->
		<form class="accgDocFileSendPreviewForm">
			<input type="hidden" th:field="*{templateSeq}" />
			<input type="hidden" th:field="*{accgDocSeq}" />
			<input type="hidden" th:field="*{sendTo}" />
			<input type="hidden" th:field="*{sendCc}" />
			<input type="hidden" th:field="*{sendBcc}" />
			<input type="hidden" th:field="*{replyTo}" />
			<input type="hidden" th:field="*{sendFromName}" />
			<input type="hidden" th:field="*{sendSubject}" />
			<input type="hidden" th:field="*{sendBody}" />
			<input type="hidden" th:field="*{mailSignature}" />
			<input type="hidden" th:field="*{password}" />
			<input type="hidden" th:field="*{DownloadViewPasswordEnabled}" />
			<input type="hidden" th:field="*{sendType}" />
		</form>
		
		<!--/* メール送信フォーム */-->
		<div class="modal_split comfirm_view">
			
			<!--/* メール送信フォーム（左） */-->
			<div class="modal_split__left">
				<div class="form-row">
					<div class="form-group col-md-12">
						<label class="input_parts_label">送付方法</label>
						<div class="mt-1" th:text="*{T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).of(sendType).getVal()}"></div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group col-md-12">
						<label class="input_parts_label">宛先メールアドレス（TO）</label>
						<div class="form-control" th:text="*{sendTo}"></div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group col-md-12">
						<label class="input_parts_label">CC</label>
						<div class="form-control" th:text="*{sendCc}"></div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group col-md-12">
						<label class="input_parts_label">BCC</label>
						<div class="form-control" th:text="*{sendBcc}"></div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group col-md-12">
						<label class="input_parts_label">送信元（FROM）</label>
						<div th:text="*{sendFrom}"></div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group col-md-12">
						<label class="input_parts_label">送信元（表示名）</label>
						<div class="form-control" th:text="*{sendFromName}"></div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group col-md-12">
						<label class="input_parts_label">返信先メールアドレス（REPLY-TO）</label>
						<div class="form-control" th:text="*{replyTo}"></div>
					</div>
				</div>
			</div>
			<!--/* メール送信フォーム（左）end */-->
			
			<!--/* メール送信フォーム（右） */-->
			<div class="modal_split__left">
				<div class="form-row">
					<div class="form-group col-md-12">
						<label class="input_parts_label">件名</label>
						<div class="form-control" th:text="*{sendSubject}"></div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group col-md-12 h-100">
						<label class="input_parts_label">本文</label>
						<div class="form-control h-100" myth:nl2br="*{dispMailSendBody}"></div>
					</div>
				</div>
				
				<th:block th:if="*{T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).WEB.equalsByCode(sendType)}">
					<div class="form-row" th:if="*{DownloadViewPasswordEnabled}">
						<div class="form-group col-md-5">
							<label class="input_parts_label">パスワード</label>
							<div class="form-control" th:text="*{password}"></div>
						</div>
					</div>
					<div class="form-row" th:if="!*{DownloadViewPasswordEnabled}">
						<div class="form-group col-md-5">
							<label class="input_parts_label">パスワード</label>
							<div class="" th:text="設定しない"></div>
						</div>
					</div>
				</th:block>
			</div>
			<!--/* メール送信フォーム（右）end  */-->
			
		</div>
	</div>
	<div class="modal-footer justify-content-start">
		<div><button type="button" class="btn btn-light icon_btn_close return"><i class="fas fa-undo-alt"></i>編集に戻る</button></div>
		<div class="ml-auto"><button type="button" class="btn btn-primary regist"><i class="far fa-envelope mr-2"></i>送信する</button></div>
	</div>
</div>
<!--/* end */-->

<!--/* 印刷して送付 */-->
<div th:fragment="accgDocFilePrintSendFragment" th:id="${fragmentId}" class="accgDocFilePrintSendFragment" th:object="${filePrintSendViewForm}"
	th:with="fragmentId=|id-${T(java.util.UUID).randomUUID().toString()}|">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		const fragment = $(/*[[|#${fragmentId}|]]*/"");
		const modal = fragment.closest(".modal");
		
		<!--/* 実行ボタンの押下 */-->
		fragment.find(".submit").on("click", function() {
			const checkedPrintType =  fragment.find("[name='printType']:checked");
			switch(checkedPrintType.val()) {
				case "printDownload": 
					printDownload();
					break;
				case "downloadAndChangeToSend": 
					downloadAndChangeToSend();
					break;
				default : break;
			}
		})
		
		<!--/* 送付ファイルをダウンロードする */-->
		function printDownload() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(() => downloadAjaxPromise(getContextPath() + "/printDownload", $(this), {}, false))
				.catch((errorObj) => {
					showErrorMessageForJs("ファイルのダウンロードに失敗しました");
				})
				.finally(() => {ajaxRunning = false;});
		}
		
		<!--/* 送付ファイルをダウンロードして、送付済みにする */-->
		function downloadAndChangeToSend() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(() => downloadAjaxPromise(getContextPath() + "/downloadAndChangeToSend", $(this), {}, false))
				.then(() => {
					showInfoMessageForJs(/*[[#{I00045(送付済みに)}]]*/"");
					return hideModalPromise(modal);
				})
				.then(renderAnkenViewFragment)
				.then(renderDocActivityViewFragment)
				.catch((errorObj) => {/* なにもしない */})
				.finally(() => {ajaxRunning = false;});
		}
	})
	</script>
	<div class="modal-header">
		<h2 class="modalheader_title">印刷して送付</h2>
	</div>
	<div class="modal-body">
		<div class="form-row">
			<div class="form-group col-md-12">
				実行内容を選択してください。<br>
				送付済みとする場合、<span th:text="*{accgDocType?.val}"></span>が送付済み状態となり、進行状況に送付履歴が追加されます。
			</div>
		</div>
		<div class="form-row">
			<div class="form-group col-md-12">
				<div class="pt-2">
					<label class="radio_btn mb-0">
						<input type="radio" class="radio_input" name="printType" value="printDownload" checked>
						<span class="radio_txt">送付ファイルをダウンロードする</span>
					</label>
				</div>
			</div>
		</div>
		<div class="form-row">
			<div class="form-group col-md-12">
				<div class="pt-2">
					<label class="radio_btn mb-0">
						<input type="radio" class="radio_input" name="printType" value="downloadAndChangeToSend">
						<span class="radio_txt" th:text="ステータスを「送付済み」にする（送付ファイルのダウンロード含む）"></span>
					</label>
				</div>
			</div>
		</div>
	</div>
	<div class="modal-footer justify-content-start">
		<div><button type="button" class="btn btn-light icon_btn_close" data-dismiss="modal" name="cancel"><i class="fas fa-times"></i>閉じる</button></div>
		<div class="ml-auto"><button type="button" class="btn btn-primary submit"><i class="fas fa-check"></i>実行</button></div>
	</div>
	
</div>
<!--/* 手動で送付 */-->

<!--/* 設定表示フラグメント start */-->
<section class="mt-3 mb-4" th:fragment="settingViewFragment(settingViewForm)" id="settingViewFragment" th:object="${settingViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#settingViewFragment");
		
		const settingViewFragment = $('#settingViewFragment');
		
		<!--/* 設定入力モード表示 */-->
		settingViewFragment.on("click", ".docSettingEdit", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(() => renderSettingInputFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<div class="mt-4">
		<!--/* 設定情報 start */-->
		<div class="doc_view_wrapper doc_edit_target docSettingEdit settingInputFragmentWrap">
			<div class="doc_view">
				<div class="row">
					<div class="col-auto" th:if="*{accgDocType.isInvoice()}">
						<label class="doc_label">請求方法</label>
						<div class="doc_value digit4" th:text="*{invoiceTypeName}">一括請求</div>
					</div>
					<div class="col-auto">
						<label class="doc_label">売上計上日</label>
						<div class="doc_value digit6" th:text="*{#strings.isEmpty(getSalesDateFormat())} ? '-' : *{getSalesDateFormat()}">2022/03/31</div>
					</div>
					<div class="col-auto">
						<label class="doc_label">売上計上先</label>
						<div class="doc_value digit6" th:text="*{#strings.isEmpty(salesAccountName)} ? '-' : *{salesAccountName}">弁護 一郎</div>
					</div>
					<div class="col-auto">
						<label class="doc_label">添付資料</label>
						<div class="doc_value">
							<th:block th:if="*{T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_ON.equalsByCode(depositDetailAttachFlg)}">
								<span class="mr-2 fs15"><i class="fas fa-paperclip text-info mr-2"></i>実費明細書</span>
							</th:block>
							<th:block th:if="*{T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_ON.equalsByCode(paymentPlanAttachFlg)}">
								<span class="mr-2 fs15"><i class="fas fa-paperclip text-info mr-2"></i>分割予定表</span>
							</th:block>
							<th:block th:if="*{T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(depositDetailAttachFlg)} and *{T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(paymentPlanAttachFlg)}">
								<span class="mr-2">-</span>
							</th:block>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--/* 設定情報 end */-->
	</div>
</section>
<!--/* 設定表示フラグメント end */-->

<!--/* 設定入力フラグメント start */-->
<div th:fragment="settingInputFragment" id="settingInputFragment" th:object="${settingInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#settingInputFragment");
		
		const settingInputFragment = $('#settingInputFragment');
		
		<!--/* 設定内 - 支払計画表表示 */-->
		settingInputFragment.on("change", ".claimType", function() {
			const ikkatsuSeikyuCd = /*[[${T(jp.loioz.common.constant.CommonConstant$SeikyuType).IKKATSU.cd}]]*/ '';
			let val = $(this).val();
			if (val === ikkatsuSeikyuCd) {
				<!--/* 支払計画表を添付を非表示 */-->
				settingInputFragment.find('#settingInputForm .paymentPlanAttachFlg').prop("disabled", true);
				settingInputFragment.find('.paymentPlanView').addClass('hidden');
			} else {
				<!--/* 支払計画表を添付を表示 */-->
				settingInputFragment.find('#settingInputForm .paymentPlanAttachFlg').prop("disabled", false);
				settingInputFragment.find('.paymentPlanView').removeClass('hidden');
			}
		});
		
		<!--/* 設定入力フラグメント保存処理 */-->
		settingInputFragment.on("click", ".saveSetting", function() {
			
			<!--/* リクエストパラメータ */-->
			const formData = $('#settingInputForm').serializeArray();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve(formData)
				.then(saveSettingFunc)
				.then(renderSettingViewFragment)
				.then(renderDocContentsSelectedViewFragment)
				.catch((errorObj) => {/* なにもしない */})
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 設定フラグメント閉じる処理 */-->
		settingInputFragment.on("click", ".closeSetting", function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(renderSettingViewFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<div class="doc_view_edit docSettingEditRow">
		<form id="settingInputForm">
			<div class="form-row">
				<div class="form-group col-md-auto pr-3" th:if="*{accgDocType?.isInvoice()}">
					<label class="top_label">請求方法</label>
					<select class="form-control digit6 claimType" th:field="*{invoiceType}" th:disabled="!*{T(jp.loioz.common.constant.CommonConstant$IssueStatus).DRAFT.equalsByCode(issueStatus)}">
						<option th:each="seikyu : ${T(jp.loioz.common.constant.CommonConstant$InvoiceType).values()}" th:value="${seikyu.cd}" th:text="${seikyu.val}"></option>
					</select>
					<div th:if="*{#fields.hasErrors('invoiceType')}" th:errors="*{invoiceType}" class="error_mag_point">error</div>
				</div>
				<div class="form-group col-md-auto pr-3">
					<label class="top_label">売上計上日</label>
					<span class="mark_equired">必須</span>
					<input type="text" class="form-control digit8 inputDateSlash inputDate" maxlength="10" th:field="*{salesDate}"
						data-click-sync="[data-target-name='salesDate']">
					<button type="button" class="btn btn_popcal hidden" data-toggle="datepicker" data-target-name="salesDate">カレンダー</button>
					<div th:if="*{#fields.hasErrors('salesDate')}" th:errors="*{salesDate}" class="error_mag_point digit8">error</div>
				</div>
				<div class="form-group col-md-auto pr-3">
					<label class="top_label">売上計上先</label>
					<span class="mark_equired">必須</span>
					<select class="form-control" th:field="*{salesAccount}">
						<option value="">-</option>
						<option th:each="account : *{salesAccountList}" th:value="${account.getValue()}" th:text="${account.getLabel()}"></option>
					</select>
					<div th:if="*{#fields.hasErrors('salesAccount')}" th:errors="*{salesAccount}" class="error_mag_point digit8">error</div>
				</div>
				<div class="form-group col-md-auto pr-3">
					<label class="top_label">添付資料</label>
					<div class="py-1">
						<div>
							<label class="check_area checkbox_btn">
								<input type="checkbox" class="checkbox_input" th:field="*{depositDetailAttachFlg}" th:disabled="!*{T(jp.loioz.common.constant.CommonConstant$IssueStatus).DRAFT.equalsByCode(issueStatus)}">
								<span class="checkbox_txt">実費明細書</span>
							</label>
						</div>
						<div class="mt-1" th:if="*{accgDocType?.isInvoice()}">
							<label class="check_area checkbox_btn paymentPlanView" th:classappend="*{(T(jp.loioz.common.constant.CommonConstant$SeikyuType).BUNKATSU.equalsByCode(invoiceType) ? '' : 'hidden')}">
								<input type="checkbox" class="checkbox_input paymentPlanAttachFlg" th:field="*{paymentPlanAttachFlg}" th:disabled="!*{T(jp.loioz.common.constant.CommonConstant$IssueStatus).DRAFT.equalsByCode(issueStatus)}">
								<span class="checkbox_txt">分割予定表</span>
							</label>
						</div>
					</div>
				</div>
			</div>
			<div class="text-right mb-2">
				<button type="button" class="btn btn-info btn-sm saveSetting"><i class="fas fa-check"></i>保存</button>
				<button type="button" class="btn btn-light btn-sm ml-3 closeSetting"><i class="fas fa-times ml-1"></i>閉じる</button>
			</div>
		</form>
	</div>
</div>
<!--/* 設定入力フラグメント end */-->

<!--/* 内部メモ表示フラグメント start */-->
<div th:fragment="memoViewFragment(memoViewForm)" id="memoViewFragment" th:object="${memoViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#memoViewFragment");
		
		const memoViewFragment = $('#memoViewFragment');
		
		<!--/* 内部メモ入力モード表示 */-->
		memoViewFragment.on("click", ".docMemoEdit", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(() => renderMemoInputFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<div class="doc_memo_container__header">
		内部メモ
	</div>
	<div class="doc_memo_container__body">
		<!--/* 内部メモ情報 start */-->
		<div class="doc_view_wrapper doc_edit_target docMemoEdit memoInputFragmentWrap">
			<div class="doc_view"myth:nl2br="*{#strings.isEmpty(memo)} ? '-' : *{memo}">
				支払の遅延あり
			</div>
		</div>
		<!--/* 内部メモ情報 end */-->
	</div>
</div>
<!--/* 内部メモ表示フラグメント end */-->

<!--/* 内部メモ入力フラグメント start */-->
<div th:fragment="memoInputFragment" id="memoInputFragment" th:object="${memoInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#memoInputFragment");
		
		const memoInputFragment = $('#memoInputFragment');
				
		<!--/* 設定入力フラグメント保存処理 */-->
		memoInputFragment.on("click", ".saveMemo", function() {
			
			<!--/* リクエストパラメータ */-->
			const formData = $('#memoInputForm').serializeArray();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve(formData)
				.then(saveMemoFunc)
				.then(renderMemoViewFragment)
				.then(renderDocContentsSelectedViewFragment)
				.catch((errorObj) => {/* なにもしない */})
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 内部メモフラグメント閉じる処理 */-->
		memoInputFragment.on("click", ".closeMemo", function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(renderMemoViewFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<div class="doc_view_edit docMemoEditRow">
		<form id="memoInputForm">
			<div class="mb-3">
				<textarea class="form-control minh200" placeholder="入力した内容は印字されません" th:field="*{memo}" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_MEMO)}"></textarea>
				<div th:if="*{#fields.hasErrors('memo')}" th:errors="*{memo}" class="error_mag_point">error</div>
			</div>
			<div class="text-right mb-1 pr-1">
				<button type="button" class="btn btn-info btn-sm saveMemo"><i class="fas fa-check"></i>保存</button>
				<button type="button" class="btn btn-light btn-sm ml-3 closeMemo"><i class="fas fa-times ml-1"></i>閉じる</button>
			</div>
		</form>
	</div>
</div>
<!--/* 内部メモ入力フラグメント end */-->


<!--/* タブフラグメント start */-->
<div th:fragment="docContentsFragment(docContentsForm)" id="docContentsFragment" th:object="${docContentsForm}"
	th:with="isInvoice=*{accgDocType.isInvoice()}, isStatement=*{accgDocType.isStatement()}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		
		<!--/* 定数 */-->
		const docContentsFragment = $('#docContentsFragment');
		const docEditFragmentWrap = $('#docEditFragmentWrap');
		const docInvoicePdfFragmentWrap = $('#docInvoicePdfFragmentWrap');
		const docStatementPdfFragmentWrap = $('#docStatementPdfFragmentWrap');
		const dipositRecordPdfFragmentWrap = $('#dipositRecordPdfFragmentWrap');
		const paymentPlanFragmentWrap = $('#paymentPlanFragmentWrap');
		
		<!--/* タブ押下のView切り替えはbootstrapにより行うが表示するHTMLは再取得する */-->
		<!--/* 編集タブ押下 */-->
		docContentsFragment.find("#detail-tab").on('click', function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(renderAccgInvoiceStatementDetailFragment)
				.catch((errorObj) => {})
				.finally(() => {
					ajaxRunning = false;
				});
		});
		
		<!--/* 請求書編集タブ押下 */-->
		docContentsFragment.find("#invoice-preview-tab").on('click', function() {
			if (ajaxRunning) {
				return false;
			}
			const selectedTabCd = $(this).data("tabCd");
			
			ajaxRunning = true;
			
			refreshAllTabContents();
			Promise.resolve()
				.then(() => renderDocContentsViewFragment({"selectedTabCd" : selectedTabCd}))
				.then(() => renderDocInvoicePdfViewFragment()) <!--/* 請求書画面の親HTMLにのみ関数を用意する */-->
				.catch((errorObj) => {})
				.finally(() => {
					ajaxRunning = false;
				});
		});
		
		<!--/* 精算書編集タブ押下 */-->
		docContentsFragment.find("#statement-preview-tab").on('click', function() {
			if (ajaxRunning) {
				return false;
			}
			const selectedTabCd = $(this).data("tabCd");
			
			ajaxRunning = true;
			refreshAllTabContents();
			Promise.resolve()
				.then(() => renderDocContentsViewFragment({"selectedTabCd" : selectedTabCd}))
				.then(() =>renderDocStatementPdfViewFragment()) <!--/* 精算書画面の親HTMLにのみ関数を用意する */-->
				.catch((errorObj) => {})
				.finally(() => {
					ajaxRunning = false;
				});
		});

		<!--/* 実費明細編集タブ押下 */-->
		docContentsFragment.find("#depositRecv-tab").on('click', function() {
			if (ajaxRunning) {
				return false;
			}
			const selectedTabCd = $(this).data("tabCd");
			
			ajaxRunning = true;
			refreshAllTabContents();
			Promise.resolve()
				.then(() => renderDocContentsViewFragment({"selectedTabCd" : selectedTabCd}))
				.then(() =>renderDipositRecordPdfViewFragment())
				.catch((errorObj) => {})
				.finally(() => {
					ajaxRunning = false;
				});
		});
		
		<!--/* 支払計画表タブ */-->
		docContentsFragment.find("#paymentPlan-tab").on('click', function() {
			if (ajaxRunning) {
				return false;
			}
			const selectedTabCd = $(this).data("tabCd");
			
			ajaxRunning = true;
			refreshAllTabContents();
			Promise.resolve()
				.then(() => renderDocContentsViewFragment({"selectedTabCd" : selectedTabCd}))
				.then(() =>renderPaymentPlanConditionViewFragment())
				.catch((errorObj) => {})
				.finally(() => {
					ajaxRunning = false;
				});
		});
		
		<!--/* 各tab内のFragmentを初期化する */-->
		function refreshAllTabContents() {
			<!--/* 編集タブのみ、編集タブ内のフラグメント更新処理を行うため、リフレッシュ対象外 */-->
			docInvoicePdfFragmentWrap.html('');
			docStatementPdfFragmentWrap.html('');
			dipositRecordPdfFragmentWrap.html('');
			paymentPlanFragmentWrap.html('');
		}
		
	});
	</script>
	<ul class="nav nav-tabs" id="myTab" role="tablist">
		<!--/* 編集 */-->
		<th:block th:if="*{showEditTab}">
			<li class="nav-item" th:with="isSelected=*{selectedTab == T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).EDIT_TAB}">
				<a class="nav-link" id="detail-tab" data-toggle="tab" href="#tabDetail" role="tab" aria-controls="detail"
					th:classappend="${isSelected}?'active'" th:aria-selected="${isSelected}" th:data-tab-cd="${T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).EDIT_TAB.cd}">
					<span class="mx-4"><i class="fas fa-pen-square fa-lg mr-2"></i>編集</span>
				</a>
			</li>
		</th:block>
		
		<!--/* 請求書プレビュー */-->
		<li class="nav-item" th:if="${isInvoice}" th:with="isSelected=*{selectedTab == T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).INVOICE_PDF_TAB}">
			<a class="nav-link" id="invoice-preview-tab" data-toggle="tab" href="#tabInvoicePreview" role="tab" aria-controls="preview"
				th:classappend="${isSelected}?'active'" th:aria-selected="${isSelected}" th:data-tab-cd="*{T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).INVOICE_PDF_TAB.cd}">
				<span class="mx-4">請求書</span>
			</a>
		</li>
		
		<!--/* 精算書プレビュー */-->
		<li class="nav-item" th:if="${isStatement}" th:with="isSelected=*{selectedTab == T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).STATEMENT_PDF_TAB}">
			<a class="nav-link" id="statement-preview-tab" data-toggle="tab" href="#tabStatementPreview" role="tab" aria-controls="preview"
				th:classappend="${isSelected}?'active'" th:aria-selected="${isSelected}" th:data-tab-cd="*{T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).STATEMENT_PDF_TAB.cd}">
				<span class="mx-4">精算書</span>
			</a>
		</li>
		
		<!--/* 預り金明細 */-->
		<li class="nav-item" th:if="*{depositDetailAttachFlg}" th:with="isSelected=*{selectedTab == T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).DEPOSIT_DETAIL_PDF_TAB}">
			<a class="nav-link" id="depositRecv-tab" data-toggle="tab" href="#tabDepositRecv" role="tab" aria-controls="depositRecv"
				th:classappend="${isSelected}?'active'" th:aria-selected="${isSelected}" th:data-tab-cd="*{T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).DEPOSIT_DETAIL_PDF_TAB.cd}">
				<span class="mx-2">実費明細書</span>
			</a>
		</li>
		
		<!--/* 支払計画表 */-->
		<li class="nav-item" th:if="*{paymentPlanAttachFlg}" th:with="isSelected=*{selectedTab == T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).INVOICE_PLAN_TAB}">
			<a class="nav-link" id="paymentPlan-tab" data-toggle="tab" href="#tabPaymentPlan" role="tab" aria-controls="paymentPlan"
				th:classappend="${isSelected}?'active'" th:aria-selected="${isSelected}" th:data-tab-cd="*{T(jp.loioz.common.constant.CommonConstant$AccggInvoiceStatementDetailViewTab).INVOICE_PLAN_TAB.cd}">
				<i th:if="*{hasPaymentPlanWarning}" class="fas fa-exclamation-circle mt-1 text-warning"></i>
				<span class="" th:classAppend="*{hasPaymentPlanWarning} ? 'ml-1' : 'mx-2' ">分割予定表</span>
			</a>
		</li>
	</ul>
</div>
<!--/* タブフラグメント end */-->

<!--/* 編集タブフラグメント start */-->
<div th:fragment="docEditFragment(docEditViewForm)" id="docEditFragment" th:object="${docEditViewForm}">
	<script type="text/javascript" th:replace="common/mvc/accgAccountSelect/accgInvoiceStatementAccountSelectModal::accgInvoiceStatementAccountSelectModalFragmentJs"></script>
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#docEditFragment");
		
		const docEditFragment = $('#docEditFragment');
		const accgInvoiceStatementAccountSelectModal = docEditFragment.find('#accgInvoiceStatementAccountSelectModal');
		
		<!--/* 口座を選択リンク押下 */-->
		docEditFragment.on("click", ".createAccgInvoiceStatementAccountSelectModal", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			const accgDocSeq = $(this).data("accgDocSeq");
			const ankenId = $(this).data("ankenId");
			Promise.resolve()
				.then(() => createAccgInvoiceStatementAccountSelectModal(accgDocSeq, ankenId))
				.then(() => $("#accgInvoiceStatementAccountSelectModal").modal("show"))
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 口座選択モーダルを開く */-->
		function createAccgInvoiceStatementAccountSelectModal(accgDocSeq, ankenId) {
			return new Promise((resolve, reject) => {
				const param = [
					{name:"accgDocSeq", value:accgDocSeq},
					{name:"ankenId", value:ankenId}
				];
				$.ajax({
					url : "/common/mvc/accgInvoiceStatementAccountSelect/createAccgInvoiceStatementAccountSelectModal",
					type : "GET",
					data : param,
					dataType: 'html',
				}).done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* ツールチップを非表示にする */-->
						$('[data-toggle="tooltip"]').tooltip('hide');
						$('.accgInvoiceStatementAccountSelectModalFragmentWrap').html(data);
						return resolve();
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageFadeOutForJs(errorMsg);
						return reject(errorMsg);
					}
				}).fail(function() {
					showErrorMessageFadeOutForJs(/*[[#{E00059}]]*/ "データの取得に失敗しました。");
					return reject();
				})
			});
		}
		
		<!--/* 口座選択モーダルを開いたとき (関数発行タイミング：表示アニメション開始時) */-->
		accgInvoiceStatementAccountSelectModal.on('show.bs.modal', function(e){
			
			<!--/* 選択処理をセットアップ */-->
			benzo.global.fragment.accgInvoiceStatementAccountSelectModalFragmentObj.setUpObj.selectAction = (e) => {
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				ajaxRunning = true;
				
				const formData = benzo.global.fragment.accgInvoiceStatementAccountSelectModalFragmentObj.paramObj.getFormParams(accgInvoiceStatementAccountSelectModal);
				
				Promise.resolve(formData)
					.then((params) => {
						return new Promise((resolve, reject) => {
							$.ajax({
								type : "POST",
								url : "/common/mvc/accgInvoiceStatementAccountSelect/selectTenantBankDetail",
								data : formData,
							}).done(function(data, status, jqXHR) {
								if (data.successed) {
									Promise.resolve()
										.then(() => $("#accgInvoiceStatementAccountSelectModal").modal("hide"))
										.then(() => renderBankDetailInputFragment())
										.then(() => $("#bankDetailInputFragment #tenantBankDetail").val(data.tenantBeanDetail))
										.catch((errorObj) => console.log(errorObj))
										.finally(() => ajaxRunning = false);
									return resolve();
								} else {
									showErrorMessageFadeOutForJs(data.message);
									return reject();
								}
							}).fail(function() {
								showErrorMessage(/*[[#{E00091}]]*/"error", accgInvoiceStatementAccountSelectModal);
								return reject()
							}).always(function() {
							});
						});
					})
					.catch(() => { /*何もしない*/ })
					.finally(() => {
						ajaxRunning = false;
					});
			};
		});
		
		<!--/* 基本タイトル入力モード表示 */-->
		docEditFragment.on("click", ".docBaseTitleEdit", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(() => renderBaseTitleInputFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 基本情報_請求先入力モード表示 */-->
		docEditFragment.on("click", ".docBaseToEdit", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(() => renderBaseToInputFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 基本情報_請求元入力モード表示 */-->
		docEditFragment.on("click", ".docBaseFromEdit", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(() => renderBaseFromInputFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 基本情報_挿入文入力モード表示 */-->
		docEditFragment.on("click", ".docBaseOtherEdit", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(() => renderBaseOtherInputFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* お振込先入力モード表示 */-->
		docEditFragment.on("click", ".docBankDetailEdit", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(() => renderBankDetailInputFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 備考入力モード表示 */-->
		docEditFragment.on("click", ".docRemarksEdit", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(() => renderRemarksInputFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<!--/* doc_base_container */-->
	<div class="doc_base_container">
		
		<!--/* 基本情報 */-->
		<section>
			<div class="section_block_header">
				<div class="section_block_title">
					<span class="badge badge-pill accg_label badge_cyan">基本情報</span>
				</div>
			</div>
			<div class="section_block_body">
				<div class="doc_base_wrapper">
					<!--/* 基本情報タイトル（表示モード） */-->
					<div th:insert="::baseTitleViewFragment(*{baseTitleViewForm})" class="docBaseTitleEdit baseTitleFragmentWrap"></div>
					
					<!--/* 請求先、請求元 */-->
					<div class="doc_info">
						<!--/* 請求先、請求元（左エリア） start */-->
						<div class="doc_info_l">
							<!--/* 請求先 start */-->
							<label th:if="*{accgDocType.isInvoice()}" class="doc_label ml-4">請求先情報</label>
							<label th:if="*{accgDocType.isStatement()}" class="doc_label ml-4">返金先情報</label>
							<hr class="m-2">
							<!--/* 請求先（表示モード） */-->
							<div th:insert="::baseToViewFragment(*{baseToViewForm})" class="docBaseToEdit baseToFragmentWrap"></div>
							<!--/* 請求先 end */-->
						</div>
						<!--/* 請求先、請求元（左エリア） end  */-->
						
						<!--/* 請求先、請求元（右エリア） start */-->
						<div class="doc_info_r">
							<!--/* 請求元 start */-->
							<label th:if="*{accgDocType.isInvoice()}" class="doc_label ml-4">請求元情報</label>
							<label th:if="*{accgDocType.isStatement()}" class="doc_label ml-4">返金元情報</label>
							<hr class="m-2">
							<!--/* 請求元（表示モード） */-->
							<div th:insert="::baseFromViewFragment(*{baseFromViewForm})" class="docBaseFromEdit baseFromFragmentWrap"></div>
							<!--/* 請求元 end */-->
						</div>
						<!--/* 請求先、請求元（右エリア）end */-->
					</div>
					<!--/* 請求先、請求元 end */-->
					
					<hr class="my-2 mx-3">
					
					<!--/* 挿入文、件名、お支払い期限 */-->
					<div th:insert="::baseOtherViewFragment(*{baseOtherViewForm})" class="docBaseOtherEdit baseOtherFragmentWrap"></div>
					
				</div>
			</div>
		</section>
		<!--/* 基本情報 section end */-->
		
		<!--/* お振込み先 */-->
		<section class="mt-4">
			<div class="section_block_header">
				<div class="section_block_title">
					<span class="badge badge-pill accg_label badge_cyan">お振込み先</span>
				</div>
				<th:block th:if="*{accgDocType.isInvoice()}">
					<a href="javascript:void(0);" class="fs14 createAccgInvoiceStatementAccountSelectModal" data-toggle="modal" data-target="#accountSelect" th:data-accg-doc-seq="*{accgDocSeq}" th:data-anken-id="*{bankDetailViewForm.ankenId}">
						<i class="fas fa-search mr-2"></i>口座を選択
					</a>
				</th:block>
			</div>
			<div class="section_block_body">
				<!--/* お振込先（表示モード） */-->
				<div th:insert="::bankDetailViewFragment(*{bankDetailViewForm})" class="doc_view_wrapper doc_edit_target docBankDetailEdit bankDetailFragmentWrap"></div>
			</div>
		</section>
		
		<!--/* 既入金 section */-->
		<section class="mt-4">
			<div class="section_block_header">
				<div class="section_block_title"><span class="badge badge-pill accg_label badge_red">既入金</span></div>
			</div>
			<div class="section_block_body">
				<!--/* 既入金（表示モード） */-->
				<div th:insert="::repayViewFragment(*{repayViewForm})" class="doc_view_wrapper invoice_item_view p-0 repayFragmentWrap"></div>
			</div>
			
		</section>
		<!--/* 既入金 section end */-->
		
		<!--/* 請求 section */-->
		<section class="mt-4">
			<div class="section_block_header">
				<div class="section_block_title">
					<span class="badge badge-pill accg_label badge_orange">請求項目</span>
				</div>
			</div>
			<div class="section_block_body">
				<!--/* 請求（表示モード） */-->
				<div th:insert="::invoiceViewFragment(*{invoiceViewForm})" class="doc_view_wrapper invoice_item_view invoiceFragmentWrap"></div>
			</div>
		</section>
		<!--/* 請求 section end */-->
		
		<!--/* 備考欄 */-->
		<section class="mt-4">
			<div class="section_block_header">
				<div class="section_block_title">
					<span class="badge badge-pill accg_label badge_cyan">備考</span>
				</div>
			</div>
			<div class="section_block_body">
				<!--/* 備考（表示モード） */-->
				<div th:insert="::remarksViewFragment(*{remarksViewForm})" class="doc_view_wrapper doc_edit_target docRemarksEdit remarksFragmentWrap"></div>
			</div>
		</section>
		
	</div>
	<!--/* doc_base_container end */-->

	<!--/* 口座選択Modal start */-->
	<div id="accgInvoiceStatementAccountSelectModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="accountSelectionTitle" aria-hidden="true" data-backdrop="static">
		<div class="modal-dialog modal-dialog-centered modal_account_select" role="document">
			<div class="modal-content">
				<div class="accgInvoiceStatementAccountSelectModalFragmentWrap"></div>
			</div>
		</div>
	</div>
	<!--/* 口座選択Modal end */-->

</div>
<!--/* 編集タブフラグメント end */-->

<!--/* 基本情報_タイトル表示フラグメント start */-->
<div th:fragment="baseTitleViewFragment(baseTitleViewForm)" id="baseTitleViewFragment" class="doc_base_inner doc_edit_target docBaseTitleEdit" th:object="${baseTitleViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#baseTitleViewFragment");
	});
	</script>
	<div class="row">
		<div class="col-6">
			<label th:if="*{accgDocType.isInvoice()}" class="doc_label">請求書タイトル</label>
			<label th:if="*{accgDocType.isStatement()}" class="doc_label">精算書タイトル</label>
			<div class="doc_value" th:text="*{baseTitle}"></div>
		</div>
		<div class="col-6">
			<div class="row">
				<div class="col-auto">
					<label th:if="*{accgDocType.isInvoice()}" class="doc_label">請求日</label>
					<label th:if="*{accgDocType.isStatement()}" class="doc_label">精算日</label>
					<div class="digit8 doc_value" th:text="*{getBaseDateFormat()}">2022/03/31</div>
				</div>
				<div class="col-auto">
					<label th:if="*{accgDocType.isInvoice()}" class="doc_label">請求番号</label>
					<label th:if="*{accgDocType.isStatement()}" class="doc_label">精算番号</label>
					<div class="digit8 doc_value" th:text="*{baseNumber}">220331-11</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!--/* 基本情報_タイトル表示フラグメント end */-->

<!--/* 基本情報_タイトル入力フラグメント start */-->
<div th:fragment="baseTitleInputFragment(baseTitleInputForm)" id="baseTitleInputFragment" class="doc_base_inner" th:object="${baseTitleInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#baseTitleInputFragment");
		
		const baseTitleInputFragment = $('#baseTitleInputFragment');
		
		<!--/* 基本タイトル入力フラグメント保存処理 */-->
		baseTitleInputFragment.on("click", ".saveBaseTitle", function() {
			
			<!--/* リクエストパラメータ */-->
			const formData = $('#baseTitleInputForm').serializeArray();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve(formData)
				.then(saveBaseTitleFunc)
				.then(renderBaseTitleViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 基本情報_タイトル入力フラグメント閉じる処理 */-->
		baseTitleInputFragment.on("click", ".closeBaseTitle", function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(renderBaseTitleViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<form id="baseTitleInputForm">
		<div class="form-row">
			<!--/* タイトル */-->
			<div class="form-group col-md-6">
				<label class="top_label">タイトル</label>
				<span class="mark_equired">必須</span>
				<input type="text" class="form-control digit18 invoiceTitleText" autocomplete="off" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_TITLE)}" th:field="*{baseTitle}">
				<div th:if="*{#fields.hasErrors('baseTitle')}" th:errors="*{baseTitle}" class="error_mag_point digit8">error</div>
			</div>
			<!--/* 日付 */-->
			<div class="form-group col-md-3 pl-4">
				<label th:if="*{accgDocType.isInvoice()}" class="top_label">請求日</label>
				<label th:if="*{accgDocType.isStatement()}" class="top_label">精算日</label>
				<span class="mark_equired">必須</span>
				<input type="text" class="form-control digit8 inputDateSlash inputDate" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_DATE)}" th:field="*{baseDate}"
					data-click-sync="[data-target-name='baseDate']">
				<button type="button" class="btn btn_popcal hidden" data-toggle="datepicker" data-target-name="baseDate">カレンダー</button>
				<div th:if="*{#fields.hasErrors('baseDate')}" th:errors="*{baseDate}" class="error_mag_point digit8">error</div>
			</div>
			<!--/* 請求番号 */-->
			<div class="form-group col-md-3">
				<label th:if="*{accgDocType.isInvoice()}" class="top_label">請求番号</label>
				<label th:if="*{accgDocType.isStatement()}" class="top_label">精算番号</label>
				<span class="mark_equired">必須</span>
				<input type="text" class="form-control digit13" autocomplete="off" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_ACCG_NO)}" th:field="*{baseNo}">
				<div th:if="*{#fields.hasErrors('baseNo')}" th:errors="*{baseNo}" class="error_mag_point digit8">error</div>
			</div>
		</div>
	</form>
	<div class="text-right mb-2 pr-3">
		<button type="button" class="btn btn-info btn-sm saveBaseTitle"><i class="fas fa-check"></i>保存</button>
		<button type="button" class="btn btn-light btn-sm ml-3 closeBaseTitle"><i class="fas fa-times ml-1"></i>閉じる</button>
	</div>
</div>
<!--/* 基本情報_タイトル入力フラグメント end */-->

<!--/* 基本情報_請求先表示フラグメント start */-->
<div th:fragment="baseToViewFragment(baseToViewForm)" id="baseToViewFragment" class="doc_base_inner doc_edit_target" th:object="${baseToViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#baseToViewFragment");
	});
	</script>
	<div class="doc_atena">
		<div class="doc_atena__name">
			<span th:text="*{baseToName}">株式会社山田商事 御中</span>
		</div>
		<div class="doc_atena__to">
			<div myth:nl2br="*{baseToDetail}">〒100-0011 東京都新宿区新宿１－１－１ ご担当者様</div>
		</div>
	</div>
</div>
<!--/* 基本情報_請求先表示フラグメント end */-->

<!--/* 基本情報_請求先入力フラグメント start */-->
<div th:fragment="baseToInputFragment(baseToInputForm)" id="baseToInputFragment" class="doc_base_inner" th:object="${baseToInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#baseToInputFragment");
		
		const baseToInputFragment = $('#baseToInputFragment');
		
		<!--/* 発行先を変更する処理 */-->
		baseToInputFragment.on("click", ".changeAtena", function() {
			$('.changeAtena').addClass('hidden');
			$('.noChangeAtena').removeClass('hidden');
			$('.changeAtenaList').removeClass('hidden');
			$('.selectAtena').prop('disabled', false);
		});
		
		<!--/* 発行先を変更しない処理 */-->
		baseToInputFragment.on("click", ".noChangeAtena", function() {
			$('.changeAtena').removeClass('hidden');
			$('.noChangeAtena').addClass('hidden');
			$('.changeAtenaList').addClass('hidden');
			$('.selectAtena').prop('disabled', true);
		});
		
		<!--/* 発行先変更処理 */-->
		baseToInputFragment.on("change", ".selectAtena", function() {
			const personId = $(this).val();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve(personId)
				.then(renderBaseToNameAndDetail)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 基本情報_請求先入力フラグメント保存処理 */-->
		baseToInputFragment.on("click", ".saveBaseTo", function() {
			
			<!--/* リクエストパラメータ */-->
			const formData = $('#baseToInputForm').serializeArray();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve(formData)
				.then(saveBaseToFunc)
				.then(renderBaseToViewFragment)
				.then(renderBankDetailViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 基本情報_請求先フラグメント閉じる処理 */-->
		baseToInputFragment.on("click", ".closeBaseTo", function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(renderBaseToViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<form id="baseToInputForm">
		<input type="hidden" th:field="*{ankenId}">
		<input type="hidden" th:field="*{ankenName}">
		<input type="hidden" th:field="*{billToPersonName}">
		<input type="hidden" th:field="*{billToPersonId}">
		<div class="select_person_title">選択中の名簿</div>
		<div class="mb-2">
			<div>
				<label class="side_parts_label">案件名：</label><span th:text="*{#strings.isEmpty(ankenName)} ? '(案件名未入力)' : *{ankenName}">残業代請求事件</span>
			</div>
			<div>
				<label class="side_parts_label">名簿：</label><span th:text="*{billToPersonName}">山田　太郎</span><span class="sub_text" th:text="| (名-*{billToPersonId})|">（#5）</span>
			</div>
			<div class="text-right">
				<a href="javascript:void(0);" class="changeAtena">発行先を変更する</a>
				<a href="javascript:void(0);" class="noChangeAtena hidden">発行先を変更しない</a>
			</div>
			<div class="changeAtenaList mt-2 mb-3 hidden">
				<select class="form-control selectAtena" disabled th:field="*{changeBillToPersonId}">
					<option th:each="customerKanyosha : *{customerKanyoshaList}"
						th:text="${customerKanyosha.getName()}" th:value="${customerKanyosha.getId()}">
					</option>
				</select>
			</div>
		</div>
		
		<!--/* 帳票表示 */-->
		<div class="select_person_title">帳票上の表示</div>
		<div class="mb-2">
			<label class="top_label">名称</label>
			<div class="d-flex">
				<div class="flex-fill pr-3">
					<input type="text" class="form-control baseToName" autocomplete="off" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_TO_NAME)}" th:field="*{baseToName}">
				</div>
				<div th:if="*{#fields.hasErrors('baseToName')}" th:errors="*{baseToName}" class="error_mag_point">error</div>
				<div class="digit5">
					<select class="form-control baseToNameEnd" th:field="*{baseToNameEnd}">
						<option th:each="nameEnd : ${T(jp.loioz.common.constant.CommonConstant$NameEnd).values()}" 
							th:label="${nameEnd.getVal()}" th:text="${nameEnd.getVal()}" th:value="${nameEnd.getCd()}">
						</option>
					</select>
				</div>
			</div>
		</div>
		<div class="mb-3">
			<label class="top_label">詳細</label>
			<div>
				<textarea rows="5" class="form-control w-100 baseToDetail" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_TO_DETAIL)}" th:field="*{baseToDetail}">〒100-0011 東京都新宿区新宿１－１－１ ご担当者様</textarea>
			</div>
			<div th:if="*{#fields.hasErrors('baseToDetail')}" th:errors="*{baseToDetail}" class="error_mag_point">error</div>
		</div>
		<div class="text-right mb-2">
			<button type="button" class="btn btn-info btn-sm saveBaseTo"><i class="fas fa-check"></i>保存</button>
			<button type="button" class="btn btn-light btn-sm ml-3 closeBaseTo"><i class="fas fa-times ml-1"></i>閉じる</button>
		</div>
	</form>
</div>
<!--/* 基本情報_請求先入力フラグメント end */-->

<!--/* 基本情報_請求元表示フラグメント start */-->
<div th:fragment="baseFromViewFragment(baseFromViewForm)" id="baseFromViewFragment" class="doc_base_inner doc_edit_target" th:object="${baseFromViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#baseFromViewFragment");
	});
	</script>
	<div>
		<div class="office_name" th:text="*{baseFromOfficeName}">ロイオズ法律事務所</div>
		<div class="office_address" myth:nl2br="*{baseFromDetail}">〒163-0246 東京都新宿区新宿1-1-1 XXXXXXビル7階</div>
		<div class="mt-2">
	<!--/* 印影画像を表示する */-->
	<th:block th:if="*{isTenantStampPrintView()}">
			<span class="fs14">
				<i class="fas fa-check-square text-primary mr-2"></i>印影画像を表示する
			</span>
	</th:block>
	<!--/* 印影画像を表示しない */-->
	<th:block th:unless="*{isTenantStampPrintView()}">
			<span class="fs14 fc_disabled">
				(印影画像を表示しない)
			</span>
	</th:block>
		</div>
	</div>
</div>
<!--/* 基本情報_請求元表示フラグメント end */-->

<!--/* 基本情報_請求元入力フラグメント start */-->
<div th:fragment="baseFromInputFragment(baseFromInputForm)" id="baseFromInputFragment" class="doc_base_inner" th:object="${baseFromInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#baseFromInputFragment");
		
		const baseFromInputFragment = $('#baseFromInputFragment');
		
		<!--/* 請求元入力フラグメント保存処理 */-->
		baseFromInputFragment.on("click", ".saveBaseFrom", function() {
			
			<!--/* リクエストパラメータ */-->
			const formData = $('#baseFromInputForm').serializeArray();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve(formData)
				.then(saveBaseFromFunc)
				.then(renderBaseFromViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 請求元フラグメント閉じる処理 */-->
		baseFromInputFragment.on("click", ".closeBaseFrom", function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(renderBaseFromViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<form id="baseFromInputForm">
		<div class="select_person_title">差出人表記</div>
		<div class="form-row">
			<div class="form-group col-md-12">
				<label class="top_label">事務所名</label>
				<input type="text" class="form-control" th:field="*{baseFromOfficeName}" autocomplete="off" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_FROM_OFFICE_NAME)}">
			</div>
			<div th:if="*{#fields.hasErrors('baseFromOfficeName')}" th:errors="*{baseFromOfficeName}" class="error_mag_point">error</div>
		</div>
		<div class="form-row">
			<div class="form-group col-md-12">
				<textarea rows="5" class="form-control w-100 minh150" th:field="*{baseFromDetail}" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_FROM_DETAIL)}">弁護士 弁護 一郎 〒163-0246 東京都新宿区新宿1-1-1 XXXXXXビル7階 電話：03-6821-1182 FAX：03-6821-1184 登録番号：T01234567810</textarea>
			</div>
			<div th:if="*{#fields.hasErrors('baseFromDetail')}" th:errors="*{baseFromDetail}" class="error_mag_point">error</div>
		</div>
		<div class="form-row">
			<div class="form-group col-md-12">
				<label class="top_label">印影画像</label>
				<div>
					<label class="check_area checkbox_btn">
						<input type="checkbox" class="checkbox_input" th:field="*{tenantStampPrintFlg}">
						<span class="checkbox_txt">表示する</span>
					</label>
				</div>
			</div>
		</div>
		<div class="text-right mb-2">
			<button type="button" class="btn btn-info btn-sm saveBaseFrom"><i class="fas fa-check"></i>保存</button>
			<button type="button" class="btn btn-light btn-sm ml-3 closeBaseFrom"><i class="fas fa-times ml-1"></i>閉じる</button>
		</div>
	</form>
</div>
<!--/* 基本情報_請求元入力フラグメント end */-->

<!--/* 基本情報_挿入文表示フラグメント start */-->
<div th:fragment="baseOtherViewFragment(baseOtherViewForm)" id="baseOtherViewFragment" class="doc_base_inner doc_edit_target" th:object="${baseOtherViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#baseOtherViewFragment");
	});
	</script>
	<div class="row">
		<div class="col-6">
			<div class="mb-2">
				<label class="doc_label">挿入文</label>
				<div class="doc_value" th:classappend="*{#strings.isEmpty(subText)} ? 'fc_disabled fs14' "
					th:text="*{#strings.isEmpty(subText)} ? '(未設定)' : *{subText}">
				</div>
			</div>
			<div class="mb-2">
				<label class="doc_label">件名</label>
				<div class="doc_value" th:classappend="*{#strings.isEmpty(title)} ? 'fc_disabled fs14' "
				 	th:text="*{#strings.isEmpty(title)} ? '(未設定)' : *{title}">
				 </div>
			</div>
		</div>
		<div class="col-6 pl-4">
			<div th:if="*{accgDocType?.isInvoice()}">
				<label class="doc_label">お支払期限</label>
				<div class="doc_value">
					<!--/* 支払期限 */-->
					<span class="mr-3" th:classappend="*{#strings.isEmpty(deadline)} ? 'fc_disabled fs14' "
						th:text="*{#strings.isEmpty(deadline)} ? '(未設定)' : *{getDeadlineFormat()}"></span>
	<!--/* 帳票に印字する */-->
	<th:block th:if="*{isDueDatePrintView()}">
						<span class="fs14">
							<i class="fas fa-check-square text-primary mr-2"></i>支払期限を印字する
						</span>
	</th:block>
	<!--/* 帳票に印字しない */-->
	<th:block th:unless="*{isDueDatePrintView()}">
						<span class="fs14 fc_disabled">
							(支払期限を印字しない)
						</span>
	</th:block>
				</div>
			</div>
			<div th:if="*{accgDocType?.isStatement()}">
				<label class="doc_label">ご返金期限</label>
				<div class="doc_value">
					<!--/* 支払期限 */-->
					<span class="mr-3" th:classappend="*{#strings.isEmpty(deadline)} ? 'fc_disabled fs14' "
						th:text="*{#strings.isEmpty(deadline)} ? '(未設定)' : *{getDeadlineFormat()}"></span>
	<!--/* 帳票に印字する */-->
	<th:block th:if="*{isRefundDatePrintView()}">
						<span class="fs14">
							<i class="fas fa-check-square text-primary mr-2"></i>返金期限を印字する
						</span>
	</th:block>
	<!--/* 帳票に印字しない */-->
	<th:block th:unless="*{isRefundDatePrintView()}">
						<span class="fs14 fc_disabled">
							(返金期限を印字しない)
						</span>
	</th:block>
				</div>
			</div>
		</div>
	</div>
</div>
<!--/* 基本情報_挿入文表示フラグメント end */-->

<!--/* 基本情報_挿入文入力フラグメント start */-->
<div th:fragment="baseOtherInputFragment(baseOtherInputForm)" id="baseOtherInputFragment" class="doc_base_inner" th:object="${baseOtherInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#baseOtherInputFragment");
		
		const baseOtherInputFragment = $('#baseOtherInputFragment');
		
		<!--/* 基本情報_挿入文入力フラグメント保存処理 */-->
		baseOtherInputFragment.on("click", ".saveBaseOther", function() {
			
			<!--/* リクエストパラメータ */-->
			const formData = $('#baseOtherInputForm').serializeArray();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve(formData)
				.then(saveBaseOtherFunc)
				.then(renderBaseOtherViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 基本情報_挿入文フラグメント閉じる処理 */-->
		baseOtherInputFragment.on("click", ".closeBaseOther", function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(renderBaseOtherViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<!--/* 挿入文（件名の上部） */-->
	<form id="baseOtherInputForm">
		<div class="form-row">
			<div class="form-group col-md-6 pr-4">
				<label class="top_label">挿入文</label>
				<input type="text" class="form-control" th:field="*{subText}" autocomplete="off" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_SUB_TEXT)}"
					th:placeholder="*{accgDocType.isInvoice()} ? '例）下記の通り、ご請求申し上げます。' : '例）下記の通り、ご精算申し上げます。'">
			</div>
			<div th:if="*{#fields.hasErrors('subText')}" th:errors="*{subText}" class="error_mag_point digit8">error</div>
			<!--/* 件名 */-->
			<div class="form-group col-md-6 pl-4">
				<label th:if="*{accgDocType.isInvoice()}" class="top_label">お支払期限</label>
				<label th:if="*{accgDocType.isStatement()}" class="top_label">ご返金期限</label>
				<div class="d-flex align-items-center">
					<input type="text" class="form-control digit8 inputDateSlash inputDate" autocomplete="off" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_DATE)}"
						th:field="*{deadline}" data-click-sync="[data-target-name='deadline']">
					<button type="button" class="btn btn_popcal hidden" data-toggle="datepicker" data-target-name="deadline">カレンダー</button>
					<label class="check_area checkbox_btn ml-3">
						<input type="checkbox" class="checkbox_input" th:field="*{deadLinePrintFlg}">
						<span th:if="*{accgDocType.isInvoice()}" class="checkbox_txt fs12">支払期限を帳票に印字する</span>
						<span th:if="*{accgDocType.isStatement()}" class="checkbox_txt fs12">返金期限を帳票に印字する</span>
					</label>
				</div>
				<div th:if="*{#fields.hasErrors('deadline')}" th:errors="*{deadline}" class="error_mag_point digit8">error</div>
			</div>
			<!--/* タイトル */-->
			<div class="form-group col-md-6 pr-4">
				<label class="top_label">件名</label>
				<input type="text" class="form-control" th:field="*{title}" autocomplete="off" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_SUBJECT)}">
			</div>
			<div th:if="*{#fields.hasErrors('title')}" th:errors="*{title}" class="error_mag_point digit8">error</div>
		</div>
	</form>
	<div class="text-right">
		<button type="button" class="btn btn-info btn-sm saveBaseOther"><i class="fas fa-check"></i>保存</button>
		<button type="button" class="btn btn-light btn-sm ml-3 closeBaseOther"><i class="fas fa-times ml-1"></i>閉じる</button>
	</div>
</div>
<!--/* 基本情報_挿入文入力フラグメント end */-->

<!--/* 既入金表示フラグメント start */-->
<div th:fragment="repayViewFragment(repayViewForm)" id="repayViewFragment" class="doc_view p-0" th:object="${repayViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#repayViewFragment");
		
		const repayViewFragment = $('#repayViewFragment');
		
		<!--/* 既入金入力フラグメント表示 */-->
		repayViewFragment.on("click", ".docRepayEdit", function() {
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(() => renderAccgDocSummaryViewFragment())
				.then(() => renderRepayInputFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	
	<table class="table table-sm table_fixed doc_invoice_table doc_type1 table-striped mb-0 docRepayEdit">
		<thead>
			<tr>
				<th class="col_15">日付</th>
				<th class="col_60">内容</th>
				<th class="col_20 text-right">金額</th>
			</tr>
		</thead>
		<tbody>
			<th:block th:each="repayRow : *{repayRowList}">
				<tr th:insert="::repayRowViewFragment(${repayRow})"></tr>
			</th:block>
			<th:block th:if="*{#lists.isEmpty(repayRowList)}">
				<tr>
					<td colspan="3" class="no_seleted border-0">
						<span>精算する預り金を選択します。</span>
					</td>
				</tr>
			</th:block>
		</tbody>
		<th:block th:unless="*{#lists.isEmpty(repayRowList)}">
			<tfoot>
				<tr>
					<th class="pb-2" colspan="2">合計</th>
					<td class="pb-2 fs15 fw600 fc_sub" th:text="*{totalRepayAmount}">1,500,000</td>
				</tr>
			</tfoot>
		</th:block>
	</table>
</div>
<!--/* 既入金表示フラグメント end */-->

<!--/* 既入金1行表示フラグメント start */-->
<th:block th:fragment="repayRowViewFragment(repayRow)" th:object="${repayRow}">
	<td th:text="${repayRow.getRepayTransactionDateFormat()}">12月10日</td>
	<td>
		<span th:text="${repayRow.repayItemName}">預り金</span>
		<div class="fc_sub fs12" th:text="${repayRow.sumText}">〇〇〇の解決金</div>
	</td>
	<td class="hidden">
		<th:block th:each="depositRecvSeq : ${repayRow.depositRecvSeqList}">
			<!--/* 紐づく預り金SEQ */-->
			<input type="hidden" class="depositRecvSeq" th:value="${depositRecvSeq}">
		</th:block>
	</td>
	<td class="text-right fs15" th:text="${repayRow.repayAmount}"></td>
</th:block>
<!--/* 既入金1行表示フラグメント end */-->

<!--/* 既入金入力フラグメント start */-->
<div th:fragment="repayInputFragment(repayInputForm)" id="repayInputFragment" class="doc_view_edit p-4 docInvoiceDeposit" th:object="${repayInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#repayInputFragment");
		
		const repayInputFragment = $('#repayInputFragment');
		
		$(".transactionDate").datepicker();
		
		<!--/* 表示項目をまとめる */-->
		repayInputFragment.on('change', '.updateRepaySumFlg', function(e) {
			<!--/* 表示している項目が無い場合は処理終了 */-->
			const displayRepayRowCount = $('.repayRow').filter(':visible').length;
			if (displayRepayRowCount === 0) {
				return;
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			<!--/* ソート順を振り直す */-->
			renumberDocRepayOrder();
			
			<!--/* 金額のカンマを除去する */-->
			invoiceDetailUnformatComma();
			
			<!--/* リクエストパラメータを取得するためにdisabled解除 */-->
			repayInputFormUnDesabledItem();
			
			<!--/* リクエストパラメータ */-->
			const formData = $('#repayInputForm').serializeArray();
			
			<!--/* 金額のdisabled設定 */-->
			invoiceDetailDesabledAmount();
			
			<!--/* 既入金入力項目のdisabled設定 */-->
			repayInputFormDesabledItem();
			
			Promise.resolve(formData)
				.then(groupOrUngroupSimilarRepayItemsFunc)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 項目入力検索 */-->
		repayInputFragment.on('focus change keydown paste cut', '.searchItemName', function(e) {
			$('[data-toggle="tooltip"]').tooltip('hide');
			const index = $(this).data("index");
			const depositType = /*[[${T(jp.loioz.common.constant.CommonConstant$DepositType).NYUKIN.cd}]]*/ '';
			<!--/* 既入金の場合は、入金項目の候補を表示する */-->
			timeoutId = lazyQueueFn(searchRepayDepositRecvItemName, {"clearQueueId":timeoutId}, index, depositType, e.which);
		});
		
		<!--/* 既入金入力フラグメントの削除ボタン押下処理 */-->
		repayInputFragment.on("click", ".deleteRepayRow", function() {
			<!--/* 既入金入力フラグメント削除処理 */-->
			deleteRepayRow(this);
		});
		
		<!--/* 既入金入力フラグメント削除処理 */-->
		function deleteRepayRow(obj) {
			<!--/* 表示チェックボックスを外す */-->
			$(obj).closest('.repayRow').find('.displayFlg').prop('checked', false);
			
			<!--/* まとめ表示している行の場合、非表示にしている個々の既入金情報も削除する */-->
			if ($(obj).closest('.repayRow').find('.rowRepaySumFlg').prop('checked')) {
				$('.repayRow').map(function() {
					if ($(this).find('.addFlg').prop('checked')) {
						<!--/* 新規作成しようとしていた既入金を削除する場合はDOM削除 */-->
						$(this).remove();
					} else {
						<!--/* 削除チェックボックスにチェックをつける */-->
						$(this).find('.deleteFlg').prop('checked', true);
						<!--/* 対象の1行分のフラグメントを非表示にする */-->
						$(this).addClass('hidden');
						<!--/* 非表示にする行の日付、摘要をValidationチェックにかからないように変更 */-->
						$(this).find('.transactionDate').val('');
						$(this).find('.sumText').val('');
					}
				})
			} else {
				<!--/* まとめ表示していない行の場合 */-->
				if ($(obj).closest('.repayRow').find('.addFlg').prop('checked')) {
					<!--/* 新規作成しようとしていた既入金を削除する場合はDOM削除 */-->
					$(obj).closest('.repayRow').remove();
				} else {
					<!--/* 削除チェックボックスにチェックをつける */-->
					$(obj).closest('.repayRow').find('.deleteFlg').prop('checked', true);
					<!--/* 対象の1行分のフラグメントを非表示にする */-->
					$(obj).closest('.repayRow').addClass('hidden');
					<!--/* 非表示にする行の日付、摘要をValidationチェックにかからないように変更 */-->
					$(obj).closest('.repayRow').find('.transactionDate').val('');
					$(obj).closest('.repayRow').find('.sumText').val('');
				}
			}
		}
		
		<!--/* 既入金入力フラグメント保存処理 */-->
		repayInputFragment.on("click", ".saveRepay", function() {
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			<!--/* ソート順を振り直す */-->
			renumberDocRepayOrder();
			
			<!--/* 金額のカンマを除去する */-->
			invoiceDetailUnformatComma();
			
			<!--/* リクエストパラメータを取得するためにdisabled解除 */-->
			repayInputFormUnDesabledItem();
			
			<!--/* リクエストパラメータ */-->
			const formData = $('#repayInputForm').serializeArray();
			
			<!--/* 金額のdisabled設定 */-->
			invoiceDetailDesabledAmount();
			
			<!--/* 既入金入力項目のdisabled設定 */-->
			repayInputFormDesabledItem();
			
			Promise.resolve(formData)
				.then(checkInvoiceAmountChangeRepayFunc)
				.then(saveRepayFunc)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 既入金入力フラグメント閉じる処理 */-->
		repayInputFragment.on("click", ".closeRepay", function() {
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(renderRepayViewFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 預り金管理から追加リンク押下 */-->
		repayInputFragment.on("click", ".addSelectDepositRow", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			
			const ankenId = $(this).data("ankenId");
			const personId = $(this).data("personId");
			const accgDocSeq = $(this).data("accgDocSeq");
			const depositType = /*[[${T(jp.loioz.common.constant.CommonConstant$DepositType).NYUKIN.cd}]]*/ '';
			
			Promise.resolve()
				.then(() => createAccgInvoiceStatementDepositRecvSelectModal(ankenId, personId, accgDocSeq, depositType))
				.then(() => $("#accgInvoiceStatementDepositRecvSelectModal").modal("show"))
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 一覧の並べ替え定義 */-->
		$('.repayUl').sortable({
			handle: '.sortableObj',
		});
		
	});
	</script>
	
	<!--/* 既入金項目 */-->
	<form id="repayInputForm">
		<input type="hidden" class="accgDocSeq" th:field="*{accgDocSeq}">
		<input type="hidden" class="ankenId" th:field="*{ankenId}">
		<input type="hidden" class="personId" th:field="*{personId}">
		<input type="hidden" class="docRepaySeqWhenSummed" th:field="*{docRepaySeqWhenSummed}">
		<div class="doc_detail_list_option">
			<div class="doc_detail_list_option__parts">
				<label class="check_area checkbox_btn">
					<input type="checkbox" class="checkbox_input" th:field="*{repayTransactionDatePrintFlg}">
					<span class="checkbox_txt">請求書に日付を印字する</span>
				</label>
			</div>
			<div class="doc_detail_list_option__parts">
				<label class="check_area checkbox_btn">
					<input type="checkbox" class="checkbox_input repaySumFlg updateRepaySumFlg" th:field="*{repaySumFlg}">
					<span class="checkbox_txt">表示項目をまとめる</span>
				</label>
			</div>
		</div>
		<div>
			<div class="doc_detail_list_head">
				<div class="doc_grip_vertical">&thinsp;</div>
				<div class="doc_data_date">日付</div>
				<div class="doc_data_contetns">内容</div>
				<div class="doc_data_amount">金額</div>
				<div class="doc_data_type">種類</div>
				<div class="doc_data_action">操作</div>
			</div>
			<div>
				<ul class="doc_detail_list repayUl">
					<th:block th:if="*{#lists.isEmpty(repayRowList)}">
						<li class="py-0 repayNoData">
							<div class="doc_row_no_data pl-4">
								<span>精算する預り金を選択します。</span>
							</div>
						</li>
					</th:block>
					
					<li th:id="|repayRow_${stat.index}|" class="repayRow" th:each="rowData, stat : *{repayRowList}" th:classappend="*{repayRowList[__${stat.index}__].displayFlg == false}? 'hidden' : ''">
						<input type="hidden" class="docRepaySeq" th:field="*{repayRowList[__${stat.index}__].docRepaySeq}">
						<input type="hidden" class="accgDocSeq" th:field="*{repayRowList[__${stat.index}__].accgDocSeq}">
						<input type="hidden" class="docRepayOrder" th:field="*{repayRowList[__${stat.index}__].docRepayOrder}">
						<input type="hidden" class="index" th:field="*{repayRowList[__${stat.index}__].repayRowCount}">
						<th:block th:each="depositRecvSeq, depositRecvSeqIndex : *{repayRowList[__${stat.index}__].depositRecvSeqList}">
							<!--/* 紐づく預り金SEQ */-->
							<input type="hidden" class="depositRecvSeq" th:field="*{repayRowList[__${stat.index}__].depositRecvSeqList[__${depositRecvSeqIndex.index}__]}">
						</th:block>
						<div class="doc_row_data docRowData">
							<div class="doc_grip_vertical p-0">
								<!--/* 並び替え用マーク */-->
								<div class="stop-events sortableObjWrap move_point justify-content-center sortableObj">
									<span class="btn btn-light btn_icon_only move_point_btn">
										<i class="fas fa-grip-vertical"></i>
									</span>
								</div>
							</div>
							<div class="doc_data_date">
								<!--/* 日付 */-->
								<input type="text" class="form-control modal_date digit7 inputDateSlash transactionDate" autocomplete="off"
									th:field="*{repayRowList[__${stat.index}__].repayTransactionDate}">
								<div th:if="${#fields.hasErrors('*{repayRowList[__${stat.index}__].repayTransactionDate}')}" th:errors="*{repayRowList[__${stat.index}__].repayTransactionDate}" class="error_mag_point">error</div>
							</div>
							<div class="doc_data_contetns">
								<div class="mb-1">
									<!--/* 項目 */-->
									<input type="text" class="form-control searchItemName repayInputItem repayItemName" maxlength="30" placeholder="項目" autocomplete="off" th:data-index="${stat.index}"
										th:field="*{repayRowList[__${stat.index}__].repayItemName}" th:disabled="*{repayRowList[__${stat.index}__].depositMadeFromAccgDocFlg}">
									<div th:id="|repayItemNameListFragment_${stat.index}|" class="itemNameListFragmentWrap">
										<!--/* 初期状態は空のまま */-->
									</div>
									<div th:if="${#fields.hasErrors('*{repayRowList[__${stat.index}__].repayItemName}')}" th:errors="*{repayRowList[__${stat.index}__].repayItemName}" class="error_mag_point">error</div>
								</div>
								<div class="mb-1">
									<!--/* 摘要 */-->
									<input type="text" class="form-control sumText" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_SUM_TEXT)}"
										placeholder="摘要" autocomplete="off" th:field="*{repayRowList[__${stat.index}__].sumText}">
									<div th:if="${#fields.hasErrors('*{repayRowList[__${stat.index}__].sumText}')}" th:errors="*{repayRowList[__${stat.index}__].sumText}" class="error_mag_point">error</div>
								</div>
							</div>
							<div class="doc_data_amount">
								<!--/* 金額 */-->
								<input type="text" class="form-control text-right commaFormat inputNumHyphen amount repayInputItem fs15" maxlength="9" autocomplete="off"
									th:field="*{repayRowList[__${stat.index}__].repayAmount}" th:disabled="*{repaySumFlg} or *{repayRowList[__${stat.index}__].depositMadeFromAccgDocFlg}">
								<div th:if="${#fields.hasErrors('*{repayRowList[__${stat.index}__].repayAmount}')}" th:errors="*{repayRowList[__${stat.index}__].repayAmount}" class="error_mag_point">error</div>
							</div>
							<div class="doc_data_type">
								<!--/* 種類 */-->
								<!--/* ※現状、選択肢はひとつしかないので、すべてのケースで編集不可とする */-->
								<select class="form-control depositSumTargetSelectBox repayInputItem" disabled>
									<option value="1" selected="selected">返金</option>
								</select>
							</div>
							<div class="doc_data_action">
								<a href="javascript:void(0);" class="btn btn-light btn_icon_only deleteRepayRow">
									<i class="fas fa-times"></i>
								</a>
								<input type="checkbox" class="checkbox_input deleteFlg" th:field="*{repayRowList[__${stat.index}__].deleteFlg}">
								<input type="checkbox" class="checkbox_input addFlg" th:field="*{repayRowList[__${stat.index}__].addFlg}">
								<input type="checkbox" class="checkbox_input rowRepaySumFlg" th:field="*{repayRowList[__${stat.index}__].rowRepaySumFlg}">
								<input type="checkbox" class="checkbox_input depositMadeFromAccgDocFlg" th:field="*{repayRowList[__${stat.index}__].depositMadeFromAccgDocFlg}">
								<input type="checkbox" class="checkbox_input displayFlg" th:field="*{repayRowList[__${stat.index}__].displayFlg}">
							</div>
						</div>
					</li>
				</ul>
			</div>
			<div th:if="${#fields.hasErrors('*{repayRowList}')}" th:errors="*{repayRowList}" class="error_mag_point">error</div>
		</div>
		<div class="add_description">
			<div>
				<a href="javascript:void(0);" class="addSelectDepositRow" th:data-anken-id="*{ankenId}" th:data-person-id="*{personId}" th:data-accg-doc-seq="*{accgDocSeq}">
					<i class="fas fa-search mr-2"></i>未精算の預り金を選択
				</a>
			</div>
		</div>
		<div class="text-right mt-3">
			<button type="button" class="btn btn-danger btn-sm saveRepay"><i class="fas fa-check"></i>保存</button>
			<button type="button" class="btn btn-light btn-sm ml-3 closeRepay"><i class="fas fa-times ml-1"></i>閉じる</button>
		</div>
	</form>
</div>
<!--/* 既入金入力フラグメント end */-->

<!--/* 既入金入力リストフラグメント start */-->
<th:block th:fragment="repayInputListFragment" th:object="${repayInputList}">
	<th:block th:each="rowInput : ${repayInputList}">
		<li th:replace="common/accg/accgInvoiceStatementFragment::repayRowInputFragment(${rowInput})"></li>
	</th:block>
</th:block>
<!--/* 既入金入力リストフラグメント end */-->

<!--/* 既入金入力（1行）追加フラグメント start */-->
<li th:fragment="repayRowInputFragment(repayRowInputForm)" th:id="|repayRow_${repayRowCount}|" class="repayRow" th:object="${repayRowInputForm}" th:with="repayRowCount=${repayRowInputForm.repayRowCount}" th:classappend="${repayRowInputForm.displayFlg == false}? 'hidden' : ''">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#repayRow_" + /*[[ ${repayRowCount} ]]*/);
		
		$(".transactionDate").datepicker();
		
		const repayRowInputFragment = $("#repayRow_" + /*[[ ${repayRowCount} ]]*/);
		
	});
	</script>
	
	<input type="hidden" class="docRepaySeq" th:id="|repayRowList${repayRowCount}.docRepaySeq|" th:name="|repayRowList[${repayRowCount}].docRepaySeq|" th:value="*{docRepaySeq}">
	<input type="hidden" class="accgDocSeq" th:id="|repayRowList${repayRowCount}.accgDocSeq|" th:name="|repayRowList[${repayRowCount}].accgDocSeq|" th:value="*{accgDocSeq}">
	<input type="hidden" class="docRepayOrder" th:id="|repayRowList${repayRowCount}.docRepayOrder|" th:name="|repayRowList[${repayRowCount}].docRepayOrder|" th:value="*{docRepayOrder}">
	<input type="hidden" class="index" th:id="|repayRowList${repayRowCount}.repayRowCount|" th:name="|repayRowList[${repayRowCount}].repayRowCount|" th:value="${repayRowCount}">
	<th:block th:each="depositRecvSeq, depositRecvSeqIndex : *{depositRecvSeqList}">
		<!--/* 紐づく預り金SEQ */-->
		<input type="hidden" class="depositRecvSeq" th:id="|repayRowList${repayRowCount}.depositRecvSeqList${depositRecvSeqIndex.index}|" th:name="|repayRowList[${repayRowCount}].depositRecvSeqList[${depositRecvSeqIndex.index}]|" th:value="${depositRecvSeq}">
	</th:block>
	<div class="doc_row_data docRowData">
		<div class="doc_grip_vertical p-0">
			<!--/* 並び替え用マーク */-->
			<div class="stop-events sortableObjWrap move_point justify-content-center sortableObj">
				<span class="btn btn-light btn_icon_only move_point_btn">
					<i class="fas fa-grip-vertical"></i>
				</span>
			</div>
		</div>
		<div class="doc_data_date">
			<!--/* 日付 */-->
			<input type="text" class="form-control modal_date digit7 inputDateSlash transactionDate" autocomplete="off"
				th:id="|repayRowList${repayRowCount}.transactionDate|" th:name="|repayRowList[${repayRowCount}].repayTransactionDate|" th:value="*{repayTransactionDate}">
		</div>
		<div class="doc_data_contetns">
			<div class="mb-1">
				<!--/* 項目 */-->
				<input type="text" class="form-control searchItemName repayInputItem repayItemName" maxlength="30" placeholder="項目" autocomplete="off" th:data-index="${repayRowCount}"
					th:id="|repayRowList${repayRowCount}.ItemName|" th:name="|repayRowList[${repayRowCount}].repayItemName|" th:value="*{repayItemName}" th:disabled="*{depositMadeFromAccgDocFlg}">
				<div th:id="|repayItemNameListFragment_${repayRowCount}|" class="itemNameListFragmentWrap">
					<!--/* 初期状態は空のまま */-->
				</div>
			</div>
			<div class="mb-1">
				<!--/* 摘要 */-->
				<input type="text" class="form-control sumText" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_SUM_TEXT)}" placeholder="摘要" autocomplete="off"
					th:id="|repayRowList${repayRowCount}.sumText|" th:name="|repayRowList[${repayRowCount}].sumText|" th:value="*{sumText}">
			</div>
		</div>
		<div class="doc_data_amount">
			<!--/* 金額 */-->
			<input type="text" class="form-control text-right commaFormat inputNumHyphen amount repayInputItem fs15" maxlength="9" autocomplete="off"
				th:id="|repayRowList${repayRowCount}.repayAmount|" th:name="|repayRowList[${repayRowCount}].repayAmount|" th:value="*{repayAmount}" th:disabled="*{rowRepaySumFlg} or *{depositMadeFromAccgDocFlg}">
		</div>
		<div class="doc_data_type">
			<!--/* 種類 */-->
			<!--/* ※現状、選択肢はひとつしかないので、すべてのケースで編集不可とする */-->
			<select class="form-control depositSumTargetSelectBox repayInputItem" disabled>
				<option value="1" selected="selected">返金</option>
			</select>
		</div>
		<div class="doc_data_action">
			<a href="javascript:void(0);" class="btn btn-light btn_icon_only deleteRepayRow">
				<i class="fas fa-times"></i>
			</a>
			<input type="checkbox" class="checkbox_input deleteFlg" th:id="|repayRowList${repayRowCount}.deleteFlg|" th:name="|repayRowList[${repayRowCount}].deleteFlg|" th:checked="*{deleteFlg == true}">
			<input type="checkbox" class="checkbox_input addFlg" th:id="|repayRowList${repayRowCount}.addFlg|" th:name="|repayRowList[${repayRowCount}].addFlg|" th:checked="*{addFlg == true}">
			<input type="checkbox" class="checkbox_input rowRepaySumFlg" th:id="|repayRowList${repayRowCount}.rowRepaySumFlg|" th:name="|repayRowList[${repayRowCount}].rowRepaySumFlg|" th:checked="*{rowRepaySumFlg == true}">
			<input type="checkbox" class="checkbox_input depositMadeFromAccgDocFlg" th:id="|repayRowList${repayRowCount}.depositMadeFromAccgDocFlg|" th:name="|repayRowList[${repayRowCount}].depositMadeFromAccgDocFlg|" th:checked="*{depositMadeFromAccgDocFlg == true}">
			<input type="checkbox" class="checkbox_input displayFlg" th:id="|repayRowList${repayRowCount}.displayFlg|" th:name="|repayRowList[${repayRowCount}].displayFlg|" th:checked="*{displayFlg == true}">
		</div>
	</div>
</li>
<!--/* 既入金入力（1行）追加フラグメント end */-->

<!--/* 請求表示フラグメント start */-->
<div th:fragment="invoiceViewFragment(invoiceViewForm)" id="invoiceViewFragment" class="doc_view p-0" th:object="${invoiceViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#invoiceViewFragment");
		
		const invoiceViewFragment = $('#invoiceViewFragment');
		
		<!--/* 請求入力フラグメント表示 */-->
		invoiceViewFragment.on("click", ".docInvoiceFeeEdit", function() {
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(() => renderAccgDocSummaryViewFragment())
				.then(() => renderInvoiceInputFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	
	<table class="table table-sm table_fixed doc_invoice_table doc_type1 table-striped mb-0 docInvoiceFeeEdit">
		<thead>
			<tr>
				<th class="col_15">日付</th>
				<th class="col_60">内容</th>
				<th class="col_20 text-right">金額</th>
			</tr>
		</thead>
		<tbody>
			<th:block th:each="invoiceRow : *{invoiceRowList}">
				<tr th:insert="::invoiceRowViewFragment(${invoiceRow})"></tr>
			</th:block>
			<th:block th:if="*{#lists.isEmpty(invoiceRowList)}">
				<tr>
					<td colspan="3" class="no_seleted border-0"><span>請求する報酬・預り金・実費を選択します。</span></td>
				</tr>
			</th:block>
		</tbody>
	<th:block th:unless="*{#lists.isEmpty(invoiceRowList)}">
		<tfoot>
			<tr>
				<th class="fw0 pt-3" colspan="2">小計</th>
				<td class="fs15 pt-3" th:text="*{subTotal}">2,150,000</td>
			</tr>
			<tr>
				<th class="fw0" colspan="2">消費税</th>
				<td class="fs15" th:text="*{tax}">215,000</td>
			</tr>
			<tr>
				<th class="fw0" colspan="2">源泉徴収税</th>
				<td class="fs15" th:text="*{withholding}">0</td>
			</tr>
			<tr th:with="addClass=*{isEmptyTarget8() and isEmptyTarget10()} ? 'pb-3' ">
				<th colspan="2" th:class="${addClass}">合計</th>
				<td th:class="|fs15 fw600 fc_sub ${addClass}|" th:text="*{total}">2,365,000</td>
			</tr>
		<th:block th:unless="*{isEmptyTarget10()}">
				<tr>
					<th class="fw0 pr-3" th:classappend="*{isEmptyTarget8()} ? 'pb-3' " colspan="3">
						<div class="row_tax">
							<div class="row_tax__ratio">&lpar;10%対象</div>
							<div class="row_tax__val fs15" th:text="*{target10}">2,150,000</div>
							<div class="row_tax__text">消費税</div>
							<div class="row_tax__val fs15" th:text="|*{target10Tax})|">215,000&rpar;</div>
						</div>
					</th>
				</tr>
		</th:block>
		<th:block th:unless="*{isEmptyTarget8()}">
				<tr>
					<th class="fw0 pr-3" th:classappend="*{(!isEmptyTarget8() and !isEmptyTarget10()) or isEmptyTarget10()} ? 'pb-3'" colspan="3">
						<div class="row_tax">
							<div class="row_tax__ratio">&lpar;8%対象</div>
							<div class="row_tax__val fs15" th:text="*{target8}">2,150,000</div>
							<div class="row_tax__text">消費税</div>
							<div class="row_tax__val fs15" th:text="|*{target8Tax})|">215,000&rpar;</div>
						</div>
					</th>
				</tr>
		</th:block>
		</tfoot>
	</th:block>
	</table>
</div>
<!--/* 請求表示フラグメント end */-->

<!--/* 請求1行表示フラグメント start */-->
<th:block th:fragment="invoiceRowViewFragment(invoiceRow)" th:object="${invoiceRow}">
	<td th:text="${invoiceRow.getTransactionDateFormat()}">12月31日</td>
	<td>
		<span th:text="${invoiceRow.itemName}">着手金</span>
		<div class="fc_sub fs12" th:text="${invoiceRow.sumText}">〇〇〇の着手金</div>
	</td>
	<td class="hidden">
		<th:block th:each="depositRecvSeq : ${invoiceRow.depositRecvSeqList}">
			<!--/* 紐づく預り金SEQ */-->
			<input type="hidden" class="depositRecvSeq" th:value="${depositRecvSeq}">
		</th:block>
	</td>
	<td class="text-right fs15" th:text="${invoiceRow.amount}"></td>
</th:block>
<!--/* 請求1行表示フラグメント end */-->

<!--/* 請求入力フラグメント start */-->
<div th:fragment="invoiceInputFragment(invoiceInputForm)" id="invoiceInputFragment" class="doc_view_edit p-4 docInvoiceFee" th:object="${invoiceInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#invoiceInputFragment");
		
		const invoiceInputFragment = $('#invoiceInputFragment');
		
		$(".transactionDate").datepicker();
		
		<!--/* 各実費をまとめる */-->
		invoiceInputFragment.on('change', '.updateExpenseSumFlg', function(e) {
			<!--/* 表示している項目が無い場合は処理終了 */-->
			const displayInvoiceRowCount = $('.invoiceRow').filter(':visible').length;
			if (displayInvoiceRowCount === 0) {
				return;
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			<!--/* ソート順を振り直す */-->
			renumberDocInvoiceOrder();
			
			<!--/* 金額のカンマを除去する */-->
			invoiceDetailUnformatComma();
			
			<!--/* リクエストパラメータ取得のため金額のdisabled解除 */-->
			invoiceDetailUnDesabledAmount();
			
			<!--/* リクエストパラメータ */-->
			const formData = $('#invoiceInputForm').serializeArray();
			
			<!--/* 金額のdisabled設定 */-->
			invoiceDetailDesabledAmount();
			
			Promise.resolve(formData)
				.then(groupOrUngroupSimilarInvoiceItemsFunc)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 項目入力検索 */-->
		invoiceInputFragment.on('focus change keydown paste cut', '.searchItemName', function(e) {
			$('[data-toggle="tooltip"]').tooltip('hide');
			const index = $(this).data("index");
			const depositRecvFlg = $(this).closest('.invoiceRow').find('.depositRecvFlg').val()
			if (depositRecvFlg === 'true') {
				const invoiceType = $(this).closest('.invoiceRow').find('.invoiceDepositType').val();
				const invoiceTypeAdvanceMoneyCd = /*[[${T(jp.loioz.common.constant.CommonConstant$InvoiceDepositType).EXPENSE.cd}]]*/ '';
				if (invoiceType === invoiceTypeAdvanceMoneyCd) {
					<!--/* 実費の場合は、出金項目の候補を表示する */-->
					const depositType = /*[[${T(jp.loioz.common.constant.CommonConstant$DepositType).SHUKKIN.cd}]]*/ '';
					timeoutId = lazyQueueFn(searchInvoiceDepositRecvItemName, {"clearQueueId":timeoutId}, index, depositType, e.which);
				} else {
					<!--/* 預り金の場合は、入金項目の候補を表示する */-->
					const depositType = /*[[${T(jp.loioz.common.constant.CommonConstant$DepositType).NYUKIN.cd}]]*/ '';
					timeoutId = lazyQueueFn(searchInvoiceDepositRecvItemName, {"clearQueueId":timeoutId}, index, depositType, e.which);
				}
			} else {
				const feeFlg = $(this).closest('.invoiceRow').find('.feeFlg').val()
				if (feeFlg === 'true') {
					<!--/* 報酬の場合は、報酬項目の候補を表示する */-->
					timeoutId = lazyQueueFn(searchFeeItemName, {"clearQueueId":timeoutId}, index, e.which);
				}
			}
		});
		
		<!--/* 金額入力フィールド Enter処理 */-->
		invoiceInputFragment.on('keydown', '.amount', function(e) {
			
			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault();
			
			<!--/* 合計フラグメント再表示 */-->
			renderInvoiceTotalAmountInputFragment();
		});
		
		<!--/* 金額入力フィールド フォーカスアウト処理 */-->
		invoiceInputFragment.on('blur', '.amount', function() {
			<!--/* 合計フラグメント再表示 */-->
			renderInvoiceTotalAmountInputFragment();
		});
		
		<!--/* 消費税セレクトボックス変更処理 */-->
		invoiceInputFragment.on("change", ".taxRateSelect", function() {
			<!--/* 合計フラグメント再表示 */-->
			renderInvoiceTotalAmountInputFragment();
		});
		
		<!--/* 源泉徴収のチェックボックス押下処理 */-->
		invoiceInputFragment.on("change", ".withholdingCheck", function() {
			<!--/* 合計フラグメント再表示 */-->
			renderInvoiceTotalAmountInputFragment();
		});
		
		<!--/* タイムチャージのチェックボックス押下処理 */-->
		invoiceInputFragment.on("change", ".timeChargeCheck", function() {
			const feeTimeChargeFlg = $(this).prop('checked');
			
			if (feeTimeChargeFlg) {
				<!--/* タイムチャージ入力時は、金額を初期化して変更不可にする */-->
				$(this).closest('.invoiceRow').find('.amount').val('')
				$(this).closest('.invoiceRow').find('.amount').prop('disabled', true);
				<!--/* 単価、時間の入力フィールドを表示する */-->
				$(this).closest('.invoiceRow').find('.timeCharge').removeClass('hidden');
			} else {
				<!--/* タイムチャージをやめる時は、金額を変更可能にする */-->
				$(this).closest('.invoiceRow').find('.amount').prop('disabled', false);
				<!--/* 単価、時間を空にする */-->
				$(this).closest('.invoiceRow').find('.timeChargeTanka').val('');
				$(this).closest('.invoiceRow').find('.timeChargeTime').val('');
				<!--/* 単価、時間の入力フィールドを非表示にする */-->
				$(this).closest('.invoiceRow').find('.timeCharge').addClass('hidden');
			}
			<!--/* 合計フラグメント再表示 */-->
			renderInvoiceTotalAmountInputFragment();
		});
		
		<!--/* 請求入力フラグメントの削除ボタン押下処理 */-->
		invoiceInputFragment.on("click", ".deleteInvoiceRow", function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve(this)
				.then(deleteInvoiceRowFunc)
				.then(() => renderInvoiceTotalAmountInputFragment())
				.catch((errorObj) => console.log())
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 請求入力フラグメント1行削除処理（請求項目から登録した報酬以外の場合） */-->
		const deleteInvoiceRowFunc = (obj) => {
			return new Promise((resolve, reject) => {
				<!--/* 表示チェックボックスを外す */-->
				$(obj).closest('.invoiceRow').find('.displayFlg').prop('checked', false);
				
				<!--/* まとめ表示している行の場合、非表示にしている個々の実費情報も削除する */-->
				if ($(obj).closest('.invoiceRow').find('.rowExpenseSumFlg').prop('checked')) {
					const expenseCd = /*[[${T(jp.loioz.common.constant.CommonConstant$InvoiceDepositType).EXPENSE.cd}]]*/ '';
					$('.invoiceRow').map(function() {
						if ($(this).find('.invoiceDepositType').val() == expenseCd && $(this).find('.addFlg').prop('checked')) {
							<!--/* 新規作成しようとしていた実費を削除する場合はDOM削除 */-->
							$(this).remove();
						} else if ($(this).find('.invoiceDepositType').val() == expenseCd) {
							<!--/* 既存の実費には削除チェックボックスにチェックをつける */-->
							$(this).find('.deleteFlg').prop('checked', true);
							<!--/* 対象の1行分のフラグメントを非表示にする */-->
							$(this).addClass('hidden');
							<!--/* 非表示にする行の日付、摘要をValidationチェックにかからないように変更 */-->
							$(this).find('.transactionDate').val('');
							$(this).find('.sumText').val('');
						} else {
							<!--/* なにもしない */-->
						}
					})
				} else {
					<!--/* まとめ表示していない行の場合 */-->
					if ($(obj).closest('.invoiceRow').find('.addFlg').prop('checked')) {
						<!--/* 新規作成しようとしていた請求項目を削除する場合はDOM削除 */-->
						$(obj).closest('.invoiceRow').remove();
					} else {
						<!--/* 削除チェックボックスにチェックをつける */-->
						$(obj).closest('.invoiceRow').find('.deleteFlg').prop('checked', true);
						<!--/* 対象の1行分のフラグメントを非表示にする */-->
						$(obj).closest('.invoiceRow').addClass('hidden');
						<!--/* 非表示にする行の日付、摘要をValidationチェックにかからないように変更 */-->
						$(obj).closest('.invoiceRow').find('.transactionDate').val('');
						$(obj).closest('.invoiceRow').find('.sumText').val('');
					}
				}
				<!--/* 表示している項目が無い場合、データが無いメッセージを表示する */-->
				const displayInvoiceRowCount = $('.invoiceRow').filter(':visible').length;
				if (displayInvoiceRowCount === 0) {
					$(".invoiceNoData").removeClass('hidden');
				}
				
				return resolve();
			});
		}
		
		<!--/* 請求入力フラグメント保存処理 */-->
		invoiceInputFragment.on("click", ".saveInvoice", function() {
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			<!--/* ソート順を振り直す */-->
			renumberDocInvoiceOrder();
			
			<!--/* 金額のカンマを除去する */-->
			invoiceDetailUnformatComma();
			
			<!--/* リクエストパラメータを取得するために金額のdisabled解除 */-->
			invoiceDetailUnDesabledAmount();
			
			<!--/* リクエストパラメータ */-->
			const formData = $('#invoiceInputForm').serializeArray();
			
			<!--/* 金額のdisabled設定 */-->
			invoiceDetailDesabledAmount();
			
			Promise.resolve(formData)
				.then(checkInvoiceAmountChangeInvoiceFunc)
				.then(saveInvoiceFunc)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 請求入力フラグメント閉じる処理 */-->
		invoiceInputFragment.on("click", ".closeInvoice", function() {
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(renderInvoiceViewFragment())
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 報酬の行を追加処理 */-->
		invoiceInputFragment.on("click", ".addFeeRow", function() {
			<!--/* 請求項目の行番号最大値を取得 */-->
			let invoiceRowCount = getMaximumInvoiceRowCount();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(addFeeRow(invoiceRowCount+1))
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 値引きの行を追加処理 */-->
		invoiceInputFragment.on("click", ".addDiscountRow", function() {
			<!--/* 請求項目の行番号最大値を取得 */-->
			let invoiceRowCount = getMaximumInvoiceRowCount();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(addDiscountRow(invoiceRowCount+1))
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* テキストの行を追加処理 */-->
		invoiceInputFragment.on("click", ".addTextRow", function() {
			<!--/* 請求項目の行番号最大値を取得 */-->
			let invoiceRowCount = getMaximumInvoiceRowCount();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(addTextRow(invoiceRowCount+1))
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 請求項目の行番号最大値を取得 */-->
		function getMaximumInvoiceRowCount() {
			let invoiceRowCount = 0;
			$('.invoiceRow').map(function() {
				invoiceRowCount = Math.max($(this).find('.index').val(), invoiceRowCount);
			})
			return invoiceRowCount;
		}
		
		<!--/* 単価、時間入力フィールド Enterでタイムチャージ計算 */-->
		invoiceInputFragment.on('keydown', '.feeTimeChargeInput', function(e) {
			
			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault();
			
			<!--/* 金額のカンマを除去する */-->
			invoiceDetailUnformatComma();
			
			const timeChargeTanka = $(this).closest('.invoiceRow').find('.timeChargeTanka').val();
			const timeChargeTime = $(this).closest('.invoiceRow').find('.timeChargeTime').val();
			let amountInputTypeHtml = $(this).closest('.invoiceRow').find('.amount');
			
			<!--/* タイムチャージの単価、時間の値をチェック */-->
			if (checkTimeChargeTankaTime(timeChargeTanka, timeChargeTime, amountInputTypeHtml)) {
				return;
			}
			
			<!--/* リクエストパラメータ */-->
			const requestParam = {
				'timeChargeTanka' : timeChargeTanka,
				'timeChargeTime' : timeChargeTime,
				'index' : $(this).closest('.invoiceRow').find('.index').val()
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			Promise.resolve(requestParam)
				.then(calculateInputTimeChargeFunc)
				.then(() => renderInvoiceTotalAmountInputFragment())
				.catch((errorObj) => console.log())
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 単価、時間入力フィールド フォーカスアウトでタイムチャージ計算 */-->
		invoiceInputFragment.on('blur', '.feeTimeChargeInput', function() {
			
			<!--/* 金額のカンマを除去する */-->
			invoiceDetailUnformatComma();
			
			const timeChargeTanka = $(this).closest('.invoiceRow').find('.timeChargeTanka').val();
			const timeChargeTime = $(this).closest('.invoiceRow').find('.timeChargeTime').val();
			let amountInputTypeHtml = $(this).closest('.invoiceRow').find('.amount');
			
			<!--/* タイムチャージの単価、時間の値をチェック */-->
			if (checkTimeChargeTankaTime(timeChargeTanka, timeChargeTime, amountInputTypeHtml)) {
				return;
			}
			
			<!--/* リクエストパラメータ */-->
			const requestParam = {
				'timeChargeTanka' : timeChargeTanka,
				'timeChargeTime' : timeChargeTime,
				'index' : $(this).closest('.invoiceRow').find('.index').val()
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			Promise.resolve(requestParam)
				.then(calculateInputTimeChargeFunc)
				.then(() => renderInvoiceTotalAmountInputFragment())
				.catch((errorObj) => console.log())
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 預り金を追加処理 */-->
		invoiceInputFragment.on("click", ".addDepositRecvRow", function() {
			<!--/* 請求項目の行数を取得 */-->
			let invoiceRowCount = getMaximumInvoiceRowCount();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(addDepositRecvRow(invoiceRowCount+1))
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 未精算の報酬を追加リンク押下 */-->
		invoiceInputFragment.on("click", ".addSelectFeeRow", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			
			const ankenId = $(this).data("ankenId");
			const personId = $(this).data("personId");
			const accgDocSeq = $(this).data("accgDocSeq");
			
			Promise.resolve()
				.then(() => createAccgInvoiceStatementUnPaidFeeSelectModal(ankenId, personId, accgDocSeq))
				.then(() => $("#accgInvoiceStatementUnPaidFeeSelectModal").modal("show"))
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 未精算報酬選択モーダルを開く */-->
		function createAccgInvoiceStatementUnPaidFeeSelectModal(ankenId, personId, accgDocSeq) {
			return new Promise((resolve, reject) => {
				const feeSeqArray = $(".feeSeq").map(function(){
					if (!$(this).closest('.invoiceRow').find('.deleteFlg').prop('checked')) {
						return $(this).val();
					}
				}).get();
				
				const param = [
					{name:"ankenId", value:ankenId},
					{name:"personId", value:personId},
					{name:"accgDocSeq", value:accgDocSeq},
					{name:"feeSeqList", value:feeSeqArray}
				];
				$.ajax({
					url : "/common/mvc/accgInvoiceStatementUnPaidFeeSelect/createAccgInvoiceStatementUnPaidFeeSelectModal",
					type : "POST",
					data : param,
					dataType: 'html',
				}).done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* ツールチップを非表示にする */-->
						$('[data-toggle="tooltip"]').tooltip('hide');
						$('.accgInvoiceStatementUnPaidFeeSelectModalFragmentWrap').html(data);
						<!--/* 未精算報酬追加処理をセットアップ */-->
						benzo.global.fragment.accgInvoiceStatementUnPaidFeeSelectModalFragmentObj.setUpObj.unPaidFeeAddAction = (e) => {
							<!--/* 2重押下防止 */-->
							if(ajaxRunning){
								return false;
							}
							ajaxRunning = true;
							
							const unPaidFeeSeqArray = benzo.global.fragment.accgInvoiceStatementUnPaidFeeSelectModalFragmentObj.paramObj.getUnPaidFeeSeqArray();
							
							Promise.resolve()
								.then(() => addUnPaidFee(unPaidFeeSeqArray))
								.then(() => renderInvoiceTotalAmountInputFragment())
								.catch((errorObj) => console.log()) 
								.finally(() => {
									$("#accgInvoiceStatementDepositRecvSelectModal").modal("hide");
									ajaxRunning = false;
								});
						};
						return resolve();
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageFadeOutForJs(errorMsg);
						return reject(errorMsg);
					}
				}).fail(function() {
					showErrorMessageFadeOutForJs(/*[[#{E00059}]]*/ "データの取得に失敗しました。");
					return reject();
				})
			});
		}
		
		<!--/* 預り金管理から追加リンク押下 */-->
		invoiceInputFragment.on("click", ".addSelectDepositRow", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			
			const ankenId = $(this).data("ankenId");
			const personId = $(this).data("personId");
			const accgDocSeq = $(this).data("accgDocSeq");
			const depositType = /*[[${T(jp.loioz.common.constant.CommonConstant$DepositType).SHUKKIN.cd}]]*/ '';
			
			Promise.resolve()
				.then(() => createAccgInvoiceStatementDepositRecvSelectModal(ankenId, personId, accgDocSeq, depositType))
				.then(() => $("#accgInvoiceStatementDepositRecvSelectModal").modal("show"))
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 一覧の並べ替え定義 */-->
		$('.invoiceUl').sortable({
			handle: '.sortableObj',
		});
		
	});
	</script>
	<form id="invoiceInputForm">
		<input type="hidden" class="accgDocSeq" th:field="*{accgDocSeq}">
		<input type="hidden" class="ankenId" th:field="*{ankenId}">
		<input type="hidden" class="personId" th:field="*{personId}">
		<input type="hidden" class="docInvoiceSeqWhenSummed" th:field="*{docInvoiceSeqWhenSummed}">
		<input type="hidden" class="docInvoiceDepositSeqWhenSummed" th:field="*{docInvoiceDepositSeqWhenSummed}">
		<div class="doc_detail_list_option">
			<div class="doc_detail_list_option__parts">
				<label class="check_area checkbox_btn">
					<input type="checkbox" class="checkbox_input " th:field="*{invoiceTransactionDatePrintFlg}">
					<span class="checkbox_txt">請求書に日付を印字する</span>
				</label>
			</div>
			<div class="doc_detail_list_option__parts">
				<label class="check_area checkbox_btn">
					<input type="checkbox" class="checkbox_input expenseSumFlg updateExpenseSumFlg" th:field="*{expenseSumFlg}">
					<span class="checkbox_txt">各実費をまとめる</span>
				</label>
			</div>
		</div>
		<div>
			<div class="doc_detail_list_head">
				<div class="doc_grip_vertical">&thinsp;</div>
				<div class="doc_data_date">日付</div>
				<div class="doc_data_contetns">内容</div>
				<div class="doc_data_amount">金額</div>
				<div class="doc_data_type">種類</div>
				<div class="doc_data_action">操作</div>
			</div>
			<div>
				<ul class="doc_detail_list invoiceUl">
					<th:block th:if="*{#lists.isEmpty(invoiceRowList)}">
						<li class="py-0 invoiceNoData ">
							<div class="doc_row_no_data pl-4">
								<span>請求する報酬・預り金・実費を選択します。</span>
							</div>
						</li>
					</th:block>
					
					<li th:id="|invoiceRow_${stat.index}|" class="invoiceRow" th:each="rowData, stat : *{invoiceRowList}" th:classappend="*{invoiceRowList[__${stat.index}__].displayFlg == false}? 'hidden' : ''">
						<input type="hidden" class="feeFlg" th:field="*{invoiceRowList[__${stat.index}__].feeFlg}">
						<input type="hidden" class="depositRecvFlg" th:field="*{invoiceRowList[__${stat.index}__].depositRecvFlg}">
						<th:block th:each="depositRecvSeq, depositRecvSeqIndex : *{invoiceRowList[__${stat.index}__].depositRecvSeqList}">
							<!--/* 紐づく預り金SEQ */-->
							<input type="hidden" class="depositRecvSeq" th:field="*{invoiceRowList[__${stat.index}__].depositRecvSeqList[__${depositRecvSeqIndex.index}__]}">
						</th:block>
						<input type="hidden" class="discountFlg" th:field="*{invoiceRowList[__${stat.index}__].discountFlg}">
						<input type="hidden" class="textFlg" th:field="*{invoiceRowList[__${stat.index}__].textFlg}">
						<input type="hidden" class="docInvoiceSeq" th:field="*{invoiceRowList[__${stat.index}__].docInvoiceSeq}">
						<input type="hidden" class="docInvoiceDepositSeq" th:field="*{invoiceRowList[__${stat.index}__].docInvoiceDepositSeq}">
						<input type="hidden" class="accgDocSeq" th:field="*{invoiceRowList[__${stat.index}__].accgDocSeq}">
						<input type="hidden" class="feeSeq" th:field="*{invoiceRowList[__${stat.index}__].feeSeq}">
						<input type="hidden" class="docInvoiceOrder" th:field="*{invoiceRowList[__${stat.index}__].docInvoiceOrder}">
						<input type="hidden" class="invoiceRowCount" th:field="*{invoiceRowList[__${stat.index}__].invoiceRowCount}">
						<input type="hidden" class="index" th:value="${stat.index}">
						<div class="doc_row_data docRowData">
							<div class="doc_grip_vertical p-0">
								<!--/* 並び替え用マーク */-->
								<div class="stop-events sortableObjWrap move_point justify-content-center sortableObj">
									<span class="btn btn-light btn_icon_only move_point_btn">
										<i class="fas fa-grip-vertical"></i>
									</span>
								</div>
							</div>
							<div class="doc_data_date">
								<input type="text" class="form-control modal_date digit7 inputDateSlash transactionDate " autocomplete="off" th:field="*{invoiceRowList[__${stat.index}__].transactionDate}">
								<div th:if="${#fields.hasErrors('*{invoiceRowList[__${stat.index}__].transactionDate}')}" th:errors="*{invoiceRowList[__${stat.index}__].transactionDate}" class="error_mag_point">error</div>
							</div>
							<div class="doc_data_contetns">
								<div class="mb-1">
									<input type="text" class="form-control searchItemName " maxlength="30" placeholder="項目" autocomplete="off" th:data-index="${stat.index}"
										th:field="*{invoiceRowList[__${stat.index}__].itemName}">
									<div th:id="|invoiceItemNameListFragment_${stat.index}|" class="itemNameListFragmentWrap">
										<!--/* 初期状態は空のまま */-->
									</div>
									<div th:if="${#fields.hasErrors('*{invoiceRowList[__${stat.index}__].itemName}')}" th:errors="*{invoiceRowList[__${stat.index}__].itemName}" class="error_mag_point">error</div>
								</div>
								<div class="mb-1">
									<input type="text" class="form-control sumText " th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_SUM_TEXT)}" placeholder="摘要" autocomplete="off" th:field="*{invoiceRowList[__${stat.index}__].sumText}"
										th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoiceRowList[__${stat.index}__].invoieType) and invoiceRowList[__${stat.index}__].depositRecvFlg == false}? 'hidden' : ''">
									<div th:if="${#fields.hasErrors('*{invoiceRowList[__${stat.index}__].sumText}')}" th:errors="*{invoiceRowList[__${stat.index}__].sumText}" class="error_mag_point">error</div>
								</div>
								<!--/* 預り金の場合は、タイムチャージを表示しない */-->
								<th:block th:unless="*{invoiceRowList[__${stat.index}__].depositRecvFlg}">
									<div class="pt-1">
										<label class="check_area checkbox_btn timeChargeCheckLabel"
											th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).DISCOUNT.equalsByCode(invoiceRowList[__${stat.index}__].invoieType) or T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoiceRowList[__${stat.index}__].invoieType)}? 'hidden' : ''">
											<input type="checkbox" class="checkbox_input timeChargeCheck " th:field="*{invoiceRowList[__${stat.index}__].feeTimeChargeFlg}">
											<span class="checkbox_txt">タイムチャージ</span>
										</label>
									</div>
								</th:block>
							</div>
							<div class="doc_data_amount">
								<input type="text" class="form-control text-right commaFormat inputNumHyphen amount fs15" maxlength="9" autocomplete="off" th:field="*{invoiceRowList[__${stat.index}__].amount}"
									th:disabled="*{invoiceRowList[__${stat.index}__].feeTimeChargeFlg or invoiceRowList[__${stat.index}__].rowExpenseSumFlg}"
									th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoiceRowList[__${stat.index}__].invoieType) and invoiceRowList[__${stat.index}__].depositRecvFlg == false}? 'hidden' : ''" >
								<div th:if="${#fields.hasErrors('*{invoiceRowList[__${stat.index}__].amount}')}" th:errors="*{invoiceRowList[__${stat.index}__].amount}" class="error_mag_point">error</div>
								<!--/* 預り金の場合は、消費税、タイムチャージ単価を表示しない */-->
								<th:block th:unless="*{invoiceRowList[__${stat.index}__].depositRecvFlg}">
									<div class="doc_data_amount_tax taxRate" th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoiceRowList[__${stat.index}__].invoieType)}? 'hidden' : ''">
										<span>消費税</span>
										<select class="form-control taxRateSelect " th:field="*{invoiceRowList[__${stat.index}__].taxRateType}">
											<option th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$TaxRate).values()}" th:value="${enum.cd}">
												<th:block th:unless="${enum == T(jp.loioz.common.constant.CommonConstant$TaxRate).TAX_FREE}" th:text="|${enum.val}%|"></th:block>
												<th:block th:if="${enum == T(jp.loioz.common.constant.CommonConstant$TaxRate).TAX_FREE}" th:text="なし"></th:block>
											</option>
										</select>
									</div>
									<div class="timeCharge" th:classappend="*{invoiceRowList[__${stat.index}__].feeTimeChargeFlg}? '' : 'hidden'">
										<input type="text" class="form-control text-right digit8 fs14 commaFormat inputNumberOnly feeTimeChargeInput timeChargeTanka "
											maxlength="9" autocomplete="off" placeholder="単価" th:field="*{invoiceRowList[__${stat.index}__].hourPrice}">
										<div th:if="${#fields.hasErrors('*{invoiceRowList[__${stat.index}__].hourPrice}')}" th:errors="*{invoiceRowList[__${stat.index}__].hourPrice}" class="error_mag_point">error</div>
									</div>
								</th:block>
							</div>
							<div class="doc_data_type">
							
								<!-- ▼ 種別の選択 ▼ -->
							
								<th:block th:if="*{invoiceRowList[__${stat.index}__].depositRecvFlg}">
									<!-- 実費／預り金のデータの場合 -->
									
									<!-- 今回の入力フォームで預り金請求追加のリンクから新規に追加したもの以外は、種別変更のSelectはdisabledとする -->
									<th:block th:unless="*{invoiceRowList[__${stat.index}__].isCanEditInvoieTypeForInvoiceDeposit()}">
										<!-- disabledにする -->
										<select disabled class="form-control invoiceDepositType" th:value="*{invoiceRowList[__${stat.index}__].invoieType}">
											<option th:value="*{invoiceRowList[__${stat.index}__].invoieType}" th:text="*{T(jp.loioz.common.constant.CommonConstant$InvoiceDepositType).of(invoiceRowList[__${stat.index}__].invoieType).val}"></option>
										</select>
										<input type="hidden" th:field="*{invoiceRowList[__${stat.index}__].invoieType}">
									</th:block>
									<th:block th:if="*{invoiceRowList[__${stat.index}__].isCanEditInvoieTypeForInvoiceDeposit()}">
										<!-- disabledにはしない -->
										<select class="form-control invoiceDepositType" th:field="*{invoiceRowList[__${stat.index}__].invoieType}">
											<option th:value="*{invoiceRowList[__${stat.index}__].invoieType}" th:text="*{T(jp.loioz.common.constant.CommonConstant$InvoiceDepositType).of(invoiceRowList[__${stat.index}__].invoieType).val}"></option>
										</select>
									</th:block>
									
								</th:block>
								<th:block th:unless="*{invoiceRowList[__${stat.index}__].depositRecvFlg}">
									<!-- 報酬／その他（値引き、テキスト）のデータの場合 -->
									
									<!-- 今回の入力フォームで報酬追加のリンクから新規追加したもの以外は、種別変更のSelectはdisabledとする -->
									<th:block th:unless="*{invoiceRowList[__${stat.index}__].isCanEditInvoieTypeForInvoiceFeeOrOther()}">
										<!-- disabledにする -->
										<select disabled class="form-control" th:value="*{invoiceRowList[__${stat.index}__].invoieType}">
											<option value="">報酬</option>
											<th:block th:if="*{invoiceRowList[__${stat.index}__].unPaidFeeFlg == false} or *{invoiceRowList[__${stat.index}__].docInvoiceSeq != null}">
												<option th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).values()}" th:value="${enum.cd}" th:text="${enum.val}" th:selected="${enum.cd} == *{invoiceRowList[__${stat.index}__].invoieType}"></option>
											</th:block>
										</select>
										<input type="hidden" th:field="*{invoiceRowList[__${stat.index}__].invoieType}">
									</th:block>
									<th:block th:if="*{invoiceRowList[__${stat.index}__].isCanEditInvoieTypeForInvoiceFeeOrOther()}">
										<!-- disabledにはしない -->
										<select class="form-control" th:field="*{invoiceRowList[__${stat.index}__].invoieType}">
											<th:block th:if="*{#strings.isEmpty(invoiceRowList[__${stat.index}__].invoieType)}">
												<option value="">報酬</option>
											</th:block>
											<th:block th:unless="*{#strings.isEmpty(invoiceRowList[__${stat.index}__].invoieType)}">
												<option th:value="*{invoiceRowList[__${stat.index}__].invoieType}" th:text="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).of(invoiceRowList[__${stat.index}__].invoieType).val}"></option>
											</th:block>
										</select>
									</th:block>
									
								</th:block>
								
								<!-- ▲ 種別の選択 ▲ -->
								
								<!--/* 預り金の場合は、源泉徴収、タイムチャージ時間を表示しない */-->
								<th:block th:unless="*{invoiceRowList[__${stat.index}__].depositRecvFlg}">
									<div class="doc_data_type__tax_withholding">
										<label class="check_area checkbox_btn withholdingCheckLabel"
											th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoiceRowList[__${stat.index}__].invoieType)}? 'hidden' : ''">
											<input type="checkbox" class="checkbox_input withholdingCheck " th:field="*{invoiceRowList[__${stat.index}__].withholdingFlg}">
											<span class="checkbox_txt">源泉徴収あり</span>
										</label>
									</div>
									<div class="d-flex align-items-center mt-2 timeCharge" th:classappend="*{invoiceRowList[__${stat.index}__].feeTimeChargeFlg}? '' : 'hidden'">
										<input type="text" class="form-control text-right digit8 fs14 inputNumberOnly feeTimeChargeInput timeChargeTime " maxlength="5"
											autocomplete="off" placeholder="時間" th:field="*{invoiceRowList[__${stat.index}__].workTimeMinute}">
										<div class="ml-1">分</div>
									</div>
									<div th:if="${#fields.hasErrors('*{invoiceRowList[__${stat.index}__].workTimeMinute}')}" th:errors="*{invoiceRowList[__${stat.index}__].workTimeMinute}" class="error_mag_point">error</div>
								</th:block>
							</div>
							<div class="doc_data_action">
								<button type="button" class="btn btn-light btn_icon_only deleteInvoiceRow">
									<i class="fas fa-times"></i>
								</button>
								<input type="checkbox" class="checkbox_input deleteFlg" th:field="*{invoiceRowList[__${stat.index}__].deleteFlg}">
								<input type="checkbox" class="checkbox_input addFlg" th:field="*{invoiceRowList[__${stat.index}__].addFlg}">
								<input type="checkbox" class="checkbox_input unPaidFeeFlg" th:field="*{invoiceRowList[__${stat.index}__].unPaidFeeFlg}">
								<input type="checkbox" class="checkbox_input rowExpenseSumFlg" th:field="*{invoiceRowList[__${stat.index}__].rowExpenseSumFlg}">
								<input type="checkbox" class="checkbox_input displayFlg" th:field="*{invoiceRowList[__${stat.index}__].displayFlg}">
							</div>
						</div>
					</li>
				</ul>
			</div>
			<div th:if="${#fields.hasErrors('*{invoiceRowList}')}" th:errors="*{invoiceRowList}" class="error_mag_point">error</div>
		</div>
		
		<!--/* 請求書下部 */-->
		<div class="add_description">
			<div class="add_description__col1">
				<div class="mb-2">
					<span class="badge badge-pill accg_label badge_orange">報酬</span>
				</div>
				<div class="mb-1 add_link_wrap">
					<a href="javascript:void(0);" class="addFeeRow">
						<i class="fas fa-plus-square mr-2"></i>報酬の行を追加
					</a>
					<div class="ml-1 d-inline-block stop-events outPutContainerClose" 
						data-toggle="popover" data-html="true" th:data-content='|
							<div class="pt-2 pb-2 px-3">
								追加した報酬は<br>報酬明細にも自動で追加されます。
							</div>
						|'>
						<i class="fas fa-info-circle cursor_pointer" data-outside='close'></i>
						
					</div>
				</div>
				<div class="add_link_wrap">
					<a href="javascript:void(0);" class="addSelectFeeRow" th:data-anken-id="*{ankenId}"
							th:data-person-id="*{personId}" th:data-accg-doc-seq="*{accgDocSeq}">
						<i class="fas fa-search mr-2"></i>未精算の報酬を選択
					</a>
				</div>
				<div class="mb-2 mt-3">
					<span class="badge badge-pill accg_label badge_gray">その他</span>
				</div>
				<div class="mb-1 add_link_wrap">
					<a href="javascript:void(0);" class="addDiscountRow">
						<i class="fas fa-plus-square mr-2"></i>値引きの行を追加
					</a>
				</div>
				<div class="mb-1 add_link_wrap">
					<a href="javascript:void(0);" class="addTextRow">
						<i class="fas fa-plus-square mr-2"></i>テキストの行を追加
					</a>
				</div>
			</div>
			<div class="add_description__col2">
				<div class="mb-2">
					<span class="badge badge-pill accg_label badge_blue">預り金/実費</span>
				</div>
				<div class="mb-1 add_link_wrap">
					<a href="javascript:void(0);" class="addDepositRecvRow" data-deposit-type="2">
						<i class="fas fa-plus-square mr-2"></i>預り金請求の行を追加
					</a>
				</div>
				<div class="add_link_wrap">
					<a href="javascript:void(0);" class="addSelectDepositRow" th:data-anken-id="*{ankenId}"
							th:data-person-id="*{personId}" th:data-accg-doc-seq="*{accgDocSeq}">
						<i class="fas fa-search mr-2"></i>未請求の実費を選択
					</a>
				</div>
			</div>
			<div class="add_description__col3">
				<!--/* 合計の表示 */-->
				<div id="invoiceTotalAmountInputFragmentWrap" class="docInvoiceFee" 
					th:insert="common/accg/accgInvoiceStatementFragment::invoiceTotalAmountInputFragment(*{invoiceTotalAmountInputForm})"></div>
			</div>
		</div>
		<div class="text-right mt-3 mb-2">
			<button type="button" class="btn btn-danger btn-sm saveInvoice"><i class="fas fa-check"></i>保存</button>
			<button type="button" class="btn btn-light btn-sm ml-3 closeInvoice"><i class="fas fa-times ml-1"></i>閉じる</button>
		</div>
		<!--/* 請求追加 end */-->
		
		<!--/* 未精算報酬選択Modal */-->
		<div id="accgInvoiceStatementUnPaidFeeSelectModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="addUnpaidRewardsTitle" aria-hidden="true" data-backdrop="static">
			<div class="modal-dialog modal-dialog-centered modal_un_paid_fee_select" role="document">
				<div class="modal-content">
					<div class="accgInvoiceStatementUnPaidFeeSelectModalFragmentWrap"></div>
				</div>
			</div>
		</div>
		<!--/* 未精算報酬選択Modal end */-->
		
	</form>
</div>
<!--/* 請求入力フラグメント end */-->

<!--/* 請求入力合計額フラグメント start */-->
<th:block th:fragment="invoiceTotalAmountInputFragment(invoiceTotalAmountInputForm)" id="invoiceTotalAmountInputFragment" th:object="${invoiceTotalAmountInputForm}">
	<!--/* 小計 */-->
	<div class="subtotal_invoice">
		<div class="subtotal_row">
			<div class="subtotal_row__label">小計</div>
			<div class="subtotal_row__amount" th:text="*{subTotal}">2,150,000</div>
			<input type="hidden" id="invoiceTotalAmountInputForm.subTotal" name="invoiceTotalAmountInputForm.subTotal" th:value="*{subTotal}">
		</div>
		<div class="subtotal_row">
			<div class="subtotal_row__label">消費税</div>
			<div class="subtotal_row__amount" th:text="*{tax}">215,000</div>
			<input type="hidden" id="invoiceTotalAmountInputForm.tax" name="invoiceTotalAmountInputForm.tax" th:value="*{tax}">
		</div>
		<div class="subtotal_row">
			<div class="subtotal_row__label">源泉徴収税</div>
			<div class="subtotal_row__amount" th:text="*{withholding}">0</div>
			<input type="hidden" id="invoiceTotalAmountInputForm.withholding" name="invoiceTotalAmountInputForm.withholding" th:value="*{withholding}">
		</div>
		<div class="subtotal_row mt-2">
			<div class="subtotal_row__label fw600">合計</div>
			<div class="subtotal_row__amount fw600" th:text="*{total}">2,365,000</div>
			<input type="hidden" id="invoiceTotalAmountInputForm.total" name="invoiceTotalAmountInputForm.total" th:value="*{total}">
		</div>
	</div>
	
	<!--/* 税計算 */-->
	<div class="subtotal_tax text-right pr-2">
	<th:block th:if="*{isThereTarget10()}">
		<div class="row_tax">
			<input type="hidden" id="invoiceTotalAmountInputForm.target10" name="invoiceTotalAmountInputForm.target10" th:value="*{target10}">
			<input type="hidden" id="invoiceTotalAmountInputForm.target10Tax" name="invoiceTotalAmountInputForm.target10Tax" th:value="*{target10Tax}">
			<div class="row_tax__ratio">&lpar;10%対象</div>
			<div class="row_tax__val fs15" th:text="*{target10}">2,150,000</div>
			<div class="row_tax__text">消費税</div>
			<div class="row_tax__val fs15" th:text="|*{target10Tax})|">215,000</div>
		</div>
	</th:block>
	<th:block th:if="*{isThereTarget8()}">
		<div class="row_tax">
			<input type="hidden" id="invoiceTotalAmountInputForm.target8" name="invoiceTotalAmountInputForm.target8" th:value="*{target8}">
			<input type="hidden" id="invoiceTotalAmountInputForm.target8Tax" name="invoiceTotalAmountInputForm.target8Tax" th:value="*{target8Tax}">
			<div class="row_tax__ratio">&lpar;8%対象</div>
			<div class="row_tax__val fs15" th:text="*{target8}">2,150,000</div>
			<div class="row_tax__text">消費税</div>
			<div class="row_tax__val fs15" th:text="|*{target8Tax})|">215,000</div>
		</div>
	</th:block>
	</div>
</th:block>
<!--/* 請求入力合計額フラグメント end */-->

<!--/* 請求入力リストフラグメント start */-->
<th:block th:fragment="invoiceInputListFragment" th:object="${invoiceInputList}">
	<th:block th:each="rowInput : ${invoiceInputList}">
		<!--/* 預り金/実費 */-->
		<th:block th:if="${rowInput.depositRecvFlg}">
			<li th:replace="common/accg/accgInvoiceStatementFragment::invoiceRowDepositExpenseInputFragment(${rowInput})"></li>
		</th:block>
		<!--/* 未精算報酬から追加した報酬 */-->
		<th:block th:if="${rowInput.unPaidFeeFlg}">
			<li th:replace="common/accg/accgInvoiceStatementFragment::invoiceRowUnPaidFeeInputFragment(${rowInput})"></li>
		</th:block>
		<!--/* 新規報酬 */-->
		<th:block th:if="${rowInput.feeFlg}">
			<li th:replace="common/accg/accgInvoiceStatementFragment::invoiceRowFeeInputFragment(${rowInput})"></li>
		</th:block>
		<!--/* 値引き */-->
		<th:block th:if="${rowInput.discountFlg}">
			<li th:replace="common/accg/accgInvoiceStatementFragment::invoiceRowDiscountInputFragment(${rowInput})"></li>
		</th:block>
		<!--/* テキスト */-->
		<th:block th:if="${rowInput.textFlg}">
			<li th:replace="common/accg/accgInvoiceStatementFragment::invoiceRowTextInputFragment(${rowInput})"></li>
		</th:block>
	</th:block>
</th:block>
<!--/* 請求入力リストフラグメント end */-->

<!--/* 報酬用請求入力（1行）追加フラグメント start */-->
<li th:fragment="invoiceRowFeeInputFragment(invoiceRowInputForm)" th:id="|invoiceRow_${invoiceRowCount}|" class="invoiceRow" th:object="${invoiceRowInputForm}" th:with="invoiceRowCount=${invoiceRowInputForm.invoiceRowCount}" th:classappend="${invoiceRowInputForm.displayFlg == false}? 'hidden' : ''">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#invoiceRow_" + /*[[ ${invoiceRowCount} ]]*/);
		
		$(".transactionDate").datepicker();
		
		const invoiceRowFeeInputFragment = $("#invoiceRow_" + /*[[ ${invoiceRowCount} ]]*/);
		
		<!--/* 単価、時間入力フィールド Enterでタイムチャージ計算 */-->
		invoiceRowFeeInputFragment.on('keydown', '.feeTimeChargeInput', function(e) {
			
			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault();
			
			<!--/* 金額のカンマを除去する */-->
			invoiceDetailUnformatComma();
			
			const timeChargeTanka = $(this).closest('.invoiceRow').find('.timeChargeTanka').val();
			const timeChargeTime = $(this).closest('.invoiceRow').find('.timeChargeTime').val();
			let amountInputTypeHtml = $(this).closest('.invoiceRow').find('.amount');
			
			<!--/* タイムチャージの単価、時間の値をチェック */-->
			if (checkTimeChargeTankaTime(timeChargeTanka, timeChargeTime, amountInputTypeHtml)) {
				return;
			}
			
			<!--/* リクエストパラメータ */-->
			const requestParam = {
				'timeChargeTanka' : timeChargeTanka,
				'timeChargeTime' : timeChargeTime,
				'index' : $(this).closest('.invoiceRow').find('.index').val()
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			Promise.resolve(requestParam)
				.then(calculateInputTimeChargeFunc)
				.then(() => renderInvoiceTotalAmountInputFragment())
				.catch((errorObj) => console.log())
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 単価、時間入力フィールド フォーカスアウトでタイムチャージ計算 */-->
		invoiceRowFeeInputFragment.on('blur', '.feeTimeChargeInput', function() {
			
			<!--/* 金額のカンマを除去する */-->
			invoiceDetailUnformatComma();
			
			const timeChargeTanka = $(this).closest('.invoiceRow').find('.timeChargeTanka').val();
			const timeChargeTime = $(this).closest('.invoiceRow').find('.timeChargeTime').val();
			let amountInputTypeHtml = $(this).closest('.invoiceRow').find('.amount');
			
			<!--/* タイムチャージの単価、時間の値をチェック */-->
			if (checkTimeChargeTankaTime(timeChargeTanka, timeChargeTime, amountInputTypeHtml)) {
				return;
			}
			
			<!--/* リクエストパラメータ */-->
			const requestParam = {
				'timeChargeTanka' : timeChargeTanka,
				'timeChargeTime' : timeChargeTime,
				'index' : $(this).closest('.invoiceRow').find('.index').val()
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			Promise.resolve(requestParam)
				.then(calculateInputTimeChargeFunc)
				.then(() => renderInvoiceTotalAmountInputFragment())
				.catch((errorObj) => console.log())
				.finally(() => ajaxRunning = false);
		});
	});
	</script>
	
	<input type="hidden" class="feeFlg" th:id="|invoiceRowList${invoiceRowCount}.feeFlg|" th:name="|invoiceRowList[${invoiceRowCount}].feeFlg|" value="true">
	<input type="hidden" class="depositRecvFlg" th:id="|invoiceRowList${invoiceRowCount}.depositRecvFlg|" th:name="|invoiceRowList[${invoiceRowCount}].depositRecvFlg|" value="false">
	<input type="hidden" class="discountFlg" th:id="|invoiceRowList${invoiceRowCount}.discountFlg|" th:name="|invoiceRowList[${invoiceRowCount}].discountFlg|" value="false">
	<input type="hidden" class="textFlg" th:id="|invoiceRowList${invoiceRowCount}.textFlg|" th:name="|invoiceRowList[${invoiceRowCount}].textFlg|" value="false">
	<input type="hidden" class="docInvoiceSeq" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceSeq|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceSeq|" th:value="*{docInvoiceSeq}">
	<input type="hidden" class="docInvoiceDepositSeq" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceDepositSeq|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceDepositSeq|" th:value="*{docInvoiceDepositSeq}">
	<input type="hidden" class="accgDocSeq" th:id="|invoiceRowList${invoiceRowCount}.accgDocSeq|" th:name="|invoiceRowList[${invoiceRowCount}].accgDocSeq|" th:value="*{accgDocSeq}">
	<input type="hidden" class="feeSeq" th:id="|invoiceRowList${invoiceRowCount}.feeSeq|" th:name="|invoiceRowList[${invoiceRowCount}].feeSeq|" th:value="*{feeSeq}">
	<input type="hidden" class="docInvoiceOrder" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceOrder|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceOrder|" th:value="*{docInvoiceOrder}">
	<input type="hidden" class="invoiceRowCount" th:id="|invoiceRowList${invoiceRowCount}.invoiceRowCount|" th:name="|invoiceRowList[${invoiceRowCount}].invoiceRowCount|" th:value="*{invoiceRowCount}">
	<input type="hidden" class="index" th:value="${invoiceRowCount}">
	<div class="doc_row_data docRowData">
		<div class="doc_grip_vertical p-0">
			<!--/* 並び替え用マーク */-->
			<div class="stop-events sortableObjWrap move_point justify-content-center sortableObj">
				<span class="btn btn-light btn_icon_only move_point_btn">
					<i class="fas fa-grip-vertical"></i>
				</span>
			</div>
		</div>
		<div class="doc_data_date">
			<input type="text" class="form-control modal_date digit7 inputDateSlash transactionDate " autocomplete="off"
				th:id="|invoiceRowList${invoiceRowCount}.transactionDate|" th:name="|invoiceRowList[${invoiceRowCount}].transactionDate|" th:value="*{transactionDate}">
		</div>
		<div class="doc_data_contetns">
			<div class="mb-1">
				<input type="text" class="form-control searchItemName " maxlength="30" placeholder="項目" autocomplete="off" th:data-index="${invoiceRowCount}"
					th:id="|invoiceRowList${invoiceRowCount}.ItemName|" th:name="|invoiceRowList[${invoiceRowCount}].itemName|" th:value="*{itemName}">
				<div th:id="|invoiceItemNameListFragment_${invoiceRowCount}|" class="itemNameListFragmentWrap">
					<!--/* 初期状態は空のまま */-->
				</div>
			</div>
			<div class="mb-1">
				<input type="text" class="form-control sumText " th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_SUM_TEXT)}" placeholder="摘要"
					autocomplete="off" th:id="|invoiceRowList${invoiceRowCount}.sumText|" th:name="|invoiceRowList[${invoiceRowCount}].sumText|" th:value="*{sumText}"
					th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoieType)}? 'hidden' : ''">
			</div>
			<div class="pt-1">
				<label class="check_area checkbox_btn timeChargeCheckLabel"
					th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).DISCOUNT.equalsByCode(invoieType) or T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoieType)}? 'hidden' : ''">
					<input type="checkbox" class="checkbox_input timeChargeCheck " th:id="|invoiceRowList${invoiceRowCount}.feeTimeChargeFlg|"
						th:name="|invoiceRowList[${invoiceRowCount}].feeTimeChargeFlg|" th:checked="*{feeTimeChargeFlg}">
					<span class="checkbox_txt">タイムチャージ</span>
				</label>
			</div>
		</div>
		<div class="doc_data_amount">
			<!--/* 金額 */-->
			<input type="text" class="form-control text-right commaFormat inputNumHyphen amount fs15" maxlength="9" autocomplete="off"
				th:id="|invoiceRowList${invoiceRowCount}.amount|" th:name="|invoiceRowList[${invoiceRowCount}].amount|" th:value="*{amount}"
				th:disabled="*{feeTimeChargeFlg}"
				th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoieType)}? 'hidden' : ''" >
			<div class="doc_data_amount_tax taxRate" th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoieType)}? 'hidden' : ''">
				<span>消費税</span>
				<select class="form-control taxRateSelect " th:id="|invoiceRowList${invoiceRowCount}.taxRateType|" th:name="|invoiceRowList[${invoiceRowCount}].taxRateType|">
					<option th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$TaxRate).values()}" th:value="${enum.cd}" th:selected="${enum.cd} == *{taxRateType}">
						<th:block th:unless="${enum == T(jp.loioz.common.constant.CommonConstant$TaxRate).TAX_FREE}" th:text="|${enum.val}%|"></th:block>
						<th:block th:if="${enum == T(jp.loioz.common.constant.CommonConstant$TaxRate).TAX_FREE}" th:text="なし"></th:block>
					</option>
				</select>
			</div>
			<!--/* タイムチャージ単価 */-->
			<div class="timeCharge" th:classappend="*{feeTimeChargeFlg}? '' : 'hidden'">
				<input type="text" class="form-control text-right digit8 fs14 commaFormat inputNumberOnly feeTimeChargeInput timeChargeTanka "
					maxlength="9" autocomplete="off" placeholder="単価" th:id="|invoiceRowList${invoiceRowCount}.hourPrice|" th:name="|invoiceRowList[${invoiceRowCount}].hourPrice|" th:value="*{hourPrice}">
			</div>
		</div>
		<div class="doc_data_type">
			<!-- 今回の入力フォームで報酬追加のリンクから新規追加したもの以外は、種別変更のSelectはdisabledとする -->
			<th:block th:unless="*{isCanEditInvoieTypeForInvoiceFeeOrOther()}">
				<!-- disabledにする -->
				<select disabled class="form-control ">
					<option value="" th:selected="*{#strings.isEmpty(invoieType)}">報酬</option>
				</select>
				<input type="hidden" th:id="|invoiceRowList${invoiceRowCount}.invoieType|" th:name="|invoiceRowList[${invoiceRowCount}].invoieType|" th:value="*{invoieType}">
			</th:block>
			<th:block th:if="*{isCanEditInvoieTypeForInvoiceFeeOrOther()}">
				<!-- disabledにはしない -->
				<select class="form-control " th:id="|invoiceRowList${invoiceRowCount}.invoieType|" th:name="|invoiceRowList[${invoiceRowCount}].invoieType|">
					<option value="" th:selected="*{#strings.isEmpty(invoieType)}">報酬</option>
				</select>
			</th:block>
			
			<div class="doc_data_type__tax_withholding">
				<label class="check_area checkbox_btn withholdingCheckLabel"
					th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoieType)}? 'hidden' : ''">
					<input type="checkbox" class="checkbox_input withholdingCheck " th:id="|invoiceRowList${invoiceRowCount}.withholdingFlg|"
						th:name="|invoiceRowList[${invoiceRowCount}].withholdingFlg|" th:checked="*{withholdingFlg}">
					<span class="checkbox_txt">源泉徴収あり</span>
				</label>
			</div>
			<div class="d-flex align-items-center mt-2 timeCharge" th:classappend="*{feeTimeChargeFlg}? '' : 'hidden'">
				<input type="text" class="form-control text-right digit8 fs14 inputNumberOnly feeTimeChargeInput timeChargeTime " maxlength="5"
					autocomplete="off" placeholder="時間" th:id="|invoiceRowList${invoiceRowCount}.workTimeMinute|" th:name="|invoiceRowList[${invoiceRowCount}].workTimeMinute|" th:value="*{workTimeMinute}">
				<div class="ml-1">分</div>
			</div>
		</div>
		<div class="doc_data_action">
			<button type="button" class="btn btn-light btn_icon_only deleteInvoiceRow">
				<i class="fas fa-times"></i>
			</button>
			<input type="checkbox" class="checkbox_input deleteFlg" th:id="|invoiceRowList${invoiceRowCount}.deleteFlg|" th:name="|invoiceRowList[${invoiceRowCount}].deleteFlg|" th:checked="*{deleteFlg == true}">
			<input type="checkbox" class="checkbox_input addFlg" th:id="|invoiceRowList${invoiceRowCount}.addFlg|" th:name="|invoiceRowList[${invoiceRowCount}].addFlg|" th:checked="*{addFlg == true}">
			<input type="checkbox" class="checkbox_input unPaidFeeFlg" th:id="|invoiceRowList${invoiceRowCount}.unPaidFeeFlg|" th:name="|invoiceRowList[${invoiceRowCount}].unPaidFeeFlg|" th:checked="*{unPaidFeeFlg == true}">
			<input type="checkbox" class="checkbox_input rowExpenseSumFlg" th:id="|invoiceRowList${invoiceRowCount}.rowExpenseSumFlg|" th:name="|invoiceRowList[${invoiceRowCount}].rowExpenseSumFlg|" th:checked="*{rowExpenseSumFlg == true}">
			<input type="checkbox" class="checkbox_input displayFlg" th:id="|invoiceRowList${invoiceRowCount}.displayFlg|" th:name="|invoiceRowList[${invoiceRowCount}].displayFlg|" th:checked="*{displayFlg == true}">
		</div>
	</div>
</li>
<!--/* 報酬用請求入力（1行）追加フラグメント end */-->

<!--/* 預り金・実費用請求入力（1行）追加フラグメント start */-->
<li th:fragment="invoiceRowDepositExpenseInputFragment(invoiceRowInputForm)" th:id="|invoiceRow_${invoiceRowCount}|" class="invoiceRow" th:object="${invoiceRowInputForm}" th:with="invoiceRowCount=${invoiceRowInputForm.invoiceRowCount}" th:classappend="${invoiceRowInputForm.displayFlg == false}? 'hidden' : ''">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#invoiceRow_" + /*[[ ${invoiceRowCount} ]]*/);
		
		$(".transactionDate").datepicker();
	});
	</script>
	<input type="hidden" class="feeFlg" th:id="|invoiceRowList${invoiceRowCount}.feeFlg|" th:name="|invoiceRowList[${invoiceRowCount}].feeFlg|" value="false">
	<input type="hidden" class="depositRecvFlg" th:id="|invoiceRowList${invoiceRowCount}.depositRecvFlg|" th:name="|invoiceRowList[${invoiceRowCount}].depositRecvFlg|" value="true">
	<th:block th:each="depositRecvSeq, depositRecvSeqIndex : *{depositRecvSeqList}">
		<!--/* 紐づく預り金SEQ */-->
		<input type="hidden" class="depositRecvSeq" th:id="|invoiceRowList${invoiceRowCount}.depositRecvSeqList${depositRecvSeqIndex.index}|" th:name="|invoiceRowList[${invoiceRowCount}].depositRecvSeqList[${depositRecvSeqIndex.index}]|" th:value="${depositRecvSeq}">
	</th:block>
	<input type="hidden" class="discountFlg" th:id="|invoiceRowList${invoiceRowCount}.discountFlg|" th:name="|invoiceRowList[${invoiceRowCount}].discountFlg|" value="false">
	<input type="hidden" class="textFlg" th:id="|invoiceRowList${invoiceRowCount}.textFlg|" th:name="|invoiceRowList[${invoiceRowCount}].textFlg|" value="false">
	<input type="hidden" class="docInvoiceSeq" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceSeq|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceSeq|" th:value="*{docInvoiceSeq}">
	<input type="hidden" class="docInvoiceDepositSeq" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceDepositSeq|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceDepositSeq|" th:value="*{docInvoiceDepositSeq}">
	<input type="hidden" class="accgDocSeq" th:id="|invoiceRowList${invoiceRowCount}.accgDocSeq|" th:name="|invoiceRowList[${invoiceRowCount}].accgDocSeq|" th:value="*{accgDocSeq}">
	<input type="hidden" class="docInvoiceOrder" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceOrder|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceOrder|" th:value="*{docInvoiceOrder}">
	<input type="hidden" class="invoiceRowCount" th:id="|invoiceRowList${invoiceRowCount}.invoiceRowCount|" th:name="|invoiceRowList[${invoiceRowCount}].invoiceRowCount|" th:value="*{invoiceRowCount}">
	<input type="hidden" class="index" th:value="${invoiceRowCount}">
	<div class="doc_row_data docRowData">
		<div class="doc_grip_vertical p-0">
			<!--/* 並び替え用マーク */-->
			<div class="stop-events sortableObjWrap move_point justify-content-center sortableObj">
				<span class="btn btn-light btn_icon_only move_point_btn">
					<i class="fas fa-grip-vertical"></i>
				</span>
			</div>
		</div>
		<div class="doc_data_date">
			<input type="text" class="form-control modal_date digit7 inputDateSlash transactionDate " autocomplete="off"
				th:id="|invoiceRowList${invoiceRowCount}.transactionDate|" th:name="|invoiceRowList[${invoiceRowCount}].transactionDate|" th:value="*{transactionDate}">
		</div>
		<div class="doc_data_contetns">
			<div class="mb-1">
				<input type="text" class="form-control searchItemName " maxlength="30" placeholder="項目" autocomplete="off" th:data-index="${invoiceRowCount}"
					th:id="|invoiceRowList${invoiceRowCount}.ItemName|" th:name="|invoiceRowList[${invoiceRowCount}].itemName|" th:value="*{itemName}">
				<div th:id="|invoiceItemNameListFragment_${invoiceRowCount}|" class="itemNameListFragmentWrap">
					<!--/* 初期状態は空のまま */-->
				</div>
			</div>
			<div class="mb-1">
				<input type="text" class="form-control sumText " th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_SUM_TEXT)}" placeholder="摘要" autocomplete="off"
					th:id="|invoiceRowList${invoiceRowCount}.sumText|" th:name="|invoiceRowList[${invoiceRowCount}].sumText|" th:value="*{sumText}">
			</div>
		</div>
		<div class="doc_data_amount">
			<input type="text" class="form-control text-right commaFormat inputNumHyphen amount fs15" maxlength="9" autocomplete="off"
				th:id="|invoiceRowList${invoiceRowCount}.amount|" th:name="|invoiceRowList[${invoiceRowCount}].amount|" th:value="*{amount}" th:disabled="*{rowExpenseSumFlg}">
		</div>
		<div class="doc_data_type">
			<!-- 今回の入力フォームで預り金請求追加のリンクから新規に追加したもの以外は、種別変更のSelectはdisabledとする -->
			<th:block th:unless="*{isCanEditInvoieTypeForInvoiceDeposit()}">
				<!-- disabledにする -->
				<select disabled class="form-control invoiceDepositType ">
					<option th:value="*{invoieType}" th:text="*{T(jp.loioz.common.constant.CommonConstant$InvoiceDepositType).of(invoieType).val}"></option>
				</select>
				<input type="hidden" th:id="|invoiceRowList${invoiceRowCount}.invoieType|" th:name="|invoiceRowList[${invoiceRowCount}].invoieType|" th:value="*{invoieType}">
			</th:block>
			<th:block th:if="*{isCanEditInvoieTypeForInvoiceDeposit()}">
				<!-- disabledにはしない -->
				<select class="form-control invoiceDepositType " th:id="|invoiceRowList${invoiceRowCount}.invoieType|" th:name="|invoiceRowList[${invoiceRowCount}].invoieType|">
					<option th:value="*{invoieType}" th:text="*{T(jp.loioz.common.constant.CommonConstant$InvoiceDepositType).of(invoieType).val}"></option>
				</select>
			</th:block>
		</div>
		<div class="doc_data_action">
			<button type="button" class="btn btn-light btn_icon_only deleteInvoiceRow">
				<i class="fas fa-times"></i>
			</button>
			<input type="checkbox" class="checkbox_input deleteFlg" th:id="|invoiceRowList${invoiceRowCount}.deleteFlg|" th:name="|invoiceRowList[${invoiceRowCount}].deleteFlg|" th:checked="*{deleteFlg == true}">
			<input type="checkbox" class="checkbox_input addFlg" th:id="|invoiceRowList${invoiceRowCount}.addFlg|" th:name="|invoiceRowList[${invoiceRowCount}].addFlg|" th:checked="*{addFlg == true}">
			<input type="checkbox" class="checkbox_input rowExpenseSumFlg" th:id="|invoiceRowList${invoiceRowCount}.rowExpenseSumFlg|" th:name="|invoiceRowList[${invoiceRowCount}].rowExpenseSumFlg|" th:checked="*{rowExpenseSumFlg == true}">
			<input type="checkbox" class="checkbox_input displayFlg" th:id="|invoiceRowList${invoiceRowCount}.displayFlg|" th:name="|invoiceRowList[${invoiceRowCount}].displayFlg|" th:checked="*{displayFlg == true}">
		</div>
	</div>
</li>
<!--/* 預り金・実費用請求入力（1行）追加フラグメント end */-->

<!--/* 未精算報酬用請求入力（1行）追加フラグメント start */-->
<li th:fragment="invoiceRowUnPaidFeeInputFragment(invoiceRowInputForm)" th:id="|invoiceRow_${invoiceRowCount}|" class="invoiceRow" th:object="${invoiceRowInputForm}" th:with="invoiceRowCount=${invoiceRowInputForm.invoiceRowCount}" th:classappend="${invoiceRowInputForm.displayFlg == false}? 'hidden' : ''">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#invoiceRow_" + /*[[ ${invoiceRowCount} ]]*/);
		
		$(".transactionDate").datepicker();
		
		const invoiceRowUnPaidFeeInputFragment = $("#invoiceRow_" + /*[[ ${invoiceRowCount} ]]*/);
		
		<!--/* 単価、時間入力フィールド Enterでタイムチャージ計算 */-->
		invoiceRowUnPaidFeeInputFragment.on('keydown', '.feeTimeChargeInput', function(e) {
			
			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault();
			
			<!--/* 金額のカンマを除去する */-->
			invoiceDetailUnformatComma();
			
			const timeChargeTanka = $(this).closest('.invoiceRow').find('.timeChargeTanka').val();
			const timeChargeTime = $(this).closest('.invoiceRow').find('.timeChargeTime').val();
			let amountInputTypeHtml = $(this).closest('.invoiceRow').find('.amount');
			
			<!--/* タイムチャージの単価、時間の値をチェック */-->
			if (checkTimeChargeTankaTime(timeChargeTanka, timeChargeTime, amountInputTypeHtml)) {
				return;
			}
			
			<!--/* リクエストパラメータ */-->
			const requestParam = {
				'timeChargeTanka' : timeChargeTanka,
				'timeChargeTime' : timeChargeTime,
				'index' : $(this).closest('.invoiceRow').find('.index').val()
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			Promise.resolve(requestParam)
				.then(calculateInputTimeChargeFunc)
				.then(() => renderInvoiceTotalAmountInputFragment())
				.catch((errorObj) => console.log())
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 単価、時間入力フィールド フォーカスアウトでタイムチャージ計算 */-->
		invoiceRowUnPaidFeeInputFragment.on('blur', '.feeTimeChargeInput', function() {
			
			<!--/* 金額のカンマを除去する */-->
			invoiceDetailUnformatComma();
			
			const timeChargeTanka = $(this).closest('.invoiceRow').find('.timeChargeTanka').val();
			const timeChargeTime = $(this).closest('.invoiceRow').find('.timeChargeTime').val();
			let amountInputTypeHtml = $(this).closest('.invoiceRow').find('.amount');
			
			<!--/* タイムチャージの単価、時間の値をチェック */-->
			if (checkTimeChargeTankaTime(timeChargeTanka, timeChargeTime, amountInputTypeHtml)) {
				return;
			}
			
			<!--/* リクエストパラメータ */-->
			const requestParam = {
				'timeChargeTanka' : timeChargeTanka,
				'timeChargeTime' : timeChargeTime,
				'index' : $(this).closest('.invoiceRow').find('.index').val()
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			Promise.resolve(requestParam)
				.then(calculateInputTimeChargeFunc)
				.then(() => renderInvoiceTotalAmountInputFragment())
				.catch((errorObj) => console.log())
				.finally(() => ajaxRunning = false);
		});
	});
	</script>
	<input type="hidden" class="feeFlg" th:id="|invoiceRowList${invoiceRowCount}.feeFlg|" th:name="|invoiceRowList[${invoiceRowCount}].feeFlg|" value="false">
	<input type="hidden" class="depositRecvFlg" th:id="|invoiceRowList${invoiceRowCount}.depositRecvFlg|" th:name="|invoiceRowList[${invoiceRowCount}].depositRecvFlg|" value="false">
	<input type="hidden" class="discountFlg" th:id="|invoiceRowList${invoiceRowCount}.discountFlg|" th:name="|invoiceRowList[${invoiceRowCount}].discountFlg|" value="false">
	<input type="hidden" class="textFlg" th:id="|invoiceRowList${invoiceRowCount}.textFlg|" th:name="|invoiceRowList[${invoiceRowCount}].textFlg|" value="false">
	<input type="hidden" class="docInvoiceSeq" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceSeq|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceSeq|" th:value="*{docInvoiceSeq}">
	<input type="hidden" class="docInvoiceDepositSeq" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceDepositSeq|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceDepositSeq|" th:value="*{docInvoiceDepositSeq}">
	<input type="hidden" class="accgDocSeq" th:id="|invoiceRowList${invoiceRowCount}.accgDocSeq|" th:name="|invoiceRowList[${invoiceRowCount}].accgDocSeq|" th:value="*{accgDocSeq}">
	<input type="hidden" class="feeSeq" th:id="|invoiceRowList${invoiceRowCount}.feeSeq|" th:name="|invoiceRowList[${invoiceRowCount}].feeSeq|" th:value="*{feeSeq}">
	<input type="hidden" class="docInvoiceOrder" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceOrder|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceOrder|" th:value="*{docInvoiceOrder}">
	<input type="hidden" class="invoiceRowCount" th:id="|invoiceRowList${invoiceRowCount}.invoiceRowCount|" th:name="|invoiceRowList[${invoiceRowCount}].invoiceRowCount|" th:value="*{invoiceRowCount}">
	<input type="hidden" class="index" th:value="${invoiceRowCount}">
	<div class="doc_row_data docRowData">
		<div class="doc_grip_vertical p-0">
			<!--/* 並び替え用マーク */-->
			<div class="stop-events sortableObjWrap move_point justify-content-center sortableObj">
				<span class="btn btn-light btn_icon_only move_point_btn">
					<i class="fas fa-grip-vertical"></i>
				</span>
			</div>
		</div>
		<div class="doc_data_date">
			<input type="text" class="form-control modal_date digit7 inputDateSlash transactionDate " autocomplete="off" th:id="|invoiceRowList${invoiceRowCount}.transactionDate|" th:name="|invoiceRowList[${invoiceRowCount}].transactionDate|" th:value="*{transactionDate}">
		</div>
		<div class="doc_data_contetns">
			<div class="mb-1">
				<input type="text" class="form-control searchItemName " maxlength="30" placeholder="項目" autocomplete="off" th:data-index="${invoiceRowCount}"
					th:id="|invoiceRowList${invoiceRowCount}.ItemName|" th:name="|invoiceRowList[${invoiceRowCount}].itemName|" th:value="*{itemName}">
				<div th:id="|invoiceItemNameListFragment_${invoiceRowCount}|" class="itemNameListFragmentWrap">
					<!--/* 初期状態は空のまま */-->
				</div>
			</div>
			<div class="mb-1">
				<input type="text" class="form-control sumText " th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_SUM_TEXT)}" placeholder="摘要" autocomplete="off"
					th:id="|invoiceRowList${invoiceRowCount}.sumText|" th:name="|invoiceRowList[${invoiceRowCount}].sumText|" th:value="*{sumText}">
			</div>
			<div class="py-2">
				<label class="check_area checkbox_btn timeChargeCheckLabel">
					<input type="checkbox" class="checkbox_input timeChargeCheck " th:id="|invoiceRowList${invoiceRowCount}.feeTimeChargeFlg|"
						th:name="|invoiceRowList[${invoiceRowCount}].feeTimeChargeFlg|" th:checked="*{feeTimeChargeFlg}">
					<span class="checkbox_txt">タイムチャージ</span>
				</label>
			</div>
		</div>
		<div class="doc_data_amount">
			<input type="text" class="form-control text-right commaFormat inputNumHyphen amount fs15" maxlength="9" autocomplete="off" th:id="|invoiceRowList${invoiceRowCount}.amount|"
				th:name="|invoiceRowList[${invoiceRowCount}].amount|" th:disabled="*{feeTimeChargeFlg}" th:value="*{amount}">
			<div class="doc_data_amount_tax taxRate">
				<span>消費税</span>
				<select class="form-control taxRateSelect " th:id="|invoiceRowList${invoiceRowCount}.taxRateType|" th:name="|invoiceRowList[${invoiceRowCount}].taxRateType|">
					<option th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$TaxRate).values()}" th:value="${enum.cd}" th:selected="*{taxRateType} == ${enum.cd}">
						<th:block th:unless="${enum == T(jp.loioz.common.constant.CommonConstant$TaxRate).TAX_FREE}" th:text="|${enum.val}%|"></th:block>
						<th:block th:if="${enum == T(jp.loioz.common.constant.CommonConstant$TaxRate).TAX_FREE}" th:text="なし"></th:block>
					</option>
				</select>
			</div>
			<div class="timeCharge" th:classappend="*{feeTimeChargeFlg}? '' : 'hidden'">
				<input type="text" class="form-control text-right digit8 fs14 commaFormat inputNumberOnly feeTimeChargeInput timeChargeTanka "
					maxlength="9" autocomplete="off" placeholder="単価" th:id="|invoiceRowList${invoiceRowCount}.hourPrice|" th:name="|invoiceRowList[${invoiceRowCount}].hourPrice|" th:value="*{hourPrice}">
			</div>
		</div>
		<div class="doc_data_type">
			<!-- 種別の変更のSelectはdisabledとする -->
			<select disabled class="form-control">
				<!-- 未精算報酬から追加した行の種別は、「報酬」で固定 -->
				<option value="">報酬</option>
			</select>
			<!-- 未精算報酬から追加した行の種別の値（value）は「報酬」の値（空）で固定 -->
			<input type="hidden" th:id="|invoiceRowList${invoiceRowCount}.invoieType|" th:name="|invoiceRowList[${invoiceRowCount}].invoieType|" value="">
			
			<div class="doc_data_type__tax_withholding">
				<label class="check_area checkbox_btn withholdingCheckLabel">
					<input type="checkbox" class="checkbox_input withholdingCheck " th:id="|invoiceRowList${invoiceRowCount}.withholdingFlg|"
						th:name="|invoiceRowList[${invoiceRowCount}].withholdingFlg|" th:checked="*{withholdingFlg}">
					<span class="checkbox_txt">源泉徴収あり</span>
				</label>
			</div>
			<div class="d-flex align-items-center mt-2 feeTimeChargeInput timeCharge" th:classappend="*{feeTimeChargeFlg}? '' : 'hidden'">
				<input type="text" class="form-control text-right digit8 fs14 inputNumberOnly timeChargeTime " maxlength="5"
					autocomplete="off" placeholder="時間" th:id="|invoiceRowList${invoiceRowCount}.workTimeMinute|" th:name="|invoiceRowList[${invoiceRowCount}].workTimeMinute|" th:value="*{workTimeMinute}">
				<div class="ml-1">分</div>
			</div>
		</div>
		<div class="doc_data_action">
			<button type="button" class="btn btn-light btn_icon_only deleteInvoiceRow">
				<i class="fas fa-times"></i>
			</button>
			<input type="checkbox" class="checkbox_input deleteFlg" th:id="|invoiceRowList${invoiceRowCount}.deleteFlg|" th:name="|invoiceRowList[${invoiceRowCount}].deleteFlg|" th:checked="*{deleteFlg == true}">
			<input type="checkbox" class="checkbox_input addFlg" th:id="|invoiceRowList${invoiceRowCount}.addFlg|" th:name="|invoiceRowList[${invoiceRowCount}].addFlg|" th:checked="*{addFlg == true}">
			<input type="checkbox" class="checkbox_input unPaidFeeFlg" th:id="|invoiceRowList${invoiceRowCount}.unPaidFeeFlg|" th:name="|invoiceRowList[${invoiceRowCount}].unPaidFeeFlg|" th:checked="*{unPaidFeeFlg == true}">
			<input type="checkbox" class="checkbox_input rowExpenseSumFlg" th:id="|invoiceRowList${invoiceRowCount}.rowExpenseSumFlg|" th:name="|invoiceRowList[${invoiceRowCount}].rowExpenseSumFlg|" th:checked="*{rowExpenseSumFlg == true}">
			<input type="checkbox" class="checkbox_input displayFlg" th:id="|invoiceRowList${invoiceRowCount}.displayFlg|" th:name="|invoiceRowList[${invoiceRowCount}].displayFlg|" th:checked="*{displayFlg == true}">
		</div>
	</div>
</li>
<!--/* 未精算報酬用請求入力（1行）追加フラグメント end */-->

<!--/* 値引き用請求入力（1行）追加フラグメント start */-->
<li th:fragment="invoiceRowDiscountInputFragment(invoiceRowInputForm)" th:id="|invoiceRow_${invoiceRowCount}|" class="invoiceRow" th:object="${invoiceRowInputForm}" th:with="invoiceRowCount=${invoiceRowInputForm.invoiceRowCount}" th:classappend="${invoiceRowInputForm.displayFlg == false}? 'hidden' : ''">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#invoiceRow_" + /*[[ ${invoiceRowCount} ]]*/);
		
		$(".transactionDate").datepicker();
		
	});
	</script>
	
	<input type="hidden" class="feeFlg" th:id="|invoiceRowList${invoiceRowCount}.feeFlg|" th:name="|invoiceRowList[${invoiceRowCount}].feeFlg|" value="false">
	<input type="hidden" class="depositRecvFlg" th:id="|invoiceRowList${invoiceRowCount}.depositRecvFlg|" th:name="|invoiceRowList[${invoiceRowCount}].depositRecvFlg|" value="false">
	<input type="hidden" class="discountFlg" th:id="|invoiceRowList${invoiceRowCount}.discountFlg|" th:name="|invoiceRowList[${invoiceRowCount}].discountFlg|" value="true">
	<input type="hidden" class="textFlg" th:id="|invoiceRowList${invoiceRowCount}.textFlg|" th:name="|invoiceRowList[${invoiceRowCount}].textFlg|" value="false">
	<input type="hidden" class="docInvoiceSeq" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceSeq|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceSeq|" th:value="*{docInvoiceSeq}">
	<input type="hidden" class="docInvoiceDepositSeq" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceDepositSeq|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceDepositSeq|" th:value="*{docInvoiceDepositSeq}">
	<input type="hidden" class="accgDocSeq" th:id="|invoiceRowList${invoiceRowCount}.accgDocSeq|" th:name="|invoiceRowList[${invoiceRowCount}].accgDocSeq|" th:value="*{accgDocSeq}">
	<input type="hidden" class="feeSeq" th:id="|invoiceRowList${invoiceRowCount}.feeSeq|" th:name="|invoiceRowList[${invoiceRowCount}].feeSeq|" th:value="*{feeSeq}">
	<input type="hidden" class="docInvoiceOrder" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceOrder|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceOrder|" th:value="*{docInvoiceOrder}">
	<input type="hidden" class="invoiceRowCount" th:id="|invoiceRowList${invoiceRowCount}.invoiceRowCount|" th:name="|invoiceRowList[${invoiceRowCount}].invoiceRowCount|" th:value="*{invoiceRowCount}">
	<input type="hidden" class="index" th:value="${invoiceRowCount}">
	<div class="doc_row_data docRowData">
		<div class="doc_grip_vertical p-0">
			<!--/* 並び替え用マーク */-->
			<div class="stop-events sortableObjWrap move_point justify-content-center sortableObj">
				<span class="btn btn-light btn_icon_only move_point_btn">
					<i class="fas fa-grip-vertical"></i>
				</span>
			</div>
		</div>
		<div class="doc_data_date">
			<input type="text" class="form-control modal_date digit7 inputDateSlash transactionDate " autocomplete="off"
				th:id="|invoiceRowList${invoiceRowCount}.transactionDate|" th:name="|invoiceRowList[${invoiceRowCount}].transactionDate|" th:value="*{transactionDate}">
		</div>
		<div class="doc_data_contetns">
			<div class="mb-1">
				<input type="text" class="form-control" maxlength="30" placeholder="項目" autocomplete="off" th:data-index="${invoiceRowCount}"
					th:id="|invoiceRowList${invoiceRowCount}.ItemName|" th:name="|invoiceRowList[${invoiceRowCount}].itemName|" th:value="*{itemName}">
			</div>
			<div class="mb-1">
				<input type="text" class="form-control sumText " th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_INVOICE_SUM_TEXT)}" placeholder="摘要"
					autocomplete="off" th:id="|invoiceRowList${invoiceRowCount}.sumText|" th:name="|invoiceRowList[${invoiceRowCount}].sumText|" th:value="*{sumText}"
					th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoieType)}? 'hidden' : ''">
			</div>
		</div>
		<div class="doc_data_amount">
			<!--/* 金額 */-->
			<input type="text" class="form-control text-right commaFormat inputNumHyphen amount fs15" maxlength="9" autocomplete="off"
				th:id="|invoiceRowList${invoiceRowCount}.amount|" th:name="|invoiceRowList[${invoiceRowCount}].amount|" th:value="*{amount}"
				th:disabled="*{feeTimeChargeFlg}"
				th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoieType)}? 'hidden' : ''" >
			<div class="doc_data_amount_tax taxRate" th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoieType)}? 'hidden' : ''">
				<span>消費税</span>
				<select class="form-control taxRateSelect " th:id="|invoiceRowList${invoiceRowCount}.taxRateType|" th:name="|invoiceRowList[${invoiceRowCount}].taxRateType|">
					<option th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$TaxRate).values()}" th:value="${enum.cd}" th:selected="${enum.cd} == *{taxRateType}">
						<th:block th:unless="${enum == T(jp.loioz.common.constant.CommonConstant$TaxRate).TAX_FREE}" th:text="|${enum.val}%|"></th:block>
						<th:block th:if="${enum == T(jp.loioz.common.constant.CommonConstant$TaxRate).TAX_FREE}" th:text="なし"></th:block>
					</option>
				</select>
			</div>
		</div>
		<div class="doc_data_type">
			<!-- 今回の入力フォームで値引き追加のリンクから新規追加したもの以外は、種別変更のSelectはdisabledとする -->
			<th:block th:unless="*{isCanEditInvoieTypeForInvoiceFeeOrOther()}">
				<!-- disabledにする -->
				<select disabled class="form-control">
					<option th:value="*{invoieType}" th:text="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).of(invoieType).val}"></option>
				</select>
				<input type="hidden" th:id="|invoiceRowList${invoiceRowCount}.invoieType|" th:name="|invoiceRowList[${invoiceRowCount}].invoieType|" th:value="*{invoieType}">
			</th:block>
			<th:block th:if="*{isCanEditInvoieTypeForInvoiceFeeOrOther()}">
				<!-- disabledにはしない -->
				<select class="form-control" th:id="|invoiceRowList${invoiceRowCount}.invoieType|" th:name="|invoiceRowList[${invoiceRowCount}].invoieType|">
					<option th:value="*{invoieType}" th:text="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).of(invoieType).val}"></option>
				</select>
			</th:block>
			
			<div class="doc_data_type__tax_withholding">
				<label class="check_area checkbox_btn withholdingCheckLabel"
					th:classappend="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).TEXT.equalsByCode(invoieType)}? 'hidden' : ''">
					<input type="checkbox" class="checkbox_input withholdingCheck " th:id="|invoiceRowList${invoiceRowCount}.withholdingFlg|"
						th:name="|invoiceRowList[${invoiceRowCount}].withholdingFlg|" th:checked="*{withholdingFlg}">
					<span class="checkbox_txt">源泉徴収あり</span>
				</label>
			</div>
		</div>
		<div class="doc_data_action">
			<button type="button" class="btn btn-light btn_icon_only deleteInvoiceRow">
				<i class="fas fa-times"></i>
			</button>
			<input type="checkbox" class="checkbox_input deleteFlg" th:id="|invoiceRowList${invoiceRowCount}.deleteFlg|" th:name="|invoiceRowList[${invoiceRowCount}].deleteFlg|" th:checked="*{deleteFlg == true}">
			<input type="checkbox" class="checkbox_input addFlg" th:id="|invoiceRowList${invoiceRowCount}.addFlg|" th:name="|invoiceRowList[${invoiceRowCount}].addFlg|" th:checked="*{addFlg == true}">
			<input type="checkbox" class="checkbox_input unPaidFeeFlg" th:id="|invoiceRowList${invoiceRowCount}.unPaidFeeFlg|" th:name="|invoiceRowList[${invoiceRowCount}].unPaidFeeFlg|" th:checked="*{unPaidFeeFlg == true}">
			<input type="checkbox" class="checkbox_input rowExpenseSumFlg" th:id="|invoiceRowList${invoiceRowCount}.rowExpenseSumFlg|" th:name="|invoiceRowList[${invoiceRowCount}].rowExpenseSumFlg|" th:checked="*{rowExpenseSumFlg == true}">
			<input type="checkbox" class="checkbox_input displayFlg" th:id="|invoiceRowList${invoiceRowCount}.displayFlg|" th:name="|invoiceRowList[${invoiceRowCount}].displayFlg|" th:checked="*{displayFlg == true}">
		</div>
	</div>
</li>
<!--/* 値引き用請求入力（1行）追加フラグメント end */-->

<!--/* テキスト用請求入力（1行）追加フラグメント start */-->
<li th:fragment="invoiceRowTextInputFragment(invoiceRowInputForm)" th:id="|invoiceRow_${invoiceRowCount}|" class="invoiceRow" th:object="${invoiceRowInputForm}" th:with="invoiceRowCount=${invoiceRowInputForm.invoiceRowCount}" th:classappend="${invoiceRowInputForm.displayFlg == false}? 'hidden' : ''">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#invoiceRow_" + /*[[ ${invoiceRowCount} ]]*/);
		
		$(".transactionDate").datepicker();
		
	});
	</script>
	
	<input type="hidden" class="feeFlg" th:id="|invoiceRowList${invoiceRowCount}.feeFlg|" th:name="|invoiceRowList[${invoiceRowCount}].feeFlg|" value="false">
	<input type="hidden" class="depositRecvFlg" th:id="|invoiceRowList${invoiceRowCount}.depositRecvFlg|" th:name="|invoiceRowList[${invoiceRowCount}].depositRecvFlg|" value="false">
	<input type="hidden" class="discountFlg" th:id="|invoiceRowList${invoiceRowCount}.discountFlg|" th:name="|invoiceRowList[${invoiceRowCount}].discountFlg|" value="false">
	<input type="hidden" class="textFlg" th:id="|invoiceRowList${invoiceRowCount}.textFlg|" th:name="|invoiceRowList[${invoiceRowCount}].textFlg|" value="true">
	<input type="hidden" class="docInvoiceSeq" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceSeq|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceSeq|" th:value="*{docInvoiceSeq}">
	<input type="hidden" class="docInvoiceDepositSeq" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceDepositSeq|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceDepositSeq|" th:value="*{docInvoiceDepositSeq}">
	<input type="hidden" class="accgDocSeq" th:id="|invoiceRowList${invoiceRowCount}.accgDocSeq|" th:name="|invoiceRowList[${invoiceRowCount}].accgDocSeq|" th:value="*{accgDocSeq}">
	<input type="hidden" class="feeSeq" th:id="|invoiceRowList${invoiceRowCount}.feeSeq|" th:name="|invoiceRowList[${invoiceRowCount}].feeSeq|" th:value="*{feeSeq}">
	<input type="hidden" class="docInvoiceOrder" th:id="|invoiceRowList${invoiceRowCount}.docInvoiceOrder|" th:name="|invoiceRowList[${invoiceRowCount}].docInvoiceOrder|" th:value="*{docInvoiceOrder}">
	<input type="hidden" class="invoiceRowCount" th:id="|invoiceRowList${invoiceRowCount}.invoiceRowCount|" th:name="|invoiceRowList[${invoiceRowCount}].invoiceRowCount|" th:value="*{invoiceRowCount}">
	<input type="hidden" class="index" th:value="${invoiceRowCount}">
	<div class="doc_row_data docRowData">
		<div class="doc_grip_vertical p-0">
			<!--/* 並び替え用マーク */-->
			<div class="stop-events sortableObjWrap move_point justify-content-center sortableObj">
				<span class="btn btn-light btn_icon_only move_point_btn">
					<i class="fas fa-grip-vertical"></i>
				</span>
			</div>
		</div>
		<div class="doc_data_date">
			<input type="text" class="form-control modal_date digit7 inputDateSlash transactionDate " autocomplete="off"
				th:id="|invoiceRowList${invoiceRowCount}.transactionDate|" th:name="|invoiceRowList[${invoiceRowCount}].transactionDate|" th:value="*{transactionDate}">
		</div>
		<div class="doc_data_contetns">
			<div class="mb-1">
				<input type="text" class="form-control" maxlength="30" placeholder="項目" autocomplete="off" th:data-index="${invoiceRowCount}"
					th:id="|invoiceRowList${invoiceRowCount}.ItemName|" th:name="|invoiceRowList[${invoiceRowCount}].itemName|" th:value="*{itemName}">
			</div>
		</div>
		<div class="doc_data_amount">
		</div>
		<div class="doc_data_type">
			<!-- 今回の入力フォームでテキスト追加のリンクから新規追加したもの以外は、種別変更のSelectはdisabledとする -->
			<th:block th:unless="*{isCanEditInvoieTypeForInvoiceFeeOrOther()}">
				<!-- disabledにする -->
				<select disabled class="form-control">
					<option th:value="*{invoieType}" th:text="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).of(invoieType).val}"></option>
				</select>
				<input type="hidden" th:id="|invoiceRowList${invoiceRowCount}.invoieType|" th:name="|invoiceRowList[${invoiceRowCount}].invoieType|" th:value="*{invoieType}">
			</th:block>
			<th:block th:if="*{isCanEditInvoieTypeForInvoiceFeeOrOther()}">
				<!-- disabledにはしない -->
				<select class="form-control" th:id="|invoiceRowList${invoiceRowCount}.invoieType|" th:name="|invoiceRowList[${invoiceRowCount}].invoieType|">
					<option th:value="*{invoieType}" th:text="*{T(jp.loioz.common.constant.CommonConstant$InvoiceOtherItemType).of(invoieType).val}"></option>
				</select>
			</th:block>
		</div>
		<div class="doc_data_action">
			<button type="button" class="btn btn-light btn_icon_only deleteInvoiceRow">
				<i class="fas fa-times"></i>
			</button>
			<input type="checkbox" class="checkbox_input deleteFlg" th:id="|invoiceRowList${invoiceRowCount}.deleteFlg|" th:name="|invoiceRowList[${invoiceRowCount}].deleteFlg|" th:checked="*{deleteFlg == true}">
			<input type="checkbox" class="checkbox_input addFlg" th:id="|invoiceRowList${invoiceRowCount}.addFlg|" th:name="|invoiceRowList[${invoiceRowCount}].addFlg|" th:checked="*{addFlg == true}">
			<input type="checkbox" class="checkbox_input unPaidFeeFlg" th:id="|invoiceRowList${invoiceRowCount}.unPaidFeeFlg|" th:name="|invoiceRowList[${invoiceRowCount}].unPaidFeeFlg|" th:checked="*{unPaidFeeFlg == true}">
			<input type="checkbox" class="checkbox_input rowExpenseSumFlg" th:id="|invoiceRowList${invoiceRowCount}.rowExpenseSumFlg|" th:name="|invoiceRowList[${invoiceRowCount}].rowExpenseSumFlg|" th:checked="*{rowExpenseSumFlg == true}">
			<input type="checkbox" class="checkbox_input displayFlg" th:id="|invoiceRowList${invoiceRowCount}.displayFlg|" th:name="|invoiceRowList[${invoiceRowCount}].displayFlg|" th:checked="*{displayFlg == true}">
		</div>
	</div>
</li>
<!--/* テキスト用請求入力（1行）追加フラグメント end */-->

<!--/* お振込先表示フラグメント start */-->
<div th:fragment="bankDetailViewFragment(bankDetailViewForm)" id="bankDetailViewFragment" th:object="${bankDetailViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#bankDetailViewFragment");
	});
	</script>
	<div class="doc_view" myth:nl2br="*{#strings.isEmpty(tenantBankDetail)} ? '(未設定)' : *{tenantBankDetail}"
		th:classappend="*{#strings.isEmpty(tenantBankDetail)} ? 'fc_disabled fc14' "></div>
</div>
<!--/* お振込先表示フラグメント end */-->

<!--/* お振込先入力フラグメント start */-->
<div th:fragment="bankDetailInputFragment(bankDetailInputForm)" id="bankDetailInputFragment" class="doc_view_edit" th:object="${bankDetailInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#bankDetailInputFragment");
		
		const bankDetailInputFragment = $('#bankDetailInputFragment');
		
		<!--/* お振込先入力フラグメント保存処理 */-->
		bankDetailInputFragment.on("click", ".saveBankDetail", function() {
			<!--/* リクエストパラメータ */-->
			const formData = $('#bankDetailInputForm').serializeArray();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve(formData)
				.then(saveBankDetailFunc)
				.then(renderBankDetailViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* お振込先フラグメント閉じる処理 */-->
		bankDetailInputFragment.on("click", ".closeBankDetail", function() {
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(renderBankDetailViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<form id="bankDetailInputForm">
		<textarea class="form-control w-100 mb-2" rows="3" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_TENANT_BANK_DETAIL)}" th:field="*{tenantBankDetail}">
			三井住友銀行 新宿西口支店（支店番号 123）
			普通口座　1234567　口座名義　カ）ロイオズ
		</textarea>
		<div th:if="*{#fields.hasErrors('tenantBankDetail')}" th:errors="*{tenantBankDetail}" class="error_mag_point">error</div>
	</form>
	<div class="text-right mt-3 mb-2">
		<button type="button" class="btn btn-danger btn-sm saveBankDetail"><i class="fas fa-check"></i>保存</button>
		<button type="button" class="btn btn-light btn-sm ml-2 closeBankDetail"><i class="fas fa-times ml-1"></i>閉じる</button>
	</div>
</div>
<!--/* お振込先入力フラグメント end */-->

<!--/* 備考表示フラグメント start */-->
<div th:fragment="remarksViewFragment(remarksViewForm)" id="remarksViewFragment" th:object="${remarksViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#remarksViewFragment");
	});
	</script>
	<div class="doc_view" th:classappend="*{#strings.isEmpty(remarks)} ? 'fc_disabled fc14' "
		myth:nl2br="*{#strings.isEmpty(remarks)} ? '(未設定)' : *{remarks}">
		※次回請求月は3月です。
	</div>
</div>
<!--/* 備考表示フラグメント end */-->

<!--/* 備考入力フラグメント start */-->
<div th:fragment="remarksInputFragment(remarksInputForm)" id="remarksInputFragment" class="doc_view_edit docRemark" th:object="${remarksInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#remarksInputFragment");
		
		const remarksInputFragment = $('#remarksInputFragment');
		
		<!--/* 備考入力フラグメント保存処理 */-->
		remarksInputFragment.on("click", ".saveRemarks", function() {
			<!--/* リクエストパラメータ */-->
			const formData = $('#remarksInputForm').serializeArray();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve(formData)
				.then(saveRemarksFunc)
				.then(renderRemarksViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* お振込先フラグメント閉じる処理 */-->
		remarksInputFragment.on("click", ".closeRemarks", function() {
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			Promise.resolve()
				.then(renderRemarksViewFragment)
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
	});
	</script>
	<form id="remarksInputForm">
		<textarea class="form-control w-100 mb-2" rows="5" th:maxlength="${(T(jp.loioz.common.constant.AccgConstant).MX_LEN_REMARKS)}" th:field="*{remarks}">※次回請求月は3月です。</textarea>
		<div th:if="*{#fields.hasErrors('remarks')}" th:errors="*{remarks}" class="error_mag_point">error</div>
	</form>
	<div class="text-right mt-3 mb-2">
		<button type="button" class="btn btn-info btn-sm saveRemarks"><i class="fas fa-check"></i>保存</button>
		<button type="button" class="btn btn-light btn-sm ml-3 closeRemarks"><i class="fas fa-times ml-1"></i>閉じる</button>
	</div>
</div>
<!--/* 備考入力フラグメント end */-->

<!--/* 請求書タブフラグメント start */-->
<div th:fragment="docInvoicePdfFragment(docInvoicePdfViewForm)" id="docInvoicePdfFragment" th:object="${docInvoicePdfViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#docPdfFragment");
		const docInvoicePdfFragment = $('#docInvoicePdfFragment');
		
		<!--/*  請求書プレビューを表示 */-->
		docInvoicePdfFragment.find('.pdfPreview').on('click', function() {
			const invoiceSeq = getInvoiceSeq();
			const url = `/user/invoiceDetail/${invoiceSeq}/docInvoicePdfPreview`
			const pdfview = window.open(url, 'rel=noopener').focus();
		});
		
	});
	</script>
	<div class="text-right my-3">
		<button type="button" class="btn btn-light pdfPreview"><i class="far fa-file-pdf text-danger"></i>PDFプレビュー</button>
	</div>
	<div class="doc_preview" th:each="page : *{invoicePngSrc}">
		<img th:src="${page}">
	</div>
</div>
<!--/* 請求書タブフラグメント end */-->

<!--/* 精算書タブフラグメント start */-->
<div th:fragment="docStatementPdfFragment(docStatementPdfViewForm)" id="docStatementPdfFragment" th:object="${docStatementPdfViewForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#docStatementPdfFragment");
		const docStatementPdfFragment = $('#docStatementPdfFragment');
		
		<!--/* 精算書プレビューを表示 */-->
		docStatementPdfFragment.find('.pdfPreview').on('click', function() {
			const url = getContextPath() + "/docStatementPdfPreview";
			const pdfview = window.open(url, 'rel=noopener').focus();
		});

	});
	</script>
	<div class="text-right my-3">
		<button type="button" class="btn btn-light pdfPreview"><i class="far fa-file-pdf text-danger"></i>PDFプレビュー</button>
	</div>
	<div class="doc_preview" th:each="page : *{statementPngSrc}">
		<img th:src="${page}">
	</div>
</div>
<!--/* 精算書タブフラグメント end */-->

<!--/* 実費明細タブフラグメント start */-->
<div th:fragment="dipositRecordPdfFragment" id="dipositRecordPdfFragment" th:object="${dipositRecordPdfViewForm}"
	th:with="
		isStatement=*{accgDocType == T(jp.loioz.common.constant.CommonConstant$AccgDocType).STATEMENT},
		isInvoice=*{accgDocType == T(jp.loioz.common.constant.CommonConstant$AccgDocType).INVOICE}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#dipositRecordPdfFragment");
		const dipositRecordPdfFragment = $('#dipositRecordPdfFragment');
		
		<!--/* 請求書の場合 */-->
		/*[# th:if="${isInvoice}"]*/
		<!--/* 実費明細プレビューを表示 */-->
		dipositRecordPdfFragment.find('.pdfPreview').on('click', function() {
			const invoiceSeq = getInvoiceSeq();
			const url = `/user/invoiceDetail/${invoiceSeq}/dipositRecordPdfPreview`
			const pdfview = window.open(url, 'rel=noopener').focus();
		});
		/*[/]*/
		
		<!--/* 精算書の場合 */-->
		/*[# th:if="${isStatement}"]*/
		dipositRecordPdfFragment.find('.pdfPreview').on('click', function() {
			const url = getContextPath() + "/dipositRecordPdfPreview";
			const pdfview = window.open(url, 'rel=noopener').focus();
		});
		/*[/]*/
		
	});
	</script>
	<!--/* 実費明細-詳細 */-->
	<div class="text-right my-3">
		<button type="button" class="btn btn-light pdfPreview"><i class="far fa-file-pdf text-danger"></i>PDFプレビュー</button>
	</div>
	<div class="doc_preview" th:each="page : *{depositRecordPngSrc}">
		<img th:src="${page}">
	</div>
</div>
<!--/* 実費明細タブフラグメント end */-->

<!--/* 支払計画表タブフラグメント start */-->
<div th:fragment="paymentPlanFragment(paymentPlanConditionViewForm)" id="paymentPlanFragment" th:object="${paymentPlanConditionViewForm}">
	<script type="text/javascript" th:inline="javascript" th:replace="common/mvc/accgPaymentPlanEdit/accgInvoiceStatementPaymentPlanEditModal::shiharaiPlanEditFragmentJs"></script>
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#paymentPlanFragment");
		
		const paymentPlanFragment = $('#paymentPlanFragment');
		const accgInvoiceStatementPaymentPlanEditModal = paymentPlanFragment.find('#accgInvoiceStatementPaymentPlanEditModal');
		
		<!--/* PDFの再取得 */-->
		paymentPlanFragment.find(".rebuild").on("click", function() {
			if (ajaxRunning) {
				return false;
			}
			const invoiceSeq = getInvoiceSeq();
			const url = `/user/invoiceDetail/${invoiceSeq}/rebuildInvoicePlanPdf`
			
			ajaxRunning = true;
			Promise.resolve()
				.then(() => {
					return new Promise((resolve, reject) => {
						$.ajax({
							url : url,
							type : "POST",
						})
						.done(function(data, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								return resolve();
							} else {
								<!--/* 処理失敗 */-->
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessageFadeOutForJs(errorMsg);
								return reject();
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							showErrorMessageFadeOutForJs(/*[[#{E00091}]]*/"データの取得に失敗しました。");
							return reject();
						});
					});
				})
				.then(renderDocContentsSelectedViewFragment)
				.then(renderPaymentPlanConditionViewFragment)
				.catch((errorObj) => {/*何もしない*/})
				.finally(() => {ajaxRunning = false;});
		});
		
		<!--/* 表示エリアの押下 */-->
		paymentPlanFragment.find(".paymentPlanSettingEdit").on("click", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			$.ajax({
				url : "getPaymentPlanConditionInputFragment",
				type : "GET",
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					paymentPlanFragment.find('.paymentPlanSettingWrapper').html(data);
					paymentPlanFragment.find('.paymentPlanSettingWrapper').addClass('edit_mode');
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageFadeOutForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageFadeOutForJs(/*[[#{E00059}]]*/"データの取得に失敗しました。");
			})
			.always(function() {
				ajaxRunning = false;
			});
			
		});
		
		<!--/* 直接編集ボタンを押下 */-->
		paymentPlanFragment.on("click", ".paymentPlanEdit", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			const invoiceSeq = $(this).data("invoiceSeq");
			Promise.resolve()
				.then(() => createAccgInvoiceStatementPaymentPlanEditModal(invoiceSeq))
				.then(() => $("#accgInvoiceStatementPaymentPlanEditModal").modal("show"))
				.catch((errorObj) => console.log(errorObj))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 支払計画編集モーダルを開く */-->
		function createAccgInvoiceStatementPaymentPlanEditModal(invoiceSeq) {
			return new Promise((resolve, reject) => {
				const param = [
					{name:"invoiceSeq", value:invoiceSeq}
				];
				$.ajax({
					url : "/common/mvc/accgInvoiceStatementPaymentPlanEdit/createAccgInvoiceStatementPaymentPlanEditModal",
					type : "GET",
					data : param,
					dataType: 'html',
				}).done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* ツールチップを非表示にする */-->
						$('[data-toggle="tooltip"]').tooltip('hide');
						$('.accgInvoiceStatementPaymentPlanEditModalFragmentWrap').html(data);
						return resolve();
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageFadeOutForJs(errorMsg);
						return reject(errorMsg);
					}
				}).fail(function() {
					showErrorMessageFadeOutForJs(/*[[#{E00059}]]*/"データの取得に失敗しました。");
					return reject();
				})
			});
		}
		
		<!--/* 支払計画プレビューを表示 */-->
		paymentPlanFragment.find('.pdfPreview').on('click', function() {
			const invoiceSeq = getInvoiceSeq();
			const url = `/user/invoiceDetail/${invoiceSeq}/planPreview`
			const pdfview = window.open(url, 'rel=noopener').focus();
		});
		
		<!--/* 保存完了処理を設定 */-->
		accgInvoiceStatementPaymentPlanEditModal.on('show.bs.modal', function(e) {
			benzo.global.fragment.shiharaiPlanEditFragment.setUpObj.registSuccessAction = (e) => {
				Promise.resolve()
					.then(renderPaymentPlanConditionViewFragment)
					.then(renderDocContentsSelectedViewFragment)
					.catch(() => {/*なにもしない*/})
					.finally(() => {/*なにもしない*/});
			};
		});
		
	});
	</script>
	<section class="mt-4 pt-2">
		<div class="alert alert-warning d-flex" role="alert" th:if="*{LostPlanPdf}">
			<i class="fas fa-exclamation-circle mt-1 mr-2"></i>
			<div>
				分割予定の取得に失敗しました。
			</div>
			<div class="ml-auto"><button type="button" class="btn btn-light rebuild">再取得</button></div>
		</div>
		<div class="alert alert-warning d-flex" role="alert" th:if="*{needReCreatePlan && !LostPlanPdf}">
			<i class="fas fa-exclamation-circle mt-1 mr-2"></i>
			<div>
				分割予定の作成時と請求金額が変更されています。<br>
				支払条件の設定を行い、再作成をしてください。
			</div>
		</div>
		
		<th:block th:if="!*{LostPlanPdf}">
			<div class="section_block_header">
				<div class="section_block_title">
					<span class="badge badge-pill accg_label badge_cyan">支払条件</span>
				</div>
			</div>
			<div class="section_block_body">
				
				<div class="doc_view_wrapper doc_edit_target paymentPlanSettingWrapper">
					<div class="doc_view" th:classappend="!*{Issued}?'paymentPlanSettingEdit':_">
						<div class="d-flex">
							<div class="flex-grow-1">
								<label class="doc_label">支払金額（月額）</label>
								<div class="doc_value">
									<span th:text="*{#strings.defaultString(monthPaymentAmount,'-')}"></span>
									<span class="fs12 ml-1">円</span>
								</div>
							</div>
							<div class="flex-grow-1">
								<label class="doc_label">支払開始年月</label>
								<div class="doc_value" th:text="*{#strings.defaultString(getPaymentStartDateFormat(),'-')}">2022年11月</div>
							</div>
							<div class="flex-grow-1">
								<label class="doc_label">支払日</label>
								<div class="doc_value" th:text="*{#strings.defaultString(getMonthPaymentDateFormat(),'-')}">月末</div>
							</div>
							<div class="flex-grow-1">
								<label class="doc_label">端数</label>
								<div class="doc_value" th:text="*{#strings.defaultString(fractionalMonthType?.val, '-')}">初回</div>
							</div>
							<div class="flex-grow-1">
								<label class="doc_label">支払回数</label>
								<div class="doc_value">
									<span th:text="*{#strings.defaultString(numberOfPayment, '-')}">12</span>
									<span class="fs13">回</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="text-right my-3">
					<div class="d-inline-block" th:if="*{!#lists.isEmpty(planPngSrc)}">
						<button type="button" class="btn btn-light pdfPreview"><i class="far fa-file-pdf text-danger"></i>PDFプレビュー</button>
					</div>
					<div class="d-inline-block ml-3" th:if="*{!Issued && canPlanEdit}">
						<button type="button" class="btn btn-light paymentPlanEdit" th:data-invoice-seq="*{invoiceSeq}">分割予定表を編集</button>
					</div>
				</div>
				<div id="planPngCreatingMsgWrap">
				</div>
				<div id="planPngWrap">
					<div class="doc_preview" th:each="page : *{planPngSrc}">
						<img th:src="${page}">
					</div>
				</div>
			</div>
		</th:block>
	</section>

	<!--/* 支払計画編集Modal start */-->
	<div id="accgInvoiceStatementPaymentPlanEditModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="paymentPlanEditTitle" aria-hidden="true" data-backdrop="static">
		<div class="modal-dialog modal-dialog-centered modal_payment_plan" role="document">
			<div class="modal-content">
				<div class="accgInvoiceStatementPaymentPlanEditModalFragmentWrap"></div>
			</div>
		</div>
	</div>
	<!--/* 支払計画編集Modal end */-->

</div>
<!--/* 支払計画表タブフラグメント end */-->

<!--/* PDF作成中 タブフラグメント start */-->
<div th:fragment="pdfCreatingFragment" id="pdfCreatingFragment" class="text-center" th:object="${pdfCreatingViewForm}">
	<div class="my-5 fs18 fw600">
		<i class="fas fa-spinner text-primary faa-spin animated mr-2"></i>
		<span th:text="|*{accgDocFileType.getVal()}を作成中|"></span></div>
</div>
<!--/* PDF作成中 タブフラグメント end */-->

<!--/* 支払計画：条件入力用フラグメント */-->
<div th:fragment="paymentPlanConditionInputFragment" id="paymentPlanConditionInputFragment" th:object="${paymentPlanConditionInputForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		
		<!--/* 定数 */-->
		const paymentPlanConditionInputFragment = $('#paymentPlanConditionInputFragment');
		
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#paymentPlanConditionInputFragment");
		
		<!--/* 支払日のラジオボタン変更 */-->
		paymentPlanConditionInputFragment.find(".shiharaiMonthDayType").on('change', function() {
			const shiharaiMonthDayType = $(this).val();
			if (shiharaiMonthDayType === /*[[${T(jp.loioz.common.constant.CommonConstant$SeisanShiharaiMonthDay).LASTDAY}]]*/"1") {
				paymentPlanConditionInputFragment.find(".monthPaymentDd").prop('disabled', true);
			} else {
				paymentPlanConditionInputFragment.find(".monthPaymentDd").prop('disabled', false);
			}
		});
		
		<!--/* 登録ボタン押下アクション */-->
		paymentPlanConditionInputFragment.find(".regist").on('click', function() {
			if (ajaxRunning) {
				return false;
			}
			
			const formData = getFormSerializeArray();
			
			ajaxRunning = true;
			
			Promise.resolve(formData)
				<!--/* 作成中メッセージを表示 */-->
				.then(renderPaymentPlanPdfCreatingViewFragment)
				.then((params) => {
					return new Promise((resolve, reject) => {
						$.ajax({
							url : /*[[@{/user/invoiceDetail/{invoiceSeq}/registPaymentPlanCondition(invoiceSeq=*{invoiceSeq})}]]*/'',
							type : "POST",
							data : params
						})
						.done(function(data, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								// 正常終了
								showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR));
								return resolve();
							} else {
								// 処理失敗
								if (data) {
									$('#paymentPlanFragment .paymentPlanSettingWrapper').html(data);
								}
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessageFadeOutForJs(errorMsg);
								return reject();
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							showErrorMessageFadeOutForJs(/*[[#{E00091}]]*/"error");
							return reject();
						});
					});
				})
				.then(renderPaymentPlanConditionViewFragment)
				.catch(() => {
					<!--/* 作成中メッセージを消す */-->
					deletePaymentPlanPdfCreatingViewFragment();
				})
				.finally(() => {
					ajaxRunning = false;
				});
		});
		
		<!--/* 更新ボタン押下アクション */-->
		paymentPlanConditionInputFragment.find(".update").on('click', function() {
			<!--/* 確認コンファームで「はい」ボタン押下処理をセットアップ */-->
			benzo.global.fragment.confirmModalFragmentObj.setUpObj.okAction = (e) => {
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				
				<!--/* モーダルを閉じる */-->
				$("#confirmModal").modal("hide");
				
				const formData = getFormSerializeArray();
				
				<!--/* 現在表示されているPNG画像を非表示にする */-->
				$("#planPngWrap").addClass("hidden");
				
				Promise.resolve(formData)
					<!--/* 作成中メッセージを表示 */-->
					.then(renderPaymentPlanPdfCreatingViewFragment)
					.then((params) => {
						return new Promise((resolve, reject) => {
							$.ajax({
								url : /*[[@{/user/invoiceDetail/{invoiceSeq}/updatePaymentPlanCondition(invoiceSeq=*{invoiceSeq})}]]*/'',
								type : "POST",
								data : params
							})
							.done(function(data, status, jqXHR) {
								if (isAjaxProcSuccess(jqXHR)) {
									// 正常終了
									showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR));
									return resolve();
								} else {
									// 処理失敗
									if (data) {
										$('#paymentPlanFragment .paymentPlanSettingWrapper').html(data);
									}
									const errorMsg = getAjaxProcResutlMessage(jqXHR);
									showErrorMessageFadeOutForJs(errorMsg);
									return reject();
								}
							})
							.fail(function(jqXHR, status, errorThrown) {
								showErrorMessageFadeOutForJs(/*[[#{E00091}]]*/"error");
								return reject();
							});
						});
					})
					.then(renderPaymentPlanConditionViewFragment)
					.then(renderDocContentsSelectedViewFragment)
					.catch(() => {
						<!--/* 作成中メッセージを消す */-->
						deletePaymentPlanPdfCreatingViewFragment();
						<!--/* 表示されていたPNG画像を再表示する */-->
						$("#planPngWrap").removeClass("hidden");
					})
					.finally(() => {
						ajaxRunning = false;
					});
			};
			
			<!--/* コンファーム表示 */-->
			benzo.global.fragment.confirmModalFragmentObj.paramObj.confirmTitle = /*[[#{confirm.C00006('分割予定表')}]]*/;
			benzo.global.fragment.confirmModalFragmentObj.paramObj.message = '';
			benzo.global.fragment.confirmModalFragmentObj.paramObj.noBtnDispFlg = false;
			$("#confirmModal").modal("show");
		});
		
		<!--/* 閉じる */-->
		paymentPlanConditionInputFragment.find(".closeArea").on('click', function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			Promise.resolve()
				.then(renderPaymentPlanConditionViewFragment)
				.catch(() => {/*なにもしない*/})
				.finally(() => {
					ajaxRunning = false;
				});
		});
		
		<!--/* 入力フォームパラメータを取得する */-->
		function getFormSerializeArray() {
			<!--/* 一度カンマを外す */-->
			paymentPlanConditionInputFragment.find('.planPaymentConditionInputForm .commaFormat').each(function() {
				$(this).unformatComma();
			});
			
			<!--/* パラメータを作成 */-->
			const formParam = paymentPlanConditionInputFragment.find('.planPaymentConditionInputForm').serializeArray();
			
			<!--/* カンマを付与 */-->
			paymentPlanConditionInputFragment.find('.planPaymentConditionInputForm .commaFormat').each(function() {
				$(this).formatComma();
			});
			
			return formParam;
		}
		
	});
	</script>
	<form class="planPaymentConditionInputForm" th:autocomplete="off">
		<input type="hidden" th:field="*{New}">
		<input type="hidden" th:field="*{invoiceSeq}">
	
		<div class="doc_view_edit">
			<div class="form-row">
				<div class="form-group col-md-auto pr-3">
					<label class="top_label">支払金額（月額）</label>
					<input type="text" class="form-control text-right digit8 fs14 commaFormat inputNumberOnly" th:field="*{monthPaymentAmount}"  maxlength="10">
					<div th:if="*{#fields.hasErrors('monthPaymentAmount')}" th:errors="*{monthPaymentAmount}" class="error_mag_point">error</div>
				</div>
				<div class="form-group col-md-auto pr-3">
					<label class="top_label">支払開始年月</label>
					<div class="d-flex">
						<select class="form-control digit7" th:field="*{year}">
							<option value="">-</option>
							<option th:each="option : *{yearSelectOptionFormList}"
								th:value="${option.value}" th:text="${option.label}"></option>
						</select>
						<select class="form-control digit4 ml-2" th:field="*{month}">
							<option value="">-</option>
							<option th:each="num : ${#numbers.sequence(1,12)}" th:value="${num}" th:text="|${num}月|"></option>
						</select>
					</div>
					<div th:if="*{#fields.hasErrors('year')}" th:errors="*{year}" class="error_mag_point">error</div>
					<div th:if="*{#fields.hasErrors('month')}" th:errors="*{month}" class="error_mag_point">error</div>
				</div>
				<div class="form-group col-md-auto pr-3">
					<label class="top_label">支払日</label>
					<div class="d-flex align-items-center">
						<div class="">
							<label class="radio_btn" th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$SeisanShiharaiMonthDay).values()}">
								<input type="radio" class="radio_input shiharaiMonthDayType" th:value="${enum.cd}" th:field="*{seisanShiharaiMonthDay}">
								<span class="radio_txt" th:text="${#strings.defaultString(enum.val, '&nbsp;')}"></span>
							</label>
						</div>
						<select class="form-control digit4 monthPaymentDd" th:disabled="*{T(jp.loioz.common.constant.CommonConstant$SeisanShiharaiMonthDay).LASTDAY.equalsByCode(seisanShiharaiMonthDay)}" th:field="*{monthPaymentDd}">
							<option th:each="num : ${#numbers.sequence(1,29)}" th:value="${num}" th:text="${num}"></option>
						</select>
						<div class="ml-2">日払い</div>
					</div>
					<div th:if="*{#fields.hasErrors('seisanShiharaiMonthDay')}" th:errors="*{seisanShiharaiMonthDay}" class="error_mag_point">error</div>
					<div th:if="*{#fields.hasErrors('monthPaymentDd')}" th:errors="*{monthPaymentDd}" class="error_mag_point">error</div>
				</div>
				<div class="form-group col-md-auto pr-3">
					<label class="top_label">端数</label>
					<div class="pt-1">
						<label class="radio_btn" th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$FractionalMonthType).values()}">
							<input type="radio" class="radio_input " th:value="${enum.cd}" th:field="*{fractionalMonthType}">
							<span class="radio_txt" th:text="${enum.val}"></span>
						</label>
					</div>
					<div th:if="*{#fields.hasErrors('fractionalMonthType')}" th:errors="*{fractionalMonthType}" class="error_mag_point">error</div>
				</div>
			</div>
			<div class="text-right">
				<button type="button" th:if="*{isNew()}" class="btn btn-info btn-sm regist">分割予定表を作成する</button>
				<button type="button" th:if="!*{isNew()}" class="btn btn-info btn-sm update">分割予定表を再作成する</button>
				<button type="button" class="btn btn-light btn-sm ml-2 closeArea">閉じる</button>
			</div>
		</div>
	</form>
</div>
<!--/* 支払計画：条件入力用フラグメント end */-->

<!--/* 進行状況フラグメント start */-->
<div th:fragment="docActivityFragment(docActivityForm)" id="docActivityFragment" th:object="${docActivityForm}">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		
		<!--/* 定数 */-->
		const docActivityFragment = $("#docActivityFragment");
		
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement("#docActivityFragment");
		
		<!--/* 会計書類送付ファイルのポップオーバー表示 */-->
		benzo.global.fragment.setUpAccgSendFilePopover(docActivityFragment.find(".setUpSendFilePopover"), {});
		
		<!--/* 新規作成のリンク押下 */-->
		docActivityFragment.on("click", ".createDocActivity", function(){
			const className = $(this).attr("class");
			if (className.match('createActivityClose')) {
				<!--/* 履歴を全て表示 */-->
				$(this).removeClass('createActivityClose');
				docActivityFragment.find('#closeCreateActivity').addClass('hidden');
				docActivityFragment.find('#openCreateActivity').removeClass('hidden');
				docActivityFragment.find('.createDocActivityList').removeClass('show_last');
			} else {
				<!--/* 履歴を直近1件のみ表示 */-->
				$(this).addClass('createActivityClose');
				docActivityFragment.find('#closeCreateActivity').removeClass('hidden');
				docActivityFragment.find('#openCreateActivity').addClass('hidden');
				docActivityFragment.find('.createDocActivityList').addClass('show_last');
			}
		});
		
		<!--/* 発行のリンク押下 */-->
		$('#docActivityFragment').on("click", ".issueDocActivity", function(){
			const className = $(this).attr("class");
			if (className.match('issueActivityClose')) {
				<!--/* 履歴を全て表示 */-->
				$(this).removeClass('issueActivityClose');
				docActivityFragment.find('#closeIssueActivity').addClass('hidden');
				docActivityFragment.find('#openIssueActivity').removeClass('hidden');
				docActivityFragment.find('.issueDocActivityList').removeClass('show_last');
			} else {
				<!--/* 履歴を直近1件のみ表示 */-->
				$(this).addClass('issueActivityClose');
				docActivityFragment.find('#closeIssueActivity').removeClass('hidden');
				docActivityFragment.find('#openIssueActivity').addClass('hidden');
				docActivityFragment.find('.issueDocActivityList').addClass('show_last');
			}
		});
		
	});
	</script>
	<div class="doc_status">
		<div class="doc_status__title">進行状況</div>
	</div>
	<div class="doc_status_detail border-bottom-0 mb-0">
		<th:block th:unless="*{#lists.isEmpty(newDocActivityList)}">
			<ul class="doc_status_detail__list">
				<li>
					<th:block th:if="*{created}">
						<div class="action_title">
							<i class="fas fa-check-circle status_comp"></i>
							<th:block th:if="*{newDocActivityList.size()} > 1">
								<a class="createDocActivity createActivityClose" href="javascript:void(0);">
									<span>新規作成</span>
								</a>
								<i id="closeCreateActivity" class="fas fa-chevron-right ml-2"></i>
								<i id="openCreateActivity" class="fas fa-chevron-down ml-2 hidden"></i>
							</th:block>
							<th:block th:if="*{newDocActivityList.size()} == 1">
								<span>新規作成</span>
							</th:block>
						</div>
						<div class="action_data show_last createDocActivityList" th:each="activity, stat : *{newDocActivityList}">
							<div th:text="${activity.activityByName}">山田　太郎</div>
							<div th:text="${activity.getBaseDateFormat()}">2022-08-12 10:59</div>
						</div>
					</th:block>
					<th:block th:unless="*{created}">
						<div class="action_title"><i class="fas fa-circle status_standby"></i><span>新規作成</span></div>
						<div class="action_data">
							<span class="standby_label">未処理</span>
						</div>
					</th:block>
				</li>
			</ul>
		</th:block>
		<th:block th:unless="*{#lists.isEmpty(issueDocActivityList)}">
			<ul class="doc_status_detail__list">
				<li>
					<th:block th:if="*{issued}">
						<div class="action_title">
							<i class="fas fa-check-circle status_comp"></i>
							<th:block th:if="*{issueDocActivityList.size()} > 1">
								<a class="issueDocActivity issueActivityClose" href="javascript:void(0);">
									<span>発行</span>
								</a>
								<i id="closeIssueActivity" class="fas fa-chevron-right ml-2"></i>
								<i id="openIssueActivity" class="fas fa-chevron-down ml-2 hidden"></i>
							</th:block>
							<th:block th:if="*{issueDocActivityList.size()} == 1">
								<span>発行</span>
							</th:block>
						</div>
						<div class="action_data show_last issueDocActivityList" th:each="activity, stat : *{issueDocActivityList}">
							<div th:text="${activity.activityByName}">山田　太郎</div>
							<div th:text="${activity.getBaseDateFormat()}">2022-08-12 10:59</div>
						</div>
					</th:block>
					<th:block th:unless="*{issued}">
						<div class="action_title"><i class="fas fa-circle status_standby mr-2"></i><span>発行</span></div>
						<div class="action_data border-0"><span class="standby_label">未処理</span></div>
					</th:block>
				</li>
			</ul>
		</th:block>
		<th:block th:unless="*{#lists.isEmpty(sendDocActivityList)}">
			<ul th:if="!*{send}" class="doc_status_detail__list">
				<li>
					<div class="action_title"><i class="fas fa-circle status_standby mr-2"></i><span>送付</span></div>
					<div class="action_data border-0"><span class="standby_label">未処理</span></div>
				</li>
			</ul>
			<th:block th:if="*{send}" th:each="activity, stat : *{sendDocActivityList}">
				<ul class="doc_status_detail__list">
					<li>
						<div class="action_title">
							<i class="fas fa-check-circle status_comp"></i>
							<span>送付</span>
						</div>
						<div class="action_data sendDocActivityList">
							<div th:text="${activity.activityByName}"></div>
							<div th:id="|sendDocSelectot${stat.index}|"></div>
							<div>
								<span th:text="${activity.getBaseDateFormat()}"></span>
								<span class="doc_status__view ml-2">
									<a href="javascript:void(0);" class="setUpSendFilePopover under_line" th:data-selector="|#sendDocSelectot${stat.index}|"
										data-container="#docActivityFragment" th:text="${activity.accgDocSendType?.val}"
										th:data-accg-doc-act-send-seq="${activity.accgDocActSendSeq}"></a>
								</span>
							</div>
						</div>
						<div class="action_data pt-0" th:if="${T(jp.loioz.common.constant.CommonConstant$AccgDocSendType).WEB == activity.accgDocSendType}" th:each="file : ${activity.downloadStatus}">
							<div>
								<span class="fs13 fc_sub">
									<span th:text="${file.fileTypeName}"></span>ダウンロード状況：
								</span>
								<th:block th:if="${file.Downloaded}">
									<i class="fas fa-check-circle status_comp"></i>
									<span class="fs14 fw600 fc_sub">済</span>
								</th:block>
								<th:block th:if="!${file.Downloaded}">
									<i class="fas fa-circle status_standby"></i>
									<span class="fs14 fw600 fc_sub">未</span>
								</th:block>
							</div>
						</div>
					</li>
				</ul>
			</th:block>

		</th:block>
	</div>
</div>
<!--/* 進行状況フラグメント end */-->

<!--/* 項目データリストフラグメント start */-->
<div th:fragment="itemFragment" id="itemFragment">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		const itemFragment = $('#itemFragment');
		itemFragment.find('.item').on('click', function() {
			const itemName = $(this).data("name");
			$(this).closest('.docRowData').find('.searchItemName').val(itemName);
			$('.itemNameListFragmentWrap').html('');
		});
	});
	</script>
	<th:block th:unless="${#lists.isEmpty(itemList)}">
		<div class="popover_box_list popoverBox notAutoClose itemSearchPopover">
			<div class="popover_box_list__wm mxh300 of_y_scroll hover_scroll">
				<ul class="list-group">
					<li class="list-group-item item_search_data_list p-3 item" th:each="item : ${itemList}"
						th:text="${item.label}" th:data-item-seq="${item.value}" th:data-name="${item.label}">
					</li>
				</ul>
			</div>
		</div>
	</th:block>
</div>
<!--/* 項目データリストフラグメント end */-->

</body>
</html>
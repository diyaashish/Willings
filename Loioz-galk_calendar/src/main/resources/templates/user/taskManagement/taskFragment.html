<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8" />
</head>
<body>



<!--/* タスクメニュー */-->
<div th:fragment="menuList" class="nav_sidebar_user" id="menuList">

	<!--/* スクリプト */-->
	<script type="text/javascript" th:inline="javascript">	

	$(function() {

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		$(".fcAddTextClear").addClear({
			tabbable : false,
			right: 7,
			top: 9
		});

		<!--/* タスクメニュークリック時処理 */-->
		$('#menuList').on("click", ".taskMenu", function() {
			const selectedTabClass = $(this).data("tab");
			$('#selectedTabClass').val(selectedTabClass);
			<!--/* タスク詳細を閉じる */-->
			$('#taskDetailFragmentWrap').addClass("hidden");

			Promise.resolve()
				<!--/* サイドメニュー更新 */-->
				.then(() => renderTaskMenu(selectedTabClass, null))
				<!--/* 一覧画面更新 */-->
				.then(() => renderTaskListInputForm(selectedTabClass, null, null, null, null))
		});

		<!--/* 案件タスクの案件クリック時処理 */-->
		$('#menuList').on("click", ".taskAnken", function() {
			const selectedTabClass = /*[[${T(jp.loioz.common.constant.CommonConstant$TaskMenu).TASK_ANKEN.cd}]]*/ '';
			$('#selectedTabClass').val(selectedTabClass);
			const selectedTaskAnkenId = $(this).data("ankenId");
			<!--/* タスク詳細を閉じる */-->
			$('#taskDetailFragmentWrap').addClass("hidden");

			Promise.resolve()
				<!--/* サイドメニュー更新 */-->
				.then(() => renderTaskMenu(selectedTabClass, selectedTaskAnkenId))
				<!--/* 一覧画面更新 */-->
				.then(() => renderTaskListInputForm(selectedTabClass, null, null, null, selectedTaskAnkenId))
		});

		let timeoutId = "";
		$('#menuList').on("input", ".taskSearchWord", function(e) {
			<!--/* タスク検索入力検索 */-->
			
			<!--/* 入力値が空は処理終了 */-->
			if ($(this).val().trim() === '') {
				return false;
			}

			const selectedTabClass = /*[[${T(jp.loioz.common.constant.CommonConstant$TaskMenu).SEARCH_RESULTS_TASK.cd}]]*/'';
			const searchWord = $(this).val().trim();
			timeoutId = lazyQueueFn(searchTask, {"clearQueueId": timeoutId}, searchWord, selectedTabClass);
		});
		
		$('#menuList').on("click", ".taskSearchBtn", function() {
			<!--/* タスク検索ボタンをクリック ボタン押下の場合は空文字も許容*/-->
			
			const selectedTabClass = /*[[${T(jp.loioz.common.constant.CommonConstant$TaskMenu).SEARCH_RESULTS_TASK.cd}]]*/'';
			const searchWord = $('#menuList .taskSearchWord').val();
			timeoutId = lazyQueueFn(searchTask, {"clearQueueId": timeoutId, lazyMilSec: 0}, searchWord, selectedTabClass);
		});
		
		<!--/* 案件タスク追加モーダル表示 */-->
		$('#menuList').on("click", ".openAnkenTaskAddModal", function() {
			openAnkenTaskAddModal();
		});
		
		<!--/* 検索処理 */-->
		function searchTask(searchWord, selectedTabClass) {
			$('#selectedTabClass').val(selectedTabClass);
			<!--/* 一覧画面更新 */-->
			renderSearchTaskListInputForm(selectedTabClass, null, null, searchWord);
			<!--/* メニューの選択中を外す */-->
			$('#taskMenuList li').removeClass('selected');
			<!--/* タスク詳細を閉じる */-->
			$('#taskDetailFragmentWrap').addClass("hidden");
		};

		<!--/* 案件タスクを固定する */-->
		$('#menuList').on("click", ".fixTaskAnken", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const fixAnkenId = $(this).data("anken-id");
			const selectedTaskAnkenId = $('#selectedTaskAnkenId').val();
			const loginAccountSeq = /*[[${T(jp.loioz.common.utility.SessionUtils).getLoginAccountSeq()}]]*/"";
			const selectedTabClass = $('#selectedTabClass').val();

			$.ajax({
				url : "/user/taskManagement/fixTaskAnken",
				type : "POST",
				data : {
					"page" : 0,
					"fixAnkenId" : fixAnkenId,
					"loginAccountSeq": loginAccountSeq
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					const msg = getAjaxProcResutlMessage(jqXHR);

					<!--/* 処理成功 */-->
					Promise.resolve()
						<!-- /* サイドメニュー更新 */ -->
						.then(() => renderTaskMenu(selectedTabClass, selectedTaskAnkenId))
						<!-- /* 処理メッセージ表示 */ -->
						.then(() => {
							showInfoMessageForJs(msg);
						});
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 案件タスクの固定を解除する */-->
		$('#menuList').on("click", ".unFixTaskAnken", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const unFixAnkenId = $(this).data("anken-id");
			const selectedTaskAnkenId = $('#selectedTaskAnkenId').val();
			const loginAccountSeq = /*[[${T(jp.loioz.common.utility.SessionUtils).getLoginAccountSeq()}]]*/"";
			const selectedTabClass = $('#selectedTabClass').val();

			$.ajax({
				url : "/user/taskManagement/unFixTaskAnken",
				type : "POST",
				data : {
					"page" : 0,
					"unFixAnkenId" : unFixAnkenId,
					"loginAccountSeq": loginAccountSeq
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					const msg = getAjaxProcResutlMessage(jqXHR);

					<!--/* 処理成功 */-->
					Promise.resolve()
						<!-- /* サイドメニュー更新 */ -->
						.then(() => renderTaskMenu(selectedTabClass, selectedTaskAnkenId))
						<!-- /* 処理メッセージ表示 */ -->
						.then(() => {
							showInfoMessageForJs(msg);
						});
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 案件タスクを解除する */-->
		$('#menuList').on("click", ".cancelTaskAnken", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const cancelAnkenId = $(this).data("anken-id");
			const selectedTaskAnkenId = $('#selectedTaskAnkenId').val();
			const loginAccountSeq = /*[[${T(jp.loioz.common.utility.SessionUtils).getLoginAccountSeq()}]]*/"";
			let selectedTabClass = $('#selectedTabClass').val();
			if (cancelAnkenId == selectedTaskAnkenId) {
				<!--/* 選択中の案件タスクを解除する場合は、「すべてのタスク」を表示する */-->
				selectedTabClass = /*[[${T(jp.loioz.common.constant.CommonConstant$TaskMenu).ALL_TASK.cd}]]*/ '';
			}

			$.ajax({
				url : "/user/taskManagement/cancelTaskAnken",
				type : "POST",
				data : {
					"page" : 0,
					"cancelAnkenId" : cancelAnkenId,
					"loginAccountSeq": loginAccountSeq
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					const msg = getAjaxProcResutlMessage(jqXHR);

					<!-- /* 詳細領域は閉じる */ -->
					$('#taskDetailFragmentWrap').addClass("hidden");
					$('#taskDetailFragmentWrap').html('');

					<!--/* 処理成功 */-->
					if (cancelAnkenId == selectedTaskAnkenId) {
						Promise.resolve()
							<!-- /* 一覧の更新 */ -->
							.then(() => renderTaskListInputForm(selectedTabClass, null, null, 0, null))
							<!-- /* サイドメニュー更新 */ -->
							.then(() => renderTaskMenu(selectedTabClass, null))
							<!-- /* 処理メッセージ表示 */ -->
							.then(() => {
								showInfoMessageForJs(msg);
							});
					} else {
						Promise.resolve()
							<!-- /* サイドメニュー更新 */ -->
							.then(() => renderTaskMenu(selectedTabClass, selectedTaskAnkenId))
							<!-- /* 処理メッセージ表示 */ -->
							.then(() => {
								showInfoMessageForJs(msg);
							});
					}
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 案件タスク行からカーソルが出た場合、ポップオーバーを閉じる */-->
		$('#menuList').on("mouseleave", ".taskAnkenRow", function(){
			<!--/* ポップオーバーを閉じる */-->
			$(".taskAnkenContainerClose").popover("hide");
		});

	});
	</script>

	<div class="nav_sidebar_user_inner">
		<input id="selectedTabClass" type="hidden" th:value=${selectedTabClass}>
		<input id="selectedTaskAnkenId" type="hidden" th:value=${selectedTaskAnkenId}>
		<div class="input-group p-4">
			<input type="text" class="form-control fcAddTextClear taskSearchWord digit12" th:field="${taskListSearchForm.searchResultsTaskListSearchForm.searchWord}" 
				maxlength="255" placeholder="タスクを検索" th:data-tab="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).SEARCH_RESULTS_TASK.getCd())}" autocomplete="off">
			<div class="input-group-append">
				<button class="btn btn-dark pt-1 pb-0 px-3 taskSearchBtn"
					data-toggle="tooltip" title="タスクを検索します" data-trigger="hover" th:data-tab="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).SEARCH_RESULTS_TASK.getCd())}"
					type="submit"><i class="fas fa-search fa-lg mr-0"></i>
				</button>
			</div>
		</div>
		
		<ul id="taskMenuList" class="task_menu_list">
			<li th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).TODAY_TASK.equalsByCode(selectedTabClass)) ? 'selected' : ''}">
				<a href="javascript:void(0);" class="taskMenu" th:data-tab="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).TODAY_TASK.getCd())}">
					<div class="nav_sidebar_user_menu_contents">
						<i class="far fa-clock nav_sidebar_user__menu_svg"></i>
						<div class="nav_sidebar_user__menu_title">今日のタスク</div>
						<div class="nav_sidebar_user__menu_cnt" th:text="${numberOfTodayTask}"></div>
						<div class="nav_sidebar_user__menu_new_icon">
							<i class="fas fa-exclamation-circle" th:if="${(numberOfTodayNewTask > 0)}"></i>
						</div>
					</div>
				</a>
			</li>
			<li th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).FUTURE_TASK.equalsByCode(selectedTabClass)) ? 'selected' : ''}">
				<a href="javascript:void(0);" class="taskMenu" th:data-tab="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).FUTURE_TASK.getCd())}">
					<div class="nav_sidebar_user_menu_contents">
						<i class="far fa-calendar-alt nav_sidebar_user__menu_svg"></i>
						<span class="nav_sidebar_user__menu_title">期限付きのタスク</span>
						<span class="nav_sidebar_user__menu_cnt" th:text="${numberOfFutureTask}"></span>
						<span class="nav_sidebar_user__menu_new_icon">
							<i class="fas fa-exclamation-circle" th:if="${(numberOfFutureNewTask > 0)}"></i>
						</span>
					</div>
				</a>
			</li>
			<li th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).ALL_TASK.equalsByCode(selectedTabClass)) ? 'selected' : ''}">
				<a href="javascript:void(0);" class="taskMenu" th:data-tab="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).ALL_TASK.getCd())}">
					<div class="nav_sidebar_user_menu_contents">
						<i class="fas fa-inbox nav_sidebar_user__menu_svg"></i>
						<span class="nav_sidebar_user__menu_title">すべてのタスク</span>
						<span class="nav_sidebar_user__menu_cnt" th:text="${numberOfAllTask}"></span>
						<span class="nav_sidebar_user__menu_new_icon">
							<i class="fas fa-exclamation-circle" th:if="${(numberOfAllNewTask > 0)}"></i>
						</span>
					</div>
				</a>
			</li>
			<li th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).OVERDUE_TASK.equalsByCode(selectedTabClass)) ? 'selected' : ''}">
				<a href="javascript:void(0);" class="taskMenu" th:data-tab="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).OVERDUE_TASK.getCd())}">
					<div class="nav_sidebar_user_menu_contents">
						<i class="fas fa-fire-alt nav_sidebar_user__menu_svg"></i>
						<span class="nav_sidebar_user__menu_title">期限を過ぎたタスク</span>
						<span class="nav_sidebar_user__menu_cnt" th:text="${numberOfOverdueTask}"></span>
						<span class="nav_sidebar_user__menu_new_icon">
							<i class="fas fa-exclamation-circle" th:if="${(numberOfOverdueNewTask > 0)}"></i>
						</span>
					</div>
				</a>
			</li>
			<li th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).ASSIGNED_TASK.equalsByCode(selectedTabClass)) ? 'selected' : ''}">
				<a href="javascript:void(0);" class="taskMenu" th:data-tab="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).ASSIGNED_TASK.getCd())}">
					<div class="nav_sidebar_user_menu_contents">
						<i class="fas fa-user-friends nav_sidebar_user__menu_svg"></i>
						<span class="nav_sidebar_user__menu_title">割り当てられたタスク</span>
						<span class="nav_sidebar_user__menu_cnt" th:text="${numberOfAssignedTask}"></span>
						<span class="nav_sidebar_user__menu_new_icon">
							<i class="fas fa-exclamation-circle" th:if="${(numberOfAssignedNewTask > 0)}"></i>
						</span>
					</div>
				</a>
			</li>
			<li th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).ASSIGN_TASK.equalsByCode(selectedTabClass)) ? 'selected' : ''}">
				<a href="javascript:void(0);" class="taskMenu" th:data-tab="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).ASSIGN_TASK.getCd())}">
					<div class="nav_sidebar_user_menu_contents">
						<i class="fas fa-user-check nav_sidebar_user__menu_svg"></i>
						<span class="nav_sidebar_user__menu_title">割り当てたタスク</span>
						<span class="nav_sidebar_user__menu_cnt" th:text="${numberOfAssignTask}"></span>
						<span class="nav_sidebar_user__menu_new_icon">
							<i class="fas fa-exclamation-circle" th:if="${(numberOfAssignNewTask > 0)}"></i>
						</span>
					</div>
				</a>
			</li>
			<li th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).CLOSE_TASK.equalsByCode(selectedTabClass)) ? 'selected' : ''}">
				<a href="javascript:void(0);" class="taskMenu" th:data-tab="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).CLOSE_TASK.getCd())}">
					<div class="nav_sidebar_user_menu_contents">
						<i class="far fa-check-circle nav_sidebar_user__menu_svg"></i>
						<span class="nav_sidebar_user__menu_title">完了したタスク</span>
						<span class="nav_sidebar_user__menu_new_icon ml-auto">
							<i class="fas fa-exclamation-circle" th:if="${(numberOfCompletedNewTask > 0)}"></i>
						</span>
					</div>
				</a>
			</li>
			<li class="separat_data"></li>
			<!--/* 案件タスク（タイトル、プラスボタン） */-->
			<li class="menu_sub_title_block">
				<div class="d-flex">
					<div class="sub_title_anken_task"></div>
					<div class="ml-auto">
						<a href="javascript:void(0);" class="openAnkenTaskAddModal plus_anken_task">
							<i class="fas fa-plus"></i>
						</a>
					</div>
				</div>
			</li>
			<!--/* 案件タスクデータ */-->
			<th:block th:each="taskAnkenAdd, stat : ${taskAnkenAddList}" th:with="selectedTaskAnkenId=${taskListSearchForm.taskAnkenListSearchForm.ankenId}">
				<li th:id="|taskAnkenRow_*{taskAnkenAdd.getAnkenId().asLong()}|" class="py-2 taskAnkenRow" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskMenu).TASK_ANKEN.equalsByCode(selectedTabClass))} and *{taskAnkenAdd.getAnkenId().asLong().equals(selectedTaskAnkenId)} ? 'selected' : ''">
					<a th:id="|taskAnkenPopover_*{taskAnkenAdd.getAnkenId().asLong()}|" href="javascript:void(0);" class="task_anken_menu pr-0">
						<div class="nav_sidebar_user_menu_contents d-flex align-items-center justify-content-end">
							<div class="task_anken_nav_data pl-1 mr-auto taskAnken" th:data-anken-id="*{taskAnkenAdd.getAnkenId().asLong()}">
								<div class="task_anken_name">
									<span th:text="*{#strings.isEmpty(taskAnkenAdd.getAnkenName())}? '(案件名未入力)' : *{taskAnkenAdd.getAnkenName()}">案件名</span>
								</div>
								<div class="task_anken_customer_name">
									<span th:text="*{taskAnkenAdd.getCustomerName()}">山田 太郎</span>
									<span th:if="*{taskAnkenAdd.getNumberOfCustomer() > 1}" th:text="|外*{taskAnkenAdd.getNumberOfCustomer()-1}名|">外1名</span>
								</div>
							</div>
							<div class="nav_sidebar_task_anken__menu_cnt taskAnken" th:data-anken-id="*{taskAnkenAdd.getAnkenId().asLong()}" th:text="*{taskAnkenAdd.getNumberOfTask()}">11</div>
							<!--/* 三点リーダー、ピン止めアイコン */-->
							<div class="task_anken_side_menu_btn_space">
								<div class="task_anken_thumbtack fs13">
									<th:block th:if="*{taskAnkenAdd.getDispOrder() != null}" >
										<i class="fas fa-thumbtack"></i>
									</th:block>
								</div>
								<th:block th:if="*{taskAnkenAdd.getDispOrder() != null}">
									<div class="task_anken_container stop-events taskAnkenContainerClose" 
										data-offset="0,0" data-boundary="window" th:data-container="|#taskAnkenRow_*{taskAnkenAdd.getAnkenId().asLong()}|" data-toggle="popover" data-placement="right" data-html="true" th:data-content=
										'|<ul class="task_anken_nav_list">
											<li><button class="btn unFixTaskAnken" data-target="#taskAnkenPopover_*{taskAnkenAdd.getAnkenId().asLong()}" data-anken-id="*{taskAnkenAdd.getAnkenId().asLong()}"><i class="fas fa-thumbtack text-primary task_anken_popover_thumbtack fs16"></i>固定を解除する</button></li>
											<li><button class="btn cancelTaskAnken" data-target="#taskAnkenPopover_*{taskAnkenAdd.getAnkenId().asLong()}" data-anken-id="*{taskAnkenAdd.getAnkenId().asLong()}"><i class="fas fa-unlink text-primary mr-3"></i>案件タスクを解除する</button></li>
										</ul>|'>
										<span class="task_anken_side_menu_btn">
											<i class="fas fa-ellipsis-v"></i>
										</span>
									</div>
								</th:block>
								<th:block th:if="*{taskAnkenAdd.getDispOrder() == null}">
									<div class="task_anken_container stop-events taskAnkenContainerClose" 
										data-offset="0,0" data-boundary="window" th:data-container="|#taskAnkenRow_*{taskAnkenAdd.getAnkenId().asLong()}|" data-toggle="popover" data-placement="right" data-html="true" th:data-content=
										'|<ul class="task_anken_nav_list">
												<li><button class="btn fixTaskAnken" data-target="#taskAnkenPopover_*{taskAnkenAdd.getAnkenId().asLong()}" data-anken-id="*{taskAnkenAdd.getAnkenId().asLong()}"><i class="fas fa-thumbtack text-primary task_anken_popover_thumbtack fs16"></i></i>固定する</button></li>
												<li><button class="btn cancelTaskAnken" data-target="#taskAnkenPopover_*{taskAnkenAdd.getAnkenId().asLong()}" data-anken-id="*{taskAnkenAdd.getAnkenId().asLong()}"><i class="fas fa-unlink text-primary mr-3"></i>案件タスクを解除する</button></li>
										</ul>|'>
										<span class="task_anken_side_menu_btn">
											<i class="fas fa-ellipsis-v"></i>
										</span>
									</div>
								</th:block>
							</div>
							<!--/* 三点リーダー、ピンアイコン end  */-->
						</div>
					</a>
				</li>
			</th:block>
			
		</ul>
	</div>
</div>



<!--/* タスク検索結果画面 */-->
<div th:fragment="searchResultsTaskListInputFragment(taskListInputForm, taskListSearchForm)" id="searchResultsTaskListInputFragment">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function(){

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		<!--/* タスク一覧クリック（タスク詳細画面表示） */-->
		$('#searchResultsTaskListInputFragment').on("click", ".taskListRow", function() {

			<!--/* 他処理を実行中に、詳細画面が開かないよう制御 */-->
			if (ajaxRunning) {
				return;
			}

			<!--/* タスク一覧の選択済みを解除 */-->
			$(".taskListRow").removeClass("selected");
			<!--/* 選択済みに変更 */-->
			$(this).addClass("selected");
			<!-- /* 一覧で選択中のタスクSEQセット */ -->
			$('#selectedTaskSeq').val($(this).data("seq"));
			$('#pageForSelectedTaskSeq').val($('#taskPage').val());

			Promise.resolve()
				<!--/* タスク詳細画面表示 */-->
				.then(() => renderTaskDetailInputForm($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, null, false))
				<!--/* タスクメニュー画面更新 新着マークの更新のため。メニューの件数と一覧で表示している件数がずれる場合有  */-->
				.then(() => renderTaskMenu(/*[[${selectedTabClass}]]*/, null))
		});

		<!-- /* タスク【未着手・進行中】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOn(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOff(this);
			}
		}, '.taskCheckHover');

		<!-- /* タスク【完了】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOff(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOn(this);
			}
		}, '.taskCheckHoverComp');

		<!--/* タスク一覧からステータス変更 */-->
		$('#searchResultsTaskListInputFragment').on("click", ".changeTaskStatus", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return;
			}
			ajaxRunning = true;

			changeTaskStatus($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, /*[[${selectedAssignSeq}]]*/, $(this).data("seq"), $(this).data("status"), null);
		});

		<!--/* タスク一覧からタスク削除 */-->
		$('#searchResultsTaskListInputFragment').on("click", ".listDeleteTask", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			
			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			<!-- /* ステータスを変更したタスクのli */ -->
			let taskLi = $('.taskData' + taskSeq);

			$.ajax({
				url : "/user/taskManagement/deleteTask",
				type : "POST",
				data : {
					"page" : 0,
					"taskSeq" : taskSeq,
					"selectedTabClass" : selectedTabClass,
					"selectedTaskSeq" : /*[[${selectedTaskSeq}]]*/,
					"selectedAssignSeq" : /*[[${selectedAssignSeq}]]*/
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					<!-- /* 対象のタスクが選択状態の場合は、選択を解除し、詳細を閉じる */ -->
					if (taskLi.hasClass('selected')) {
						taskLi.removeClass('selected');
						<!-- /* 詳細領域は閉じる */ -->
						$('#taskDetailFragmentWrap').addClass("hidden");
						$('#taskDetailFragmentWrap').html('');
					}
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

					Promise.resolve()
						.then(() => deleteTaskRowForAfterDeleteTask(selectedTabClass, taskSeq, null))
						.then(() => renderTaskMenu(selectedTabClass, null))
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00014}]]*/ "削除に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 一覧出力 */-->
		$('#searchResultsTaskListInputFragment').on("click", ".outputTaskList", function() {

			<!--/* ダウンロード処理 */-->
			const url = "/user/taskManagement/outputTaskList";
			const button = $(this);
			let formData = {};
			downloadFileAjax(url, button, formData);

			return false;
		});

	});
	</script>

	<!--/* HTML */-->
	<input type="hidden" id="taskPageSize" th:value="${taskListSearchForm.searchResultsTaskListSearchForm.pageSize.intVal}">
	<input type="hidden" id="taskPage" th:value="${taskListSearchForm.searchResultsTaskListSearchForm.page}">
	<!--/* ページング時に参照する選択中タスクSEQ */-->
	<input id="selectedTaskSeq" type="hidden" th:value=${selectedTaskSeq}>
	<!--/* 選択中タスクSEQを表示しているページ */-->
	<input id="pageForSelectedTaskSeq" type="hidden" th:value=${pageForSelectedTaskSeq}>
	<form id="taskListInputForm" th:object="${taskListInputForm}" autocomplete="off">

		<!--/* タスク一覧ブロック */-->
		<div class="vertical_block_wrapper">

			<!--/* タスクタイトル */-->
			<div id="taskListTitle" class="vertical_block_header d-flex flex-wrap align-items-center my-3 pr-3">
				<div class="selected_list_title mr-auto" th:text="${listTitle}">検索結果</div>

				<!--/* ページング */-->
				<div id="taskListPagerFragmentWrap">
					<div th:replace="common/pagerAjax::pagerAjax(page=*{taskListForTaskManagement[0].page}, listFragmentId='taskListTitle')"></div>
				</div>

				<!--/* 一覧出力 */-->
				<div>
					<button class="btn btn-light outputTaskList"><i class="fas fa-download text-primary"></i><i class="fas fa-spinner text-primary faa-spin animated hidden"></i>一覧出力</button>
				</div>
			</div>

			<!--/* タスク一覧 */-->
			<div id="todayTask" class="vertical_block_body">

				<div class="task_list_data_block" th:if="*{!isExistTask()}">
					<div class="task_type_title">
						<div class="no_data_task">
							<i class="far fa-clock"></i>
							<span th:text="|${listTitle}はありません。|"></span>
						</div>
					</div>
				</div>

				<div class="task_list_data_block taskListDataBlock" th:each="taskData, stat : *{taskListForTaskManagement}" th:classappend="${taskData.taskList.size() > 0 ? '' : 'hidden'}">
					<div class="collapse show" th:id="|collapseTaskType${stat.index}|">
						<ul id="taskDataList" class="task_data_list">
							<th:block th:each="task : ${taskData.taskList}">
								<!--/* タスクの1行 */-->
								<li th:replace="::searchResultsTaskListRowFragment(${task})"></li>
							</th:block>
						</ul>
					</div>
				</div>

			</div>
			<!--/* タスク一覧 end */-->

		</div>
		<!--/* タスク一覧ブロック end */-->

	</form>
</div>


<!--/* タスク検索画面 - タスク1行分のHTML */-->
<li th:fragment="searchResultsTaskListRowFragment(task)"
	th:class="|taskListRow taskData${task.taskSeq}|"
	th:classappend="|${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'task_compleat' : '')} ${(selectedTaskSeq==task.taskSeq) ? 'selected' : ''}|"
	th:data-seq ="${task.taskSeq}" th:data-worker-seq="${task.taskWorkerSeq}">
	
	<input type="hidden" name="newTaskSeq" th:value="${newTaskSeq}">
	<input type="hidden" name="rowTaskSeq" th:value="${task.taskSeq}">
	<!--/* タスク1行 */-->
	<div class="task_row_data">
		<!--/* チェックマーク */-->
		<div class="task_row_data_check stop-events changeTaskStatus" th:data-seq="${task.taskSeq}" th:data-status="${task.taskStatus}"
			data-boundary="window" data-container="#searchResultsTaskListInputFragment" data-toggle="tooltip"
			th:title="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? '未着手に戻す' : '完了にする')}"
			th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'taskCheckHoverComp' : 'taskCheckHover')}">
			
			<!--/* 未完了 */-->
			<div class="taskStatusPreparing" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'hidden' : ' ')}">
				<i class="far fa-circle"></i>
			</div>
			<!--/* 完了 */-->
			<div class="taskStatusComp task_check__comp" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'noHoverTask' : 'hidden')}" >
				<i class="far fa-check-circle"></i>
			</div>
		</div>
		
		<!--/* タスクの内容 */-->
		<div class="task_contents">
			<!--/* 1行目 */-->
			<div class="task_contents_main">
				<!--/* タイトル */-->
				<div class="task_contents__title taskTitle">
					<i th:classappend="|taskExclamation${task.taskSeq}|" class="fas fa-exclamation-circle text-danger taskExclamation" th:if="${(T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newTaskKakuninFlg)) || (T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newHistoryKakuninFlg))}"></i>
					<span th:text="${task.title}">タスクタイトル</span>
				</div>
				
				<!--/* サブタスクが有る場合、件数を表示） */-->
				<div class="check_item_count">
					<th:block th:if="${task.checkItemCount != 0}">
						<i class="far fa-check-square mr-1"></i>
						<span th:text="${task.completeCheckItemCount}"></span>/<span th:text="${task.checkItemCount}"></span>
					</th:block>
				</div>
				
				<!--/* ステータス（進行中のみ） */-->
				<div class="task_list_staus taskListStaus">
					<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.equalsByCode(task.taskStatus))}">
						<span>進行中</span>
					</th:block>
				</div>
				<!--/* ステータス（進行中のみ）end  */-->
			</div>
			<!--/* 1行目 end */-->
			
			<!--/* 2行目 */-->
			<div class="task_contents_sub">
				<!--/* 期限 */-->
				<div class="task_contents_sub__limit" th:if="${task.limitDtTo}" th:classappend="${task.limitDateStyle}">
					<i class="far fa-calendar-alt"></i>
					<span th:text ="${#temporals.format(task.limitDateForDisplay, 'M月d日')}">1月1日</span>
					<span th:text="| (${#temporals.format(task.limitDateForDisplay, 'E')})|">(月)</span>
					<span th:if="${task.limitTime}" th:text ="| ${#temporals.format(task.limitTime, 'H:mm')}|">0:00</span>
				</div>
				
				<!--/* 今日タスク */-->
				<div class="task_contents_sub__today" th:if="${#temporals.format(task.todayTaskDate, 'yyyy-MM-dd')==#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
					<i class="far fa-clock"></i>
					<span>今日のタスク</span>
				</div>
				
				<!--/* コメント数 */-->
				<div class="task_contents_sub__comment" th:if="${task.commentCount} > 0">
					<i class="far fa-comment"></i>
					<span th:text="${task.commentCount}"></span>
				</div>
				
				<!--/* 案件リンク */-->
				<div class="task_contents_sub__anken" th:if="${task.ankenId}">
					<span class="relation_link">
						<i class="fas fa-hashtag"></i>
						<span th:text="${#strings.isEmpty(task.ankenName)} ? |(案件名未入力) (${task.ankenId.toString()})| : |${task.ankenName} (${task.ankenId.toString()})|"></span>
					</span>
				</div>
				
				<!--/* タスク割り当て */-->
				<div class="task_contents_sub__tanto">
					<th:block th:each="taskTanto, stat : ${task.assignTaskTantoList}">
						<span data-boundary="window" data-container="#searchResultsTaskListInputFragment" data-toggle="tooltip" th:title="${task.getAccountName(taskTanto.workerAccountSeq)}" >
							<i class="fas fa-user-circle" th:style="|color: ${taskTanto.accountColor}|"></i>
						</span>
					</th:block>
				</div>
				<!--/* タスク割り当て end */-->
				
			</div>
		</div>
		<!--/* タスクの内容 end */-->
		
		<!--/* タスク削除 */-->
		<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus))}">
			<div class="task_contents__delete listDeleteTask" th:data-seq="${task.taskSeq}">
				<div class="task_list_delete__trash" data-boundary="window" data-container="#searchResultsTaskListInputFragment" data-toggle="tooltip" title="タスク削除">
					<i class="far fa-trash-alt"></i>
				</div>
			</div>
		</th:block>
		<!--/* 削除 end  */-->
		
		
	</div>
	<!--/* タスク1行 end */-->
</li>


<!--/* 今日のタスク画面 */-->
<div th:fragment="todayTaskListInputFragment(taskListInputForm, taskListSearchForm)" id="todayTaskListInputFragment">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function(){

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		<!--/* タスク追加フォームにフォーカス */-->
		$('.addTask').focus();

		<!--/* タスク一覧クリック（タスク詳細画面表示） */-->
		$('#todayTaskListInputFragment').on("click", ".taskListRow", function() {

			<!--/* 他処理を実行中に、詳細画面が開かないよう制御 */-->
			if (ajaxRunning) {
				return;
			}

			<!--/* タスク一覧の選択済みを解除 */-->
			$(".taskListRow").removeClass("selected");
			<!--/* 選択済みに変更 */-->
			$(this).addClass("selected");
			<!-- /* 一覧で選択中のタスクSEQセット */ -->
			$('#selectedTaskSeq').val($(this).data("seq"));
			$('#pageForSelectedTaskSeq').val($('#taskPage').val());

			Promise.resolve()
				<!--/* タスク詳細画面表示 */-->
				.then(() => renderTaskDetailInputForm($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, null, false))
				<!--/* タスクメニュー画面更新 新着マークの更新のため。メニューの件数と一覧で表示している件数がずれる場合有  */-->
				.then(() => renderTaskMenu(/*[[${selectedTabClass}]]*/, null))
		});

		<!-- /* タスク【未着手・進行中】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOn(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOff(this);
			}
		}, '.taskCheckHover');

		<!-- /* タスク【完了】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOff(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOn(this);
			}
		}, '.taskCheckHoverComp');

		<!-- /* タスク行hoverで並び替えマーク表示／非表示 */ -->
		$('#todayTaskListInputFragment').on({
			mouseenter: function() {
				viewSortableObjOn(this);
			},
			mouseleave: function() {
				viewSortableObjOff(this);
			}
		}, '.taskListRow');

		<!--/* タスク一覧からステータス変更 */-->
		$('#todayTaskListInputFragment').on("click", ".changeTaskStatus", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return;
			}
			ajaxRunning = true;

			changeTaskStatus($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, /*[[${selectedAssignSeq}]]*/, $(this).data("seq"), $(this).data("status"), null);
		});

		<!--/* タスク一覧画面のタスク追加フォームでボタン押下 */-->
		$('#todayTaskListInputFragment').on("keydown", ".addTask", function(e) {

			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault();

			<!--/* 入力値が空は処理終了 */-->
			if ($(this).val().trim() == '') {
				return false;
			}

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const formData = $('#todayTaskListInputFragment #taskListInputForm').serializeArray();
			addTask(formData, /*[[${selectedTabClass}]]*/, $('#selectedTaskSeq').val(), null, null);
		});

		<!--/* タスク一覧の初期の表示順を保存する（１行ずつ変更する処理） */-->
		let currentDispOrder = new Map();
		$('#taskDataList li').each(function(idx){
			currentDispOrder.set($(this).attr('data-worker-seq'), parseInt(idx));
		});

		<!--/* タスク一覧の並べ替え処理（１行ずつ変更する処理） */-->
		$('#taskDataList').sortable({
			containment: "parent",
			handle: '.sortableObj',
		});

		<!--/* タスク一覧の並べ替え処理（１行ずつ変更する処理） */-->
		$('#taskDataList').bind('sortupdate', function(){

			let workerSeq = [];

			$(this).find('.taskListRow').each(function(idx){
				<!--/* 並び替えたタスク一覧を順番通りにセット */-->
				workerSeq.push($(this).attr('data-worker-seq'));
			});

			<!--/* パラメータをStringに変換して渡す */-->
			if (workerSeq.length > 0) {
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				const selectedTabClass = /*[[${selectedTabClass}]]*/;

				$.ajax({
					url : "/user/taskManagement/dispOrder",
					type : "POST",
					data : {
						"page" : 0,
						"taskWorkerSeq" : String(workerSeq),
						"selectedTabClass": selectedTabClass
					},
				}).done(function(responce) {
					if (responce.succeeded) {
						$('#taskDataList li').each(function(idx){
							currentDispOrder.set($(this).attr('data-worker-seq'), parseInt(idx));
						});
					} else {
						if (responce.message) {
							alert(responce.message);
						}
					}
				}).fail(function(jqXHR, textStatus, errorThrown) {
				}).always(function() {
					ajaxRunning = false;
				});
			}
		});

		<!--/* 一覧出力 */-->
		$('#todayTaskListInputFragment').on("click", ".outputTaskList", function() {

			<!--/* ダウンロード処理 */-->
			const url = "/user/taskManagement/outputTaskList";
			const button = $(this);
			let formData = {};
			downloadFileAjax(url, button, formData);

			return false;
		});

	});
	</script>

	<!--/* HTML */-->
	<input type="hidden" id="taskPageSize" th:value="${taskListSearchForm.todayTaskListSearchForm.pageSize.intVal}">
	<input type="hidden" id="taskPage" th:value="${taskListSearchForm.todayTaskListSearchForm.page}">
	<!--/* ページング時に参照する選択中タスクSEQ */-->
	<input id="selectedTaskSeq" type="hidden" th:value=${selectedTaskSeq}>
	<!--/* 選択中タスクSEQを表示しているページ */-->
	<input id="pageForSelectedTaskSeq" type="hidden" th:value=${pageForSelectedTaskSeq}>
	<form id="taskListInputForm" th:object="${taskListInputForm}" autocomplete="off">

		<!--/* タスク一覧ブロック */-->
		<div class="vertical_block_wrapper">

			<!--/* タスクタイトル */-->
			<div id="taskListTitle" class="vertical_block_header d-flex flex-wrap align-items-center my-3 pr-3">
				<div class="selected_list_title" th:text="${listTitle}">今日のタスク</div>
				<div class="selected_list_title_day ml-3" th:text ="| ${#dates.format(#dates.createNow(), 'M月d日')}|">1月1日</div>
				<div class="selected_list_title_day mr-auto" th:text="| (${#dates.format(#dates.createNow(), 'E')})|">(月)</div>
				<!--/* ページング */-->
				<div id="taskListPagerFragmentWrap">
					<div th:replace="common/pagerAjax::pagerAjax(page=*{taskListForTaskManagement[0].page}, listFragmentId='taskListTitle')"></div>
				</div>
				<!--/* 一覧出力 */-->
				<div>
					<button class="btn btn-light outputTaskList"><i class="fas fa-download text-primary"></i><i class="fas fa-spinner text-primary faa-spin animated hidden"></i>一覧出力</button>
				</div>
			</div>

			<!--/* タスク一覧 */-->
			<div id="todayTask" class="vertical_block_body">

				<div class="task_list_data_block" th:if="*{!isExistTask()}">
					<div class="task_type_title">
						<div class="no_data_task">
							<i class="far fa-clock"></i>
							<span th:text="|${listTitle}はありません。|"></span>
						</div>
					</div>
				</div>

				<div class="task_list_data_block taskListDataBlock" th:each="taskData, stat : *{taskListForTaskManagement}" th:classappend="${taskData.taskList.size() > 0 ? '' : 'hidden'}">
					<div class="collapse" th:id="|collapseTaskType${stat.index}|" 
						th:classappend="|${(!T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskData.taskStatusCd) && !T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.getVal().equals(taskData.taskTypeTitle) ? 'show' : '')}|">
						<ul id="taskDataList" class="task_data_list">
							<th:block th:each="task : ${taskData.taskList}">
								<!--/* タスクの1行 */-->
								<li th:replace="::todayTaskListRowFragment(${task})"></li>
							</th:block>
						</ul>
					</div>
				</div>

			</div>
			<!--/* タスク一覧 end */-->

			<!--/* タスク追加 */-->
			<div class="vertical_block_footer">
				<div class="add_task_block">
					<input type="text" class="form-control add_task_text addTask" placeholder="＋タスクを追加" th:field="*{taskTitle}" maxlength="255">
					<div th:if="*{#fields.hasErrors('taskTitle')}" th:errors="*{taskTitle}" class="error_mag_point">error</div>
				</div>
			</div>
			<!--/* タスク追加 end */-->

		</div>
		<!--/* タスク一覧ブロック end */-->

	</form>
</div>


<!--/* 今日のタスク画面 - タスク1行分のHTML */-->
<li th:fragment="todayTaskListRowFragment(task)"
	th:class="|taskListRow taskData${task.taskSeq}|"
	th:classappend="|${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'task_compleat' : '')} ${(selectedTaskSeq==task.taskSeq) ? 'selected' : ''}|"
	th:data-seq ="${task.taskSeq}" th:data-worker-seq="${task.taskWorkerSeq}">
	
	<input type="hidden" name="newTaskSeq" th:value="${newTaskSeq}">
	<input type="hidden" name="rowTaskSeq" th:value="${task.taskSeq}">
	<!--/* タスク1行 */-->
	<div class="task_row_data">
		
		<!--/* 並び替え用マーク */-->
		<div class="stop-events sortableObjWrap">
			<div class="move_point sortableObj">
				<svg class="icon_drag_indicator hidden"></svg>
				<div class="sortable_obj_space"></div>
			</div>
		</div>
		
		<!--/* チェックマーク */-->
		<div class="task_row_data_check stop-events changeTaskStatus" th:data-seq="${task.taskSeq}" th:data-status="${task.taskStatus}"
			data-boundary="window" data-container="#todayTaskListInputFragment" data-toggle="tooltip"
			th:title="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? '未着手に戻す' : '完了にする')}"
			th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'taskCheckHoverComp' : 'taskCheckHover')}">
			
			<!--/* 未完了 */-->
			<div class="taskStatusPreparing" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'hidden' : ' ')}">
				<i class="far fa-circle"></i>
			</div>
			<!--/* 完了 */-->
			<div class="taskStatusComp task_check__comp" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'noHoverTask' : 'hidden')}" >
				<i class="far fa-check-circle"></i>
			</div>
		</div>
		
		<!--/* タスクの内容 */-->
		<div class="task_contents">
			<!--/* 1行目 */-->
			<div class="task_contents_main">
				<!--/* タイトル */-->
				<div class="task_contents__title taskTitle">
					<i th:classappend="|taskExclamation${task.taskSeq}|" class="fas fa-exclamation-circle text-danger taskExclamation" th:if="${(T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newTaskKakuninFlg)) || (T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newHistoryKakuninFlg))}"></i>
					<span th:text="${task.title}">タスクタイトル</span>
				</div>
				
				<!--/* サブタスクが有る場合、件数を表示） */-->
				<div class="check_item_count">
					<th:block th:if="${task.checkItemCount != 0}">
						<i class="far fa-check-square mr-1"></i>
						<span th:text="${task.completeCheckItemCount}"></span>/<span th:text="${task.checkItemCount}"></span>
					</th:block>
				</div>
				
				<!--/* ステータス（進行中のみ） */-->
				<div class="task_list_staus taskListStaus">
					<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.equalsByCode(task.taskStatus))}">
						<span>進行中</span>
					</th:block>
				</div>
				<!--/* ステータス（進行中のみ）end  */-->
			</div>
			<!--/* 1行目 end */-->
			
			<!--/* 2行目 */-->
			<div class="task_contents_sub">
				<!--/* 期限 */-->
				<div class="task_contents_sub__limit" th:if="${task.limitDtTo}" th:classappend="${task.limitDateStyle}">
					<i class="far fa-calendar-alt"></i>
					<span th:text ="${#temporals.format(task.limitDateForDisplay, 'M月d日')}">1月1日</span>
					<span th:text="| (${#temporals.format(task.limitDateForDisplay, 'E')})|">(月)</span>
					<span th:if="${task.limitTime}" th:text ="| ${#temporals.format(task.limitTime, 'H:mm')}|">0:00</span>
				</div>
				
				<!--/* 今日タスク */-->
				<div class="task_contents_sub__today" th:if="${#temporals.format(task.todayTaskDate, 'yyyy-MM-dd')==#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
					<i class="far fa-clock"></i>
					<span>今日のタスク</span>
				</div>
				
				<!--/* コメント数 */-->
				<div class="task_contents_sub__comment" th:if="${task.commentCount} > 0">
					<i class="far fa-comment"></i>
					<span th:text="${task.commentCount}"></span>
				</div>
				
				<!--/* 案件リンク */-->
				<div class="task_contents_sub__anken" th:if="${task.ankenId}">
					<span class="relation_link">
						<i class="fas fa-hashtag"></i>
						<span th:text="${#strings.isEmpty(task.ankenName)} ? |(案件名未入力) (${task.ankenId.toString()})| : |${task.ankenName} (${task.ankenId.toString()})|"></span>
					</span>
				</div>
				
				<!--/* タスク割り当て */-->
				<div class="task_contents_sub__tanto">
					<th:block th:each="taskTanto, stat : ${task.assignTaskTantoList}">
						<span data-boundary="window" data-container="#todayTaskListInputFragment" data-toggle="tooltip" th:title="${task.getAccountName(taskTanto.workerAccountSeq)}" >
							<i class="fas fa-user-circle" th:style="|color: ${taskTanto.accountColor}|"></i>
						</span>
					</th:block>
				</div>
				<!--/* タスク割り当て end */-->
				
			</div>
		</div>
		<!--/* タスクの内容 end */-->
		
		
		
	</div>
	<!--/* タスク1行 end */-->
</li>


<!--/* 期限付きのタスクリスト画面 */-->
<div th:fragment="futureTaskListInputFragment(taskListInputForm)" id="futureTaskListInputFragment">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function(){

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		<!--/* タスク追加フォームにフォーカス */-->
		$('.addTask').focus();

		<!--/* タスク一覧画面で選択したタスクSEQ */-->
		let globalSelectedTaskSeq = /*[[${selectedTaskSeq}]]*/;

		<!--/* タスク一覧クリック（タスク詳細画面表示） */-->
		$('#futureTaskListInputFragment').on("click", ".taskListRow", function() {

			<!--/* 他処理を実行中に、詳細画面が開かないよう制御 */-->
			if (ajaxRunning) {
				return false;
			}

			<!--/* タスク一覧の選択済みを解除 */-->
			$(".taskListRow").removeClass("selected");
			<!--/* 選択済みに変更 */-->
			$(this).addClass("selected");
			globalSelectedTaskSeq = $(this).data("seq");

			Promise.resolve()
				<!--/* タスク詳細画面表示 */-->
				.then(() => renderTaskDetailInputForm(globalSelectedTaskSeq, /*[[${selectedTabClass}]]*/, null, false))
				<!--/* タスクメニュー画面更新 新着マークの更新のため。メニューの件数と一覧で表示している件数がずれる場合有  */-->
				.then(() => renderTaskMenu(/*[[${selectedTabClass}]]*/, null))
		});

		<!-- /* タスク【未着手・進行中】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOn(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOff(this);
			}
		}, '.taskCheckHover');

		<!-- /* タスク【完了】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOff(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOn(this);
			}
		}, '.taskCheckHoverComp');

		<!--/* タスク一覧からステータス変更 */-->
		$('#futureTaskListInputFragment').on("click", ".changeTaskStatus", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			changeTaskStatus(globalSelectedTaskSeq, /*[[${selectedTabClass}]]*/, null, $(this).data("seq"), $(this).data("status"), null);
		});

		<!--/* タスク一覧画面のタスク追加フォームでボタン押下 */-->
		$('#futureTaskListInputFragment').on("keydown", ".addTask", function(e) {

			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault();

			<!--/* 入力値が空は処理終了 */-->
			if ($(this).val().trim() == '') {
				return false;
			}

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const formData = $('#futureTaskListInputFragment #taskListInputForm').serializeArray();
			addTask(formData, /*[[${selectedTabClass}]]*/, globalSelectedTaskSeq, null, null);
		});

		<!--/* タスクアコーディオンクリック押下 */-->
		$('#futureTaskListInputFragment').on("click", ".taskCollapse", function() {
			incompleteTaskCollapse($(this));
		});

		<!--/* 一覧出力 */-->
		$('#futureTaskListInputFragment').on("click", ".outputTaskList", function() {

			<!--/* ダウンロード処理 */-->
			const url = "/user/taskManagement/outputTaskList";
			const button = $(this);
			let formData = {};
			downloadFileAjax(url, button, formData);

			return false;
		});

	});
	</script>

	<!--/* HTML */-->
	<!--/* 選択中タスクSEQを表示しているページ ページングではないため固定で0 */-->
	<input id="pageForSelectedTaskSeq" type="hidden" value=0>
	<form id="taskListInputForm" th:object="${taskListInputForm}" autocomplete="off">

		<!--/* タスク一覧ブロック */-->
		<div class="vertical_block_wrapper">

			<!--/* タスクタイトル */-->
			<div class="vertical_block_header d-flex flex-wrap align-items-center my-3 pr-3">
				<div class="selected_list_title mr-auto" th:text="${listTitle}">期限付きのタスク</div>
				<!--/* 一覧出力 */-->
				<div>
					<button class="btn btn-light outputTaskList"><i class="fas fa-download text-primary"></i><i class="fas fa-spinner text-primary faa-spin animated hidden"></i>一覧出力</button>
				</div>
			</div>

			<!--/* タスク一覧 */-->
			<div class="vertical_block_body">
				<div class="task_list_data_block" th:if="*{!isExistTask()}">
					<div class="task_type_title">
						<div class="no_data_task">
							<i class="far fa-calendar-alt"></i>
							<span th:text="|${listTitle}はありません。|"></span>
						</div>
					</div>
				</div>
				<div class="task_list_data_block taskListDataBlock" th:each="taskData, stat : *{taskListForTaskManagement}" th:classappend="${taskData.taskList.size() > 0 ? '' : 'hidden'}" th:data-category-date="${taskData.getLimitDateCategoryDateStr()}" >

					<!--/* 開閉アコーディオン */-->
					<div class="task_type_title">
						<a class="taskCollapse task_collapse_open" th:data-index="${stat.index}"
							data-toggle="collapse" th:href="|#collapseTaskType${stat.index}|" role="button" aria-expanded="false" th:aria-controls="|collapseTaskType${stat.index}|">
							<i th:id="|collapseClose${stat.index}|" class="fas fa-chevron-right mr-2" 
								th:classappend="${T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.getVal().equals(taskData.taskTypeTitle) ? '' : 'hidden'}"></i>
							<i th:id="|collapseOpen${stat.index}|" class="fas fa-chevron-down mr-2"
								th:classappend="${T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.getVal().equals(taskData.taskTypeTitle) ? 'hidden' : ''}"></i>
							<span th:text="| ${taskData.taskTypeTitle}|">今日</span><span class="ml-3 taskCollapseCount" th:text="${taskData.taskList.size()}"></span>
						</a>
					</div>

					<div class="collapse" th:id="|collapseTaskType${stat.index}|" 
						th:classappend="|${(!T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskData.taskStatusCd) && !T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.getVal().equals(taskData.taskTypeTitle) ? 'show' : '')}|">
						<ul id="taskDataList" class="task_data_list">
							<th:block th:each="task : ${taskData.taskList}">
								<li th:replace="::futureTaskListRowFragment(${task})"></li>
							</th:block>
						</ul>
					</div>
				</div>
			</div>
			<!--/* タスク一覧 end */-->

			<!--/* タスク追加 */-->
			<div class="vertical_block_footer">
				<div class="add_task_block">
					<input type="text" class="form-control add_task_text addTask" placeholder="＋タスクを追加" th:field="*{taskTitle}" maxlength="255">
					<div th:if="*{#fields.hasErrors('taskTitle')}" th:errors="*{taskTitle}" class="error_mag_point">error</div>
				</div>
			</div>
			<!--/* タスク追加 end */-->

		</div>
		<!--/* タスク一覧ブロック end */-->

	</form>
</div>

<!--/* 期限付きのタスクリスト画面 - タスク1行分のHTML */-->
<li th:fragment="futureTaskListRowFragment(task)"
	th:class="|taskListRow taskData${task.taskSeq}|"
	th:classappend="|${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'task_compleat' : '')} ${selectedTaskSeq==task.taskSeq ? 'selected' : ''}|"
	th:data-seq ="${task.taskSeq}" th:data-worker-seq="${task.taskWorkerSeq}">
	
	<input type="hidden" name="newTaskSeq" th:value="${newTaskSeq}">
	<input type="hidden" name="rowTaskSeq" th:value="${task.taskSeq}">
	<!--/* タスク1行 */-->
	<div class="task_row_data">
		
		<!--/* チェックマーク */-->
		<div class="task_row_data_check stop-events changeTaskStatus" th:data-seq="${task.taskSeq}" th:data-status="${task.taskStatus}"
			data-boundary="window" data-container="#futureTaskListInputFragment" data-toggle="tooltip"
			th:title="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? '未着手に戻す' : '完了にする')}"
			th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'taskCheckHoverComp' : 'taskCheckHover')}">
			
			<!--/* 未完了 */-->
			<div class="taskStatusPreparing" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'hidden' : ' ')}">
				<i class="far fa-circle"></i>
			</div>
			<!--/* 完了 */-->
			<div class="taskStatusComp task_check__comp" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'noHoverTask' : 'hidden')}" >
				<i class="far fa-check-circle"></i>
			</div>
		</div>
		
		<!--/* タスクの内容 */-->
		<div class="task_contents">
			<!--/* 1行目 */-->
			<div class="task_contents_main">
				<!--/* タイトル */-->
				<div class="task_contents__title taskTitle">
					<i th:classappend="|taskExclamation${task.taskSeq}|" class="fas fa-exclamation-circle text-danger taskExclamation" th:if="${(T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newTaskKakuninFlg)) || (T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newHistoryKakuninFlg))}"></i>
					<span th:text="${task.title}">タスクタイトル</span>
				</div>
				
				<!--/* サブタスクが有る場合、件数を表示） */-->
				<div class="check_item_count">
					<th:block th:if="${task.checkItemCount != 0}">
						<i class="far fa-check-square mr-1"></i>
						<span th:text="${task.completeCheckItemCount}"></span>/<span th:text="${task.checkItemCount}"></span>
					</th:block>
				</div>
				
				<!--/* ステータス（進行中のみ） */-->
				<div class="task_list_staus taskListStaus">
					<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.equalsByCode(task.taskStatus))}">
						<span>進行中</span>
					</th:block>
				</div>
				<!--/* ステータス（進行中のみ）end  */-->
			</div>
			<!--/* 1行目 end */-->
			
			<!--/* 2行目 */-->
			<div class="task_contents_sub">
				<!--/* 期限 */-->
				<div class="task_contents_sub__limit" th:if="${task.limitDtTo}" th:classappend="${task.limitDateStyle}">
					<i class="far fa-calendar-alt"></i>
					<span th:text ="${#temporals.format(task.limitDateForDisplay, 'M月d日')}">1月1日</span>
					<span th:text="| (${#temporals.format(task.limitDateForDisplay, 'E')})|">(月)</span>
					<span th:if="${task.limitTime}" th:text ="| ${#temporals.format(task.limitTime, 'H:mm')}|">0:00</span>
				</div>
				
				<!--/* 今日タスク */-->
				<div class="task_contents_sub__today" th:if="${#temporals.format(task.todayTaskDate, 'yyyy-MM-dd')==#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
					<i class="far fa-clock"></i>
					<span>今日のタスク</span>
				</div>
				
				<!--/* コメント数 */-->
				<div class="task_contents_sub__comment" th:if="${task.commentCount} > 0">
					<i class="far fa-comment"></i>
					<span th:text="${task.commentCount}"></span>
				</div>
				
				<!--/* 案件リンク */-->
				<div class="task_contents_sub__anken" th:if="${task.ankenId}">
					<span class="relation_link">
						<i class="fas fa-hashtag"></i>
						<span th:text="${#strings.isEmpty(task.ankenName)} ? |(案件名未入力) (${task.ankenId.toString()})| : |${task.ankenName} (${task.ankenId.toString()})|"></span>
					</span>
				</div>
				
				<!--/* タスク割り当て */-->
				<div class="task_contents_sub__tanto">
					<th:block th:each="taskTanto, stat : ${task.assignTaskTantoList}">
						<span data-boundary="window" data-container="#futureTaskListInputFragment" data-toggle="tooltip" th:title="${task.getAccountName(taskTanto.workerAccountSeq)}" >
							<i class="fas fa-user-circle" th:style="|color: ${taskTanto.accountColor}|"></i>
						</span>
					</th:block>
				</div>
				<!--/* タスク割り当て end */-->
				
			</div>
		</div>
		<!--/* タスクの内容 end */-->
	</div>
	<!--/* タスク1行 end */-->
</li>



<!--/* すべてのタスクリスト画面 */-->
<div th:fragment="allTaskListInputFragment(taskListInputForm, taskListSearchForm)" id="allTaskListInputFragment">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function(){

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		<!--/* タスク追加フォームにフォーカス */-->
		$('.addTask').focus();

		<!--/* タスク一覧クリック（タスク詳細画面表示） */-->
		$('#allTaskListInputFragment').on("click", ".taskListRow", function() {

			<!--/* 他処理を実行中に、詳細画面が開かないよう制御 */-->
			if (ajaxRunning) {
				return false;
			}

			<!--/* タスク一覧の選択済みを解除 */-->
			$(".taskListRow").removeClass("selected");
			<!--/* 選択済みに変更 */-->
			$(this).addClass("selected");
			<!-- /* 一覧で選択中のタスクSEQセット */ -->
			$('#selectedTaskSeq').val($(this).data("seq"));
			$('#pageForSelectedTaskSeq').val($('#taskPage').val());

			Promise.resolve()
				<!--/* タスク詳細画面表示 */-->
				.then(() => renderTaskDetailInputForm($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, null, false))
				<!--/* タスクメニュー画面更新 新着マークの更新のため。メニューの件数と一覧で表示している件数がずれる場合有  */-->
				.then(() => renderTaskMenu(/*[[${selectedTabClass}]]*/, null))
		});

		<!-- /* タスク【未着手・進行中】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOn(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOff(this);
			}
		}, '.taskCheckHover');

		<!-- /* タスク【完了】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOff(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOn(this);
			}
		}, '.taskCheckHoverComp');

		<!-- /* タスク行hoverで並び替えマーク表示／非表示 */ -->
		$('#allTaskListInputFragment').on({
			mouseenter: function() {
				viewSortableObjOn(this);
			},
			mouseleave: function() {
				viewSortableObjOff(this);
			}
		}, '.taskListRow');

		<!--/* タスク一覧からステータス変更 */-->
		$('#allTaskListInputFragment').on("click", ".changeTaskStatus", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			changeTaskStatus($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, null, $(this).data("seq"), $(this).data("status"), null);
		});

		<!--/* タスク一覧画面のタスク追加フォームでボタン押下 */-->
		$('#allTaskListInputFragment').on("keydown", ".addTask", function(e) {

			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault();

			<!--/* 入力値が空は処理終了 */-->
			if ($(this).val().trim() == '') {
				return false;
			}

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const formData = $('#allTaskListInputFragment #taskListInputForm').serializeArray();
			addTask(formData, /*[[${selectedTabClass}]]*/, $('#selectedTaskSeq').val(), null, null);
		});

		<!--/* タスク一覧の初期の表示順を保存する（１行ずつ変更する処理） */-->
		let currentDispOrder = new Map();
		$('#taskDataList li').each(function(idx){
			currentDispOrder.set($(this).attr('data-worker-seq'), parseInt(idx));
		});

		<!--/* タスク一覧の並べ替え処理（１行ずつ変更する処理） */-->
		$('#taskDataList').sortable({
			containment: "parent",
			handle: '.sortableObj',
		});

		<!--/* タスク一覧の並べ替え処理（１行ずつ変更する処理） */-->
		$('#taskDataList').bind('sortupdate', function(){
			let workerSeq = [];

			$(this).find('.taskListRow').each(function(idx){
				<!--/* 並び替えたタスク一覧を順番通りにセット */-->
				workerSeq.push($(this).attr('data-worker-seq'));
			});

			<!--/* パラメータをStringに変換して渡す */-->
			if (workerSeq.length > 0) {
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				const selectedTabClass = /*[[${selectedTabClass}]]*/;

				$.ajax({
					url : "/user/taskManagement/dispOrder",
					type : "POST",
					data : {
						"page" : 0,
						"taskWorkerSeq" : String(workerSeq),
						"selectedTabClass": selectedTabClass
					},
				}).done(function(responce) {
					if (responce.succeeded) {
						$('#taskDataList li').each(function(idx){
							currentDispOrder.set($(this).attr('data-worker-seq'), parseInt(idx));
						});
					} else {
						if (responce.message) {
							alert(responce.message);
						}
					}
				}).fail(function(jqXHR, textStatus, errorThrown) {
				}).always(function() {
					ajaxRunning = false;
				});
			}
		});

		<!--/* 並び替えセレクトボックス変更 */-->
		$('#allTaskListInputFragment').on("change", ".changeTaskListSortKey", function() {

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			<!--/* タスク一覧ソート 1:設定した順 2:期限日-昇順 3:期限日-降順 */-->
			const sortKeyCd = $(this).val();
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedTaskSeq = $('#selectedTaskSeq').val();

			$.ajax({
				url : '/user/taskManagement/sortAllTaskList',
				type : "GET",
				data : {
					"page": 0,
					"selectedTabClass": selectedTabClass,
					"selectedTaskSeq": selectedTaskSeq,
					"sortKeyCd": sortKeyCd
				},
			}).done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					$('#taskListFragmentWrap').html(data);

					<!--/* 詳細画面が開いていたら再表示 */-->
					if (!$('#taskDetailFragmentWrap').hasClass('hidden')) {
						renderTaskDetailInputForm(selectedTaskSeq, selectedTabClass, null, false);
					}
					renderTaskMenu(selectedTabClass, null);
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					let sessionTimeOutKey = /*[[${T(jp.loioz.common.constant.MessageEnum).MSG_E00161.messageKey}]]*/'';
					if (sessionTimeOutKey == errorMsg) {
						window.location.href = '/user/taskManagement/list'
					} else {
						showErrorMessageForJs(errorMsg);
					}
				}
			}).fail(function(jqXHR, textStatus, errorThrown) {
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 一覧出力 */-->
		$('#allTaskListInputFragment').on("click", ".outputTaskList", function() {

			<!--/* ダウンロード処理 */-->
			const url = "/user/taskManagement/outputTaskList";
			const button = $(this);
			let formData = {};
			downloadFileAjax(url, button, formData);

			return false;
		});

	});
	</script>

	<!--/* HTML */-->
	<input type="hidden" id="taskPageSize" th:value="${taskListSearchForm.allTaskListSearchForm.pageSize.intVal}">
	<input type="hidden" id="taskPage" th:value="${taskListSearchForm.allTaskListSearchForm.page}">
	<!--/* ページング時に参照する選択中タスクSEQ */-->
	<input id="selectedTaskSeq" type="hidden" th:value=${selectedTaskSeq}>
	<!--/* 選択中タスクSEQを表示しているページ */-->
	<input id="pageForSelectedTaskSeq" type="hidden" th:value=${pageForSelectedTaskSeq}>
	<form id="taskListInputForm" th:object="${taskListInputForm}" autocomplete="off">

		<!--/* タスク一覧ブロック */-->
		<div class="vertical_block_wrapper">

			<!--/* タスクタイトル */-->
			<div id="taskListTitle" class="vertical_block_header d-flex flex-wrap align-items-center my-3 pr-3">
				<div class="selected_list_title mr-auto" th:text="${listTitle}">すべてのタスク</div>
				<!--/* ページング */-->
				<div id="taskListPagerFragmentWrap">
					<div th:replace="common/pagerAjax::pagerAjax(page=*{taskListForTaskManagement[0].page}, listFragmentId='taskListTitle')"></div>
				</div>
				<div class="selected_list_sort_task">
					<select class="form-control digit7 changeTaskListSortKey" th:with="sortKeyCd=*{taskListSortKeyCd}">
						<option th:each="taskListSortKey : ${T(jp.loioz.common.constant.CommonConstant$AllTaskListSortKey).values()}" 
							th:label="${taskListSortKey.getVal()}" th:text="${taskListSortKey.getVal()}" th:value="${taskListSortKey.getCd()}" th:selected="${taskListSortKey.equalsByCode(sortKeyCd)}">
						</option>
					</select>
				</div>
				<!--/* 一覧出力 */-->
				<div>
					<button class="btn btn-light outputTaskList"><i class="fas fa-download text-primary"></i><i class="fas fa-spinner text-primary faa-spin animated hidden"></i>一覧出力</button>
				</div>
			</div>

			<!--/* タスク一覧 */-->
			<div class="vertical_block_body">
				<div class="task_list_data_block" th:if="*{!isExistTask()}">
					<div class="task_type_title">
						<div class="no_data_task">
							<i class="fas fa-inbox"></i>
							<span th:text="|${listTitle}はありません。|"></span>
						</div>
					</div>
				</div>
				<div class="task_list_data_block taskListDataBlock" th:each="taskData, stat : *{taskListForTaskManagement}" th:classappend="${taskData.taskList.size() > 0 ? '' : 'hidden'}">

					<div class="collapse" th:id="|collapseTaskType${stat.index}|" 
						th:classappend="|${(!T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskData.taskStatusCd) && !T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.getVal().equals(taskData.taskTypeTitle) ? 'show' : '')}|">
						<ul id="taskDataList" class="task_data_list">
							<th:block th:each="task : ${taskData.taskList}">
								<!--/* タスクの1行 */-->
								<li th:replace="::allTaskListRowFragment(task)(${task})"></li>
							</th:block>
						</ul>
					</div>
				</div>
			</div>
			<!--/* タスク一覧 end */-->

			<!--/* タスク追加 */-->
			<div class="vertical_block_footer">
				<div class="add_task_block">
					<input type="text" class="form-control add_task_text addTask" placeholder="＋タスクを追加" th:field="*{taskTitle}" maxlength="255">
					<div th:if="*{#fields.hasErrors('taskTitle')}" th:errors="*{taskTitle}" class="error_mag_point">error</div>
				</div>
			</div>
			<!--/* タスク追加 end */-->

		</div>
		<!--/* タスク一覧ブロック end */-->

	</form>
</div>

<!--/* すべてのタスクリスト画面 - タスク1行分のHTML */-->
<li th:fragment="allTaskListRowFragment(task)"
	th:class="|taskListRow taskData${task.taskSeq}|"
	th:classappend="|${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'task_compleat' : '')} ${selectedTaskSeq==task.taskSeq ? 'selected' : ''}|"
	th:data-seq ="${task.taskSeq}" th:data-worker-seq="${task.taskWorkerSeq}">
	
	<input type="hidden" name="newTaskSeq" th:value="${newTaskSeq}">
	<input type="hidden" name="rowTaskSeq" th:value="${task.taskSeq}">
	<input type="hidden" name="isAllTaskDisp" th:value="${isAllTask}">
	<!--/* タスク1行 */-->
	<div class="task_row_data">
		
		<!--/* 並び替え用マーク */-->
		<div class="stop-events sortableObjWrap" th:classappend="${!(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus)) ? '' : 'hidden'}">
			<div class="move_point sortableObj" th:classappend="${taskListSearchForm.allTaskListSearchForm.canSort() ? '' : 'hidden'}">
				<svg class="icon_drag_indicator hidden"></svg>
				<di class="sortable_obj_space"></di>
			</div>
		</div>
		
		<!--/* チェックマーク */-->
		<div class="task_row_data_check stop-events changeTaskStatus" th:data-seq="${task.taskSeq}" th:data-status="${task.taskStatus}"
			data-boundary="window" data-container="#allTaskListInputFragment" data-toggle="tooltip"
			th:title="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? '未着手に戻す' : '完了にする')}"
			th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'taskCheckHoverComp' : 'taskCheckHover')}">
			
			<!--/* 未完了 */-->
			<div class="taskStatusPreparing" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'hidden' : ' ')}">
				<i class="far fa-circle"></i>
			</div>
			<!--/* 完了 */-->
			<div class="taskStatusComp task_check__comp" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'noHoverTask' : 'hidden')}" >
				<i class="far fa-check-circle"></i>
			</div>
		</div>
		
		<!--/* タスクの内容 */-->
		<div class="task_contents">
			<!--/* 1行目 */-->
			<div class="task_contents_main">
				<!--/* タイトル */-->
				<div class="task_contents__title taskTitle">
					<i th:classappend="|taskExclamation${task.taskSeq}|" class="fas fa-exclamation-circle text-danger taskExclamation" th:if="${(T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newTaskKakuninFlg)) || (T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newHistoryKakuninFlg))}"></i>
					<span th:text="${task.title}">タスクタイトル</span>
				</div>
				
				<!--/* サブタスクが有る場合、件数を表示） */-->
				<div class="check_item_count">
					<th:block th:if="${task.checkItemCount != 0}">
						<i class="far fa-check-square mr-1"></i>
						<span th:text="${task.completeCheckItemCount}"></span>/<span th:text="${task.checkItemCount}"></span>
					</th:block>
				</div>
				
				<!--/* ステータス（進行中のみ） */-->
				<div class="task_list_staus taskListStaus">
					<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.equalsByCode(task.taskStatus))}">
						<span>進行中</span>
					</th:block>
				</div>
				<!--/* ステータス（進行中のみ）end  */-->
			</div>
			<!--/* 1行目 end */-->
			
			<!--/* 2行目 */-->
			<div class="task_contents_sub">
				<!--/* 期限 */-->
				<div class="task_contents_sub__limit" th:if="${task.limitDtTo}" th:classappend="${task.limitDateStyle}">
					<i class="far fa-calendar-alt"></i>
					<span th:text ="${#temporals.format(task.limitDateForDisplay, 'M月d日')}">1月1日</span>
					<span th:text="| (${#temporals.format(task.limitDateForDisplay, 'E')})|">(月)</span>
					<span th:if="${task.limitTime}" th:text ="| ${#temporals.format(task.limitTime, 'H:mm')}|">0:00</span>
				</div>
				
				<!--/* 今日タスク */-->
				<div class="task_contents_sub__today" th:if="${#temporals.format(task.todayTaskDate, 'yyyy-MM-dd')==#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
					<i class="far fa-clock"></i>
					<span>今日のタスク</span>
				</div>
				
				<!--/* コメント数 */-->
				<div class="task_contents_sub__comment" th:if="${task.commentCount} > 0">
					<i class="far fa-comment"></i>
					<span th:text="${task.commentCount}"></span>
				</div>
				
				<!--/* 案件リンク */-->
				<div class="task_contents_sub__anken" th:if="${task.ankenId}">
					<span class="relation_link">
						<i class="fas fa-hashtag"></i>
						<span th:text="${#strings.isEmpty(task.ankenName)} ? |(案件名未入力) (${task.ankenId.toString()})| : |${task.ankenName} (${task.ankenId.toString()})|"></span>
					</span>
				</div>
				
				<!--/* タスク割り当て */-->
				<div class="task_contents_sub__tanto">
					<th:block th:each="taskTanto, stat : ${task.assignTaskTantoList}">
						<span data-boundary="window" data-container="#allTaskListInputFragment" data-toggle="tooltip" th:title="${task.getAccountName(taskTanto.workerAccountSeq)}" >
							<i class="fas fa-user-circle" th:style="|color: ${taskTanto.accountColor}|"></i>
						</span>
					</th:block>
				</div>
				<!--/* タスク割り当て end */-->
				
			</div>
		</div>
		<!--/* タスクの内容 end */-->
		
	</div>
	<!--/* タスク1行 end */-->
</li>



<!--/* 期限を過ぎたタスクリスト画面 */-->
<div th:fragment="overdueTaskListInputFragment(taskListInputForm)" id="overdueTaskListInputFragment">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function(){

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		<!--/* タスク一覧クリック（タスク詳細画面表示） */-->
		$('#overdueTaskListInputFragment').on("click", ".taskListRow", function() {

			<!--/* 他処理を実行中に、詳細画面が開かないよう制御 */-->
			if (ajaxRunning) {
				return false;
			}

			<!--/* タスク一覧の選択済みを解除 */-->
			$(".taskListRow").removeClass("selected");
			<!--/* 選択済みに変更 */-->
			$(this).addClass("selected");
			<!-- /* 一覧で選択中のタスクSEQセット */ -->
			$('#selectedTaskSeq').val($(this).data("seq"));
			$('#pageForSelectedTaskSeq').val($('#taskPage').val());

			Promise.resolve()
				<!--/* タスク詳細画面表示 */-->
				.then(() => renderTaskDetailInputForm($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, null, false))
				<!--/* タスクメニュー画面更新 新着マークの更新のため。メニューの件数と一覧で表示している件数がずれる場合有  */-->
				.then(() => renderTaskMenu(/*[[${selectedTabClass}]]*/, null))
		});

		<!-- /* タスク【未着手・進行中】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOn(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOff(this);
			}
		}, '.taskCheckHover');

		<!-- /* タスク【完了】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOff(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOn(this);
			}
		}, '.taskCheckHoverComp');

		<!--/* タスク一覧からステータス変更 */-->
		$('#overdueTaskListInputFragment').on("click", ".changeTaskStatus", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			changeTaskStatus($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, null, $(this).data("seq"), $(this).data("status"), null);
		});

		<!--/* 一覧出力 */-->
		$('#overdueTaskListInputFragment').on("click", ".outputTaskList", function() {

			<!--/* ダウンロード処理 */-->
			const url = "/user/taskManagement/outputTaskList";
			const button = $(this);
			let formData = {};
			downloadFileAjax(url, button, formData);

			return false;
		});

	});
	</script>

	<!--/* HTML */-->
	<input type="hidden" id="taskPageSize" th:value="${taskListSearchForm.overdueTaskListSearchForm.pageSize.intVal}">
	<input type="hidden" id="taskPage" th:value="${taskListSearchForm.overdueTaskListSearchForm.page}">
	<!--/* ページング時に参照する選択中タスクSEQ */-->
	<input id="selectedTaskSeq" type="hidden" th:value=${selectedTaskSeq}>
	<!--/* 選択中タスクSEQを表示しているページ */-->
	<input id="pageForSelectedTaskSeq" type="hidden" th:value=${pageForSelectedTaskSeq}>
	<form id="taskListInputForm" th:object="${taskListInputForm}" autocomplete="off">

		<!--/* タスク一覧ブロック */-->
		<div class="vertical_block_wrapper">

			<!--/* タスクタイトル */-->
			<div id="taskListTitle" class="vertical_block_header d-flex flex-wrap align-items-center my-3 pr-3">
				<div class="selected_list_title mr-auto" th:text="${listTitle}">期限を過ぎたタスク</div>
				<!--/* ページング */-->
				<div id="taskListPagerFragmentWrap">
					<div th:replace="common/pagerAjax::pagerAjax(page=*{taskListForTaskManagement[0].page}, listFragmentId='taskListTitle')"></div>
				</div>
				<!--/* 一覧出力 */-->
				<div>
					<button class="btn btn-light outputTaskList"><i class="fas fa-download text-primary"></i><i class="fas fa-spinner text-primary faa-spin animated hidden"></i>一覧出力</button>
				</div>
			</div>

			<!--/* タスク一覧 */-->
			<div class="vertical_block_body">
				<div class="task_list_data_block" th:if="*{!isExistTask()}">
					<div class="task_type_title">
						<div class="no_data_task">
							<i class="fas fa-fire-alt"></i> 
							<span th:text="|${listTitle}はありません。|"></span>
						</div>
					</div>
				</div>
				<div class="task_list_data_block taskListDataBlock" th:each="taskData, stat : *{taskListForTaskManagement}">

					<div th:id="|collapseTaskType${stat.index}|">
						<ul id="taskDataList" class="task_data_list">
							<th:block th:each="task : ${taskData.taskList}">
								<!--/* タスクの1行 */-->
								<li th:replace="::overdueTaskListRowFragment(${task})"></li>
							</th:block>
						</ul>
					</div>
				</div>
			</div>
			<!--/* タスク一覧 end */-->
		</div>
		<!--/* タスク一覧ブロック end */-->
	</form>
</div>

<!--/* 期限を過ぎたタスクリスト画面 - タスク1行分のHTML */-->
<li th:fragment="overdueTaskListRowFragment(task)"
	th:class="|taskListRow taskData${task.taskSeq}|"
	th:classappend="|${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'task_compleat' : '')} ${selectedTaskSeq==task.taskSeq ? 'selected' : ''}|"
	th:data-seq ="${task.taskSeq}" th:data-worker-seq="${task.taskWorkerSeq}">
	
	<input type="hidden" name="newTaskSeq" th:value="${newTaskSeq}">
	<input type="hidden" name="rowTaskSeq" th:value="${task.taskSeq}">
	<!--/* タスク1行 */-->
	<div class="task_row_data">
		
		<!--/* チェックマーク */-->
		<div class="task_row_data_check stop-events changeTaskStatus" th:data-seq="${task.taskSeq}" th:data-status="${task.taskStatus}"
			data-boundary="window" data-container="#overdueTaskListInputFragment" data-toggle="tooltip"
			th:title="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? '未着手に戻す' : '完了にする')}"
			th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'taskCheckHoverComp' : 'taskCheckHover')}">
			
			<!--/* 未完了 */-->
			<div class="taskStatusPreparing" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'hidden' : ' ')}">
				<i class="far fa-circle"></i>
			</div>
			<!--/* 完了 */-->
			<div class="taskStatusComp task_check__comp" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'noHoverTask' : 'hidden')}" >
				<i class="far fa-check-circle"></i>
			</div>
		</div>
		
		<!--/* タスクの内容 */-->
		<div class="task_contents">
			<!--/* 1行目 */-->
			<div class="task_contents_main">
				<!--/* タイトル */-->
				<div class="task_contents__title taskTitle">
					<i th:classappend="|taskExclamation${task.taskSeq}|" class="fas fa-exclamation-circle text-danger taskExclamation" th:if="${(T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newTaskKakuninFlg)) || (T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newHistoryKakuninFlg))}"></i>
					<span th:text="${task.title}">タスクタイトル</span>
				</div>
				
				<!--/* サブタスクが有る場合、件数を表示） */-->
				<div class="check_item_count">
					<th:block th:if="${task.checkItemCount != 0}">
						<i class="far fa-check-square mr-1"></i>
						<span th:text="${task.completeCheckItemCount}"></span>/<span th:text="${task.checkItemCount}"></span>
					</th:block>
				</div>
				
				<!--/* ステータス（進行中のみ） */-->
				<div class="task_list_staus taskListStaus">
					<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.equalsByCode(task.taskStatus))}">
						<span>進行中</span>
					</th:block>
				</div>
				<!--/* ステータス（進行中のみ）end  */-->
			</div>
			<!--/* 1行目 end */-->
			
			<!--/* 2行目 */-->
			<div class="task_contents_sub">
				<!--/* 期限 */-->
				<div class="task_contents_sub__limit" th:if="${task.limitDtTo}" th:classappend="${task.limitDateStyle}">
					<i class="far fa-calendar-alt"></i>
					<span th:text ="${#temporals.format(task.limitDateForDisplay, 'M月d日')}">1月1日</span>
					<span th:text="| (${#temporals.format(task.limitDateForDisplay, 'E')})|">(月)</span>
					<span th:if="${task.limitTime}" th:text ="| ${#temporals.format(task.limitTime, 'H:mm')}|">0:00</span>
				</div>
				
				<!--/* 今日タスク */-->
				<div class="task_contents_sub__today" th:if="${#temporals.format(task.todayTaskDate, 'yyyy-MM-dd')==#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
					<i class="far fa-clock"></i>
					<span>今日のタスク</span>
				</div>
				
				<!--/* コメント数 */-->
				<div class="task_contents_sub__comment" th:if="${task.commentCount} > 0">
					<i class="far fa-comment"></i>
					<span th:text="${task.commentCount}"></span>
				</div>
				
				<!--/* 案件リンク */-->
				<div class="task_contents_sub__anken" th:if="${task.ankenId}">
					<span class="relation_link">
						<i class="fas fa-hashtag"></i>
						<span th:text="${#strings.isEmpty(task.ankenName)} ? |(案件名未入力) (${task.ankenId.toString()})| : |${task.ankenName} (${task.ankenId.toString()})|"></span>
					</span>
				</div>
				
				<!--/* タスク割り当て */-->
				<div class="task_contents_sub__tanto">
					<th:block th:each="taskTanto, stat : ${task.assignTaskTantoList}">
						<span data-boundary="window" data-container="#overdueTaskListInputFragment" data-toggle="tooltip" th:title="${task.getAccountName(taskTanto.workerAccountSeq)}" >
							<i class="fas fa-user-circle" th:style="|color: ${taskTanto.accountColor}|"></i>
						</span>
					</th:block>
				</div>
				<!--/* タスク割り当て end */-->
				
			</div>
		</div>
		<!--/* タスクの内容 end */-->
		
		
	</div>
	<!--/* タスク1行 end */-->
</li>



<!--/* 割り当てられたタスクリスト画面 */-->
<div th:fragment="assignedTaskListInputFragment(taskListInputForm)" id="assignedTaskListInputFragment">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function(){

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		<!--/* タスク一覧画面で選択したタスクSEQ */-->
		let globalSelectedTaskSeq = /*[[${selectedTaskSeq}]]*/;
		let globalSelectedAssignSeq = /*[[${selectedAssignSeq}]]*/;

		<!--/* タスク一覧クリック（タスク詳細画面表示） */-->
		$('#assignedTaskListInputFragment').on("click", ".taskListRow", function() {

			<!--/* 他処理を実行中に、詳細画面が開かないよう制御 */-->
			if (ajaxRunning) {
				return false;
			}

			<!--/* タスク一覧の選択済みを解除 */-->
			$(".taskListRow").removeClass("selected");
			<!--/* 選択済みに変更 */-->
			$(this).addClass("selected");
			globalSelectedTaskSeq = $(this).data("seq");
			globalSelectedAssignSeq = $(this).data("assignSeq");

			Promise.resolve()
				<!--/* タスク詳細画面表示 */-->
				.then(() => renderTaskDetailInputForm(globalSelectedTaskSeq, /*[[${selectedTabClass}]]*/, globalSelectedAssignSeq, false))
				<!--/* タスクメニュー画面更新 新着マークの更新のため。メニューの件数と一覧で表示している件数がずれる場合有  */-->
				.then(() => renderTaskMenu(/*[[${selectedTabClass}]]*/, null))
		});
		
		<!-- /* タスク【未着手・進行中】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOn(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOff(this);
			}
		}, '.taskCheckHover');
		
		<!-- /* タスク【完了】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOff(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOn(this);
			}
		}, '.taskCheckHoverComp');
		
		<!--/* タスク一覧からステータス変更 */-->
		$('#assignedTaskListInputFragment').on("click", ".changeTaskStatus", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			changeTaskStatus(globalSelectedTaskSeq, /*[[${selectedTabClass}]]*/, globalSelectedAssignSeq, $(this).data("seq"), $(this).data("status"), null);
		});

		<!--/* タスクアコーディオンクリック押下（完了アコーディオン） */-->
		$('#assignedTaskListInputFragment').on("click", ".taskCollapse", function() {
			completedTaskCollapse($(this));
		});

		<!--/* タスクアコーディオンクリック押下（未完了アコーディオン） */-->
		$('#assignedTaskListInputFragment').on("click", ".taskCollapseParent", function() {
			incompleteTaskCollapse($(this));
		});

		<!--/* 一覧出力 */-->
		$('#assignedTaskListInputFragment').on("click", ".outputTaskList", function() {

			<!--/* ダウンロード処理 */-->
			const url = "/user/taskManagement/outputTaskList";
			const button = $(this);
			let formData = {};
			downloadFileAjax(url, button, formData);

			return false;
		});

	});
	</script>

	<!--/* HTML */-->
	<!--/* 選択中タスクSEQを表示しているページ ページングではないため固定で0 */-->
	<input id="pageForSelectedTaskSeq" type="hidden" value=0>
	<form id="taskListInputForm" th:object="${taskListInputForm}" autocomplete="off">

		<!--/* タスク一覧ブロック */-->
		<div class="vertical_block_wrapper">

			<!--/* タスクタイトル */-->
			<div class="vertical_block_header d-flex flex-wrap align-items-center my-3 pr-3">
				<div class="selected_list_title mr-auto" th:text="${listTitle}">割り当てられたタスク</div>
				<!--/* 一覧出力 */-->
				<div>
					<button class="btn btn-light outputTaskList"><i class="fas fa-download text-primary"></i><i class="fas fa-spinner text-primary faa-spin animated hidden"></i>一覧出力</button>
				</div>
			</div>

			<!--/* タスク一覧 */-->
			<div class="vertical_block_body">
				<div class="task_list_data_block" th:if="*{!isExistTask()}">
					<div class="task_type_title">
						<div class="no_data_task">
							<i class="fas fa-user-friends"></i>
							<span th:text="|${listTitle}はありません。|"></span>
						</div>
					</div>
				</div>
				<div class="task_list_data_block taskListDataBlock" th:each="taskData, stat : *{taskListForTaskManagement}"
					th:classappend="${taskListInputForm.getTaskCountForAssignedTask(taskData.taskStatusCd, __${stat.index}__) > 0 ? '' : 'hidden'}"
					th:data-assign-seq="${taskData.taskAssignSeq}">

					<!--/* 開閉アコーディオン */-->
					<th:block th:if="${!(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskData.taskStatusCd))}">
						<div class="" th:classappend="${stat.index == 0 ? 'task_type_title' : 'assign_task_type_title'}">
							<a class="taskCollapseParent task_collapse_open" th:data-index="${stat.index}"
								data-toggle="collapse" th:href="|#collapseTaskType${stat.index}|" role="button" aria-expanded="false" th:aria-controls="|collapseTaskType${stat.index}|">
								<i th:id="|collapseClose${stat.index}|" class="fas fa-chevron-right mr-2 hidden"></i>
								<i th:id="|collapseOpen${stat.index}|" class="fas fa-chevron-down mr-2"></i>
								<span th:text="${taskData.taskAssignName}" th:if="${!#strings.isEmpty(taskData.taskAssignName)}"></span>
								<span class="ml-3 taskCollapseParentCount" th:text="${taskData.taskList.size()}"></span>
							</a>
						</div>
					</th:block>

					<div class="collapse" th:id="|collapseTaskType${stat.index}|" 
						th:classappend="|${(!T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskData.taskStatusCd) && !T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.getVal().equals(taskData.taskTypeTitle) ? 'show' : '')}|">
						<ul id="taskDataList" class="task_data_list" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskData.taskStatusCd)) ? 'ml-5' : ''}">
							<th:block th:each="task : ${taskData.taskList}">
								<!--/* タスクの1行 */-->
								<li th:replace="::assignedTaskListRowFragment(${task}, ${taskData.taskAssignSeq})"></li>
							</th:block>
						</ul>
					</div>
				</div>
			</div>
			<!--/* タスク一覧 end */-->

		</div>
		<!--/* タスク一覧ブロック end */-->

	</form>
</div>

<!--/* 割り当てられたタスクリスト画面 - タスク1行分のHTML */-->
<li th:fragment="assignedTaskListRowFragment(task, taskAssignSeq)"
	th:class="|taskListRow taskData${task.taskSeq}|"
	th:classappend="|${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'task_compleat' : '')} ${(selectedTaskSeq==task.taskSeq && selectedAssignSeq==taskAssignSeq) ? 'selected' : ''}|"
	th:data-seq ="${task.taskSeq}" th:data-worker-seq="${task.taskWorkerSeq}" th:data-assign-seq="${taskAssignSeq}">
	
	<input type="hidden" name="newTaskSeq" th:value="${newTaskSeq}">
	<input type="hidden" name="rowTaskSeq" th:value="${task.taskSeq}">
	<!--/* タスク1行 */-->
	<div class="task_row_data">
		
		<!--/* チェックマーク */-->
		<div class="task_row_data_check stop-events changeTaskStatus" th:data-seq="${task.taskSeq}" th:data-status="${task.taskStatus}"
			data-boundary="window" data-container="#assignedTaskListInputFragment" data-toggle="tooltip"
			th:title="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? '未着手に戻す' : '完了にする')}"
			th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'taskCheckHoverComp' : 'taskCheckHover')}">
			
			<!--/* 未完了 */-->
			<div class="taskStatusPreparing" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'hidden' : ' ')}">
				<i class="far fa-circle"></i>
			</div>
			<!--/* 完了 */-->
			<div class="taskStatusComp task_check__comp" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'noHoverTask' : 'hidden')}" >
				<i class="far fa-check-circle"></i>
			</div>
		</div>
		
		<!--/* タスクの内容 */-->
		<div class="task_contents">
			<!--/* 1行目 */-->
			<div class="task_contents_main">
				<!--/* タイトル */-->
				<div class="task_contents__title taskTitle">
					<i th:classappend="|taskExclamation${task.taskSeq}|" class="fas fa-exclamation-circle text-danger taskExclamation" th:if="${(T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newTaskKakuninFlg)) || (T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newHistoryKakuninFlg))}"></i>
					<span th:text="${task.title}">タスクタイトル</span>
				</div>
				
				<!--/* サブタスクが有る場合、件数を表示） */-->
				<div class="check_item_count">
					<th:block th:if="${task.checkItemCount != 0}">
						<i class="far fa-check-square mr-1"></i>
						<span th:text="${task.completeCheckItemCount}"></span>/<span th:text="${task.checkItemCount}"></span>
					</th:block>
				</div>
				
				<!--/* ステータス（進行中のみ） */-->
				<div class="task_list_staus taskListStaus">
					<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.equalsByCode(task.taskStatus))}">
						<span>進行中</span>
					</th:block>
				</div>
				<!--/* ステータス（進行中のみ）end  */-->
			</div>
			<!--/* 1行目 end */-->
			
			<!--/* 2行目 */-->
			<div class="task_contents_sub">
				<!--/* 期限 */-->
				<div class="task_contents_sub__limit" th:if="${task.limitDtTo}" th:classappend="${task.limitDateStyle}">
					<i class="far fa-calendar-alt"></i>
					<span th:text ="${#temporals.format(task.limitDateForDisplay, 'M月d日')}">1月1日</span>
					<span th:text="| (${#temporals.format(task.limitDateForDisplay, 'E')})|">(月)</span>
					<span th:if="${task.limitTime}" th:text ="| ${#temporals.format(task.limitTime, 'H:mm')}|">0:00</span>
				</div>
				
				<!--/* 今日タスク */-->
				<div class="task_contents_sub__today" th:if="${#temporals.format(task.todayTaskDate, 'yyyy-MM-dd')==#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
					<i class="far fa-clock"></i>
					<span>今日のタスク</span>
				</div>
				
				<!--/* コメント数 */-->
				<div class="task_contents_sub__comment" th:if="${task.commentCount} > 0">
					<i class="far fa-comment"></i>
					<span th:text="${task.commentCount}"></span>
				</div>
				
				<!--/* 案件リンク */-->
				<div class="task_contents_sub__anken" th:if="${task.ankenId}">
					<span class="relation_link">
						<i class="fas fa-hashtag"></i>
						<span th:text="${#strings.isEmpty(task.ankenName)} ? |(案件名未入力) (${task.ankenId.toString()})| : |${task.ankenName} (${task.ankenId.toString()})|"></span>
					</span>
				</div>
				
				<!--/* タスク割り当て */-->
				<div class="task_contents_sub__tanto">
					<th:block th:each="taskTanto, stat : ${task.assignTaskTantoList}">
						<span data-boundary="window" data-container="#assignedTaskListInputFragment" data-toggle="tooltip" th:title="${task.getAccountName(taskTanto.workerAccountSeq)}" >
							<i class="fas fa-user-circle" th:style="|color: ${taskTanto.accountColor}|"></i>
						</span>
					</th:block>
				</div>
				<!--/* タスク割り当て end */-->
				
			</div>
		</div>
		<!--/* タスクの内容 end */-->
		
		
	</div>
	<!--/* タスク1行 end */-->
</li>



<!--/* 割り当てたタスクリスト画面 */-->
<div th:fragment="assignTaskListInputFragment(taskListInputForm)" id="assignTaskListInputFragment">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function(){

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		<!--/* タスク一覧画面で選択したタスクSEQ */-->
		let globalSelectedTaskSeq = /*[[${selectedTaskSeq}]]*/;
		let globalSelectedAssignSeq = /*[[${selectedAssignSeq}]]*/;

		<!--/* タスク一覧クリック（タスク詳細画面表示） */-->
		$('#assignTaskListInputFragment').on("click", ".taskListRow", function() {

			<!--/* 他処理を実行中に、詳細画面が開かないよう制御 */-->
			if (ajaxRunning) {
				return false;
			}

			<!--/* タスク一覧の選択済みを解除 */-->
			$(".taskListRow").removeClass("selected");
			<!--/* 選択済みに変更 */-->
			$(this).addClass("selected");
			globalSelectedTaskSeq = $(this).data("seq");
			globalSelectedAssignSeq = $(this).data("assignSeq");

			Promise.resolve()
				<!--/* タスク詳細画面表示 */-->
				.then(() => renderTaskDetailInputForm(globalSelectedTaskSeq, /*[[${selectedTabClass}]]*/, globalSelectedAssignSeq, false))
				<!--/* タスクメニュー画面更新 新着マークの更新のため。メニューの件数と一覧で表示している件数がずれる場合有  */-->
				.then(() => renderTaskMenu(/*[[${selectedTabClass}]]*/, null))
		});

		<!-- /* タスク【未着手・進行中】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOn(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOff(this);
			}
		}, '.taskCheckHover');

		<!-- /* タスク【完了】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOff(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOn(this);
			}
		}, '.taskCheckHoverComp');

		<!--/* タスク一覧からステータス変更 */-->
		$('#assignTaskListInputFragment').on("click", ".changeTaskStatus", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			changeTaskStatus(globalSelectedTaskSeq, /*[[${selectedTabClass}]]*/, globalSelectedAssignSeq, $(this).data("seq"), $(this).data("status"), null);
		});

		<!--/* タスクアコーディオンクリック押下（完了アコーディオン） */-->
		$('#assignTaskListInputFragment').on("click", ".taskCollapse", function() {
			completedTaskCollapse($(this));
		});

		<!--/* タスクアコーディオンクリック押下（未完了アコーディオン） */-->
		$('#assignTaskListInputFragment').on("click", ".taskCollapseParent", function() {
			incompleteTaskCollapse($(this));
		});

		<!--/* 一覧出力 */-->
		$('#assignTaskListInputFragment').on("click", ".outputTaskList", function() {

			<!--/* ダウンロード処理 */-->
			const url = "/user/taskManagement/outputTaskList";
			const button = $(this);
			let formData = {};
			downloadFileAjax(url, button, formData);

			return false;
		});

	});
	</script>

	<!--/* HTML */-->
	<!--/* 選択中タスクSEQを表示しているページ ページングではないため固定で0 */-->
	<input id="pageForSelectedTaskSeq" type="hidden" value=0>
	<form id="taskListInputForm" th:object="${taskListInputForm}" autocomplete="off">

		<!--/* タスク一覧ブロック */-->
		<div class="vertical_block_wrapper">

			<!--/* タスクタイトル */-->
			<div class="vertical_block_header d-flex flex-wrap align-items-center my-3 pr-3">
				<div class="selected_list_title mr-auto" th:text="${listTitle}">割り当てたタスク</div>
				<!--/* 一覧出力 */-->
				<div>
					<button class="btn btn-light outputTaskList"><i class="fas fa-download text-primary"></i><i class="fas fa-spinner text-primary faa-spin animated hidden"></i>一覧出力</button>
				</div>
			</div>

			<!--/* タスク一覧 */-->
			<div class="vertical_block_body">
				<div class="task_list_data_block" th:if="*{!isExistTask()}">
					<div class="task_type_title">
						<div class="no_data_task">
							<i class="fas fa-user-check"></i>
							<span th:text="|${listTitle}はありません。|"></span>
						</div>
					</div>
				</div>
				<div class="task_list_assign_data_block taskListDataBlock" th:each="taskData, stat : *{taskListForTaskManagement}"
					th:classappend="${taskListInputForm.getTaskCountForAssignedTask(taskData.taskStatusCd, __${stat.index}__) > 0 ? '' : 'hidden'}"
					th:data-assign-seq="${taskData.taskAssignSeq}">

					<!--/* 開閉アコーディオン */-->
					<th:block th:if="${!(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskData.taskStatusCd))}">
						<div class="" th:classappend="${stat.index == 0 ? 'task_type_title' : 'assign_task_type_title'}">
							<a class="taskCollapseParent task_collapse_open" th:data-index="${stat.index}"
								data-toggle="collapse" th:href="|#collapseTaskType${stat.index}|" role="button" aria-expanded="false" th:aria-controls="|collapseTaskType${stat.index}|">
								<i th:id="|collapseClose${stat.index}|" class="fas fa-chevron-right mr-2 hidden"></i>
								<i th:id="|collapseOpen${stat.index}|" class="fas fa-chevron-down mr-2"></i>
								<span th:text="${taskData.taskAssignName}" th:if="${!#strings.isEmpty(taskData.taskAssignName)}"></span>
								<span class="ml-3 taskCollapseParentCount" th:text="${taskData.taskList.size()}"></span>
							</a>
						</div>
					</th:block>

					<div class="collapse" th:id="|collapseTaskType${stat.index}|" 
						th:classappend="|${(!T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskData.taskStatusCd) && !T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.getVal().equals(taskData.taskTypeTitle) ? 'show' : '')}|">
						<ul id="taskDataList" class="task_data_list" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskData.taskStatusCd)) ? 'ml-5' : ''}">
							<th:block th:each="task : ${taskData.taskList}">
								<!--/* タスクの1行 */-->
								<li th:replace="::assignTaskListRowFragment(${task}, ${taskData.taskAssignSeq})"></li>
							</th:block>
						</ul>
					</div>
				</div>
			</div>
			<!--/* タスク一覧 end */-->

		</div>
		<!--/* タスク一覧ブロック end */-->

	</form>
</div>

<!--/* 割り当てたタスクリスト画面 - タスク1行分のHTML */-->
<li th:fragment="assignTaskListRowFragment(task, taskAssignSeq)"
	th:class="|taskListRow taskData${task.taskSeq}|"
	th:classappend="|${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'task_compleat' : '')} ${(selectedTaskSeq==task.taskSeq && selectedAssignSeq==taskAssignSeq) ? 'selected' : ''}|"
	th:data-seq ="${task.taskSeq}" th:data-worker-seq="${task.taskWorkerSeq}" th:data-assign-seq="${taskAssignSeq}">
	
	<input type="hidden" name="newTaskSeq" th:value="${newTaskSeq}">
	<input type="hidden" name="rowTaskSeq" th:value="${task.taskSeq}">
	<!--/* タスク1行 */-->
	<div class="task_row_data">
		
		<!--/* チェックマーク */-->
		<div class="task_row_data_check stop-events changeTaskStatus" th:data-seq="${task.taskSeq}" th:data-status="${task.taskStatus}"
			data-boundary="window" data-container="#assignTaskListInputFragment" data-toggle="tooltip"
			th:title="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? '未着手に戻す' : '完了にする')}"
			th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'taskCheckHoverComp' : 'taskCheckHover')}">
			
			<!--/* 未完了 */-->
			<div class="taskStatusPreparing" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'hidden' : ' ')}">
				<i class="far fa-circle"></i>
			</div>
			<!--/* 完了 */-->
			<div class="taskStatusComp task_check__comp" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'noHoverTask' : 'hidden')}" >
				<i class="far fa-check-circle"></i>
			</div>
		</div>
		
		<!--/* タスクの内容 */-->
		<div class="task_contents">
			<!--/* 1行目 */-->
			<div class="task_contents_main">
				<!--/* タイトル */-->
				<div class="task_contents__title taskTitle">
					<i th:classappend="|taskExclamation${task.taskSeq}|" class="fas fa-exclamation-circle text-danger taskExclamation" th:if="${(T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newTaskKakuninFlg)) || (T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newHistoryKakuninFlg))}"></i>
					<span th:text="${task.title}">タスクタイトル</span>
				</div>
				
				<!--/* サブタスクが有る場合、件数を表示） */-->
				<div class="check_item_count">
					<th:block th:if="${task.checkItemCount != 0}">
						<i class="far fa-check-square mr-1"></i>
						<span th:text="${task.completeCheckItemCount}"></span>/<span th:text="${task.checkItemCount}"></span>
					</th:block>
				</div>
				
				<!--/* ステータス（進行中のみ） */-->
				<div class="task_list_staus taskListStaus">
					<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.equalsByCode(task.taskStatus))}">
						<span>進行中</span>
					</th:block>
				</div>
				<!--/* ステータス（進行中のみ）end  */-->
			</div>
			<!--/* 1行目 end */-->
			
			<!--/* 2行目 */-->
			<div class="task_contents_sub">
				<!--/* 期限 */-->
				<div class="task_contents_sub__limit" th:if="${task.limitDtTo}" th:classappend="${task.limitDateStyle}">
					<i class="far fa-calendar-alt"></i>
					<span th:text ="${#temporals.format(task.limitDateForDisplay, 'M月d日')}">1月1日</span>
					<span th:text="| (${#temporals.format(task.limitDateForDisplay, 'E')})|">(月)</span>
					<span th:if="${task.limitTime}" th:text ="| ${#temporals.format(task.limitTime, 'H:mm')}|">0:00</span>
				</div>
				
				<!--/* 今日タスク */-->
				<div class="task_contents_sub__today" th:if="${#temporals.format(task.todayTaskDate, 'yyyy-MM-dd')==#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
					<i class="far fa-clock"></i>
					<span>今日のタスク</span>
				</div>
				
				<!--/* コメント数 */-->
				<div class="task_contents_sub__comment" th:if="${task.commentCount} > 0">
					<i class="far fa-comment"></i>
					<span th:text="${task.commentCount}"></span>
				</div>
				
				<!--/* 案件リンク */-->
				<div class="task_contents_sub__anken" th:if="${task.ankenId}">
					<span class="relation_link">
						<i class="fas fa-hashtag"></i>
						<span th:text="${#strings.isEmpty(task.ankenName)} ? |(案件名未入力) (${task.ankenId.toString()})| : |${task.ankenName} (${task.ankenId.toString()})|"></span>
					</span>
				</div>
				
				<!--/* タスク割り当て */-->
				<div class="task_contents_sub__tanto">
					<th:block th:each="taskTanto, stat : ${task.assignTaskTantoList}">
						<span data-boundary="window" data-container="#assignTaskListInputFragment" data-toggle="tooltip" th:title="${task.getAccountName(taskTanto.workerAccountSeq)}" >
							<i class="fas fa-user-circle" th:style="|color: ${taskTanto.accountColor}|"></i>
						</span>
					</th:block>
				</div>
				<!--/* タスク割り当て end */-->
				
			</div>
		</div>
		<!--/* タスクの内容 end */-->
	</div>
	<!--/* タスク1行 end */-->
</li>

<!--/* 完了したタスクリスト画面 */-->
<div th:fragment="closeTaskListInputFragment(taskListInputForm)" id="closeTaskListInputFragment">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function(){

		<!--/* 共有の要素セットアップ処理  */-->
		commonSetUpElement();

		<!--/* タスク一覧クリック（タスク詳細画面表示） */-->
		$('#closeTaskListInputFragment').on("click", ".taskListRow", function() {
			<!--/* 他処理を実行中に、詳細画面が開かないよう制御  */-->
			if (ajaxRunning) {
				return false;
			}

			<!--/* タスク一覧の選択済みを解除  */-->
			$(".taskListRow").removeClass("selected");
			<!--/* 選択済みに変更  */-->
			$(this).addClass("selected");
			<!-- /* 一覧で選択中のタスクSEQ、ページ番号セット */ -->
			$('#selectedTaskSeq').val($(this).data("seq"));
			$('#pageForSelectedTaskSeq').val($('#taskPage').val());

			Promise.resolve()
				<!--/* タスク詳細画面表示 */-->
				.then(() => renderTaskDetailInputForm($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, null, false))
				<!--/* タスクメニュー画面更新 新着マークの更新のため。メニューの件数と一覧で表示している件数がずれる場合有  */-->
				.then(() => renderTaskMenu(/*[[${selectedTabClass}]]*/, null))
		});

		<!-- /* タスク【未着手・進行中】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOn(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOff(this);
			}
		}, '.taskCheckHover');

		<!-- /* タスク【完了】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOff(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOn(this);
			}
		}, '.taskCheckHoverComp');
		
		<!--/* タスク一覧からステータス変更 */-->
		$('#closeTaskListInputFragment').on("click", ".changeTaskStatus", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			changeTaskStatus($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, null, $(this).data("seq"), $(this).data("status"), null);
		});

		<!--/* タスク一覧からタスク削除 */-->
		$('#closeTaskListInputFragment').on("click", ".listDeleteTask", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			
			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			<!-- /* ステータスを変更したタスクのli */ -->
			let taskLi = $('.taskData' + taskSeq);

			$.ajax({
				url : "/user/taskManagement/deleteTask",
				type : "POST",
				data : {
					"page" : 0,
					"taskSeq" : taskSeq,
					"selectedTabClass" : selectedTabClass,
					"selectedTaskSeq" : /*[[${selectedTaskSeq}]]*/,
					"selectedAssignSeq" : /*[[${selectedAssignSeq}]]*/
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!-- /* 処理成功 */-->
					<!-- /* 対象のタスクが選択状態の場合は、選択を解除し、詳細を閉じる */ -->
					if (taskLi.hasClass('selected')) {
						taskLi.removeClass('selected');
						<!-- /* 詳細領域は閉じる */ -->
						$('#taskDetailFragmentWrap').addClass("hidden");
						$('#taskDetailFragmentWrap').html('');
					}
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

					Promise.resolve()
						.then(() => deleteTaskRowForAfterDeleteTask(selectedTabClass, taskSeq, null))
						.then(() => renderTaskMenu(selectedTabClass, null))
				} else {
					<!-- /* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00014}]]*/ "削除に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 並び替えセレクトボックス変更 */-->
		$('#closeTaskListInputFragment').on("change", ".changeTaskListSortKey", function() {

			<!--/* タスク一覧ソート 1:完了順 2:期限日-昇順 3:期限日-降順 */-->
			const sortKeyCd = $(this).val();
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedTaskSeq = $('#selectedTaskSeq').val();

			$.ajax({
				url : '/user/taskManagement/sortCloseTaskList',
				type : "GET",
				data : {
					"page": 0,
					"selectedTabClass": selectedTabClass,
					"selectedTaskSeq": selectedTaskSeq,
					"sortKeyCd": sortKeyCd
				},
			}).done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					$('#taskListFragmentWrap').html(data);

					<!--/* 詳細画面が開いていたら再表示 */-->
					if (!$('#taskDetailFragmentWrap').hasClass('hidden')) {
						renderTaskDetailInputForm(selectedTaskSeq, selectedTabClass, null, false);
					}
					renderTaskMenu(selectedTabClass, null);
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					let sessionTimeOutKey = /*[[${T(jp.loioz.common.constant.MessageEnum).MSG_E00161.messageKey}]]*/'';
					if (sessionTimeOutKey == errorMsg) {
						window.location.href = '/user/taskManagement/list'
					} else {
						showErrorMessageForJs(errorMsg);
					}
				}
			}).fail(function(jqXHR, textStatus, errorThrown) {
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 一覧出力 */-->
		$('#closeTaskListInputFragment').on("click", ".outputTaskList", function() {

			<!--/* ダウンロード処理 */-->
			const url = "/user/taskManagement/outputTaskList";
			const button = $(this);
			let formData = {};
			downloadFileAjax(url, button, formData);

			return false;
		});

	});
	</script>

	<!--/* HTML */-->
	<input type="hidden" id="taskPageSize" th:value="${taskListSearchForm.closeTaskListSearchForm.pageSize.intVal}">
	<input type="hidden" id="taskPage" th:value="${taskListSearchForm.closeTaskListSearchForm.page}">
	<!--/* ページング時に参照する選択中タスクSEQ */-->
	<input id="selectedTaskSeq" type="hidden" th:value=${selectedTaskSeq}>
	<!--/* 選択中タスクSEQを表示しているページ */-->
	<input id="pageForSelectedTaskSeq" type="hidden" th:value=${pageForSelectedTaskSeq}>
	<form id="taskListInputForm" th:object="${taskListInputForm}" autocomplete="off">

		<!--/* タスク一覧ブロック */-->
		<div class="vertical_block_wrapper">

			<!--/* タスクタイトル */-->
			<div id="taskListTitle" class="vertical_block_header d-flex flex-wrap align-items-center my-3 pr-3">
				<div class="selected_list_title mr-auto" th:text="${listTitle}">完了したタスク</div>
				<!--/* ページング */-->
				<div id="taskListPagerFragmentWrap">
					<div th:replace="common/pagerAjax::pagerAjax(page=*{taskListForTaskManagement[0].page}, listFragmentId='taskListTitle')"></div>
				</div>
				<div class="selected_list_sort_task">
					<select class="form-control digit7 changeTaskListSortKey" th:with="sortKeyCd=*{taskListSortKeyCd}">
						<option th:each="taskListSortKey : ${T(jp.loioz.common.constant.CommonConstant$CloseTaskListSortKey).values()}" 
							th:label="${taskListSortKey.getVal()}" th:text="${taskListSortKey.getVal()}" th:value="${taskListSortKey.getCd()}" th:selected="${taskListSortKey.equalsByCode(sortKeyCd)}">
						</option>
					</select>
				</div>
				<!--/* 一覧出力 */-->
				<div>
					<button class="btn btn-light outputTaskList"><i class="fas fa-download text-primary"></i><i class="fas fa-spinner text-primary faa-spin animated hidden"></i>一覧出力</button>
				</div>
			</div>

			<!--/* タスク一覧 */-->
			<div class="vertical_block_body">
				<div class="task_list_data_block" th:if="*{!isExistTask()}">
					<div class="task_type_title">
						<div class="no_data_task">
							<i class="far fa-check-circle"></i> 
							<span th:text="|${listTitle}はありません。|"></span>
						</div>
					</div>
				</div>
				<div class="task_list_data_block taskListDataBlock" th:each="taskData, stat : *{taskListForTaskManagement}" th:classappend="${taskData.taskList.size() > 0 ? '' : 'hidden'}">
					<ul id="taskDataList" class="task_data_list">
						<th:block th:each="task : ${taskData.taskList}">
							<!--/* タスクの1行 */-->
							<li th:replace="::closeTaskListRowFragment(task)(${task})"></li>
						</th:block>
					</ul>
				</div>
			</div>
			<!--/* タスク一覧 end */-->

		</div>
		<!--/* タスク一覧ブロック end */-->

	</form>
</div>

<!--/* 完了したタスクリスト画面 - タスク1行分のHTML */-->
<li th:fragment="closeTaskListRowFragment(task)"
	th:class="|taskListRow taskData${task.taskSeq}|"
	th:classappend="|${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'task_compleat' : '')} ${selectedTaskSeq==task.taskSeq ? 'selected' : ''}|"
	th:data-seq ="${task.taskSeq}" th:data-worker-seq="${task.taskWorkerSeq}">
	
	<input type="hidden" name="newTaskSeq" th:value="${newTaskSeq}">
	<input type="hidden" name="rowTaskSeq" th:value="${task.taskSeq}">
	<!--/* タスク1行 */-->
	<div class="task_row_data">
		
		<!--/* チェックマーク */-->
		<div class="task_row_data_check changeTaskStatus" th:data-seq="${task.taskSeq}" th:data-status="${task.taskStatus}"
			data-boundary="window" data-container="#closeTaskListInputFragment" data-toggle="tooltip"
			th:title="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? '未着手に戻す' : '完了にする')}"
			th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'taskCheckHoverComp' : 'taskCheckHover')}">
			
			<!--/* 未完了 */-->
			<div class="taskStatusPreparing" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'hidden' : ' ')}">
				<i class="far fa-circle"></i>
			</div>
			<!--/* 完了 */-->
			<div class="taskStatusComp task_check__comp" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'noHoverTask' : 'hidden')}" >
				<i class="far fa-check-circle"></i>
			</div>
		</div>
		
		<!--/* タスクの内容 */-->
		<div class="task_contents">
			<!--/* 1行目 */-->
			<div class="task_contents_main">
				<!--/* タイトル */-->
				<div class="task_contents__title taskTitle">
					<i th:classappend="|taskExclamation${task.taskSeq}|" class="fas fa-exclamation-circle text-danger taskExclamation" th:if="${(T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newTaskKakuninFlg)) || (T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newHistoryKakuninFlg))}"></i>
					<span th:text="${task.title}">タスクタイトル</span>
				</div>
				<!--/* サブタスクが有る場合、件数を表示） */-->
				<div class="check_item_count">
					<th:block th:if="${task.checkItemCount != 0}">
						<i class="far fa-check-square mr-1"></i>
						<span th:text="${task.completeCheckItemCount}"></span>/<span th:text="${task.checkItemCount}"></span>
					</th:block>
				</div>
			</div>

			<!--/* 2行目 */-->
			<div class="task_contents_sub">
				<!--/* 期限 */-->
				<div class="task_contents_sub__limit" th:if="${task.limitDtTo}">
					<i class="far fa-calendar-alt"></i>
					<span th:text ="${#temporals.format(task.limitDateForDisplay, 'M月d日')}">1月1日</span>
					<span th:text="| (${#temporals.format(task.limitDateForDisplay, 'E')})|">(月)</span>
					<span th:if="${task.limitTime}" th:text ="| ${#temporals.format(task.limitTime, 'H:mm')}|">0:00</span>
				</div>
				
				<!--/* 今日タスク */-->
				<div class="task_contents_sub__today" th:if="${#temporals.format(task.todayTaskDate, 'yyyy-MM-dd')==#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
					<i class="far fa-clock"></i>
					<span>今日のタスク</span>
				</div>
				
				<!--/* コメント数 */-->
				<div class="task_contents_sub__comment" th:if="${task.commentCount} > 0">
					<i class="far fa-comment"></i>
					<span th:text="${task.commentCount}"></span>
				</div>
				
				<!--/* 案件リンク */-->
				<div class="task_contents_sub__anken" th:if="${task.ankenId}">
					<span class="relation_link">
						<i class="fas fa-hashtag"></i>
						<span th:text="${#strings.isEmpty(task.ankenName)} ? |(案件名未入力) (${task.ankenId.toString()})| : |${task.ankenName} (${task.ankenId.toString()})|"></span>
					</span>
				</div>
				
				<!--/* タスク割り当て */-->
				<div class="task_contents_sub__tanto">
					<th:block th:each="taskTanto, stat : ${task.assignTaskTantoList}">
						<span data-boundary="window" data-container="#closeTaskListInputFragment" data-toggle="tooltip" th:title="${task.getAccountName(taskTanto.workerAccountSeq)}" >
							<i class="fas fa-user-circle" th:style="|color: ${taskTanto.accountColor}|"></i>
						</span>
					</th:block>
				</div>
				<!--/* タスク割り当て end */-->
			</div>
		</div>
		<!--/* タスクの内容 end */-->
		
		<!--/* タスク削除 */-->
		<div class="task_contents__delete listDeleteTask" th:data-seq="${task.taskSeq}">
			<div class="task_list_delete__trash" data-boundary="window" data-container="#closeTaskListInputFragment" data-toggle="tooltip" title="タスク削除">
				<i class="far fa-trash-alt"></i>
			</div>
		</div>
		<!--/* 削除 end  */-->
		
	</div>
	<!--/* タスク1行 end */-->
</li>



<!--/* 案件タスクリスト画面 */-->
<div th:fragment="taskAnkenListInputFragment(taskListInputForm, taskListSearchForm)" id="taskAnkenListInputFragment" class="task_anken_list">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function(){

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement('#taskAnkenListInputFragment');

		<!--/* タスク追加フォームにフォーカス */-->
		$('.addTask').focus();

		<!--/* タスク一覧クリック（タスク詳細画面表示） */-->
		$('#taskAnkenListInputFragment').on("click", ".taskListRow", function() {

			<!--/* 他処理を実行中に、詳細画面が開かないよう制御 */-->
			if (ajaxRunning) {
				return false;
			}

			<!--/* タスク一覧の選択済みを解除 */-->
			$(".taskListRow").removeClass("selected");
			<!--/* 選択済みに変更 */-->
			$(this).addClass("selected");
			<!-- /* 一覧で選択中のタスクSEQセット */ -->
			$('#selectedTaskSeq').val($(this).data("seq"));
			$('#pageForSelectedTaskSeq').val($('#taskPage').val());

			Promise.resolve()
				<!--/* タスク詳細画面表示 */-->
				.then(() => renderTaskDetailInputForm($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, null, false))
				<!--/* タスクメニュー画面更新 新着マークの更新のため。メニューの件数と一覧で表示している件数がずれる場合有  */-->
				.then(() => renderTaskMenu(/*[[${selectedTabClass}]]*/, null))
		});

		<!-- /* タスク【未着手・進行中】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOn(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOff(this);
			}
		}, '.taskCheckHover');

		<!-- /* タスク【完了】チェックhoverアクション */ -->
		$('.task_data_list').on({
			mouseenter: function() {
				viewTaskStatusCheckOff(this);
			},
			mouseleave: function() {
				viewTaskStatusCheckOn(this);
			}
		}, '.taskCheckHoverComp');

		<!--/* タスク一覧からステータス変更 */-->
		$('#taskAnkenListInputFragment').on("click", ".changeTaskStatus", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			changeTaskStatus($('#selectedTaskSeq').val(), /*[[${selectedTabClass}]]*/, null, $(this).data("seq"), $(this).data("status"), $('#taskAnkenSelectedTaskAnkenId').val());
		});

		<!--/* タスク一覧画面のタスク追加フォームでボタン押下 */-->
		$('#taskAnkenListInputFragment').on("keydown", ".addTask", function(e) {

			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault();

			<!--/* 入力値が空は処理終了 */-->
			if ($(this).val().trim() == '') {
				return false;
			}

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const formData = $('#taskAnkenListInputFragment #taskListInputForm').serializeArray();
			addTask(formData, /*[[${selectedTabClass}]]*/, $('#selectedTaskSeq').val(), null, $('#taskAnkenSelectedTaskAnkenId').val());
		});

		<!--/* 並び替えセレクトボックス変更 */-->
		$('#taskAnkenListInputFragment').on("change", ".changeTaskListSortKey", function() {

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			<!--/* タスク一覧ソート 1:設定した順 2:期限日-昇順 3:期限日-降順 */-->
			const sortKeyCd = $(this).val();
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedTaskSeq = $('#selectedTaskSeq').val();
			const selectedTaskAnkenId = $('#taskAnkenSelectedTaskAnkenId').val();

			$.ajax({
				url : '/user/taskManagement/sortTaskAnkenList',
				type : "GET",
				data : {
					"page": 0,
					"selectedTabClass": selectedTabClass,
					"selectedTaskSeq": selectedTaskSeq,
					"sortKeyCd": sortKeyCd,
					"selectedTaskAnkenId": selectedTaskAnkenId
				},
			}).done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					$('#taskListFragmentWrap').html(data);

					<!--/* 詳細画面が開いていたら再表示 */-->
					if (!$('#taskDetailFragmentWrap').hasClass('hidden')) {
						renderTaskDetailInputForm(selectedTaskSeq, selectedTabClass, null, false);
					}
					renderTaskMenu(selectedTabClass, null);
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					let sessionTimeOutKey = /*[[${T(jp.loioz.common.constant.MessageEnum).MSG_E00161.messageKey}]]*/'';
					if (sessionTimeOutKey == errorMsg) {
						window.location.href = '/user/taskManagement/list'
					} else {
						showErrorMessageForJs(errorMsg);
					}
				}
			}).fail(function(jqXHR, textStatus, errorThrown) {
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 一覧出力 */-->
		$('#taskAnkenListInputFragment').on("click", ".outputTaskList", function() {

			<!--/* ダウンロード処理 */-->
			const url = "/user/taskManagement/outputTaskList";
			const button = $(this);
			let formData = {};
			downloadFileAjax(url, button, formData);

			return false;
		});

		<!--/* 未完了タスク、完了タスクの切替 */-->
		$('#taskAnkenListInputFragment .changeCompleteTask').on('change', function(e) {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const dispKeyCd = $(this).val();
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedTaskAnkenId = $('#taskAnkenSelectedTaskAnkenId').val();

			$.ajax({
				url : '/user/taskManagement/changeCompleteTask',
				type : "GET",
				data : {
					"page": 0,
					"selectedTabClass": selectedTabClass,
					"selectedTaskAnkenId": selectedTaskAnkenId,
					"dispKeyCd": dispKeyCd
				},
			}).done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					$('#taskListFragmentWrap').html(data);
					<!--/* タスク詳細を閉じる */-->
					$('#taskDetailFragmentWrap').addClass("hidden");
					<!--/* サイドメニュー更新 */-->
					renderTaskMenu(selectedTabClass, null);
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					let sessionTimeOutKey = /*[[${T(jp.loioz.common.constant.MessageEnum).MSG_E00161.messageKey}]]*/'';
					if (sessionTimeOutKey == errorMsg) {
						window.location.href = '/user/taskManagement/list'
					} else {
						showErrorMessageForJs(errorMsg);
					}
				}
			}).fail(function(jqXHR, textStatus, errorThrown) {
			}).always(function() {
				ajaxRunning = false;
			});
		})

		<!--/* タスク一覧からタスク削除 */-->
		$('#taskAnkenListInputFragment').on("click", ".listDeleteTask", function(e) {

			e.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			
			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedTaskAnkenId = $('#taskAnkenSelectedTaskAnkenId').val();
			<!-- /* ステータスを変更したタスクのli */ -->
			let taskLi = $('.taskData' + taskSeq);

			$.ajax({
				url : "/user/taskManagement/deleteTask",
				type : "POST",
				data : {
					"page" : 0,
					"taskSeq" : taskSeq,
					"selectedTabClass" : selectedTabClass,
					"selectedTaskSeq" : /*[[${selectedTaskSeq}]]*/,
					"selectedAssignSeq" : /*[[${selectedAssignSeq}]]*/
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!-- /* 処理成功 */-->
					<!-- /* 対象のタスクが選択状態の場合は、選択を解除し、詳細を閉じる */ -->
					if (taskLi.hasClass('selected')) {
						taskLi.removeClass('selected');
						<!-- /* 詳細領域は閉じる */ -->
						$('#taskDetailFragmentWrap').addClass("hidden");
						$('#taskDetailFragmentWrap').html('');
					}
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

					Promise.resolve()
						.then(() => deleteTaskRowForAfterDeleteTask(selectedTabClass, taskSeq, selectedTaskAnkenId))
						.then(() => renderTaskMenu(selectedTabClass, selectedTaskAnkenId))
				} else {
					<!-- /* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00014}]]*/ "削除に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});
	});
	</script>

	<!--/* HTML */-->
	<input type="hidden" id="taskPageSize" th:value="${taskListSearchForm.taskAnkenListSearchForm.pageSize.intVal}">
	<input type="hidden" id="taskPage" th:value="${taskListSearchForm.taskAnkenListSearchForm.page}">
	<!--/* ページング時に参照する選択中タスクSEQ */-->
	<input id="selectedTaskSeq" type="hidden" th:value=${selectedTaskSeq}>
	<!--/* 選択中タスクSEQを表示しているページ */-->
	<input id="pageForSelectedTaskSeq" type="hidden" th:value=${pageForSelectedTaskSeq}>
	<!--/* 選択中案件タスクの案件ID */-->
	<input id="taskAnkenSelectedTaskAnkenId" type="hidden" th:value="${taskListSearchForm.taskAnkenListSearchForm.ankenId}">
	<input id="completeTaskDispFlg" type="hidden" th:value="${(T(jp.loioz.common.constant.CommonConstant$TaskAnkenListDispKey).COMPLETED.equalsByCode(taskListSearchForm.taskAnkenListSearchForm.dispKeyCd))}">
	<form id="taskListInputForm" th:object="${taskListInputForm}" autocomplete="off">

		<!--/* タスク一覧ブロック */-->
		<div class="vertical_block_wrapper">

			<!--/* タスクタイトル */-->
			<div id="taskListTitle" class="vertical_block_header flex-wrap align-items-center my-3 pr-3">
				<div class="case_task_header">
					
					<!--/* タイトル */-->
					<div class="case_task_header__name">
						
						<!--/* 案件 */-->
						<div class="img_info_mid">
							<!--/* 案件画像 */-->
							<div class="img_info_mid__image">
								<div th:class="|case_image_wrapper${listAnkenType?.cd}|">
									<!--/* 案件区分 */-->
									<img class="img-thumbnail case_img_mid"
										th:src="@{/img/case_type{typeCd}.svg?{ver}(typeCd=${listAnkenType?.cd}, ver=${@environment.getProperty('app.version')})}">
								</div>
							</div>
							<!--/* 案件画像 end */-->
							
							<!--/* 案件名 */-->
							<div class="img_info_mid__info pt-1">
								<div class="fs28 lh1_2 fw600 mb-2" th:text="${#strings.isEmpty(listTitle)} ? '(案件名未入力)' : ${listTitle}">案件名</div>
								<!--/* 案件ID */-->
								<a th:href="@{/user/ankenDashboard/{ankenId}/(ankenId=${listTitleAnkenId.asLong()})}" class="app_id_link case_link fs12 mr-3"
									th:text="|案件ID：${listTitleAnkenId.asLong()}|"
									data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" title="案件ダッシュボードへ">案件ID</a>
							</div>
							<!--/* 案件名 end */-->
						</div>
						<!--/* 案件 end */-->
					</div>
					<!--/* タイトル end */-->
					
					<div class="case_task_header__button d-flex align-items-center header_actions_container">
						<!--/* ページング */-->
						<div id="taskListPagerFragmentWrap">
							<div th:replace="common/pagerAjax::pagerAjax(page=*{taskListForTaskManagement[0].page}, listFragmentId='taskListTitle')"></div>
						</div>
						<!--/* 完了タスク切替 */-->
						<div class="selected_list_disp_task">
							<select class="form-control digit8 changeCompleteTask" th:with="dispKeyCd=*{taskAnkenListDispKeyCd}">
								<option th:each="taskListDispKey : ${T(jp.loioz.common.constant.CommonConstant$TaskAnkenListDispKey).values()}"
									th:label="${taskListDispKey.getVal()}" th:text="${taskListDispKey.getVal()}" th:value="${taskListDispKey.getCd()}" th:selected="${taskListDispKey.equalsByCode(dispKeyCd)}">
								</option>
							</select>
						</div>
						<!--/* 並び替え */-->
						<div class="selected_list_sort_task">
							<select th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskAnkenListDispKey).INCOMPLETE.equalsByCode(taskListSearchForm.taskAnkenListSearchForm.dispKeyCd))}" class="form-control digit7 changeTaskListSortKey" th:with="sortKeyCd=*{taskListSortKeyCd}">
								<option th:each="taskListSortKey : ${T(jp.loioz.common.constant.CommonConstant$TaskAnkenListSortKey).values()}" 
									th:label="${taskListSortKey.getVal()}" th:text="${taskListSortKey.getVal()}" th:value="${taskListSortKey.getCd()}" th:selected="${taskListSortKey.equalsByCode(sortKeyCd)}">
								</option>
							</select>
							<select th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskAnkenListDispKey).COMPLETED.equalsByCode(taskListSearchForm.taskAnkenListSearchForm.dispKeyCd))}" class="form-control digit7 changeTaskListSortKey" th:with="sortKeyCd=*{taskListSortKeyCd}">
								<option th:each="taskListSortKey : ${T(jp.loioz.common.constant.CommonConstant$CloseTaskListSortKey).values()}" 
									th:label="${taskListSortKey.getVal()}" th:text="${taskListSortKey.getVal()}" th:value="${taskListSortKey.getCd()}" th:selected="${taskListSortKey.equalsByCode(sortKeyCd)}">
								</option>
							</select>
						</div>
						<!--/* 一覧出力 */-->
						<div>
							<button class="btn btn-light outputTaskList"><i class="fas fa-download text-primary"></i><i class="fas fa-spinner text-primary faa-spin animated hidden"></i>一覧出力</button>
						</div>
					</div>
				</div>
			</div>
			
			<!--/* 案件詳細情報 */-->
			<div class="case_task_info hover_scroll">
				
				<!--/* 顧客 */-->
				<div class="case_task_info__customer">
					<span class="badge badge-pill badge_square badge_blue" th:text="${listKeiji} ? '被疑者（顧客）情報' : '顧客情報' "></span>
					<div class="case_task_info_val">
	<th:block th:each="customer : ${listTitleCustomerName}"
			th:with="initShowMaxCharCountMainText=15, isOverCharCount=(${initShowMaxCharCountMainText} < ${#strings.length(customer.customerName)})">
						<div>
							<!--/* 名前 */-->
							<a th:href="@{/user/personManagement/edit/{customerId}/(customerId=${customer.personId})}"
									data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" title="名簿情報へ">
								<th:block th:unless="${isOverCharCount}">
									<span th:text="${customer.customerName}">山田 太郎</span>
								</th:block>
								<th:block th:if="${isOverCharCount}">
									<span myth:nl2br="|${#strings.substring(customer.customerName, 0, initShowMaxCharCountMainText)}…|">山田 太郎</span>
								</th:block>
								<span class="fs12" th:text="|(${customer.getPersonIdDisp()}) [${customer.getAnkenStatusDisp()}]|">(名-123456) [進行中]</span>
							</a>
						</div>
	</th:block>
					</div>
				</div>
				<!--/* 顧客 end */-->
				
	<!--/* 民事 */-->
	<th:block th:unless="${listKeiji}">
				
				<!--/* 相手方 */-->
				<div class="case_task_info__opposing_party">
					<span class="badge badge-pill badge_square badge_green pr-2">相手方情報</span>
					<div class="case_task_info_val">
	<!--/* 相手方がいない場合 */-->
	<th:block th:if="${listOpposingParty.size() == 0}">
						相手方はいません。
	</th:block>
	
	<!--/* 相手方がいる場合 */-->
	<th:block th:each="opposingParty : ${listOpposingParty}">
						<div>
							<i class="fas fa-user fs12"></i>
							<!--/* 相手名 */-->
							<span th:text="${opposingParty.kanyoshaName}"></span>
							<!--/* 相手名代理人 */-->
							<span class="fs13" th:text="${!#strings.isEmpty(opposingParty.lawyerName)} ?  |(${opposingParty.lawyerName})| "></span>
						</div>
	</th:block>
						
					</div>
				</div>
				<!--/* 相手方 end */-->
				
	</th:block>
	<!--/* 民事 end */-->
	
	<!--/* 刑事 */-->
	<th:block th:if="${listKeiji}">
							
				<!--/* 共犯者 */-->
				<div class="case_task_info__accomplice">
					<span class="badge badge-pill badge_square badge_green pr-2">共犯者情報</span>
					<div class="case_task_info_val">
	<!--/* 共犯者がいない場合 */-->
	<th:block th:if="${listAccomplice.size() == 0}">
						共犯者はいません。
	</th:block>
	
	<!--/* 共犯者がいる場合 */-->
	<th:block th:each="accomplice : ${listAccomplice}">
						<div>
							<i class="fas fa-user fs12"></i>
							<!--/* 共犯者名 */-->
							<span th:text="${accomplice.kanyoshaName}"></span>
							<!--/* 共犯者弁護士人 */-->
							<span class="fs13" th:text="${!#strings.isEmpty(accomplice.lawyerName)} ?  |(${accomplice.lawyerName})| "></span>
						</div>
	</th:block>
						
					</div>
				</div>
				<!--/* 共犯者 end */-->
				
				<!--/* 被害者 */-->
				<div class="case_task_info__victim">
					<span class="badge badge-pill badge_square badge_green pr-2">被害者情報</span>
					<div class="case_task_info_val">
	<!--/* 被害者がいない場合 */-->
	<th:block th:if="${listVictim.size() == 0}">
						被害者はいません。
	</th:block>
	
	<!--/* 被害者がいる場合 */-->
	<th:block th:each="victim : ${listVictim}">
						<div>
							<i class="fas fa-user fs12"></i>
							<!--/* 被害者 */-->
							<span th:text="${victim.kanyoshaName}"></span>
							<!--/* 被害者代理人 */-->
							<span class="fs13" th:text="${!#strings.isEmpty(victim.lawyerName)} ?  |(${victim.lawyerName})| "></span>
						</div>
	</th:block>
						
					</div>
				</div>
				<!--/* 被害者 end */-->
				
	</th:block>
	<!--/* 刑事 end */-->
			
			</div>

			<!--/* タスク一覧 */-->
			<div class="vertical_block_body">
				<div class="task_list_data_block" th:if="*{!isExistTask()}">
					<div class="task_type_title">
						<div class="no_data_task">
							<i class="far fa-file-alt"></i>
							<span th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskAnkenListDispKey).INCOMPLETE.equalsByCode(taskListSearchForm.taskAnkenListSearchForm.dispKeyCd))}">案件のタスクがありません。</span>
							<span th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskAnkenListDispKey).COMPLETED.equalsByCode(taskListSearchForm.taskAnkenListSearchForm.dispKeyCd))}">案件の完了タスクがありません。</span>
						</div>
					</div>
				</div>
				<div class="task_list_data_block taskListDataBlock" th:each="taskData, stat : *{taskListForTaskManagement}" th:classappend="${taskData.taskList.size() > 0 ? '' : 'hidden'}">
					<div class="collapse" th:id="|collapseTaskType${stat.index}|" 
						th:classappend="|${(!T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskData.taskStatusCd) && !T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.getVal().equals(taskData.taskTypeTitle) ? 'show' : '')}|">
						<ul id="taskDataList" class="task_data_list">
							<th:block th:each="task : ${taskData.taskList}">
								<!--/* タスクの1行 */-->
								<li th:replace="::taskAnkenListRowFragment(task)(${task})"></li>
							</th:block>
						</ul>
					</div>
				</div>
			</div>
			<!--/* タスク一覧 end */-->

			<!--/* タスク追加 */-->
			<div class="vertical_block_footer">
				<div th:unless="${(T(jp.loioz.common.constant.CommonConstant$TaskAnkenListDispKey).COMPLETED.equalsByCode(taskListSearchForm.taskAnkenListSearchForm.dispKeyCd))}" class="add_task_block">
					<input type="text" class="form-control add_task_text addTask" placeholder="＋タスクを追加" th:field="*{taskTitle}" maxlength="255">
					<div th:if="*{#fields.hasErrors('taskTitle')}" th:errors="*{taskTitle}" class="error_mag_point">error</div>
				</div>
			</div>
			<!--/* タスク追加 end */-->

		</div>
		<!--/* タスク一覧ブロック end */-->

	</form>
</div>

<!--/* 案件タスクリスト画面 - タスク1行分のHTML */-->
<li th:fragment="taskAnkenListRowFragment(task)"
	th:class="|taskListRow taskData${task.taskSeq}|"
	th:classappend="|${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'task_compleat' : '')} ${selectedTaskSeq==task.taskSeq ? 'selected' : ''}|"
	th:data-seq ="${task.taskSeq}" th:data-worker-seq="${task.taskWorkerSeq}">
	
	<input type="hidden" name="newTaskSeq" th:value="${newTaskSeq}">
	<input type="hidden" name="rowTaskSeq" th:value="${task.taskSeq}">
	<!--/* タスク1行 */-->
	<div class="task_row_data">
		
		<!--/* チェックマーク */-->
		<div class="task_row_data_check stop-events changeTaskStatus" th:data-seq="${task.taskSeq}" th:data-status="${task.taskStatus}"
			data-boundary="window" data-container="#taskAnkenListInputFragment" data-toggle="tooltip"
			th:title="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? '未着手に戻す' : '完了にする')}"
			th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'taskCheckHoverComp' : 'taskCheckHover')}">
			
			<!--/* 未完了 */-->
			<div class="taskStatusPreparing" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'hidden' : ' ')}">
				<i class="far fa-circle"></i>
			</div>
			<!--/* 完了 */-->
			<div class="taskStatusComp task_check__comp" th:classappend="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(task.taskStatus) ? 'noHoverTask' : 'hidden')}" >
				<i class="far fa-check-circle"></i>
			</div>
		</div>
		
		<!--/* タスクの内容 */-->
		<div class="task_contents">
			<!--/* 1行目 */-->
			<div class="task_contents_main">
				<!--/* タイトル */-->
				<div class="task_contents__title taskTitle">
					<i th:classappend="|taskExclamation${task.taskSeq}|" class="fas fa-exclamation-circle text-danger taskExclamation" th:if="${(T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newTaskKakuninFlg)) || (T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_OFF.equalsByCode(task.newHistoryKakuninFlg))}"></i>
					<span th:text="${task.title}">タスクタイトル</span>
				</div>
				
				<!--/* サブタスクが有る場合、件数を表示） */-->
				<div class="check_item_count">
					<th:block th:if="${task.checkItemCount != 0}">
						<i class="far fa-check-square mr-1"></i>
						<span th:text="${task.completeCheckItemCount}"></span>/<span th:text="${task.checkItemCount}"></span>
					</th:block>
				</div>
				
				<!--/* ステータス（進行中のみ） */-->
				<div class="task_list_staus taskListStaus">
					<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskStatus).WORKING.equalsByCode(task.taskStatus))}">
						<span>進行中</span>
					</th:block>
				</div>
				<!--/* ステータス（進行中のみ）end  */-->
			</div>
			<!--/* 1行目 end */-->
			
			<!--/* 2行目 */-->
			<div class="task_contents_sub">
				<!--/* 期限 */-->
				<div class="task_contents_sub__limit" th:if="${task.limitDtTo}" th:classappend="${task.limitDateStyle}">
					<i class="far fa-calendar-alt"></i>
					<span th:text ="${#temporals.format(task.limitDateForDisplay, 'M月d日')}">1月1日</span>
					<span th:text="| (${#temporals.format(task.limitDateForDisplay, 'E')})|">(月)</span>
					<span th:if="${task.limitTime}" th:text ="| ${#temporals.format(task.limitTime, 'H:mm')}|">0:00</span>
				</div>
				
				<!--/* コメント数 */-->
				<div class="task_contents_sub__comment" th:if="${task.commentCount} > 0">
					<i class="far fa-comment"></i>
					<span th:text="${task.commentCount}"></span>
				</div>
				
				<!--/* タスク割り当て */-->
				<div class="task_contents_sub__tanto">
					<th:block th:each="taskTanto, stat : ${task.assignTaskTantoList}">
						<span data-boundary="window" data-container="#taskAnkenListInputFragment" data-toggle="tooltip" th:title="${task.getAccountName(taskTanto.workerAccountSeq)}" >
							<i class="fas fa-user-circle" th:style="|color: ${taskTanto.accountColor}|"></i>
						</span>
					</th:block>
				</div>
				<!--/* タスク割り当て end */-->
				
			</div>
		</div>
		<!--/* タスクの内容 end */-->
		
		<!--/* タスク削除 */-->
		<div th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskAnkenListDispKey).COMPLETED.equalsByCode(taskListSearchForm.taskAnkenListSearchForm.dispKeyCd))}" class="task_contents__delete listDeleteTask" th:data-seq="${task.taskSeq}">
			<div class="task_list_delete__trash" data-boundary="window" data-container="#taskAnkenListInputFragment" data-toggle="tooltip" title="タスク削除">
				<i class="far fa-trash-alt"></i>
			</div>
		</div>
		<!--/* 削除 end  */-->
		
	</div>
	<!--/* タスク1行 end */-->
</li>



<!--/* タスク詳細画面 */-->
<div th:fragment="taskDetailInputFragment" id="taskDetailInputFragment">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function(){

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		<!--/* サブタスク追加リンクの表示／非表示制御 */-->
		function refreshCheckItemAddLinkShowHidden() {

			let checkItemAddLimit = /*[[${T(jp.loioz.common.constant.CommonConstant).TASK_CHECK_ITEM_ADD_LIMIT}]]*/ ''

			<!--/* サブタスクの表示件数 */-->
			let checkItemInputFormCount = $('#taskDetailInputFragment #taskCheckList li').length;

			<!--/* サブタスクが上限数より小さい場合は追加リンクを表示する */-->
			if (checkItemInputFormCount < checkItemAddLimit) {
				$('#taskDetailInputFragment .addCheckList').removeClass('hidden');
			} else {
				$('#taskDetailInputFragment .addCheckList').addClass('hidden');
			}
		}

		<!--/* サブタスクが上限数以上かチェックする（上限数以上ならtrue） */-->
		function validCheckItemCountOver() {

			let checkItemAddLimit = /*[[${T(jp.loioz.common.constant.CommonConstant).TASK_CHECK_ITEM_ADD_LIMIT}]]*/ ''

			<!--/* サブタスクの表示件数 */-->
			let checkItemInputFormCount = $('#taskDetailInputFragment #taskCheckList li').length;

			<!--/* サブタスクが上限数以上場合はtrueを返す */-->
			if (checkItemAddLimit <= checkItemInputFormCount) {
				return true;
			}
			return false;
		}
		
		<!--/* 選択アカウントの表示非表示設定を最新化 */-->
		function hiddenIfSelect() {
			$('#taskDetailInputFragment').find(".selectArea button").removeClass("hidden");
			const seletedAccount = getSelectedAccountSeq();
			const workerButton = $('#taskDetailInputFragment').find(".selectArea a").filter((idx, elem) => {
				return seletedAccount.includes($(elem).data("workerAccountSeq"));
			});
			workerButton.addClass("workerSelected");
			workerButton.find(".workerCheckSquare").removeClass("hidden");
			workerButton.find(".workerSquare").addClass("hidden");
		};

		<!--/* 選択中のアカウントSEQをArray型で取得 */-->
		function getSelectedAccountSeq() {
			return $.map($('#taskDetailInputFragment').find("input[name*='workerAccountSeq']"), (elem, idx) => {
				if (elem.value) {
					return Number(elem.value);
				}
			});
		};

		<!--/* removeした際にパラメータの中抜けが発生するため、パラメータを詰める */-->
		function sortParam() {
			const paramContents = $('#taskDetailInputFragment').find(".taskTanto");
			const paramJson = $.map(paramContents, (elem, ids) => {
				if($(elem).find("input[name*='workerAccountSeq']").val()) {
					return {
						"seq": $(elem).find("input[name*='workerAccountSeq']").val(),
						"name":$(elem).find(".accountName").text(),
					};
				} 
			});

			paramContents.addClass("hidden");
			paramContents.each((idx, elem) => {
				const params = paramJson[idx];
				if (params) {
					$(elem).find("input[name*='workerAccountSeq']").val(params.seq);
					$(elem).find(".accountName").text(params.name);
					$(elem).removeClass("hidden");

				} else {
					$(elem).find("input[name*='workerAccountSeq']").val("");
					$(elem).find(".accountName").text("");
				}
			});
		}

		<!--/* タスク詳細画面タイトル表示用divを非表示にし、入力フォームを表示する */-->
		function showDetailTitleInput() {
 			$('.detailTitleView').addClass("hidden");
 			$('.detailTitleInput').removeClass("hidden");
		}

		<!--/* タスクタイトル変更処理 */-->
		function changeTaskTitle(formData, taskSeq, selectedTabClass, selectedAssignSeq) {

			formData.push({name: "page", value: 0});
			formData.push({name: "selectedTabClass", value: selectedTabClass});
			formData.push({name: "selectedTaskSeq", value: taskSeq});
			formData.push({name: "selectedAssignSeq", value: selectedAssignSeq});

			$.ajax({
				url : "/user/taskManagement/changeTaskTitle",
				type : "POST",
				data : formData,
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					
					<!--/* 更新された行データを更新 */-->
					replaceTaskRow(selectedTabClass, taskSeq, data);
					renderTaskDetailInputForm(taskSeq, selectedTabClass, selectedAssignSeq, false);

					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

				} else {
					if (data) {
						<!--/* ajaxProcがFailureだがHTMLが帰って来た場合は、validationエラー */-->
						$('#taskDetailFragmentWrap').html(data);
						showDetailTitleInput();
						<!--/* 詳細文のHTMLタグを有効にする */-->
						enableHtmlForDetailContent();
						<!--/* コメントのHTMLタグを有効にする */-->
						enableHtmlForComment();
					}
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});	
		}

		<!--/* タスク詳細画面タイトル入力フォームを非表示にし、ラベルを表示する */-->
		function showDetailTitleLabel() {
			$('.detailTitleView').removeClass("hidden");
			$('.detailTitleInput').addClass("hidden");
		}

		<!--/* 
		期限を変更する
		・期限付きタスク
			期限を削除したり過去日にした場合は一覧から削除。選択状態を解除。変更したタスクを詳細画面で表示したまま。
			期限を「過去日、未来日、未設定」から未来日に変更した場合は一覧のタスク行を対象アコーディオンへ移動。選択中にし詳細画面で表示する。
		・期限を過ぎたタスク
			期限を削除したり未来日にした場合は一覧から削除。選択状態を解除。変更したタスクを詳細画面で表示したまま。
			期限を過去日から過去日に変更した場合は一覧と詳細画面へ反映する。
			期限を「未来日、未設定」から過去日に変更した場合は1ページ目の先頭に追加。選択状態にし詳細画面で表示する。
		・上記以外の画面
			選択中のタスクの変更内容を一覧と詳細画面へ反映する。
		*/-->
		function changeLimitDate(taskSeq, selectedTabClass, selectedAssignSeq) {

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			
			const formData = $('#taskDetailInputFragment #taskDetailInputForm').serializeArray();
			formData.push({name: "page", value: 0});
			formData.push({name: "selectedTabClass", value: selectedTabClass});
			formData.push({name: "selectedTaskSeq", value: taskSeq});
			formData.push({name: "selectedAssignSeq", value: selectedAssignSeq});
			
			let limitDate = $('#taskDetailInputFragment #taskDetailInputForm .inputTaskLimitDate').val();
			const beforeLimitDate = $('.inputTaskLimitDate').data("limitDate");
			
			$.ajax({
				url : "/user/taskManagement/changeLimitDate",
				type : "POST",
				data : formData,
			}).done(function(data, status, jqXHR) {
				
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					replaceTaskRowForChangeLimitDate(selectedTabClass, taskSeq, data, limitDate, beforeLimitDate);
					renderTaskDetailInputForm(taskSeq, selectedTabClass, selectedAssignSeq, false);
					renderTaskMenu(selectedTabClass, null);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					if (data) {
						<!--/* ajaxProcがFailureだがHTMLが帰って来た場合は、validationエラー */-->
						$('#taskDetailFragmentWrap').html(data);
						<!--/* 詳細文のHTMLタグを有効にする */-->
						enableHtmlForDetailContent();
						<!--/* コメントのHTMLタグを有効にする */-->
						enableHtmlForComment();
					}
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		}

		<!--/* 期限を削除する */-->
		function deleteLimitDate(taskSeq, selectedTabClass, selectedAssignSeq) {

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const pageForSelectedTaskSeq = $('#pageForSelectedTaskSeq').val();

			$.ajax({
				url : "/user/taskManagement/deleteLimitDtTo",
				type : "POST",
				data : {
					"page" : 0,
					"taskSeq" : taskSeq,
					"selectedTabClass" : selectedTabClass,
					"selectedAssignSeq" : selectedAssignSeq,
					"pageForSelectedTaskSeq" : pageForSelectedTaskSeq
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					$('#taskListFragmentWrap').html(data);
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

					Promise.resolve()
						.then(() => renderTaskDetailInputForm(taskSeq, selectedTabClass, selectedAssignSeq, false))
						.then(() => renderTaskMenu(selectedTabClass, null))
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		}

		<!--/* 案件設定の候補案件を検索 */-->
		function searchAnkenList(searchWord) {
			
			if($(".ankenList").val().trim() === '') {
				$('#taskAnkenDataListFragmentWrap').html('');
				return;
			}

			$.ajax({
				url : "/user/taskManagement/searchAnkenList",
				type : "GET",
				data : {
					"page" : 0,
					"searchWord" : searchWord
				},
				}).done(function(data, status, jqXHR) {
	
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					$('#taskAnkenDataListFragmentWrap').html(data);
	
				} else {
					if (data) {
						<!--/* ajaxProcがFailureだがHTMLが帰って来た場合は、validationエラー */-->
						$('#taskDetailFragmentWrap').html(data);
						<!--/* 詳細文のHTMLタグを有効にする */-->
						enableHtmlForDetailContent();
						<!--/* コメントのHTMLタグを有効にする */-->
						enableHtmlForComment();
					}
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					let sessionTimeOutKey = /*[[${T(jp.loioz.common.constant.MessageEnum).MSG_E00161.messageKey}]]*/'';
					if (sessionTimeOutKey == errorMsg) {
						window.location.href = '/user/taskManagement/list'
					} else {
						showErrorMessageForJs(errorMsg);
					}
				}
			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			});
		}

		<!--/* タイトルをクリック */-->
		$('#taskDetailInputFragment').on("click", ".detailTitleView", function(){
			showDetailTitleInput();
			<!-- /* クリック時に入力フォームの値を戻しフォーカスをあてる */-->
			const title = $(this).data("title");
			$('.taskTitleInput').val(title);
			$('.taskTitleInput').focus();
		});

		<!--/* タイトルからフォーカスアウト */-->
		$('#taskDetailInputFragment .taskTitleInput').blur(function(){
			<!--/* 保存処理のclickよりfocusoutイベントが先に実行されるため遅延させる */-->
			setTimeout(function(){
				if (ajaxRunning) {
					return false;
				}
				showDetailTitleLabel();
			},160);
		});

		<!--/* タスクタイトルフォームでボタン押下 */-->
		$('#taskDetailInputFragment').on("keydown", ".taskTitleInput", function(e) {

			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault(); 

			<!--/* 入力値が空は処理終了 */-->
			if ($(this).val() == '') {
				return false;
			}


			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const taskSeq = $(this).data("seq");
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;
			const formData = $('#taskDetailInputFragment #taskDetailInputForm').serializeArray();
			changeTaskTitle(formData, taskSeq, selectedTabClass, selectedAssignSeq);
		});

		<!--/* タイトル保存ボタンをクリック */-->
		$('#taskDetailInputFragment .changeTaskTitle').mousedown(function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;
			const formData = $('#taskDetailInputFragment #taskDetailInputForm').serializeArray();
			changeTaskTitle(formData, taskSeq, selectedTabClass, selectedAssignSeq);
		});

		<!--/* 削除ボタン押下 */-->
		$('#taskDetailInputFragment').on("click", ".deleteTask", function() {

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			if (!confirm('タスクを削除します。よろしいですか?')) {
				ajaxRunning = false;
				return false;
			}

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const selectedTabClass = /*[[${selectedTabClass}]]*/;

			$.ajax({
				url : "/user/taskManagement/deleteTask",
				type : "POST",
				data : {
					"page" : 0,
					"taskSeq" : taskSeq,
					"selectedTabClass" : selectedTabClass,
					"selectedTaskSeq" : /*[[${selectedTaskSeq}]]*/,
					"selectedAssignSeq" : /*[[${selectedAssignSeq}]]*/
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!-- /* 処理成功 */-->

					<!--/* タスク詳細を閉じる */-->
					$('#taskDetailFragmentWrap').addClass("hidden");
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

					Promise.resolve()
						.then(() => deleteTaskRowForAfterDeleteTask(selectedTabClass, taskSeq, $('#taskDetailAnkenId').val()))
						.then(() => renderTaskMenu(selectedTabClass, null))
				} else {
					<!-- /* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00014}]]*/ "削除に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!-- /* 詳細画面を閉じる処理 */ -->
		$('#taskDetailInputFragment').on("click", ".taskDetailClose", function(){
			$('#taskDetailFragmentWrap').addClass("hidden");
		});

		<!--/* ステータスのセレクトボックス変更 */-->
		$('#taskDetailInputFragment').on("change", ".changeTaskStatus", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const taskSeq = $(this).data("seq");
			const taskStatusCd = $(this).val();
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;
			const selectedTaskAnkenId = /*[[${selectedTaskAnkenId}]]*/;
			Promise.resolve()
				.then(() => setNextTaskSeqTaskDetailInputForm(taskSeq))
				.then(() => changeStatus(taskSeq, taskStatusCd, selectedTabClass, selectedAssignSeq, selectedTaskAnkenId))
				.finally(() => ajaxRunning = false);
		});

		<!--/* 
		ステータス変更処理
		・（ページング無）期限付きタスク、割り当てられたタスク、割り当てたタスク
			選択中のタスクを完了にしたら、一覧画面から削除。次のタスクを選択状態で詳細画面を表示。
			次のタスクが無い場合、アコーディオン単位の先頭タスクを選択状態にする。選択できるタスクが無い場合は詳細画面を閉じる。
		・（ページング有）今日のタスク、すべてのタスク、期限を過ぎたタスク
			選択中のタスクを完了にしたら、一覧画面から削除。次タスクを選択状態で詳細画面を表示（選択しているタスクのページを表示しているいないに関わらず）。
			次タスクが無い場合、選択しているタスクのページを表示であれば当ページの先頭タスクを選択状態にする。選択タスクとは違うページを表示であれば1ページ目の先頭タスクを選択状態にする。選択できるタスクが無い場合は詳細画面を閉じる。
		・（ページング有）完了したタスク：
			選択中のタスクを未着手・進行中にしたら、一覧画面から削除。次タスクを選択状態で詳細画面を表示（選択しているタスクのページを表示しているいないに関わらず）。
			次タスクが無い場合、選択しているタスクのページを表示であれば当ページの先頭タスクを選択状態にする。選択タスクとは違うページを表示であれば1ページ目の先頭タスクを選択状態にする。選択できるタスクが無い場合は詳細画面を閉じる。
		・（ページング有）検索結果：
			ステータス変更しても選択中のまま画面上に残す。
		*/-->
		function changeStatus(taskSeq, taskStatusCd, selectedTabClass, selectedAssignSeq, selectedTaskAnkenId){
			return new Promise((resolve, reject) => {

				$.ajax({
					url : "/user/taskManagement/changeStatus",
					type : "POST",
					data : {
						"page" : 0,
						"taskSeq" : taskSeq,
						"taskStatus" : taskStatusCd,
						"selectedTabClass" : selectedTabClass,
						"selectedTaskSeq" : taskSeq,
						"selectedAssignSeq" : selectedAssignSeq,
						"isChangeStatusInDetail" : true
					},
				}).done(function(data, status, jqXHR) {

					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* 処理成功 */-->
						changeTaskStatusForDetail(selectedTabClass, selectedAssignSeq, taskSeq, taskStatusCd, data, $('#taskDetailAnkenId').val(), selectedTaskAnkenId);
						renderTaskMenu(selectedTabClass, selectedTaskAnkenId);
						
						const msg = getAjaxProcResutlMessage(jqXHR);
						showInfoMessageForJs(msg);

					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
					return resolve();
				}).fail(function() {
					showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
					return reject();
				}).always(function() {
				});

			});
		}

		<!--/* 詳細（テキストエリア）内容一時保存 */-->
		let tempTaskContent = "";
		let tempTaskContentEditLinkClick;

		<!--/* 詳細をクリック */-->
		$('#taskDetailInputFragment').on("click", ".taskDetailContentEditLink", function(){
			<!--/* 詳細内容を非表示 */-->
			$(".taskDetailContentEditLink").addClass("hidden");
			<!--/* 詳細入力を表示 */-->
			$(".taskDetailContent").removeClass("hidden");
			$(".taskDetailContent > textarea").focus();
			<!--/* 保存ボタンを表示 */-->
			$("#taskContentSaveButton").removeClass("hidden");
			<!--/* 閉じるボタンを表示 */-->
			$("#taskContentCloseButton").removeClass("hidden");
			
			tempTaskContentEditLinkClick = true;
		});

		<!--/* 詳細をクリック */-->
		$('#taskDetailInputFragment').on("click", ".taskDetailContentView", function(){
			<!--/* 詳細内容をマウスで選択コピー可能とする */-->
			let selObj = window.getSelection();
			if (selObj.toString().length) {
				return false;
			}
			<!--/* 詳細内容を非表示 */-->
			$('.shortContentWrap').addClass("hidden");
			$('.allContentWrap').addClass("hidden");
			<!--/* 詳細入力を表示 */-->
			$(".taskDetailContent").removeClass("hidden");
			<!--/* 詳細入力欄の大きさを入力内容に合わせて変更 */-->
			const textArea = $('.taskDetailContent');
			const rawTarget = textArea.get(0);
			let lineHeight = Number(textArea.attr("rows"));
			while (rawTarget.scrollHeight > rawTarget.offsetHeight){
				lineHeight++;
				textArea.attr("rows", lineHeight);
			}
			$(".taskDetailContent").focus();
			<!--/* 保存ボタンを表示 */-->
			$("#taskContentSaveButton").removeClass("hidden");
			<!--/* 閉じるボタンを表示 */-->
			$("#taskContentCloseButton").removeClass("hidden");
			<!--/* フォーカスアウト時に内容を編集前に戻すため */-->
			tempTaskContent = $('.taskDetailContent').val();
		});

		<!--/* 詳細の中のURLをクリック */-->
		$('#taskDetailInputFragment').on("click", ".taskDetailContentLink", function(e){
			<!--/* リンクのURLを別タブで開く際、inputフォームに切り替わるのを防ぐ  */-->
			e.stopPropagation();
		});

		<!--/* 詳細閉じるボタン */-->
		$('#taskDetailInputFragment').on("click", ".closeContent", function(){

			<!--/* 保存ボタン実行時は非表示にしない */-->
			if (ajaxRunning) {
				return false;
			}

			if (tempTaskContentEditLinkClick) {
				<!--/* 詳細内容を非表示 */-->
				$(".taskDetailContentEditLink").removeClass("hidden");
			} else {
				if ($(".shortContentWrap").length && !isShowAllContent) {
					$(".shortContentWrap").removeClass("hidden");
				} else {
					$(".allContentWrap").removeClass("hidden");
				}
			}
			<!--/* フォーカスアウト時は、内容を元に戻す */-->
			$('.taskDetailContent').val(tempTaskContent);
			$(".taskDetailContent").addClass("hidden");
			$("#taskContentSaveButton").addClass("hidden");
			$("#taskContentCloseButton").addClass("hidden");
			tempTaskContent = '';
		});

		<!--/* 詳細の保存ボタンをクリック */-->
		$('#taskDetailInputFragment').on("click", ".saveContent", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const formData = $('#taskDetailInputFragment #taskDetailInputForm').serializeArray();
			formData.push({name: "page", value: 0});
			formData.push({name: "selectedTabClass", value: /*[[${selectedTabClass}]]*/});
			formData.push({name: "selectedAssignSeq", value: /*[[${selectedAssignSeq}]]*/});

			$.ajax({
				url : "/user/taskManagement/saveContent",
				type : "POST",
				data : formData,
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					renderTaskDetailInputForm(taskSeq, /*[[${selectedTabClass}]]*/, /*[[${selectedAssignSeq}]]*/, false);
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
				} else {
					if (data) {
						<!--/* ajaxProcがFailureだがHTMLが帰って来た場合は、validationエラー */-->
						$('#taskDetailFragmentWrap').html(data);
						<!--/* 詳細文のHTMLタグを有効にする */-->
						enableHtmlForDetailContent();
						<!--/* コメントのHTMLタグを有効にする */-->
						enableHtmlForComment();
					}
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 期限にホバーした場合*/-->
		$('#taskDetailInputFragment .taskLimitDate').hover(
				function() {
					<!--/* マウスカーソルが重なった時の処理 */-->
					const beforeLimitDate = $(this).data("limitDate");
					if (beforeLimitDate !== undefined) {
						<!--/* 削除ボタンを表示 */-->
						$('#taskLimitDateDeleteButton').removeClass('hidden');
					}
				},
				function() {
					<!--/* マウスカーソルが離れた時の処理 */-->
					<!--/* 削除ボタンを非表示 */-->
					$('#taskLimitDateDeleteButton').addClass('hidden');
				}
		);

		<!--/* 期限の変更処理 */-->
		$('#taskDetailInputFragment').on("change", ".inputTaskLimitDate", function(){

			<!--/* 期限が空の場合は更新処理をしない（別途削除処理のほうで実行） */-->
			if ($(this).val() === '') {
				return false;
			}

			$('[data-toggle="tooltip"]').tooltip('hide');
			changeLimitDate($(this).data("seq"), /*[[${selectedTabClass}]]*/, /*[[${selectedAssignSeq}]]*/);
		});

		<!--/* 期限削除ボタンをクリック */-->
		$('#taskDetailInputFragment').on("click", ".deleteLimitDtTo", function(){
			$('[data-toggle="tooltip"]').tooltip('hide');
			if (confirm('期限を削除します。よろしいですか?')) {
				deleteLimitDate($(this).data("seq"), /*[[${selectedTabClass}]]*/, /*[[${selectedAssignSeq}]]*/);
			} else {
				<!--/* カレンダーを非表示 */-->
				$('.inputTaskLimitDate').datepicker("hide");
			}
		});

		<!--/* 期限入力フォームで手入力した場合 */-->
		$('#taskDetailInputForm .inputTaskLimitDate').on('keyup', function(e){

			const beforeLimitDate = $(this).data("limitDate");
			<!--/* 期限入力フォームを空にし、元々期限が設定してあれば削除処理を実行する */-->
			if ($(this).val() === '' && beforeLimitDate !== undefined && e.keyCode == 13) {

				$('[data-toggle="tooltip"]').tooltip('hide');
				if (confirm('期限を削除します。よろしいですか?')) {
					deleteLimitDate($(this).data("seq"), /*[[${selectedTabClass}]]*/, /*[[${selectedAssignSeq}]]*/);
				} else {
					<!--/* 元の日付を再セット */-->
					$('.inputTaskLimitDate').val($('.inputTaskLimitDate').data("limitDate"));
					<!--/* カレンダーを非表示 */-->
					$('.inputTaskLimitDate').datepicker("hide");
					$('.inputTaskLimitDate').blur();
				}
			} else if (e.keyCode == 13) {

				<!--/* Enterキーのみは期限を変更する */-->
				e.preventDefault();
				$('[data-toggle="tooltip"]').tooltip('hide');
				<!--/* 削除ボタンを非表示 */-->
				$('#taskLimitDateDeleteButton').addClass('hidden');
				<!--/* カレンダーを非表示 */-->
				$(this).datepicker("hide");
				changeLimitDate($(this).data("seq"), /*[[${selectedTabClass}]]*/, /*[[${selectedAssignSeq}]]*/);
			}
		});

		<!--/* 期限からフォーカスアウト */-->
		$('#taskDetailInputFragment .inputTaskLimitDate').blur(function(){
			if (ajaxRunning) {
				return false;
			}
			if ($(this).val() === "") {
				<!--/* 元の日付を再セット */-->
				$('.inputTaskLimitDate').val($('.inputTaskLimitDate').data("limitDate"));
			}
		});

		<!--/* タスクに設定してある案件を外す */-->
		$('#taskDetailInputFragment').on("click", ".deleteAnken", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			if (!confirm('案件紐付けを解除します。よろしいですか?')) {
				<!--/* 案件設定入力inputからフォーカスが外れると、案件設定の表示が入力用から表示用に変わってしまうため制御する */-->
				setTimeout(function(){
					ajaxRunning = false;
				},160);
				return false;
			}

			const taskSeq = $(this).data("seq");
			const selectedTaskAnkenId = /*[[${selectedTaskAnkenId}]]*/;

			$.ajax({
				url : "/user/taskManagement/deleteTaskAnken",
				type : "POST",
				data : {
					"page" : 0,
					"taskSeq" : taskSeq,
					"selectedTabClass" : /*[[${selectedTabClass}]]*/,
					"selectedAssignSeq" : /*[[${selectedAssignSeq}]]*/
					},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					replaceTaskRowForDeleteTaskAnken(/*[[${selectedTabClass}]]*/, taskSeq, data, selectedTaskAnkenId);
					Promise.resolve()
						.then(() => renderTaskDetailInputForm(taskSeq, /*[[${selectedTabClass}]]*/, /*[[${selectedAssignSeq}]]*/, false))
						.then(() => renderTaskMenu(/*[[${selectedTabClass}]]*/, null))

					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

				} else {
					if (data) {
						<!--/* ajaxProcがFailureだがHTMLが帰って来た場合は、validationエラー */-->
						$('#taskDetailFragmentWrap').html(data);
						<!--/* 詳細文のHTMLタグを有効にする */-->
						enableHtmlForDetailContent();
						<!--/* コメントのHTMLタグを有効にする */-->
						enableHtmlForComment();
					}
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00014}]]*/ "削除に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 
		今日のタスクボタン押下（今日のタスクに追加）
		・今日のタスク画面以外
			変更内容を一覧画面と詳細画面へ反映。
		・今日のタスク画面
			1ページ目の先頭に変更したタスクの行を追加。選択状態にし詳細画面を開く。
		*/-->
		$('#taskDetailInputForm').on("click", ".doTaskToday", function() {

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const taskSeq = $(this).data("seq");
			const selectedTaskWorkerSeq = $(this).data("workerSeq");
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;

			$.ajax({
				url : "/user/taskManagement/doTaskToday",
				type : "POST",
				data : {
					"page" : 0,
					"taskSeq" : taskSeq,
					"selectedTaskWorkerSeq" : selectedTaskWorkerSeq,
					"selectedTabClass" : selectedTabClass,
					"selectedAssignSeq" : selectedAssignSeq
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

					Promise.resolve()
						.then(() => addOrDeleteTaskRowForAfterChangeTodayTask(selectedTabClass, taskSeq, selectedAssignSeq, data, true))
						.then(() => renderTaskDetailInputForm(taskSeq, selectedTabClass, selectedAssignSeq, false))
						.then(() => renderTaskMenu(selectedTabClass, null))
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				setTimeout(function(){
					ajaxRunning = false;
				}, 400);
			});
		});

		<!--/* 
		今日のタスク追加ボタン押下（今日のタスクから外す
		・今日のタスク画面以外
			変更内容を一覧画面と詳細画面へ反映。
		・今日のタスク画面
			選択中のタスクを一覧から削除。選択状態を解除。詳細画面は変更したタスクを表示する。
		*/-->
		$('#taskDetailInputForm').on("click", ".doTaskLater", function() {

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const selectedTaskWorkerSeq = $(this).data("workerSeq");
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;

			$.ajax({
				url : "/user/taskManagement/doTaskLater",
				type : "POST",
				data : {
					"page" : 0,
					"taskSeq" : taskSeq,
					"selectedTaskWorkerSeq" : selectedTaskWorkerSeq,
					"selectedTabClass" : selectedTabClass,
					"selectedAssignSeq" : selectedAssignSeq
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

					Promise.resolve()
						.then(() => addOrDeleteTaskRowForAfterChangeTodayTask(selectedTabClass, taskSeq, selectedAssignSeq, data, false))
						.then(() => renderTaskDetailInputForm(taskSeq, selectedTabClass, selectedAssignSeq, false))
						.then(() => renderTaskMenu(selectedTabClass, null))
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				setTimeout(function(){
					ajaxRunning = false;
				}, 400);
			});
		});

		<!--/* 割り当て選択エリア 独自popperの表示処理 */-->
		$('#taskDetailInputFragment').on("click", ".showSelectArea", function() {
			<!--/* 担当者欄の選択済（workerSelected）を削除、チェックマークを非表示、□マークを表示にする（フラットな状態） */-->
			$(".addWorkerAccount").removeClass("workerSelected");
			$(".workerSquare").removeClass("hidden");
			$(".workerCheckSquare").addClass("hidden");
			<!--/* 実際の担当者のみチェックマークを表示、□マークを非表示にする */-->
			hiddenIfSelect();
			$('#taskDetailInputFragment').find(".selectArea").removeClass("hidden");
		});

		<!--/* 割り当て選択エリア 独自popperの閉じる処理 */-->
		$('#taskDetailInputFragment').on("click", ".closeSelectArea", function() {
			$('#taskDetailInputFragment').find(".selectArea").addClass("hidden");
		});

		<!--/* 割り当て選択エリアクリック ここだけdocumentにアクションを追加する*/-->
		$(document).off("click.taskTanto");
		$(document).on("click.taskTanto", function(e) {
			if ($(e.target).is(".showSelectArea")) {
				return false;
			}
			if (!$(e.target).closest('.task_tanto_select').length && !$('#taskDetailInputFragment').find(".selectArea").hasClass("hidden")) {
				$('#taskDetailInputFragment').find(".selectArea").toggleClass("hidden");
			}
		});

		<!--/* 割り当ての選択処理 */-->
		$('#taskDetailInputFragment').on("click",".addWorkerAccount", function() {
			if ($(this).find(".workerSquare").hasClass("hidden")) {
				$(this).removeClass("workerSelected");
				$(this).find(".workerCheckSquare").addClass("hidden")
				$(this).find(".workerSquare").removeClass("hidden");
			} else {
				$(this).addClass("workerSelected");
				$(this).find(".workerCheckSquare").removeClass("hidden")
				$(this).find(".workerSquare").addClass("hidden");
			}
		});

		<!--/* 割り当ての保存処理 */-->
		$('#taskDetailInputFragment').on("click",".changeTaskTanto", function() {

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const workerAccountSeq = [];
			$(".workerSelected").map(function (index, el) {
				workerAccountSeq.push($(this).attr("data-worker-account-seq"));
			});
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;

			$.ajax({
				url : "/user/taskManagement/changeTaskTanto",
				type : "POST",
				data : {
					"page": 0,
					"taskSeq": taskSeq,
					"workerAccountSeq" : String(workerAccountSeq),
					"selectedTabClass" : selectedTabClass,
					"selectedAssignSeq" : selectedAssignSeq
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					updateTaskRowForChangeTaskTanto(selectedTabClass, selectedAssignSeq, taskSeq, workerAccountSeq, data);
					renderTaskDetailInputForm(taskSeq, selectedTabClass, selectedAssignSeq, false);
					renderTaskMenu(selectedTabClass, null);

					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 案件リンクをクリック */-->
		$('#taskDetailInputFragment').on("click", ".transitionAnken", function(){
			const ankenId = $(this).data("ankenId");
			<!--/* 案件ダッシュボード画面へ遷移 */-->
			window.location.href = "/user/ankenDashboard/" + ankenId + "/";
		});
		
		<!--/* 案件設定：表示処理 */-->
		$('#taskDetailInputFragment').on("click", ".setAnken", function() {
			$('.setAnken').addClass("hidden");
			$('.taskAnkenSearchPopoverWrap').removeClass("hidden");
			$(".ankenList").trigger('input').focus();
		});
		
		<!--/* 案件設定：非表示処理 */-->
		$(document).off('click.taskAnkenSearchPopoverHide');
		$(document).on('click.taskAnkenSearchPopoverHide', function(e) {
			
			<!--/* 自作ポップオーバーの非表示処理（ポップオーバー外のクリック） */-->
			let setAnkenLink = $(e.target).closest('.setAnken');
			let popoverWraper = $(e.target).closest('.taskAnkenSearchPopoverWrap');
			if(!popoverWraper.length && !setAnkenLink.length) {
				<!--/* ポップオーバー要素の外側をクリックした時の操作 */--> 
				<!--/* 全てのポップオーバーを非表示とする */--> 
				$('.taskAnkenSearchPopover').hide();
				$('.setAnken').removeClass("hidden");
				$('.taskAnkenSearchPopoverWrap').addClass("hidden");
			} else {
				<!--/* ターゲット要素をクリックした時の操作 */-->
				<!--/* 特になにもしない */-->
			}
		});
		
		<!--/* 案件設定入力検索 */-->
		let timeoutId = "";
		$('#taskDetailInputForm .ankenList').on('input', function(e) {

			const searchWord = $(this).val();
			if (searchWord.trim() === '') {
				$('#taskAnkenDataListFragmentWrap').html('');
				return;
			}
			
			$('[data-toggle="tooltip"]').tooltip('hide');
			timeoutId = lazyQueueFn(searchAnkenList, {"clearQueueId":timeoutId}, searchWord);
		});
		
		<!--/* タスクに案件紐づけ処理 この関数はポップオーバーから呼ばれる */-->
		benzo.global.fragment.addTaskAnken = function(ankenDataObj) {
			if (ajaxRunning) {
				return false;
			}
			const {ankenId} = ankenDataObj;
			const taskSeq = /*[[${taskDetailInputForm.taskDetail.taskSeq}]]*/'';
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;
			const selectedTaskAnkenId = /*[[${selectedTaskAnkenId}]]*/;

			ajaxRunning = true;
			$.ajax({
				url : "/user/taskManagement/addTaskAnken",
				type : "POST",
				data : {
					"page": 0,
					"taskSeq": taskSeq,
					"ankenId" : ankenId,
					"selectedTabClass" : selectedTabClass,
					"selectedAssignSeq" : selectedAssignSeq
				},
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

					replaceTaskRowForAddTaskAnken(selectedTabClass, taskSeq, data, ankenId, selectedTaskAnkenId);
					Promise.resolve()
						.then(() => renderTaskDetailInputForm(taskSeq, selectedTabClass, selectedAssignSeq, false))
						.then(() => renderTaskMenu(selectedTabClass, selectedTaskAnkenId))
				} else {
					if (data) {
						<!--/* ajaxProcがFailureだがHTMLが帰って来た場合は、validationエラー */-->
						$('#taskDetailFragmentWrap').html(data);
						<!--/* 詳細文のHTMLタグを有効にする */-->
						enableHtmlForDetailContent();
						<!--/* コメントのHTMLタグを有効にする */-->
						enableHtmlForComment();
					}
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		};
		
		<!--/* 詳細タブのコメント入力フォーム、投稿ボタン、閉じるボタンを表示 */-->
		function showTaskDetailCommentInput() {
			<!--/* 詳細内容を非表示 */-->
			$(".taskDetailCommentEditLink").addClass("hidden");
			<!--/* 詳細入力を表示 */-->
			$(".taskDetailComment").removeClass("hidden");
			$(".taskDetailComment > textarea").focus();
			<!--/* 投稿ボタンを表示 */-->
			$("#taskCommentSaveButton").removeClass("hidden");
			<!--/* 閉じるボタンを表示 */-->
			$("#taskCommentCloseButton").removeClass("hidden");
		}

		<!--/* コメントタブのコメントをクリック */-->
		$('#taskDetailInputFragment').on("click", ".taskDetailCommentEditLink", function(){
			showTaskDetailCommentInput();
		});
		
		<!--/* コメント閉じるボタン */-->
		$('#taskDetailInputFragment').on("click", ".closeComment", function(){
			<!--/* 投稿ボタン実行時は非表示にしない  */-->
			if (ajaxRunning) {
				return false;
			}
			<!--/* 詳細内容を非表示 */-->
			$(".taskDetailCommentEditLink").removeClass("hidden");
			$(".taskDetailComment").addClass("hidden");
			$("#taskCommentSaveButton").addClass("hidden");
			$("#taskCommentCloseButton").addClass("hidden");
		});

		<!--/* 詳細タブのコメント保存ボタンをクリック */-->
		$('#taskDetailInputFragment').on("click", ".saveDetailsTabComment", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const formData = $('#taskDetailInputFragment #taskDetailInputForm').serializeArray();
			formData.push({name: "page", value: 0});
			formData.push({name: "selectedTabClass", value: /*[[${selectedTabClass}]]*/});
			formData.push({name: "selectedTaskSeq", value: taskSeq});
			formData.push({name: "selectedAssignSeq", value: /*[[${selectedAssignSeq}]]*/});

			$.ajax({
				url : "/user/taskManagement/saveDetailsTabComment",
				type : "POST",
				data : formData,
			}).done(function(result) {

				if(result.succeeded){
					<!--/* コメント入力フォームを非表示 */-->
					$(".taskDetailCommentEditLink").removeClass("hidden");
					$(".taskDetailComment > textarea").val("");
					$(".taskDetailComment").addClass("hidden");
					$("#taskCommentSaveButton").addClass("hidden");
					$("#taskCommentCloseButton").addClass("hidden");

					<!--/* 詳細タブのコメント履歴更新 */-->
					const newCommentContentRequest = $.when(getDetailsTabCommentHistory(taskSeq));
					newCommentContentRequest.done(function(newContents){
						$('#taskHistoryContents').prepend(newContents.find("#commentData" + result.taskHistorySeq));
						<!--/* HTML有効化 */-->
						$('#commentView' + result.taskHistorySeq).html($('#commentView' + result.taskHistorySeq).text());
					});

					<!--/* コメントタブのコメント履歴更新 */-->
					const newCommentTabCommentContentRequest = $.when(getCommentTabCommentHistory(taskSeq));
					newCommentTabCommentContentRequest.done(function(newContents){
						$('#commentTabTaskHistoryContents').prepend(newContents.find("#commentTabCommentData" + result.taskHistorySeq));
						<!--/* HTML有効化 */-->
						$('#tabCommentView' + result.taskHistorySeq).html($('#tabCommentView' + result.taskHistorySeq).text());
					});
					<!-- /* タブのコメント件数更新 */-->
					getNumberOfComment(taskSeq);
					
					<!-- /* タスク一覧の対象行更新 */-->
					refreshTaskListRow(/*[[${selectedTabClass}]]*/, taskSeq, /*[[${selectedAssignSeq}]]*/, taskSeq)
					showInfoMessageForJs(result.message);

				} else {
					showErrorMessageForJs(result.message);
					showErrorMessage(result.message, $("#taskDetailInputFragment"), result.errors);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!--/* 詳細タブコメント1行分の再表示関数 */-->
		function renderDetailTabCommentRow(taskSeq) {
			return new Promise((resolve, reject) => {

				const param = {
						"page" : 0,
						"taskSeq" : taskSeq
					}

				$.ajax({
					url : '/user/taskManagement/getCommentRow',
					type : "GET",
					data : param,
					dataType: 'html',
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!-- /* 再表示処理なのでreplace */-->
						$("#taskCheckItemData_" + taskCheckItemSeq).replaceWith(data);
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
					return resolve();
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					return reject();
				});
			});
		}

		<!--/* コメントタブのコメント保存ボタンをクリック */-->
		$('#taskDetailInputFragment').on("click", ".saveCommentTabComment", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const formData = $('#taskDetailInputFragment #taskDetailInputForm').serializeArray();
			formData.push({name: "page", value: 0});
			formData.push({name: "selectedTabClass", value: /*[[${selectedTabClass}]]*/});
			formData.push({name: "selectedTaskSeq", value: taskSeq});
			formData.push({name: "selectedAssignSeq", value: /*[[${selectedAssignSeq}]]*/});

			$.ajax({
				url : "/user/taskManagement/saveCommentTabComment",
				type : "POST",
				data : formData,
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					replaceTaskRow(/*[[${selectedTabClass}]]*/, taskSeq, data);
					renderTaskDetailInputForm(taskSeq, /*[[${selectedTabClass}]]*/, /*[[${selectedAssignSeq}]]*/, true);

					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

				} else {
					if (data) {
						<!--/* ajaxProcがFailureだがHTMLが帰って来た場合は、validationエラー */-->
						$('#taskDetailFragmentWrap').html(data);
						<!--/* 選択タブの変更 */-->
						$('#detail-tab').attr('aria-selected', false);
						$('#detail-tab').removeClass('active');
						$('#tabDetail').removeClass('active');
						$('#tabDetail').removeClass('show');
						$('#comment-tab').attr('aria-selected', true);
						$('#comment-tab').addClass('active');
						$('#tabComment').addClass('active');
						$('#tabComment').addClass('show');
						<!--/* 詳細文のHTMLタグを有効にする */-->
						enableHtmlForDetailContent();
						<!--/* コメントのHTMLタグを有効にする */-->
						enableHtmlForComment();
					}
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!-- 詳細タブコメント編集ボタン押下時 -->
		$('#taskDetailInputFragment').on("click",".commentEdit", function(){
			const taskHistorySeq= $(this).data("task-history-seq");
			$("#taskDetailInputFragment").find("#commentLabel" + taskHistorySeq).addClass("hidden");
			$("#taskDetailInputFragment").find("#commentEditForm" + taskHistorySeq).removeClass("hidden");
			$("#taskDetailInputFragment").find("#commentEditForm" + taskHistorySeq + ' > textarea ').focus();
			commonSetUpElement();
		});

		<!-- 詳細タブコメント編集キャンセルボタン押下時 -->
		$('#taskDetailInputFragment').on("click",".editEnd", function(){
			const taskHistorySeq= $(this).data("task-history-seq");
			$("#taskDetailInputFragment").find("#commentEditForm" + taskHistorySeq).addClass("hidden");
			$("#taskDetailInputFragment").find("#commentLabel" + taskHistorySeq).removeClass("hidden");
		});

		<!-- コメントタブコメント編集ボタン押下時 -->
		$('#taskDetailInputFragment').on("click",".commentTabEdit", function(){
			const taskHistorySeq= $(this).data("task-history-seq");
			$("#taskDetailInputFragment").find("#commentTabLabel" + taskHistorySeq).addClass("hidden");
			$("#taskDetailInputFragment").find("#commentTabEditForm" + taskHistorySeq).removeClass("hidden");
			commonSetUpElement();
		});

		<!-- コメントタブコメント編集キャンセルボタン押下時 -->
		$('#taskDetailInputFragment').on("click",".editEndTab", function(){
			const taskHistorySeq= $(this).data("task-history-seq");
			$("#taskDetailInputFragment").find("#commentTabEditForm" + taskHistorySeq).addClass("hidden");
			$("#taskDetailInputFragment").find("#commentTabLabel" + taskHistorySeq).removeClass("hidden");
		});

		<!-- /** 詳細タブコメント編集 処理*/ -->
		$("#taskDetailInputFragment").on("click",".updateComment", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const taskHistorySeq= $(this).data("task-history-seq");
			const comment = $("#taskDetailInputFragment").find("#commentEditForm" + taskHistorySeq).find("[name='comment']").val();
			const params = [];
			params.push({"name" : "taskSeq" , "value" : taskSeq});
			params.push({"name" : "taskHistorySeq" , "value" : taskHistorySeq});
			params.push({"name" : "comment" , "value" : comment});

			$.ajax({
				url : "/user/taskManagement/updateDetailComment",
				type : "POST",
				data : params,
			}).done(function(result) {
				if(result.succeeded){
					<!--/* 詳細タブのコメント履歴更新 */-->
					const newCommentContentRequest = $.when(getDetailsTabCommentHistory(taskSeq));
					newCommentContentRequest.done(function(newContents){
						<!--/* 更新処理なのでreplace */-->
						let replaceContents = newContents.find("#commentData" + result.taskHistorySeq);
						$("#taskDetailInputFragment").find("#commentData" + result.taskHistorySeq).replaceWith(replaceContents);
						<!--/* HTML有効化 */-->
						$('#commentView' + taskHistorySeq).html($('#commentView' + taskHistorySeq).text());
					});

					<!--/* コメントタブのコメント履歴更新 */-->
					const newCommentTabCommentContentRequest = $.when(getCommentTabCommentHistory(taskSeq));
					newCommentTabCommentContentRequest.done(function(newContents){
						<!--/* 更新処理なのでreplace */-->
						let replaceContents = newContents.find("#commentTabCommentData" + result.taskHistorySeq);
						$("#taskDetailInputFragment").find("#commentTabCommentData" + result.taskHistorySeq).replaceWith(replaceContents);
						<!--/* HTML有効化 */-->
						$('#tabCommentView' + taskHistorySeq).html($('#tabCommentView' + taskHistorySeq).text());
					});

					showInfoMessageForJs(result.message);
				}else{
					showErrorMessageForJs(result.message);
					showErrorMessage(result.message, $("#taskDetailInputFragment"), result.errors);
				}
			}).fail(function(jqXHR, textStatus, errorThrown) {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!-- /** 詳細タブコメント削除 処理*/ -->
		$("#taskDetailInputFragment").on("click",".deleteComment", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const taskHistorySeq= $(this).data("task-history-seq");
			const params = [];
			params.push({"name" : "taskSeq" , "value" : taskSeq});
			params.push({"name" : "taskHistorySeq" , "value" : taskHistorySeq});

			$.ajax({
				url : "/user/taskManagement/deleteDetailComment",
				type : "POST",
				data : params,
			}).done(function(result) {
				if(result.succeeded){
					<!-- /* 詳細タブのコメント履歴削除 */-->
					let removeDetailCommentContents ="#commentData" + taskHistorySeq;
					$(removeDetailCommentContents).remove();

					<!-- /* コメントタブのコメント履歴削除 */-->
					let removeCommentTabCommentContents ="#commentTabCommentData" + taskHistorySeq;
					$(removeCommentTabCommentContents).remove();

					<!-- /* タブのコメント件数更新 */-->
					getNumberOfComment(taskSeq);
					
					refreshTaskListRow(/*[[${selectedTabClass}]]*/, taskSeq, /*[[${selectedAssignSeq}]]*/, taskSeq)
					
					showInfoMessageForJs(result.message);
				}else{
					showErrorMessageForJs(result.message);
				}
			}).fail(function(jqXHR, textStatus, errorThrown) {
				showErrorMessageForJs(/*[[#{E00014}]]*/ "削除に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!-- /* コメントタブコメント編集 処理*/ -->
		$("#taskDetailInputFragment").on("click",".updateCommentTab", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const taskHistorySeq= $(this).data("task-history-seq");
			const comment = $("#taskDetailInputFragment").find("#commentTabEditForm" + taskHistorySeq).find("[name='comment']").val();
			const params = [];
			params.push({"name" : "taskSeq" , "value" : taskSeq});
			params.push({"name" : "taskHistorySeq" , "value" : taskHistorySeq});
			params.push({"name" : "comment" , "value" : comment});

			$.ajax({
				url : "/user/taskManagement/updateDetailComment",
				type : "POST",
				data : params,
			}).done(function(result) {
				if(result.succeeded){
					<!-- /* 詳細タブのコメント履歴更新 */-->
					const newCommentContentRequest = $.when(getDetailsTabCommentHistory(taskSeq));
					newCommentContentRequest.done(function(newContents){
						<!-- /* 更新処理なのでreplace */-->
						let replaceContents = newContents.find("#commentData" + result.taskHistorySeq);
						$("#taskDetailInputFragment").find("#commentData" + result.taskHistorySeq).replaceWith(replaceContents);
						<!--/* HTML有効化 */-->
						$('#commentView' + taskHistorySeq).html($('#commentView' + taskHistorySeq).text());
					});

					<!-- /* コメントタブのコメント履歴更新 */-->
					const newCommentTabCommentContentRequest = $.when(getCommentTabCommentHistory(taskSeq));
					newCommentTabCommentContentRequest.done(function(newContents){
						<!-- /* 更新処理なのでreplace */-->
						let replaceContents = newContents.find("#commentTabCommentData" + result.taskHistorySeq);
						$("#taskDetailInputFragment").find("#commentTabCommentData" + result.taskHistorySeq).replaceWith(replaceContents);
						<!--/* HTML有効化 */-->
						$('#tabCommentView' + taskHistorySeq).html($('#tabCommentView' + taskHistorySeq).text());
					});

					showInfoMessageForJs(result.message);
				}else{
					showErrorMessageForJs(result.message);
					showErrorMessage(result.message, $("#taskDetailInputFragment"), result.errors);
				}
			}).fail(function(jqXHR, textStatus, errorThrown) {
				showErrorMessageForJs(/*[[#{E00010}]]*/ "変更に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!-- /** コメントタブコメント削除 処理*/ -->
		$("#taskDetailInputFragment").on("click",".deleteCommentTab", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const taskHistorySeq= $(this).data("task-history-seq");
			const params = [];
			params.push({"name" : "taskSeq" , "value" : taskSeq});
			params.push({"name" : "taskHistorySeq" , "value" : taskHistorySeq});

			$.ajax({
				url : "/user/taskManagement/deleteDetailComment",
				type : "POST",
				data : params,
			}).done(function(result) {
				if(result.succeeded){
					<!-- /* 詳細タブのコメント履歴削除 */ -->
					let removeDetailCommentContents ="#commentData" + taskHistorySeq;
					$(removeDetailCommentContents).remove();

					<!-- /* コメントタブのコメント履歴削除 */ -->
					let removeCommentTabCommentContents ="#commentTabCommentData" + taskHistorySeq;
					$(removeCommentTabCommentContents).remove();

					<!-- /* タブのコメント件数更新 */ -->
					getNumberOfComment(taskSeq);

					refreshTaskListRow(/*[[${selectedTabClass}]]*/, taskSeq, /*[[${selectedAssignSeq}]]*/, taskSeq)
					
					showInfoMessageForJs(result.message);
				}else{
					showErrorMessageForJs(result.message);
				}
			}).fail(function(jqXHR, textStatus, errorThrown) {
				showErrorMessageForJs(/*[[#{E00014}]]*/ "削除に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});
		});

		<!-- /* 詳細タブコメント履歴の取得処理 */ -->
		function getDetailsTabCommentHistory(taskSeq){
			const def= $.Deferred();

			const getHistoryRequest = $.ajax({
				url : "/user/taskManagement/getDetailsTabCommentHistory",
				type : "GET",
				data : {
					"page" : 0,
					"taskSeq": taskSeq
					},
			})

			<!-- /* 成功時 */ -->
			getHistoryRequest.done(function(result) {
				let response = $(result)
				def.resolve(response);
			})

			<!-- /* 失敗時 */ -->
			getHistoryRequest.fail(function(jqXHR, textStatus, errorThrown) {
				window.location.href = "/systemError";
			})

			<!-- /* どちらも行う処理 */ -->
			getHistoryRequest.always(function() {
			});

			<!-- /* 結果を返却 */ -->
			return def.promise(this);
		};

		<!-- /* コメントタブコメント履歴の取得処理 */ -->
		function getCommentTabCommentHistory(taskSeq){
			const def= $.Deferred();

			const getHistoryRequest = $.ajax({
				url : "/user/taskManagement/getCommentTabCommentHistory",
				type : "GET",
				data : {
					"page": 0,
					"taskSeq": taskSeq
					},
			})

			<!-- /* 成功時 */ -->
			getHistoryRequest.done(function(result) {
				let response = $(result)
				def.resolve(response);
			})

			<!-- /* 失敗時 */ -->
			getHistoryRequest.fail(function(jqXHR, textStatus, errorThrown) {
				window.location.href = "/systemError";
			})

			<!-- /* どちらも行う処理 */ -->
			getHistoryRequest.always(function() {
			});

			<!-- /* 結果を返却 */ -->
			return def.promise(this);
		};

		<!-- /* 詳細タブのコメント件数更新処理 */ -->
		function getNumberOfComment(taskSeq){
			$.ajax({
				url : "/user/taskManagement/getNumberOfComment",
				type : "GET",
				data : {
					"page": 0,
					"taskSeq": taskSeq
					},
			}).done(function(result) {
				if(result.succeeded){
					$("#numberOfComment").text("コメント(" + result.numberOfComment + ")");
				}else{
					alert(result.message);
				}
			}).fail(function(jqXHR, textStatus, errorThrown) {
				window.location.href = "/systemError";
			}).always(function() {
			});
		};

		<!--/* サブタスクを追加するリンクをクリック */-->
		$('#taskDetailInputFragment').on("click", ".addCheckList", function(){
			<!--/* サブタスク入力フォームを全て非表示にする */-->
			closeAllCheckItemInput();
			<!--/* 新規サブタスク入力フォームを表示する */-->
			showNewCheckItemInput();
		});

		<!--/* サブタスク入力フォームを全て非表示にする */-->
		function closeAllCheckItemInput() {
			$('.checkItemName').removeClass("hidden");
			$('.checkItemInput').addClass("hidden");
			$('.changeCheckItemName').addClass("hidden");
			$('.closeCheckItemName').addClass("hidden");
		}

		<!--/* 該当のサブタスク入力フォームを表示する */-->
		function showCheckItemInput(checkItemSeq) {
			$('#taskCheckItemView_' + checkItemSeq).addClass("hidden");
			$('#taskCheckItemInputField_' + checkItemSeq).removeClass("hidden");
			$('#taskCheckItemSaveButton_' + checkItemSeq).removeClass("hidden");
			$('#taskCheckItemCloseButton_' + checkItemSeq).removeClass("hidden");
		}

		<!--/* 新規サブタスク入力フォームを表示する */-->
		function showNewCheckItemInput() {
			$('.newTaskContents').removeClass("hidden");
			$('.addCheckItem').addClass("hidden");
			$('.saveCheckItem').removeClass("hidden");
			$('.closeNewCheckItem').removeClass("hidden");
			$('.newCheckItem').removeClass("hidden");
			if ($('.newCheckItemError').text()) {
				$('.newCheckItemError').removeClass("hidden");
			}
			$('.newCheckItem').select();
		}

		<!--/* 新規サブタスク入力フォームを非表示する */-->
		function closeNewCheckItemInput() {
			$('.addCheckItem').removeClass("hidden");
			$('.saveCheckItem').addClass("hidden");
			$('.closeNewCheckItem').addClass("hidden");
			$('.newCheckItem').val("");
			$('.newCheckItem').addClass("hidden");
			$('.newCheckItemError').addClass("hidden");
			$('.newTaskContents').addClass("hidden");
		}

		<!--/* サブタスク新規追加の閉じるボタン押下 */-->
		$('#taskDetailInputFragment').on("click", ".closeNewCheckItem", function(){
			<!--/* 新規サブタスク入力フォームを非表示にする */-->
			closeNewCheckItemInput();
		});

		<!--/* 新規サブタスクフォームでボタン押下 */-->
		$('#taskDetailInputFragment').on("keydown", ".newCheckItem", function(e) {

			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault(); 

			<!--/* 入力値が空は処理終了 */-->
			if ($(this).val() == '') {
				return false;
			}

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const taskSeq = $(this).data("seq");
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;
			const formData = $('#taskDetailInputFragment #taskDetailInputForm').serializeArray();
			saveCheckItem(formData, taskSeq, selectedTabClass, selectedAssignSeq);
		});

		<!--/* サブタスク保存ボタンをクリック */-->
		$('#taskDetailInputFragment').on("click", ".saveCheckItem", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;
			const formData = $('#taskDetailInputFragment #taskDetailInputForm').serializeArray();
			saveCheckItem(formData, taskSeq, selectedTabClass, selectedAssignSeq);
		});


		<!--/* サブタスク保存処理 */-->
		function saveCheckItem(formData, taskSeq, selectedTabClass, selectedAssignSeq) {

			formData.push({name: "page", value: 0});
			formData.push({name: "selectedTabClass", value: selectedTabClass});

			$.ajax({
				url : "/user/taskManagement/saveTaskCheckItem",
				type : "POST",
				data : formData,
			}).done(function(data, status, jqXHR) {

				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					$('#taskCheckList').append(data);
					renderActivityTab(taskSeq);
					<!-- /* タスク一覧の対象行更新 */-->
					refreshTaskListRow(selectedTabClass, taskSeq, selectedAssignSeq, taskSeq);
					<!--/* 成功時エラーメッセージ削除 */-->
					$('.newCheckItemError').text("");

					if (validCheckItemCountOver()) {
						<!--/* サブタスクが上限数以上の場合、新規入力フォームを非表示にする */-->
						closeNewCheckItemInput();
					} else {
						<!--/* サブタスクが登録可能なら、入力フォームの内容をクリアしフォーカスをあてる */-->
						$('.newCheckItemError').addClass("hidden");
						$('.newCheckItem').val('');
						$('.newCheckItem').focus();
					}

					<!--/* サブタスク追加リンク表示／非表示処理 */-->
					refreshCheckItemAddLinkShowHidden();

					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);

				} else {
					if (data) {
						<!--/* ajaxProcがFailureだがHTMLが帰って来た場合は、validationエラー */-->
						$('#taskDetailFragmentWrap').html(data);
						showNewCheckItemInput();
						<!--/* 詳細文のHTMLタグを有効にする */-->
						enableHtmlForDetailContent();
						<!--/* コメントのHTMLタグを有効にする */-->
						enableHtmlForComment();
					}
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});	
		}

		<!--/* サブタスク名をホバー */-->
		$("#taskDetailInputFragment").on('mouseenter','.checkItemName',function(){
			<!--/* 追加登録したサブタスク行のツールチップを有効化する */-->
			commonSetUpElement();
		});

		<!--/* サブタスク名をクリック */-->
		$('#taskDetailInputFragment').on("click", ".checkItemName", function() {
			<!--/* サブタスク入力フォームを全て非表示にする */-->
			closeAllCheckItemInput();
			<!--/* 新規サブタスク入力フォームを非表示にする */-->
			closeNewCheckItemInput();

			const checkItemSeq = $(this).data("check-item-seq");
			const checkItemName = $(this).data("check-item-name");
			<!--/* 該当のサブタスク入力フォームを表示する */-->
			showCheckItemInput(checkItemSeq);
			<!--/* サブタスク入力フォームの内容を変更前に戻す */-->
			$('#taskCheckItemInput_' + checkItemSeq).val(checkItemName);
			$('#taskCheckItemInput_' + checkItemSeq).focus();
			commonSetUpElement();
		});

		<!--/* サブタスク名フォームでボタン押下 */-->
		$('#taskDetailInputFragment').on("keydown", ".checkItem", function(e) {

			<!--/* Enterキー以外は処理終了 */-->
			if (e.keyCode != 13) {
				return;
			}
			<!--/* 本来設定されているキーイベントを外す */-->
			e.preventDefault(); 

			<!--/* 入力値が空は処理終了 */-->
			if ($(this).val() == '') {
				return false;
			}

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			const taskSeq = $(this).data("seq");
			const checkItemSeq = $(this).data("check-item-seq");
			const checkItemName = $('#taskCheckItemInput_' + checkItemSeq).val();
			changeCheckItemName(taskSeq, checkItemName, checkItemSeq);
		});

		<!--/* サブタスク名保存ボタンをクリック */-->
		$('#taskDetailInputFragment').on("click", ".changeCheckItemName", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const checkItemSeq = $(this).data("check-item-seq");
			const checkItemName = $('#taskCheckItemInput_' + checkItemSeq).val();
			changeCheckItemName(taskSeq, checkItemName, checkItemSeq);
		});

		<!--/* サブタスク名変更処理 */-->
		function changeCheckItemName(taskSeq, checkItemName, checkItemSeq) {

			const formData = [];
			formData.push({"name" : "taskSeq", "value" : taskSeq});
			formData.push({"name" : "taskCheckItemSeq", "value" : checkItemSeq});
			formData.push({"name" : "checkItemName", "value" : checkItemName});

			$.ajax({
				url : "/user/taskManagement/changeCheckItemName",
				type : "POST",
				data : formData,
			}).done(function(result) {

				if(result.succeeded){
					<!--/* 処理成功 */-->
					renderCheckItem(checkItemSeq);
					renderActivityTab(taskSeq);
					showInfoMessageForJs(result.message);
				}else{
					showErrorMessageForJs(result.message);
					showErrorMessage(result.message, $("#taskDetailInputFragment"), result.errors);
					$('#taskCheckItemInput_' + checkItemSeq).focus();
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});	
		}

		<!--/* サブタスク名閉じるボタンをクリック */-->
		$('#taskDetailInputFragment').on("click", ".closeCheckItemName", function(){
			const checkItemSeq = $(this).data("check-item-seq");
			<!--/* サブタスク入力フォームを非表示にする */-->
			$('#taskCheckItemView_' + checkItemSeq).removeClass("hidden");
			$('#taskCheckItemInputField_' + checkItemSeq).addClass("hidden");
			$('#taskCheckItemSaveButton_' + checkItemSeq).addClass("hidden");
			$('#taskCheckItemCloseButton_' + checkItemSeq).addClass("hidden");
		});

		<!--/* サブタスクのステータスチェックボックスをクリック */-->
		$('#taskDetailInputFragment').on("click", ".changeCheckItemStatus", function(){

			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const checkItemSeq = $(this).data("check-item-seq");
			const completeFlg = $(this).data("complete-flg");
			const checkItemName = $('#taskCheckItemInput_' + checkItemSeq).data("check-item-name");
			let newCompleteFlg;
			<!--/* サブタスクの状態を変更する */-->
			if (completeFlg) {
				<!--/* 未完了に変更 */-->
				newCompleteFlg = /*[[${T(jp.loioz.common.constant.CommonConstant$CheckItemStatus).INCOMPLETE.cd}]]*/'';
			} else {
				<!--/* 完了に変更 */-->
				newCompleteFlg = /*[[${T(jp.loioz.common.constant.CommonConstant$CheckItemStatus).COMPLETED.cd}]]*/'';
			}
			changeCheckItemStatus(taskSeq, newCompleteFlg, checkItemName, checkItemSeq);
		});

		<!--/* サブタスクステータス変更処理 */-->
		function changeCheckItemStatus(taskSeq, newCompleteFlg, checkItemName, checkItemSeq) {

			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;

			const formData = [];
			formData.push({"name" : "taskSeq", "value" : taskSeq});
			formData.push({"name" : "taskCheckItemSeq", "value" : checkItemSeq});
			formData.push({"name" : "checkItemName", "value" : checkItemName});
			formData.push({"name" : "newCompleteFlg", "value" : newCompleteFlg});

			$.ajax({
				url : "/user/taskManagement/changeCheckItemStatus",
				type : "POST",
				data : formData,
			}).done(function(result) {

				if(result.succeeded){
					<!--/* 処理成功 */-->
					renderCheckItem(checkItemSeq);
					renderActivityTab(taskSeq);
					<!-- /* タスク一覧の対象行更新 */-->
					refreshTaskListRow(selectedTabClass, taskSeq, selectedAssignSeq, taskSeq);
					showInfoMessageForJs(result.message);
				}else{
					showErrorMessageForJs(result.message);
					showErrorMessage(result.message, $("#taskDetailInputFragment"), result.errors);
					$('#taskCheckItemInput_' + checkItemSeq).focus();
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});	
		}

		<!--/* サブタスク1行分の再表示関数 */-->
		function renderCheckItem(taskCheckItemSeq) {
			return new Promise((resolve, reject) => {

				const param = {
						"page" : 0,
						"taskCheckItemSeq" : taskCheckItemSeq
					}

				$.ajax({
					url : '/user/taskManagement/getCheckItem',
					type : "GET",
					data : param,
					dataType: 'html',
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!-- /* 再表示処理なのでreplace */-->
						$("#taskCheckItemData_" + taskCheckItemSeq).replaceWith(data);
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						let sessionTimeOutKey = /*[[${T(jp.loioz.common.constant.MessageEnum).MSG_E00161.messageKey}]]*/'';
						if (sessionTimeOutKey == errorMsg) {
							window.location.href = '/user/taskManagement/list'
						} else {
							showErrorMessageForJs(errorMsg);
						}
					}
					return resolve();
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					return reject();
				});
			});
		}

		<!--/* アクティビティタブの再表示関数 */-->
		function renderActivityTab(selectedTaskSeq) {
			return new Promise((resolve, reject) => {

				const param = {
						"page" : 0,
						"taskSeq" : selectedTaskSeq
					}

				$.ajax({
					url : '/user/taskManagement/displayActivity',
					type : "GET",
					data : param,
					dataType: 'html',
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* アクティビティタブ部分に描画 */-->
						$('#acrivityListFragmentWrap').html(data);
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						let sessionTimeOutKey = /*[[${T(jp.loioz.common.constant.MessageEnum).MSG_E00161.messageKey}]]*/'';
						if (sessionTimeOutKey == errorMsg) {
							window.location.href = '/user/taskManagement/list'
						} else {
							showErrorMessageForJs(errorMsg);
						}
					}
					return resolve();
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					return reject();
				});
			});
		}

		<!--/* サブタスクの削除ボタンをクリック */-->
		$('#taskDetailInputFragment').on("click", ".deleteCheckItemRow", function(event){

			event.stopPropagation();
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;

			$('[data-toggle="tooltip"]').tooltip('hide');
			const taskSeq = $(this).data("seq");
			const checkItemName = $(this).data("check-item-name");
			const checkItemSeq = $(this).data("check-item-seq");
			deleteCheckItem(taskSeq, checkItemName, checkItemSeq);
		});

		<!--/* サブタスク削除処理 */-->
		function deleteCheckItem(taskSeq, checkItemName, checkItemSeq) {

			const selectedTabClass = /*[[${selectedTabClass}]]*/;
			const selectedAssignSeq = /*[[${selectedAssignSeq}]]*/;

			const formData = [];
			formData.push({"name" : "taskSeq", "value" : taskSeq});
			formData.push({"name" : "checkItemName", "value" : checkItemName});
			formData.push({"name" : "taskCheckItemSeq", "value" : checkItemSeq});

			$.ajax({
				url : "/user/taskManagement/deleteCheckItem",
				type : "POST",
				data : formData,
			}).done(function(result) {

				if(result.succeeded){
					<!--/* 処理成功 */-->
					$('#taskCheckItemData_' + checkItemSeq).remove();
					<!--/* サブタスク追加リンク表示／非表示処理 */-->
					refreshCheckItemAddLinkShowHidden();
					renderActivityTab(taskSeq);
					<!-- /* タスク一覧の対象行更新 */-->
					refreshTaskListRow(selectedTabClass, taskSeq, selectedAssignSeq, taskSeq);
					showInfoMessageForJs(result.message);
				}else{
					showErrorMessageForJs(result.message);
					showErrorMessage(result.message, $("#taskDetailInputFragment"), result.errors);
					$('#taskCheckItemInput_' + checkItemSeq).focus();
				}

			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			}).always(function() {
				ajaxRunning = false;
			});	
		}

		<!--/* サブタスクの初期の表示順を保存する（１行ずつ変更する処理） */-->
		let currentDispOrder = new Map();
		$('#taskCheckList li').each(function(idx){
			currentDispOrder.set($(this).attr('data-check-item-seq'), parseInt(idx));
		});

		<!--/* サブタスクの並べ替え処理（１行ずつ変更する処理） */-->
		$('#taskCheckList').sortable({
			containment: "parent",
		});

		<!--/* サブタスクの並べ替え処理（１行ずつ変更する処理） */-->
		$('#taskCheckList').bind('sortupdate', function(){

			let checkItemSeq = [];

			$(this).find('.checkItemRow').each(function(idx){
				<!--/* 並び替えたタスク一覧を順番通りにセット */-->
				checkItemSeq.push($(this).attr('data-check-item-seq'));
			});

			<!--/* パラメータをStringに変換して渡す */-->
			if (checkItemSeq.length > 0) {
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;

				$.ajax({
					url : "/user/taskManagement/changeCheckItemDispOrder",
					type : "POST",
					data : {
						"page" : 0,
						"checkItemSeq" : String(checkItemSeq)
					},
				}).done(function(responce) {
					if (responce.succeeded) {
						$('#taskCheckList li').each(function(idx){
							currentDispOrder.set($(this).attr('data-check-item-seq'), parseInt(idx));
						});
					} else {
						if (responce.message) {
							alert(responce.message);
						}
					}
				}).fail(function(jqXHR, textStatus, errorThrown) {
				}).always(function() {
					ajaxRunning = false;
				});
			}
		});

		<!-- /** 詳細 すべて見るリンク押下フラグ */ -->
		let isShowAllContent = false;

		<!-- /** 詳細 すべて見る */ -->
		$("#taskDetailInputFragment").on("click",".showAllContent", function(){
			isShowAllContent = true;
			$('.shortContentWrap').addClass("hidden");
			$('.allContentWrap').removeClass("hidden");
		});

	});
	</script>

	<!--/* HTML */-->
	<form id="taskDetailInputForm" th:object="${taskDetailInputForm}" autocomplete="off">

		<input type="hidden" th:field="*{taskDetail.taskSeq}">
		<!--/* 一覧で選択中のタスクSEQの次のタスクSEQ（詳細画面でステータス変更時に使用） */-->
		<input id="nextTaskSeq" type="hidden">

		<!--/* タスク編集エリア */-->
		<div class="task_edit_wrapper">

			<!--/* タスク-ヘッダ部 */-->
			<div class="task_edit_header">

				<div class="under_line_tab task_edit_tab">
					<ul class="nav nav-tabs nav-justified" id="myTab" role="tablist">
						<!--/* 詳細 */-->
						<li class="nav-item under_line_tab__detail">
							<a class="nav-link active" id="detail-tab" data-toggle="tab" href="#tabDetail" role="tab" aria-controls="detail" aria-selected="true">詳細</a>
						</li>
						<!--/* コメント */-->
						<li class="nav-item under_line_tab__comment">
							<a class="nav-link" id="comment-tab" data-toggle="tab" href="#tabComment" role="tab" aria-controls="comment" aria-selected="false"><span id="numberOfComment" th:text="|コメント(*{numberOfComment})|"></span></a>
						</li>
						<!--/* アクティビティ */-->
						<li class="nav-item under_line_tab__activity">
							<a class="nav-link" id="history-tab" data-toggle="tab" href="#tabHistory" role="tab" aria-controls="history" aria-selected="false">アクティビティ</a>
						</li>
					</ul>
				</div>

				<!--/* アクションボタン */-->
				<div class="task_action_block">
					<button type="button" class="btn btn-light btn_icon_only mr-4 deleteTask"
						data-boundary="window" data-container=".task_detail_block"
						th:data-seq="*{taskDetail.taskSeq}" data-toggle="tooltip" data-trigger="hover" title="タスク削除">
						<i class="far fa-trash-alt"></i>
					</button>
					<button type="button" class="btn btn-light btn_icon_only taskDetailClose"
						data-boundary="window" data-container=".task_detail_block"
						data-toggle="tooltip" data-trigger="hover" title="詳細を閉じる">
						<i class="fas fa-times"></i>
					</button>
				</div>
			</div>

			<!--/* タスク-ボディ部 */-->
			<div class="task_edit_body">
				<div class="detail_input_area">
					<!--/* タブの内容 */-->
					<div class="tab-content" id="myTabContent">

						<!--/* 詳細 */-->
						<div class="tab-pane fade show active" id="tabDetail" role="tabpanel" aria-labelledby="detail-tab">
							<!--/* 案件未設定 */-->
							<div th:unless="*{taskDetail.ankenId}" class="mt-2">
								<input type="hidden" id="taskDetailAnkenId" value="">
								<a href="javascript:void(0);" class="select_anken setAnken" data-boundary="window"
									data-container=".task_detail_block" data-toggle="tooltip" data-trigger="hover" title="案件のタスクとして登録">
									<i class="fas fa-plus mr-2"></i>案件を設定する</a>
								<div class="popover_box_wrap taskAnkenSearchPopoverWrap w-100 hidden">
									<input type="search" id="search" class="form-control ankenList" placeholder="案件名または顧客名を入力..." autocomplete="off" th:data-seq="*{taskDetail.taskSeq}" th:data-anken-id="*{taskDetail.ankenId.asLong()}">
									<!--/* 案件候補 */-->
									<div id="taskAnkenDataListFragmentWrap">
										<!--/* 初期状態は空のまま */-->
									</div>
								</div>
							</div>

							<!--/* 案件設定済み */-->
							<div th:if="*{taskDetail.ankenId}" class="ml-1 mt-1 d-flex align-items-center">
								<input type="hidden" id="taskDetailAnkenId" th:value="*{taskDetail.ankenId.asLong()}">
								<!--/* 案件設定 */-->
								<div class="task_edit_relation_anken_block char_ellipsis" data-boundary="window" data-container=".task_detail_block" data-toggle="tooltip" data-trigger="hover" title="案件ダッシュボードへ">
									<a href="javascript:void(0);" class="relation_link select_relation_anken transitionAnken" th:data-anken-id="*{taskDetail.ankenId.asLong()}">
										<i class="fas fa-hashtag mr-1"></i><span th:text="*{taskDetail.ankenNameAndCustomerName}"></span>
									</a>
								</div>
								<!--/* 削除ボタン */-->
								<div th:if="*{taskDetail.ankenId}" class="unlink_anken_block">
									<button type="button" class="btn btn-light btn_icon_only deleteAnken unlink_anken pt-2 fs13"
										data-boundary="window" data-container=".task_detail_block"
										th:data-seq="*{taskDetail.taskSeq}" data-toggle="tooltip" data-trigger="hover" title="案件紐付けを解除する">
										<i class="fas fa-unlink"></i>
									</button>
								</div>
							</div>

							<div class="task_edit_top">
								<!--/* 【表示用】タイトル */-->
								<div class="task_edit_top__title_view detailTitleView"
									th:classappend="*{(T(jp.loioz.common.constant.CommonConstant$TaskStatus).COMPLETED.equalsByCode(taskDetail.taskStatus) ? 'task_compleat' : '')}" 
									th:text="*{taskDetail.title}" 
									th:data-title="*{taskDetail.title}">
								</div>

								<!--/* 【編集用】タイトル */-->
								<div class="edit_title detailTitleInput hidden">
									<div class="task_edit_top_input">
										<!--/* 【入力】タイトル */-->
										<div class="task_edit_top_input__title">
											<input type="text" class="form-control taskTitleInput" placeholder="タイトル" th:field="*{taskDetail.title}" maxlength="255" th:data-seq="*{taskDetail.taskSeq}">
											<!--/* 【保存ボタン】タイトル */-->
											<div class="text-right my-2">
												<button type="button" class="btn ml-3 btn btn-info btn_icon_only changeTaskTitle"
													th:data-seq="*{taskDetail.taskSeq}" data-toggle="tooltip" data-trigger="hover" title="タイトル保存">
													<i class="fas fa-check"></i>
												</button>
											</div>
										</div>
									</div>
									<div th:if="*{#fields.hasErrors('taskDetail.title')}" th:errors="*{taskDetail.title}" class="error_mag_point">error</div>
								</div>
							</div>

							<!--/* サブタスク */-->
							<div th:replace="::checkListFragment"></div>

							<!--/* 詳細 */-->
							<div class="task_content">
								<!--/* 入力なし */-->
								<th:block th:if="${#strings.isEmpty(taskDetailInputForm.taskDetail.content)}">
									<a href="javascript:void(0);" class="task_content__link taskDetailContentEditLink">詳細を追加する...</a>
								</th:block>
								<!--/* 入力あり */-->
								<th:block th:if="${!#strings.isEmpty(taskDetailInputForm.taskDetail.shortContentForDisplay)}">
									<!-- 詳細文一部表示 -->
									<div id="taskShortContent" class="task_content__view short_content_wrap shortContentWrap taskDetailContentView" th:text="*{taskDetail.shortContentForDisplay}"></div>
									<!-- すべて見るリンク -->
									<p class="mb-0 text-left show_all_content_wrap shortContentWrap">
										<a href="javascirpt:void(0);" onClick="return false;">
											<span class="showAllContent">
												...すべて見る
											</span>
										</a>
									</p>
								</th:block>
								<!-- 詳細文全て表示 -->
								<th:block th:if="${!#strings.isEmpty(taskDetailInputForm.taskDetail.shortContentForDisplay) && !#strings.isEmpty(taskDetailInputForm.taskDetail.allContentForDisplay)}">
									<div id="taskAllContent" class="task_content__view allContentWrap taskDetailContentView hidden" th:text="*{taskDetail.allContentForDisplay}"></div>
								</th:block>
								<th:block th:if="${#strings.isEmpty(taskDetailInputForm.taskDetail.shortContentForDisplay) && !#strings.isEmpty(taskDetailInputForm.taskDetail.allContentForDisplay)}">
									<div id="taskAllContent" class="task_content__view allContentWrap taskDetailContentView" th:text="*{taskDetail.allContentForDisplay}"></div>
								</th:block>
								<!--/* 詳細入力エリア */-->
								<div class="task_content__edit taskDetailContent hidden">
									<textarea rows="5" name="content" class="form-control"
										maxlength="2000" th:field="*{taskDetail.content}" th:data-content="*{taskDetail.content}"></textarea>
										
									<div th:if="*{#fields.hasErrors('taskDetail.content')}" th:errors="*{taskDetail.content}" class="error_mag_point">error</div>
									<div class="text-right">
										<button type="button" id="taskContentSaveButton" class="mt-2 btn btn-info btn_icon_only saveContent hidden" 
											th:data-seq="*{taskDetail.taskSeq}" data-toggle="tooltip" data-trigger="hover" title="詳細保存">
											<i class="fas fa-check"></i>
										</button>
										<button type="button" id="taskContentCloseButton" class="mt-2 ml-3 btn btn-light btn_icon_only closeContent hidden" 
											data-toggle="tooltip" data-trigger="hover" title="保存せずに閉じる">
											<i class="fas fa-times"></i>
										</button>
									</div>
								</div>
							</div>

							<div class="task_setting">
								<!--/* ステータス start */-->
								<div class="form-row">
									<div class="form-group col-md-4 mb-1">
										<label class="form_label"><i class="far fa-check-circle mr-2"></i>進捗</label>
									</div>
									<div class="form-group col-md-8 mb-1">
										<select class="form-control digit7 changeTaskStatus" th:with="status=*{taskDetail.taskStatus.getCd()}" th:data-seq="*{taskDetail.taskSeq}">
											<option th:each="taskStatus : ${T(jp.loioz.common.constant.CommonConstant$TaskStatus).values()}" 
												th:label="${taskStatus.getVal()}" th:text="${taskStatus.getVal()}" th:value="${taskStatus.getCd()}" th:selected="${taskStatus.equalsByCode(status)}">未着手</option>
										</select>
									</div>
								</div>
								<!--/* ステータス end */-->

								<!--/* 期限 start */-->
								<div class="form-row">
									<div class="form-group col-md-4 mb-1">
										<label class="form_label"><i class="far fa-calendar-alt mr-2"></i>期限</label>
									</div>
									<div class="form-group col-md-8 mb-1">
										<div class="taskLimitDate d-flex" th:data-limit-date="*{taskDetail.limitDate}">
											<div class="task_edit_item">
												<input type="text" class="form-control inputDateSlash task_limit_date inputTaskLimitDate" 
												th:classappend="*{taskDetail.limitDate} ? 'registed_limit_date' : '' "
												th:field="*{taskDetail.limitDate}" placeholder="未設定" data-click-sync="[data-target-name='taskDetail.limitDate']" th:data-seq="*{taskDetail.taskSeq}" th:data-limit-date="*{taskDetail.limitDate}">
												<button type="button" class="btn btn_popcal hidden" data-toggle="datepicker" data-target-name="taskDetail.limitDate">カレンダー</button>
												<div th:if="*{#fields.hasErrors('taskDetail.limitDate')}" th:errors="*{taskDetail.limitDate}" class="error_mag_point">error</div>
											</div>
											<div id="taskLimitDateDeleteButton" class="text-right hidden mt-1 ml-2">
												<button type="button" class="btn btn-light btn_icon_only deleteLimitDtTo" th:data-seq="*{taskDetail.taskSeq}" data-toggle="tooltip" data-trigger="hover" title="期限削除">
													<i class="far fa-calendar-minus"></i>
												</button>
											</div>
										</div>
									</div>
								</div>
								<!--/* 期限 end */-->

								<!--/* 今日のタスク start */-->
								<div class="form-row" th:if="${taskDetailInputForm.isTaskTanto()}">
									<div class="form-group col-md-4 mb-1">
										<label class="form_label"><i class="far fa-clock"></i> 今日のタスク</label>
									</div>
									<div class="form-group col-md-8 mb-1">
										<div class="task_edit_item">
											<button type="button" class="btn btn_today_task doTaskToday" th:data-seq ="*{taskDetail.taskSeq}" th:data-worker-seq="*{taskDetail.taskWorkerSeq}"
											 	th:classappend="*{#temporals.format(taskDetail.todayTaskDate, 'yyyy-MM-dd')==#dates.format(#dates.createNow(), 'yyyy-MM-dd')} ? 'hidden' : ''"
												data-boundary="window" data-container=".task_detail_block" data-toggle="tooltip" data-trigger="hover"
												title="今日のタスクに追加">
												未設定
											</button>
											<button type="button" class="btn btn_today_task comp_task doTaskLater" th:data-seq ="*{taskDetail.taskSeq}" th:data-worker-seq="*{taskDetail.taskWorkerSeq}" 
												th:classappend="*{#temporals.format(taskDetail.todayTaskDate, 'yyyy-MM-dd')==#dates.format(#dates.createNow(), 'yyyy-MM-dd')} ? '' : 'hidden'" 
												data-boundary="window" data-container=".task_detail_block"
												data-toggle="tooltip" data-trigger="hover" title="今日のタスクから除外">
												追加済み <i class="far fa-calendar-check ml-1"></i>
											</button>
										</div>
									</div>
								</div>
								<!--/* 今日のタスク end */-->

								<!--/* 割り当て設定 start */-->
								<div class="form-row align-items-start mt-2">
									<div class="form-group col-md-4 mb-1">
										<label class="form_label"> <i class="fas fa-user-check mr-1"></i>割り当て</label>
									</div>
									<div class="form-group col-md-8 mb-1">
										<!--/* 選択候補が存在しない場合 */-->
										<th:block th:if="*{taskTantoList.size() == 0}">
											<a href="javascript:void(0);" class="showSelectArea btn_select_tanto"
												data-boundary="window" data-container=".task_detail_block"
												data-toggle="tooltip" data-trigger="hover" title="割り当てを設定">未設定</a>
										</th:block>
										<!--/* 選択候補が存在しない場合 end */-->
										
										<!--/* 選択済みのアカウントエリア */-->
										<div th:if="*{taskTantoList.size() > 0}">
											<!-- /* 割り当て名表示 */-->
											<div class="task_tanto_view">
												<th:block th:each="taskTanto, stat : *{taskTantoList}">
													<div th:id="|taskTanto${stat.index}|" class="taskTanto d-flex align-items-center mb-1" th:classappend="${taskTanto.isEmpty()} ? 'hidden'">
														<input type="hidden" name="workerAccountSeq" th:value="${taskTanto.workerAccountSeq}">
														<th:block th:with="workerAccountSeq=${taskTanto.workerAccountSeq}">
															<i class="fas fa-user-circle mr-2" th:style="|color: ${taskTanto.accountColor}|"></i>
															<div class="task_tanto_view__name" th:text="${taskDetailInputForm.getAccountName(workerAccountSeq)}"></div> 
														</th:block>
													</div>
												</th:block>
											</div>
											<div class="text-left mt-1">
												<!-- /* 割り当て名表示 end */-->
												<a href="javascript:void(0);" class="showSelectArea"><i class="fas fa-user-plus mx-2"></i>変更</a>
											</div>
										</div>

										<!--/* 割り当て選択 */-->
										<div class="position-relative">
											<div class="position-absolute task_tanto_select selectArea hidden">
												<div class="task_tanto_select_title">タスクを割り当てます</div>
												<ul>
													<li th:each="option : *{tantoOptions}">
														<a href="javascript:void(0);" class="btn btn-light addWorkerAccount" th:data-worker-account-seq="${option.value}">
															<span class="workerSquare">
																<i class="far fa-square mr-3"></i>
															</span>
															<span class="workerCheckSquare hidden">
																<i class="far fa-check-square mr-3"></i>
															</span>
															<span class="tanto_select__account_label" th:text="${option.label}"></span>
														</a>
													</li>
												</ul>
												<div class="task_tanto_select_footer">
													<div>
														<button type="button" class="btn btn-light btn_icon_only closeSelectArea" data-toggle="tooltip" data-trigger="hover" title="閉じる">
															<i class="fas fa-times"></i>
														</button>
													</div>
													<div class="ml-auto">
														<button type="button" class="btn btn-info btn-sm changeTaskTanto" th:data-seq ="*{taskDetail.taskSeq}"
															data-toggle="tooltip" data-trigger="hover" title="割り当てを設定">
															<i class="fas fa-check mr-2"></i>設定する
														</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!--/* 割り当て設定 end */-->
							</div>

							<!--/* コメント */-->
							<div th:replace="::detailTabCommentFragment(${taskDetailInputForm})"></div>
						</div>
						<!--/* 詳細 end */-->

						<!--/* コメントタブ start */-->
						<div class="tab-pane fade" id="tabComment" role="tabpanel" aria-labelledby="comment-tab">
							<div th:replace="::commentTabFragment(${taskDetailInputForm})"></div>
						</div>
						<!--/* コメントタブ end */-->

						<!--/* アクティビティタブ start */-->
						<div class="tab-pane fade" id="tabHistory" role="tabpanel" aria-labelledby="history-tab">
							<div id="acrivityListFragmentWrap" th:insert="::activityListFragment(*{activityList})"></div>
						</div>
						<!--/* アクティビティタブ end */-->
					</div>
					<!--/* タブの内容 end */-->
				</div>
			</div>
			<!--/* タスク-ボディ部 end */-->
		</div>
	</form>
</div>


<!--/* 案件設定データリストフラグメント start */-->
<div th:fragment="taskAnkenDataListInputFragment" id="taskAnkenDataListInputFragment">
	<script type="text/javascript" th:inline="javascript">
	$(function() {
		const taskAnkenDataListInputFragment = $('#taskAnkenDataListInputFragment');
		taskAnkenDataListInputFragment.find('.ankenData').on('click', function() {
			const ankenDataObj = {
					"ankenId": $(this).data('ankenId'),
					"ankenName": $(this).data("name")
			}
			benzo.global.fragment.addTaskAnken(ankenDataObj);
		});
	});
	</script>
	<div class="popover_box_list notAutoClose popoverBox taskAnkenSearchPopover">
		<div class="popover_box_list__wl of_y_scroll mxh500 hover_scroll">
			<ul class="list-group">
				<li class="list-group-item p-3 task_anken_search_no_data" th:if="${#lists.isEmpty(taskAnkenSelectListDtoList)}">
					<div class="no_data">対象のデータは見つかりませんでした。</div>
				</li>
				<li class="list-group-item task_anken_search_data_list p-3 ankenData" th:each="ankenData : ${taskAnkenSelectListDtoList}"
					th:text="${ankenData.getDispLabel()}" th:data-anken-id="${ankenData.ankenId.asLong()}" th:data-name="${ankenData.getDispLabel()}"></li>
			</ul>
		</div>
	</div>
</div>
<!--/* 案件設定データリストフラグメント end */-->

<!--/* サブタスクリストフラグメント start */-->
<div th:fragment="checkListFragment" th:object="${taskDetailInputForm}">
	<ul id="taskCheckList" class="task_check_list">
		<th:block th:each="checkItem, stat : *{taskDetail.checkList}">
			<li th:replace="::checkItemFragment(${checkItem})"></li>
		</th:block>
	</ul>
	<div>
		<div class="task_edit_top_input newTaskContents hidden">
			<!--/* 【入力】サブタスク名 */-->
			<div class="task_edit_top_input__check_list">
				<input type="text" class="form-control hidden newCheckItem" placeholder="サブタスク" th:field="*{taskDetail.checkItem}" autocomplete="off" maxlength="100" th:data-seq ="*{taskDetail.taskSeq}">
				<div th:if="*{#fields.hasErrors('taskDetail.checkItem')}" th:errors="*{taskDetail.checkItem}" class="error_mag_point newCheckItemError">error</div>
				<div class="text-right mt-2">
					<!--/* 保存ボタン */-->
					<button type="button" class="btn btn-info btn_icon_only ml-3 hidden saveCheckItem"
						th:data-seq ="*{taskDetail.taskSeq}" data-toggle="tooltip" data-trigger="hover" title="サブタスクを追加">
						<i class="fas fa-check"></i>
					</button>
					<!--/* 閉じるボタン */-->
					<button type="button" class="btn btn-light ml-2 btn_icon_only hidden closeNewCheckItem" 
						data-toggle="tooltip" data-trigger="hover" title="追加せずに閉じる">
						<i class="fas fa-times"></i>
					</button>
				</div>
			</div>
		</div>
		<div>
			<a href="javascript:void(0);" class="addCheckList">
				<i class="fas fa-plus mr-2"></i>サブタスクを追加する
			</a>
		</div>
	</div>
</div>
<!--/* サブタスクリストフラグメント end */-->

<!--/* サブタスクリスト1行分フラグメント start */-->
<li th:fragment="checkItemFragment(checkItem)" th:id="|taskCheckItemData_${checkItem.taskCheckItemSeq}|" class="checkItemRow" th:data-check-item-seq="${checkItem.taskCheckItemSeq}">
	<div class="task_sub_item">
		<!--/* チェックマーク */-->
		<div class="task_check_item_check_box changeCheckItemStatus" th:data-seq="${checkItem.taskSeq}" th:data-check-item-seq="${checkItem.taskCheckItemSeq}" th:data-complete-flg="${checkItem.completeFlg}">
			<label class="checkbox_btn no_text">
				<input type="checkbox" class="checkbox_input" th:checked="${checkItem.completeFlg}">
				<span class="checkbox_txt"></span>
			</label>
		</div>
		<!--/* 【表示】サブタスク名 */-->
		<div th:id="|taskCheckItemView_${checkItem.taskCheckItemSeq}|" class="d-flex checkItemName" th:classappend="${checkItem.completeFlg ? 'task_check_item_name_compleat' : 'task_check_item_name'}"
			th:data-check-item-seq="${checkItem.taskCheckItemSeq}" th:data-check-item-name="${checkItem.itemName}">
			<div class="task_check_item_name_view" th:text="${checkItem.itemName}"></div>
			<!--/* 削除ボタン */-->
			<div class="ml-auto ">
				<div class="check_item_delete__trash deleteCheckItemRow" th:data-seq="${checkItem.taskSeq}" th:data-check-item-seq="${checkItem.taskCheckItemSeq}" th:data-check-item-name="${checkItem.itemName}" data-toggle="tooltip" title="削除">
					<i class="far fa-trash-alt"></i>
				</div>
			</div>
		</div>
		<!--/* 【入力】サブタスク名 */-->
		<div th:id="|taskCheckItemInputField_${checkItem.taskCheckItemSeq}|" class="task_edit_top_input__check_list checkItemInput hidden">
			<input type="text" th:id="|taskCheckItemInput_${checkItem.taskCheckItemSeq}|" class="form-control checkItem" placeholder="サブタスク" autocomplete="off" maxlength="100" 
				th:value="${checkItem.itemName}" th:data-seq="${checkItem.taskSeq}" th:data-check-item-seq="${checkItem.taskCheckItemSeq}" th:data-check-item-name="${checkItem.itemName}">
			<div class="error_mag_point checkItemError hidden" th:id="|itemMsg_checkItemName[${checkItem.taskCheckItemSeq}]|"></div>
			<div class="text-right mt-2">
				<!--/* 保存ボタン */-->
				<button type="button" th:id="|taskCheckItemSaveButton_${checkItem.taskCheckItemSeq}|" class="btn btn-info btn_icon_only ml-3 changeCheckItemName hidden"
					th:data-seq="${checkItem.taskSeq}" th:data-check-item-seq="${checkItem.taskCheckItemSeq}" data-toggle="tooltip" data-trigger="hover" title="変更">
					<i class="fas fa-check"></i>
				</button>
				<!--/* 閉じるボタン */-->
				<button type="button" th:id="|taskCheckItemCloseButton_${checkItem.taskCheckItemSeq}|" class="btn btn-light btn_icon_only ml-2 closeCheckItemName hidden" 
					th:data-seq="${checkItem.taskSeq}" th:data-check-item-seq="${checkItem.taskCheckItemSeq}" data-toggle="tooltip" data-trigger="hover" title="閉じる">
					<i class="fas fa-times"></i>
				</button>
			</div>
		</div>
	</div>
</li>
<!--/* サブタスクリスト1行分フラグメント end */-->

<!--/* 詳細タブコメントフラグメント start */-->
<div th:fragment="detailTabCommentFragment(taskDetailInputForm)" class="mt-4">
	<div th:fragment="taskDetailsTabCommentForm" id="taskDetailsTabCommentForm">
		<div class="task_detail_header">
			<label><i class="far fa-comment mr-2"></i>コメント</label>
		</div>
		<div class="task_detail_body">
			<div>
				<a href="javascript:void(0);" class="task_comment__link taskDetailCommentEditLink">コメントは割り当てた人にも通知されます...</a>
				
				<div class="task_comment_edit taskDetailComment hidden">
					<!--/* コメント入力エリア */-->
					<textarea rows="5" name="comment" class="form-control mt-2"
						maxlength="2000" th:field="${taskDetailInputForm.detailsTabComment}" th:data-comment="${taskDetailInputForm.detailsTabComment}"></textarea>
					<div class="error_mag_point hidden" th:id="itemMsg_detailsTabComment"></div>
					<div class="text-right">
						<button type="button" id="taskCommentSaveButton" class="btn btn-info btn_icon_only mt-2 saveDetailsTabComment hidden" 
							th:data-seq ="${taskDetailInputForm.taskDetail.taskSeq}" data-toggle="tooltip" data-trigger="hover" title="コメントを投稿">
							<i class="far fa-comment mr-2"></i>投稿する
						</button>
						<button type="button" id="taskCommentCloseButton" class="mt-2 ml-3 btn btn-light btn_icon_only closeComment hidden"
							data-toggle="tooltip" data-trigger="hover" title="" data-original-title="投稿せずに閉じる">
							<i class="fas fa-times"></i>
						</button>
					</div>
				</div>
			</div>
			<div id="taskHistoryContents">
				<ul th:id="|commentData${comment.taskHistorySeq}|" class="comment_list" th:each="comment : ${taskDetailInputForm.commentList}">
					<li>
						<div class="comment_header">
							<div class="comment_name" th:text="${comment.accountName}">山田　太郎</div>
							<div class="sub_text">
								<span th:text ="${#temporals.format(comment.createdAt, 'M月d日')}">1月1日</span>
								<span th:text="| (${#temporals.format(comment.createdAt, 'E')})|">(月)</span>
								<span th:if="${comment.createdAt}" th:text ="| ${#temporals.format(comment.createdAt, 'H:mm')}|">0:00</span>
							</div>
						</div>
						<div th:id="|commentLabel${comment.taskHistorySeq}|">
							<div class="comment_body">
								<span th:id="|commentView${comment.taskHistorySeq}|" class="commentView" myth:nl2br="${comment.commentForDisplay}">コメント</span>
							</div>
							<div class="text-right">
								<a href="javascript:void(0);" class="comment_edit commentEdit" th:if="${comment.MyComment}" th:data-task-history-seq="${comment.taskHistorySeq}">
									<span>編集</span>
								</a>
							</div>
						</div>
						<div th:id="|commentEditForm${comment.taskHistorySeq}|" class="task_comment_edit mt-2 hidden" th:if="${comment.MyComment}" >
							<textarea class="form-control" name="comment" rows="4" maxlength="200">[[${comment.comment}]]</textarea>
							<div class="error_mag_point hidden" th:id="|itemMsg_comment[${comment.taskHistorySeq}]|"></div>
							<div class="button_container">
								<!--/* コメント削除 */-->
								<button type="button" class="btn btn-light mr-auto btn_icon_only deleteComment" th:data-seq="${comment.taskSeq}" th:data-task-history-seq="${comment.taskHistorySeq}"
									data-boundary="window" data-container=".task_detail_block" data-toggle="tooltip" data-trigger="hover" title="コメント削除"><i class="far fa-trash-alt"></i></button>
								<!--/* コメント保存 */-->
								<button type="button" class="btn btn-info btn_icon_only updateComment" th:data-seq="${comment.taskSeq}" th:data-task-history-seq="${comment.taskHistorySeq}"
									data-boundary="window" data-container=".task_detail_block" data-toggle="tooltip" data-trigger="hover" title="コメント保存"><i class="fas fa-check"></i></button>
								<!--/* コメント閉じる */-->
								<button type="button" class="btn btn-light btn_icon_only editEnd ml-3" th:data-task-history-seq="${comment.taskHistorySeq}" 
									data-boundary="window" data-container=".task_detail_block" data-toggle="tooltip" data-trigger="hover" title="閉じる"><i class="fas fa-times"></i></button>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>
<!--/* 詳細タブコメントフラグメント end */-->

<!--/* コメントタブフラグメント start */-->
<div th:fragment="commentTabFragment(taskDetailInputForm)" class="mt-3 mb-4">
	<div th:fragment="taskCommentTabCommentForm" id="taskCommentTabCommentForm">
		<div class="comment_regist">
			<textarea rows="3" name="comment" class="form-control" maxlength="2000" placeholder="コメントは割り当てた人にも通知されます" th:field="${taskDetailInputForm.commentTabComment}"></textarea>
			<div th:errors="${taskDetailInputForm.commentTabComment}" class="error_mag_point">error</div>
			<div class="text-right mt-2 mr-1">
				<button type="button" class="btn btn-info btn_icon_only saveCommentTabComment" th:data-seq ="${taskDetailInputForm.taskDetail.taskSeq}" data-toggle="tooltip" data-trigger="hover" title="コメントを投稿">
					<i class="far fa-comment mr-2"></i>投稿する
				</button>
			</div>
		</div>
		<div id="commentTabTaskHistoryContents">
			<ul th:id="|commentTabCommentData${comment.taskHistorySeq}|" class="comment_list" th:each="comment : ${taskDetailInputForm.commentList}">
				<li>
					<div class="comment_header">
						<div class="comment_name" th:text="${comment.accountName}">山田　太郎</div>
						<div class="sub_text">
							<span th:text ="${#temporals.format(comment.createdAt, 'M月d日')}">1月1日</span>
							<span th:text="| (${#temporals.format(comment.createdAt, 'E')})|">(月)</span>
							<span th:if="${comment.createdAt}" th:text ="| ${#temporals.format(comment.createdAt, 'H:mm')}|">0:00</span>
						</div>
					</div>
					<div th:id="|commentTabLabel${comment.taskHistorySeq}|">
						<div class="comment_body">
							<span th:id="|tabCommentView${comment.taskHistorySeq}|" class="tabCommentView" myth:nl2br="${comment.commentForDisplay}">コメント</span>
						</div>
						<div class="text-right">
							<a href="javascript:void(0);" class="comment_edit commentTabEdit" th:if="${comment.MyComment}" th:data-task-history-seq="${comment.taskHistorySeq}">
								<span>編集</span>
							</a>
						</div>
					</div>
					<div th:id="|commentTabEditForm${comment.taskHistorySeq}|" class="task_comment_edit mt-2 hidden" th:if="${comment.MyComment}" >
						<textarea class="form-control" name="comment" rows="4" maxlength="200">[[${comment.comment}]]</textarea>
						<div class="error_mag_point hidden" th:id="|itemMsg_comment[${comment.taskHistorySeq}]|"></div>
						<div class="button_container">
							<!--/* コメント削除 */-->
							<button type="button" class="btn btn-light mr-auto btn_icon_only deleteCommentTab" th:data-seq="${comment.taskSeq}" th:data-task-history-seq="${comment.taskHistorySeq}"
								data-boundary="window" data-container=".task_detail_block" data-toggle="tooltip" data-trigger="hover" title="コメント削除"><i class="far fa-trash-alt"></i></button>
							<!--/* コメント保存 */-->
							<button type="button" class="btn btn-info btn_icon_only updateCommentTab" th:data-seq="${comment.taskSeq}" th:data-task-history-seq="${comment.taskHistorySeq}"
								data-boundary="window" data-container=".task_detail_block" data-toggle="tooltip" data-trigger="hover" title="コメント保存"><i class="fas fa-check"></i></button>
							<!--/* コメント閉じる */-->
							<button type="button" class="btn btn-light btn_icon_only editEndTab ml-3" th:data-task-history-seq="${comment.taskHistorySeq}" 
								data-boundary="window" data-container=".task_detail_block" data-toggle="tooltip" data-trigger="hover" title="閉じる"><i class="fas fa-times"></i></button>
						</div>
					</div>
				</li>
			</ul>
		</div>
	</div>
</div>
<!--/* コメントタブフラグメント end */-->

<!--/* アクティビティフラグメント start */-->
<div th:fragment="activityListFragment(activityList)" class="mt-3 mb-4">
	<ul class="activity_list">
		<li th:each="activity : ${activityList}">
			<th:block th:if="${activity.accountName} != null">
				<span class="activity_list__val" th:text="${activity.accountName}"></span>さんが
				<span class="activity_list__val" th:text="${activity.itemName}"></span>
				<th:block th:if="${activity.checkItemName} != null">
					<span class="activity_list__val">：</span>
					<span class="activity_list__val" th:text="${activity.checkItemName}"></span>
				</th:block>
				<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskCheckItemUpdateKbn).UPDATE.equalsByCode(activity.checkItemUpdateKbn))}">
					に名称
				</th:block>
				を
				<th:block th:if="${activity.taskStatus} != null">
					<span class="activity_list__val" th:text="${activity.taskStatus}"></span>に
				</th:block>
				<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskCheckItemUpdateKbn).IN_COMPLETE.equalsByCode(activity.checkItemUpdateKbn))}">
					<span class="activity_list__val">未完了</span>に
				</th:block>
				<th:block th:if="${(T(jp.loioz.common.constant.CommonConstant$TaskCheckItemUpdateKbn).COMPLETE.equalsByCode(activity.checkItemUpdateKbn))}">
					<span class="activity_list__val">完了</span>に
				</th:block>
				<span class="activity_list__val" th:text="${activity.action}"></span>しました
			</th:block>
	
			<div class="activity_sub_text" th:if="${activity.createdAt} != null">
				<span th:text ="${#temporals.format(activity.createdAt, 'M月d日')}">1月1日</span>
				<span th:text="| (${#temporals.format(activity.createdAt, 'E')})|">(月)</span>
				<span th:if="${activity.createdAt}" th:text ="| ${#temporals.format(activity.createdAt, 'H:mm')}|">0:00</span>
			</div>
		</li>
	</ul>
</div>
<!--/* アクティビティフラグメント end */-->


</body>
</html>
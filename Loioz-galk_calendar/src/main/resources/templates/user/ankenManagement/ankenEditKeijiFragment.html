<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8" />
</head>
<body>

<!--/* 案件（刑事）-基本情報表示ブロック */-->
<div th:fragment="ankenBasicViewFragment(ankenBasicViewForm)" id="ankenBasicViewFragment">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {
			
		// 共有の要素セットアップ処理
		commonSetUpElement();
		
		const ankenBasicViewFragment = $("#ankenBasicViewFragment");
		let ajaxRunning = false;
		
		<!--/* 案件編集エリアの取得 */-->
		ankenBasicViewFragment.find('.ankenEdit').on("click", function() {
				
			// 2重押下防止
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			$.ajax({
				url : /*[[@{/user/ankenKeijiManagement/{ankenId}/getAnkenBasicInputForm(ankenId=${ankenBasicViewForm.ankenId.asLong()})}]]*/"",
				type : "GET",
				dataType: 'html',
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 親HTMLのID
					$('#ankenBasicFragmentWrap').html(data);
					
				} else {
					// 処理失敗
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
			})
			.always(function(){
				ajaxRunning = false;
			});
		});
		
		ankenBasicViewFragment.find('#openDeleteAnkenModal').on("click", function() {
			// 2重押下防止
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			$.ajax({
				url : /*[[@{/user/ankenManagement/openAnkenDeleteModal}]]*/"",
				type : "GET",
				data : {"ankenId" : /*[[${ankenBasicViewForm.ankenId.asLong()}]]*/""},
				dataType: 'html',
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 親HTMLのID
					$('#ankenDeleteModalBody').html(data);
					$("#ankenDeleteModal").modal("show");
				} else {
					// 処理失敗
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
			})
			.always(function(){
				ajaxRunning = false;
			});
		});
		
	});
	</script>

	<div class="case_edit_top">
		<div class="case_edit_top__info">
			<span class="main_view_title">案件情報</span>
		</div>
		<div class="case_edit_top__btn">
			
			<!--/* 編集ボタン */-->
			<span>
				<button type="button" class="btn btn-primary btn_icon_only ankenEdit"
					data-boundary="window" data-container="#ankenBasicViewFragment" data-toggle="tooltip" data-trigger="hover" title="案件情報を編集">
					<i class="fas fa-edit mr-2"></i>編集
				</button>
			</span>
	
			<!--/* 案件削除ボタン */-->
			<span>
				<button type="button" id="openDeleteAnkenModal" class="btn btn-light btn_icon_only"
					data-boundary="window" data-container="#ankenBasicViewFragment" data-toggle="tooltip" data-trigger="hover" title="案件削除">
					<i class="far fa-trash-alt"></i>
				</button>
			</span>
			
		<!--/* 裁判追加 */-->
		<th:block th:with="saibanAddable = ${ankenBasicViewForm.saibanCount < T(jp.loioz.common.constant.CommonConstant).SAIBAN_ADD_LIMIT}">
			<th:block th:if="${saibanAddable}">
				<a href="javascript:void(0);" class="btn btn-sm btn-primary pr-3 ml-5" th:href="@{/user/saibanManagement/{ankenId}/new/(ankenId=${ankenBasicViewForm.ankenId.asLong()})}">
					<i class="fas fa-plus"></i>裁判（刑事）追加
				</a>
			</th:block>
				<span class="warning_label" th:if="${!saibanAddable}">
					<i class="fas fa-exclamation-triangle mr-2"></i>裁判は登録上限に達したため、追加できません。
				</span>
		</th:block>
		</div>
	</div>
	<div class="case_edit_split">
		<div class="case_edit_split__left">
			<!--/* 案件名 */-->
			<div class="case_detail">
				<div class="case_detail__image">
					<div th:class="|case_image_wrapper${ankenBasicViewForm.ankenType?.cd}|">
						<!--/* 案件区分 */-->
						<img class="img-thumbnail person_case_img"
							th:src="@{/img/case_type{typeCd}.svg?{ver}(typeCd=${ankenBasicViewForm.ankenType?.cd}, ver=${@environment.getProperty('app.version')})}">
					</div>
				</div>
				<div class="case_detail__case_name">
					<div class="fs13">
	<!--/* 案件区分 */-->
	<!--/* 事務所 */-->
	<th:block th:if="${T(jp.loioz.common.constant.CommonConstant$AnkenType).JIMUSHO.equals(ankenBasicViewForm.ankenType)}">
						<i class="far fa-building"></i>
	</th:block>
	<!--/* 個人 */-->
	<th:block th:if="${T(jp.loioz.common.constant.CommonConstant$AnkenType).KOJIN.equals(ankenBasicViewForm.ankenType)}">
						<i class="fas fa-briefcase"></i>
	</th:block>
						<!--/* 案件種別 */-->
						<span th:text="${ankenBasicViewForm.ankenType?.val}"></span>
						<span >／</span>
						<span th:text="${ankenBasicViewForm.getBunya().getVal()}">分野</span>
	<th:block th:if="${!#strings.isEmpty(ankenBasicViewForm.getBengoTypeVal())}">
						<span >／</span>
						<span th:text="${ankenBasicViewForm.getBengoTypeVal()}">私選・国選</span>
	</th:block>
					</div>
					<!--/* 案件名 */-->
					<span class="fs30 fw600 lh1_4" th:text="${#strings.isEmpty(ankenBasicViewForm.ankenName)} ? '(案件名未入力)' : ${ankenBasicViewForm.ankenName}">案件名</span>
					<div>
						<!--/* 案件ID */-->
						<span class="app_id_link case_link mr-3" th:text="|案件ID：${ankenBasicViewForm.ankenId.asLong()}|">案件ID</span>
						<!--/* 登録日 */-->
						<span class="mr-3 badge badge_square badge_tag">
							<i class="far fa-calendar-check fc_title mr-2"></i>登録日：<span th:text ="*{ankenBasicViewForm.ankenCreatedDate == null ? '' : ankenBasicViewForm.ankenCreatedDate}"></span>
						</span>
						
					</div>
				</div>
			</div>
			<!--/* 案件名 end */-->
			
			<!--/* 売上計上先、担当弁護士、担当事務 */-->
			<div class="case_person_contact">
				<!--/* 売上計上先 */-->
				<div class="case_person_contact__col1">
					<span class="badge badge-pill data_label badge_gray badge_square px-3">売上計上先</span>
					<div class="data_label_value">
						<div th:if="*{ankenBasicViewForm.salesOwner.size() == 0}">
							(未設定)
						</div>
						<div class="case_person_contact__data">
<!--/*/				<th:block th:each="salesOwner : ${ankenBasicViewForm.salesOwner}"> /*/-->
							<div class="case_account">
								<i class="fas fa-user-circle" th:style="|color : ${salesOwner.accountColor};|"></i>
								<div class="person_contact_wrapper mr-3">
									<div class="person_contact__name char_ellipsis">
										<span th:text="${salesOwner.accountName}"></span>
									</div>
								</div>
							</div>
<!--/*/				</th:block> /*/-->
						</div>
					</div>
				</div>
				<!--/* 売上計上先 end */-->
				
				<!--/* 担当者 */-->
				<div class="case_person_contact__col2">
					<span class="badge badge-pill data_label badge_gray badge_square">弁護士</span>
					<div class="data_label_value">
						<div th:if="*{ankenBasicViewForm.tantoLaywer.size() == 0}">
							(未設定)
						</div>
						<div class="case_person_contact__data">
							<!--/* 弁護士 */-->
<!--/*/					<th:block th:each="tantoLaywer : ${ankenBasicViewForm.tantoLaywer}"> /*/-->
							<div class="case_account">
								<i class="fas fa-user-circle" th:style="|color : ${tantoLaywer.accountColor};|"></i>
								<div class="person_contact_wrapper mr-3">
									<div class="person_contact__name char_ellipsis">
										<span th:if="${tantoLaywer.Main}" class="mr-1 fs12 fc_sub">(主担当)</span>
										<span th:text="${tantoLaywer.accountName}"></span>
									</div>
								</div>
							</div>
<!--/*/					</th:block> /*/-->
							<!--/* 弁護士 end */-->
						</div>
					</div>
				</div>
				<div class="case_person_contact__col2">
					<span class="badge badge-pill data_label badge_gray badge_square">事務職員</span>
					<div class="data_label_value">
						<div th:if="*{ankenBasicViewForm.tantoJimu.size() == 0}">
							(未設定)
						</div>
						<div class="case_person_contact__data">
							<!--/* 事務 */-->
<!--/*/					<th:block th:each="tantoJimu : ${ankenBasicViewForm.tantoJimu}"> /*/-->
							<div class="case_account">
								<i class="fas fa-user-circle" th:style="|color : ${tantoJimu.accountColor};|"></i>
								<div class="person_contact_wrapper mr-3">
									<div class="person_contact__name char_ellipsis">
										<span th:if="${tantoJimu.Main}" class="mr-1 fs12 fc_sub">(主担当)</span>
										<span th:text="${tantoJimu.accountName}"></span>
									</div>
								</div>
							</div>
<!--/*/					</th:block> /*/-->
							<!--/* 事務 end */-->
						</div>
					</div>
					<!--/* 担当者 end */-->
					
				</div>
			</div>
			<!--/* 売上計上先、担当弁護士、担当事務 end */-->
			
		</div>
		<div class="case_edit_split__right">
			<!--/* 事案概要・方針 */-->
			<div class="pt-4">
				<span class="badge badge-pill data_label badge_gray badge_square px-3">事案概要・方針</span>
				<div class="biko_detail data_label_value mt-0"
					myth:nl2br="${#strings.isEmpty(ankenBasicViewForm.jianSummary)} ? '(記載なし)' : ${ankenBasicViewForm.jianSummary}">
				</div>
			</div>
		</div>
	</div>
	
	<!--/* 案件削除モーダル */-->
	<div id="ankenDeleteModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
		<div class="modal-dialog modal-dialog-centered modal_deleteSelect_simple" role="document">
			<div class="modal-content">
				<div id="ankenDeleteModalBody"></div>
			</div>
		</div>
	</div>
	
</div>

<!--/* 案件画面基本情報編集入力部品 */-->
<div th:fragment="ankenBasicInputFragment(ankenBasicInputForm)" id="ankenBasicInputFragment">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {
		
		// 共有の要素セットアップ処理
		commonSetUpElement();
		gropingSelectOptions("salesOwner-select", "tantoLawyer-select", "tantoJimu-select");
		$(".addInputItem").each(function() {
			hideIfNoTarget(this);
			showMainTanto(this);
		});
		
		const ankenBasicInputFragment = $('#ankenBasicInputFragment');
		let ajaxRunning = false;
		
		<!--/* 案件編集エリアの取得ロジック */-->
		function getAnkenBasicView() {
			return new Promise((resolve,reject) => {
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/getAnkenBasicView(ankenId=${ankenBasicInputForm.ankenId})}]]*/"",
					type : "GET",
					dataType: 'html',
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 親HTMLのID
						$('#ankenBasicFragmentWrap').html(data);
						return resolve();
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						return reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					return reject();
				});
			
			});
		}
		
		<!--/* 案件編集エリアの取得 */-->
		ankenBasicInputFragment.on('click', '.ankenClose', function() {
			
			// 2重押下防止
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			getAnkenBasicView().finally(() => ajaxRunning = false)
		});
		
		<!--/* 案件更新処理の取得 */-->
		ankenBasicInputFragment.on('click', '.ankenUpdate', function() {
			const formParam = $('#ankenBasicInputForm').serializeArray();
			
			let dataObj = {
				sideMenuPersonId : null,
				sideMenuAnkenId : /*[[${ankenBasicInputForm.ankenId}]]*/null,
				selectedTabClass : 'is_anken'
			}
			
			// 2重押下防止
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			
			// Promiseによる同期処理
			Promise.resolve()
				.then(() => saveBeforeAjax(formParam)) //最初に行う処理は「内部関数：更新前チェック」
				.then(() => saveAjax(formParam)) // 更新前チェック通信：正常終了時処理
				.then(() => wrapHeaderRefresh(dataObj)) // ヘッダー（パンくず）部分の更新
				.catch((errors) => console.log(errors))
				.finally(() => ajaxRunning = false);
			
			<!--/* 内部関数：更新前チェック */-->
			function saveBeforeAjax(params) {
				return new Promise((resolve, reject) => {
					$.ajax({
						url : /*[[@{/user/ankenKeijiManagement/{ankenId}/beforeSaveAnkenBasicCheck(ankenId=${ankenBasicInputForm.ankenId})}]]*/"",
						type : "POST",
						data : params,
						dataType: 'json',
					})
					.done(function(result) {
						if (!result.succeed) {
							// 更新不可の場合
							showErrorMessageForJs(result.message);
							return reject([result.message]);
						} else {
							if (result.confirm && !confirm(result.message)) {
								// 更新可能だがユーザーへの確認が必要
								// 確認の結果、更新を行わない場合
								return reject(["confirmed:false"]);
							}
							return resolve()
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const message = /*[[#{E00091}]]*/ "error";
						showErrorMessageForJs(message);
						return reject([jqXHR, status, errorThrown]);
					});
				});
			};
			
			<!--/* 内部関数：更新 */-->
			function saveAjax(params) {
				return new Promise((resolve, reject) => {
					$.ajax({
						url : /*[[@{/user/ankenKeijiManagement/{ankenId}/saveAnkenBasic(ankenId=${ankenBasicInputForm.ankenId})}]]*/"",
						type : "POST",
						data : params,
						dataType: 'html',
					})
					.done(function(data, status, jqXHR) {
						const redirectCode = /*[[${T(jp.loioz.app.user.ankenManagement.form.AnkenEditKeijiInputForm.AnkenBasicInputForm).HEADER_VALUE_OF_AJAX_PROC_RESULT_REDIRECT}]]*/"100";
						if (getAjaxProcResutl(jqXHR) == redirectCode) {
							// 画面全体をリダイレクトする特殊ケース
							window.location.href = /*[[@{/user/ankenManagement/edit/{ankenId}/(ankenId=${ankenBasicInputForm.ankenId})}]]*/"";
							
						} else if (isAjaxProcSuccess(jqXHR)) {
							const infoMsg = getAjaxProcResutlMessage(jqXHR);
							showInfoMessageForJs(infoMsg);
							
							// 親HTMLのID
							$('#ankenBasicFragmentWrap').html(data);
							resolve();
						} else {
							if (data) {
								// ajaxProcがFailureだがHTMLが帰って来た場合は、validationエラー
								$('#ankenBasicFragmentWrap').html(data);
							}
							
							// 処理失敗
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							reject([errorMsg, status, jqXHR])
						}

					})
					.fail(function(jqXHR, status, errorThrown) {
						const message = /*[[#{E00091}]]*/ "error";
						showErrorMessageForJs(message);
						reject([jqXHR, status, errorThrown]);
					});
				});
			};
		});
		
		<!--/* 案件区分の変更（事務所案件⇔個人案件）で売上計上先の再取得 */-->
		ankenBasicInputFragment.on("change", "[name='ankenType']", function() {

			if (ajaxRunning) {
				return false;
			}

			let alertFlg = false;
			// 売上計上先の弁護士が選択されているかチェックする
			if(ankenBasicInputFragment.find(".salesOwner").length !== ankenBasicInputFragment.find(".salesOwner.pl-0.hidden").length) {
				alertFlg = true;
			}

			if (alertFlg) {
				if (!confirm("区分を変更した場合、売上計上先がリセットされます。")) {
					ankenBasicInputFragment.find("[name='ankenType']:not(:checked)").prop("checked", true);
					return false;
				}
			}

			ajaxRunning = true;
			// 売上計上先を取得し、再設定する
			_setSalesOwner().finally(() => {
				$("[data-toggle=popover]").popover();
				ajaxRunning = false;
			});
		});

		<!--/** 売上計上先取得 */-->
		function _setSalesOwner() {
			return new Promise((resolve, reject) => {
				let ankenType = ankenBasicInputFragment.find("[name='ankenType']:checked").val();
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/changeType(ankenId=${ankenBasicInputForm.ankenId})}]]*/"",
					type :"GET",
					data : {'ankenType' : ankenType},
					dataType: 'html',
				}).done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						ankenBasicInputFragment.find(".lawyerOptionList").replaceWith(data);
						
						return resolve();
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						return reject();
					}

				}).fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					return reject();
				});
			});
		}
		
	});
	</script>

	<!--/* 案件情報入力ブロック */-->
	<div class="main_edit">

		<form id="ankenBasicInputForm" th:object="${ankenBasicInputForm}" th:autocomplete="off">

			<!--/* 入力 */-->
			<div class="row">

				<!--/* 左側 */-->
				<div class="col-md-6">

					<!--/* 左側の入力エリア */-->
					<div class="detail_input_area">
						<!--/* 区分・登録日 */-->
						<div class="form-row">
							<!--/* 区分 */-->
							<div class="form-group col-md-5 col-auto">
								<label class="input_parts_label">受任区分</label>
								<div class="pt-2">
									<label class="radio_btn mb-0 ml-0" th:each="option : *{ankenTypeOptions}">
										<input type="radio" class="radio_input" th:field="*{ankenType}" th:value="${option.value}">
										<span class="radio_txt" th:text="${option.label}"></span>
									</label>
								</div>
								<div th:if="*{#fields.hasErrors('ankenType')}" th:errors="*{ankenType}" class="error_mag_point">error</div>
							</div>
							<!--/* 私選／国選 */-->
							<div class="form-group col-md-3 col-auto">
								<label class="input_parts_label">私選／国選</label>
								<div class="pt-2">
									<label class="radio_btn mb-0 ml-0" th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$BengoType).values()}">
										<input type="radio" class="radio_input" th:field="*{lawyerSelectType}" th:value="${enum.cd}">
										<span class="radio_txt" th:text="${enum.val}"></span>
									</label>
								</div>
								<div th:if="*{#fields.hasErrors('lawyerSelectType')}" th:errors="*{lawyerSelectType}" class="error_mag_point">error</div>
							</div>
							<!--/*  登録日 */-->
							<div class="form-group col-md-4 col-auto">
								<label class="input_parts_label">登録日</label>
								<input type="text" class="form-control digit7 inputDateSlash" data-click-sync="[data-target-name='ankenCreatedDate']"
									th:field="*{ankenCreatedDate}" maxlength="10">
								<button type="button" class="btn btn_popcal hidden" data-target-name="ankenCreatedDate"
									data-toggle="datepicker" data-target="#ankenCreatedDate">カレンダー</button>
								<div th:if="*{#fields.hasErrors('ankenCreatedDate')}" th:errors="*{ankenCreatedDate}" class="error_mag_point">error</div>
							</div>
						</div>

						<!--/* 案件名・分野 */-->
						<div class="form-row">
							<!--/* 案件名 */-->
							<div class="form-group col-md-8">
								<label class="input_parts_label">案件名</label>
								<input type="text" class="form-control" th:field="*{ankenName}" maxlength="150">
								<div th:if="*{#fields.hasErrors('ankenName')}" th:errors="*{ankenName}" class="error_mag_point">error</div>
							</div>

							<!--/* 分野 */-->
							<div class="form-group col-md-4">
								<label class="input_parts_label">分野</label>
								<select class="form-control" th:field="*{bunya}">
									<option
										th:each="bunyaDto : ${ankenBasicInputForm.bunyaList}"
										th:value="${bunyaDto.cd}" th:text="${bunyaDto.val}"></option>
								</select>
								<div th:if="*{#fields.hasErrors('bunya')}" th:errors="*{bunya}" class="error_mag_point">error</div>
							</div>
						</div>
						<!--/* 案件名・分野 end */-->

						<!--/* 弁護士・事務選択 */-->
						<div class="form-row">
							<div class="form-group col-sm-6">
								<div class="lawyerOptionList" th:fragment="lawyerOptionList">
									<div
										th:replace="::tantoTemplate(
										itemName='salesOwner',
										itemLabel='売上計上先',
										optionList=${ankenBasicInputForm.salesOwnerOptions})">
									</div>
								</div>
							</div>
						</div>
						<div class="form-row">
							<div class="form-group col-sm-6">
								<div
									th:replace="::tantoTemplate(
									itemName='tantoLawyer',
									itemLabel='担当弁護士',
									optionList=${ankenBasicInputForm.tantoLawyerOptions},
									dispMainTanto=true)">
								</div>
							</div>
							<div class="form-group col-sm-6">
								<div
									th:replace="::tantoTemplate(
									itemName='tantoJimu',
									itemLabel='担当事務',
									optionList=${ankenBasicInputForm.tantoJimuOptions},
									dispMainTanto=true)">
								</div>
							</div>
						</div>
						<!--/* 弁護士・事務選択 end */-->
					</div>
					<!--/* 左側の入力エリア end */-->

				</div>
				<!--/* 左側 end */-->

				<!--/* 右側 */-->
				<div class="col-md-6">
					<div class="detail_input_area">
						<div class="form-row">
							<div class="form-group col-md-12">
								<label class="input_parts_label">事案概要・方針</label>
								<textarea rows="10" class="form-control" th:field="*{jianSummary}" maxlength="5000"></textarea>
								<div th:if="*{#fields.hasErrors('jianSummary')}" th:errors="*{jianSummary}" class="error_mag_point">error</div>
							</div>
						</div>
					</div>
					
					<!--/* ボタン */-->
					<div class="text-right mt-4">
						<!--/* 保存ボタン */-->
						<button type="button" class="btn btn-info mr-3 ankenUpdate">
							<i class="fas fa-check"></i>保存
						</button>
						<!--/* 閉じるボタン */-->
						<button type="button" class="btn btn-light ankenClose"
							data-boundary="window" data-container="#ankenBasicInputFragment" data-toggle="tooltip" data-trigger="hover" title="閉じる">
							<i class="fas fa-times"></i>閉じる
						</button>
					</div>
					
				</div>
				<!--/* 右側 end */-->

			</div>
			<!--/* 入力 row end */-->
		</form>

	</div>

</div>
	
<!--/* 売上計上・担当弁護士・担当事務 入力項目 */-->
<div th:id="|${itemName}Container|" th:fragment="tantoTemplate(itemName, itemLabel, optionList)" th:with="dispMainTanto=${dispMainTanto}?: false">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {
		const $container = $(/*[[|#${itemName}Container|]]*/"");
		
		// レンダリング時に選択アカウントの表示非表示切り替えを発火
		hiddenIfSelect();
		
		<!--/* 選択アカウントの表示非表示設定を最新化 */-->
		function hiddenIfSelect() {
			const seletedAccount = getSelectedAccountSeq();
			$container.find(".selectArea button").removeClass("hidden");
			$container.find(".selectArea button").filter((idx, elem) => {
				return seletedAccount.includes($(elem).data("seq"));
			}).addClass("hidden");
			if (canAddUser()) {
				$container.find(".showSelectArea").removeClass("hidden");
			}
		};
		
		<!--/* 選択中のアカウントSEQをArray型で取得 */-->
		function getSelectedAccountSeq() {
			return $.map($container.find("input[name*='accountSeq']"), (elem, idx) => {
				if (elem.value) {
					return Number(elem.value);
				}
			});
		};
		
		<!--/* アカウントが追加可能かどうか */-->
		function canAddUser() {
			return  $container.find("."+ [[${itemName}]] + ".hidden").length > 0;
		}
		
		<!--/* removeした際にパラメータの中抜けが発生するため、パラメータを詰める */-->
		function sortParam() {
			const paramContents = $container.find("."+ [[${itemName}]]);
			const paramJson = $.map(paramContents, (elem, ids) => {
				if($(elem).find("input[name*='accountSeq']").val()) {
					return {
						"seq": $(elem).find("input[name*='accountSeq']").val(),
						"mainTanto": $(elem).find("input[name*='mainTanto']").val() === "true",
						"name":$(elem).find(".accountName").text(),
					};
				} 
			});
			
			paramContents.addClass("hidden")
			paramContents.each((idx, elem) => {
				const params = paramJson[idx];
				if (params) {
					$(elem).find("input[name*='accountSeq']").val(params.seq);
					$(elem).find(".accountName").text(params.name);
					$(elem).removeClass("hidden");

					if (params.mainTanto) {
						$(elem).find(".star_btn_main").addClass("btn_checked");
						$(elem).find("input[name*='mainTanto']").val(true);
					} else {
						$(elem).find(".star_btn_main").removeClass("btn_checked");
						$(elem).find("input[name*='mainTanto']").val(false);
					}
				} else {
					$(elem).find("input[name*='accountSeq']").val("");
					$(elem).find(".star_btn_main").removeClass("btn_checked");
					$(elem).find("input[name*='mainTanto']").val(false);
					$(elem).find(".accountName").text("");
				}
			});
		}
		
		<!--/* 独自popperの表示処理 */-->
		$container.on("click", ".showSelectArea", function() {
			$(".selectArea").addClass("hidden");
			$container.find(".selectArea").removeClass("hidden");
		});
		
		<!--/* 独自popperの閉じる処理 */-->
		$container.on("click", ".closeSelectArea", function() {
			$container.find(".selectArea").addClass("hidden");
		});
		
		<!--/* ここだけdocumentにアクションを追加する*/-->
		const itemName = /*[[${itemName}]]*/"";
		$(document).off("click."+itemName);
		$(document).on("click."+itemName, function(e) {
			if ($(e.target).is(".showSelectArea")) {
				return false;
			}
			if (!$(e.target).closest('.tanto_select').length && !$container.find(".selectArea").hasClass("hidden")) {
				$container.find(".selectArea").toggleClass("hidden");
			}
		});
		
		<!--/* ユーザーの選択処理 */-->
		$container.on("click",".addInputUser", function() {
			const accountSeq = $(this).data("seq");
			const accountName = $(this).text();
			
			const nextContent = $container.find("."+ [[${itemName}]] + ".hidden:first");
			if (!nextContent.length) {
				alert("追加できる上限追加できません")
			}
			
			nextContent.removeClass("hidden");
			nextContent.find("input[name*='accountSeq']").val(accountSeq);
			nextContent.find(".accountName").text(accountName);
			
			// 選択肢の表示非表示切り替え
			hiddenIfSelect();
			
			if(!canAddUser()) {
				$container.find(".selectArea").addClass("hidden");
				$container.find(".showSelectArea").addClass("hidden");
			}
		});
		
		<!--/* ユーザーの選択解除処理 */-->
		$container.on("click",".removeInputUser", function() {
			const refleshContent = $(this).closest("."+ [[${itemName}]]);
			refleshContent.addClass("hidden");
			refleshContent.find(".star_btn_main").removeClass("btn_checked");
			refleshContent.find("input[name*='mainTanto']").val(false);
			refleshContent.find("input[name*='accountSeq']").val("");
			refleshContent.find(".accountName").text("");
			
			hiddenIfSelect();
			sortParam();
			
			// 追加可能の場合
			if(canAddUser()) {
				$container.find(".showSelectArea").removeClass("hidden");
			}
		});
		
	});
	</script>

	<div class="hoverTooltip tanto_block">
		<div class="d-flex align-items-center">
			<div th:unless="${itemLabel} == '売上計上先'">
				<label class="input_parts_label" th:text="${itemLabel}">担当弁護士</label>
			</div>
			<div th:if="${itemLabel} == '売上計上先'" class="stop-events outPutContainerClose" data-toggle="popover" data-html="true" 
							data-content='
							<div class="popover_anken_msg">
								<div class="pt-2 pb-2 px-3">
									弁護士アカウントの種別、区分によって選択できるアカウントが変わります。
									<ul>
										<li>事務所案件：経営者種別を持つ弁護士アカウントのみ選択できます。</li>
										<li>個人案件　：すべての弁護士アカウントから選択できます。</li>
									</ul>
								</div>
							</div>
							'>
				<label class="input_parts_label">売上計上先 <i class="far fa-question-circle cursor_pointer"></i></label>
			</div>
			<div class="ml-auto pt-1 mr-3">
				<a href="javascript:void(0);" class="showSelectArea hidden"><i class="fas fa-user-plus mr-2"></i>選択</a>
				
				<!--/* 選択候補のアカウントエリア */-->
				<div class="position-relative">
					<div class="position-absolute tanto_select selectArea hidden">
					
					<!--/* 選択候補が存在する */-->
<!--/*/			<th:block th:if="${!optionList.isEmpty()}"> /*/-->
						<div class="tanto_select_title">担当を選択してください。</div>
						<ul>
							<!--/* 選択候補のアカウント */-->
							<li th:each="option : ${optionList}">
								<button type="button" class="btn btn-light addInputUser" th:data-seq="${option.value}">
									<i class="fas fa-user-check mr-3"></i><span class="tanto_select__account_label" th:text="${option.label}"></span>
								</button>
							</li>
						</ul>
						<div class="tanto_select_footer">
							<button type="button" class="btn btn-light btn_icon_only closeSelectArea" title="閉じる">
								<i class="fas fa-times"></i>
							</button>
						</div>
<!--/*/			</th:block> /*/-->
					<!--/* 選択候補が存在する end */-->
					
					</div>
				</div>
				<!--/* 選択候補のアカウントエリア end */-->
				
			</div>
		</div>
		
		<!--/* 選択済みのアカウントエリア */-->
		<div class="row row_list">
			<!--/* 選択候補が存在しない場合 */-->
			<div class="tanto_select_no_data" th:if="${optionList.isEmpty()}">
				<div>
					<p><i class="fas fa-exclamation-triangle mr-2"></i>選択できるアカウント</p>
					<p>（<span th:text="${itemLabel}"></span>）が存在しません。</p>
				</div>
				<th:block th:if="${salesOwnerHelpNavi}">
					<!--/* 売上計上先のみのエラーメッセージ */-->
					<div class="sub_text">
						<p><i class="far fa-question-circle mr-2"></i>売上計上先のアカウントとは：</p>
						<p class="ml-3">「弁護士」「経営者」チェックあり</p>
					</div>
				</th:block>
			</div>
			<!--/* 選択候補が存在しない場合 end */-->
			
<!--/*/		<th:block th:if="${!optionList.isEmpty()}" th:each="i : ${#numbers.sequence(0, T(java.lang.Math).min(optionList.size(), T(jp.loioz.common.constant.CommonConstant).ANKEN_TANTO_ADD_LIMIT) - 1)}"> /*/-->
			<div th:class="|col-auto mw-100 ${itemName} pl-0|" th:object="${ankenBasicInputForm.__${itemName}__[__${i}__]}"
				th:classappend="*{isEmpty()} ? 'hidden'">
				<div class="d-flex align-items-center" th:id="|${itemName}${i}|">
					<input type="button" th:if="${dispMainTanto}" class="star_btn_main" th:classappend="*{mainTanto} ? 'btn_checked': ''"
						data-boundary="window" th:data-container="|#${itemName}${i}|" data-toggle="tooltip" data-trigger="hover" title="主担当">
					<input type="hidden" th:if="${dispMainTanto}" th:field="*{mainTanto}" th:value="*{mainTanto}">
					<input type="hidden" th:field="*{accountSeq}" th:value="*{accountSeq}">
					<th:block th:with="accountSeq=*{accountSeq}">
						<button type="button" class="btn tanto_selected_btn accountName removeInputUser"
							th:text="${ankenBasicInputForm.getAccountName(accountSeq)}"></button>
					</th:block>
				</div>
				<div th:if="${#fields.hasErrors('${ankenBasicInputForm.__${itemName}__[__${i}__]}')}" class="error_mag_point m-2"
					th:errors="${ankenBasicInputForm.__${itemName}__[__${i}__]}">
				</div>
			</div>
<!--/*/		</th:block> /*/-->
		</div>
		<!--/* 選択済みのアカウントエリア end */-->

		<div th:if="${#fields.hasErrors('${ankenBasicInputForm.__${itemName}__}')}" class="error_mag_point m-2" th:errors="${ankenBasicInputForm.__${itemName}__}"></div>
		
	</div>
</div>
	
<!--/* 案件-顧客一覧 */-->
<div th:fragment="ankenCustomerListViewFragment(ankenCustomerListViewForm)" id="ankenCustomerListViewFragment">
	
	<!--/* 顧客モーダルを扱うので共通JS定義 */-->
	<script type="text/javascript" th:replace="common/mvc/ankenCustomer/customerRegist::customerRegistModalFragmentObjJs"></script>
	
	<!--/* Script */-->
	<script th:inline="javascript">
		$(function() {

			// 共有の要素セットアップ処理
			commonSetUpElement();
			
			const ankenCustomerListViewFragment = $("#ankenCustomerListViewFragment");
			let ajaxRunning = false;
			
			<!--/* 名簿ポップオーバー */-->
			benzo.global.fragment.setUpPersonPopover(ankenCustomerListViewFragment.find(".customerIdLabel"));
			
			ankenCustomerListViewFragment.on("change", ".koryuStatus", function() {
				const row = $(this).closest(".customerListRow");
				const customerId = row.attr("data-customerId");
				const koryuStatus = $(this).val();
				
				$.ajax({
					type : "POST",
					url : "saveAnkenCustomerKoryuStatus",
					data : {
						"customerId" : customerId,
						"koryuStatus": koryuStatus,
					},
					dataType: 'json',
				}).done(function(result) {
					if(result.succeeded){
						showInfoMessageForJs(result.message);
					} else {
						showErrorMessageForJs(result.message);
					}
				}).fail(function() {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				}).always(function(){
					ajaxRunning = false;
				});
			});
			
			<!--/* 案件顧客の編集 */-->
			ankenCustomerListViewFragment.on("click", ".ankenCustomerEdit", function() {
				if (ajaxRunning) {
					return false;
				}
				
				const customerId = $(this).data("customerId");
				ajaxRunning = true;
				Promise.resolve()
					.then(() => getAnkenCustomerListView())
					.then(() => getAnkenCustomerInputView(customerId))
					.catch((errorObj) => console.log(errorObj))
					.finally(() => ajaxRunning = false);
			});
			
			<!--/* 案件顧客の紐付け削除 */-->
			ankenCustomerListViewFragment.on("click",".deleteAnkenCustomer", function(){
				// 確認メッセージ
				if (!confirm("対象の顧客をこの案件から外します。よろしいですか？")){
					return false;
				}
				if(ajaxRunning){
					return false;
				}
				const customerId = $(this).data('customerId');
				ajaxRunning = true;
				$.ajax({
					type : "POST",
					url : "deleteCustomer",
					data : {
						"customerId" : customerId
					},
					dataType: 'json',
				}).done(function(result) {
					if(result.succeeded){
						showInfoMessageForJs(result.message);
						<!--/* 案件顧客と、サイドメニューを再描画 */-->
						Promise.resolve()
							.then(getAnkenCustomerListView)
							.then(renderCustomerAnkenMenuView);<!--/* 親HTMLで定義している関数 */-->
					} else {
						showErrorMessageForJs(result.message);
					}
				}).fail(function() {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				}).always(function(){
					ajaxRunning = false;
				});
			});
			
			<!--/* 帳票出力処理 */-->
			ankenCustomerListViewFragment.on("click", ".downloadBtn", function() {

				const postUrl = "/user/ankenManagement/souhusho/outputSouhusho";

				const outPutContainer = $($(this).data("target"));
				const ankenId = $(outPutContainer).data("ankenId");
				const customerId = $(outPutContainer).data("customerId");
				const souhushoType = $(this).data("souhushoType");
				const params = [
					{name : "ankenId", value :ankenId},
					{name : "souhushoType", value :souhushoType},
					{name : "personId", value :customerId}
				];

				downloadFileAjax(postUrl, $(this), params);
			});

			<!--/* 顧客登録モーダル */-->
			const $customerRegistModal = ankenCustomerListViewFragment.find("#customerRegistModal");
			$customerRegistModal.on("show.bs.modal", function() {
				
				<!--/* 顧客の登録処理 */-->
				benzo.global.fragment.customerRegistModalFragmentObj.setUpObj.registAction = function(triggerBtn) {
					let param = benzo.global.fragment.customerRegistModalFragmentObj.paramObj.getRegistFormParams($customerRegistModal);
					let url = /*[[@{/common/mvc/ankencustomer/registCustomer}]]*/"";
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 処理成功 */-->
							Promise.resolve()
								.then(() => modalHidePromise($customerRegistModal))
								.then(() => getAnkenCustomerListView())
								.then(() => renderCustomerAnkenMenuView()) <!--/* 親HTMLで定義している関数 */-->
								.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
						} else {
							if (data) {
								$customerRegistModal.find(".customerRegistModalFragmentWrap").html(data);
							}
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $customerRegistModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $customerRegistModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				<!--/* 登録モーダルの初期レンダリング処理 */-->
				benzo.global.fragment.customerRegistModalFragmentObj.setUpObj.initRenderRegistViewAction = function(triggerBtn) {
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					Promise.resolve()
						.then(() => initRenderRegistViewAction())
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
				};
				
				<!--/* 検索モーダルの登録処理 */-->
				benzo.global.fragment.customerRegistModalFragmentObj.setUpObj.searchRegistAction = function(triggerBtn) {
					if (ajaxRunning) {
						return false;
					}
					
					const params = benzo.global.fragment.customerRegistModalFragmentObj.paramObj.getSearchResultFormParams($customerRegistModal);
					ajaxRunning = true;
					Promise.resolve()
						.then(() => preCheckInnerFn(params))
						.then((preCheckResult) => registInnerFn(params, preCheckResult))
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
					
					function preCheckInnerFn(preCheckParams) {
						return new Promise((resolve, reject) => {
							const url = /*[[@{/common/mvc/ankencustomer/registSearchResultCustomerPreCheck}]]*/"";
							$.ajax({
								type : "GET",
								url : url,
								data : preCheckParams,
								dataType : "json"
							})
							.done(function(result, status, jqXHR) {
								if (result.succeeded) {
									return resolve(result);
								} else {
									const errorMsg = result.message;
									showErrorMessage(errorMsg, $customerRegistModal);
									return reject(errorMsg);
								}
							})
							.fail(function(jqXHR, status, errorThrown) {
								showErrorMessage(/*[[#{E00091}]]*/ "error", $customerRegistModal);
								return reject(jqXHR, status, errorThrown)
							});
						});
					};
					
					function registInnerFn(registParams, preCheckResult) {
						return new Promise((resolve, reject) => {
							if (!confirm(preCheckResult.confirmMsg)) {
								return resolve();
							}
							const url = /*[[@{/common/mvc/ankencustomer/registSearchResultCustomer}]]*/"";
							$.ajax({
								type : "POST",
								url : url,
								data : registParams,
								dataType : "html"
							})
							.done(function(result, status, jqXHR) {
								if (isAjaxProcSuccess(jqXHR)) {
									<!--/* 処理成功 */-->
									return Promise.resolve()
										.then(() => modalHidePromise($customerRegistModal))
										.then(() => getAnkenCustomerListView())
										.then(() => renderCustomerAnkenMenuView()) <!--/* 親HTMLで定義している関数 */-->
										.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
								} else {
									const errorMsg = getAjaxProcResutlMessage(jqXHR);
									showErrorMessage(errorMsg, $customerRegistModal);
									return reject(errorMsg);
								}
							})
							.fail(function(jqXHR, status, errorThrown) {
								showErrorMessage(/*[[#{E00091}]]*/ "error", $customerRegistModal);
								return reject(jqXHR, status, errorThrown)
							});
						});
					};
					
				};
				
				<!--/* 検索モーダルの検索処理 */-->
				benzo.global.fragment.customerRegistModalFragmentObj.setUpObj.searchRenderPromise = function(triggerBtn) {
					return new Promise((resolve, reject) => {
						const params = benzo.global.fragment.customerRegistModalFragmentObj.paramObj.getSearchFormParams($customerRegistModal);
						const url = /*[[@{/common/mvc/ankencustomer/getCustomerSearchModalFragment}]]*/"";
						$.ajax({
							type : "GET",
							url : url,
							data : params,
							dataType : "html"
						})
						.done(function(result, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								<!--/* 処理成功 */-->
								$customerRegistModal.find(".customerRegistModalFragmentWrap").html(result);
								return resolve();
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessageForJs(errorMsg);
								return reject(errorMsg);
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
							return reject(jqXHR, status, errorThrown)
						});
					});
				};
				
				<!--/* 検索モーダルの初期レンダリング処理 */-->
				benzo.global.fragment.customerRegistModalFragmentObj.setUpObj.initRenderSearchViewAction = function(triggerBtn) {
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					Promise.resolve()
						.then(() => initRenderSearchViewAction())
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
				};
				
			});
			
			<!--/* 顧客追加モーダルの初期レンダリング処理 */-->
			function initRenderRegistViewAction() {
				return new Promise((resolve, reject) => {
					let initRenderRegistViewParams = Object.assign({}, benzo.global.fragment.customerRegistModalFragmentObj.initRenderRegistViewParams);
					const ankenId = initRenderRegistViewParams["ankenId"];
					const url = /*[[@{/common/mvc/ankencustomer/getCustomeRegistModalFragment}]]*/"";
					
					const param = {
							"ankenId": ankenId,
					};
					
					$.ajax({
						type : "GET",
						url : url,
						data : param,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 処理成功 */-->
							$customerRegistModal.find(".customerRegistModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject([jqXHR, status, errorThrown]);
					});
				});
			};
			
			<!--/* 顧客検索モーダルの初期レンダリング処理 */-->
			function initRenderSearchViewAction() {
				return new Promise((resolve, reject) => {
					let initRenderSearchViewParams = Object.assign({}, benzo.global.fragment.customerRegistModalFragmentObj.initRenderSearchViewParams);
					const ankenId = initRenderSearchViewParams["ankenId"];
					const params = [
						{"name": "ankenId", "value": ankenId},
					];
					
					const url = /*[[@{/common/mvc/ankencustomer/getCustomerSearchModalFragment}]]*/"";
					$.ajax({
						type : "GET",
						url : url,
						data : params,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 処理成功 */-->
							$customerRegistModal.find(".customerRegistModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject(jqXHR, status, errorThrown)
					});
				});
			};
			
			<!--/* 「顧客を追加する」処理 */-->
			ankenCustomerListViewFragment.find(".openRegistCustomer").on("click", function(e) {
				if (ajaxRunning) {
					return false
				}
				const ankenId = /*[[${ankenCustomerListViewForm.ankenId.asLong()}]]*/"";
				
				<!--/* 新規登録モーダル初期表示用のパラメータをメモリに保持しておく */-->
				benzo.global.fragment.customerRegistModalFragmentObj.initRenderRegistViewParams = {
						"ankenId": ankenId,
				};
				
				<!--/* 検索モーダル初期表示用のパラメータをメモリに保持しておく */-->
				benzo.global.fragment.customerRegistModalFragmentObj.initRenderSearchViewParams = {
						"ankenId": ankenId,
				};
				
				ajaxRunning = true;
				Promise.resolve()
					.then(() => initRenderRegistViewAction())
					.then(() => $customerRegistModal.modal("show"))
					.catch((errors) => console.log(errors))
					.finally(() => ajaxRunning = false);
			});
			
			<!--/* モーダル閉じる処理をPromise化 */-->
			function modalHidePromise(modal){
				return new Promise((resolve) => {
					$(modal).one('hidden.bs.modal', function() {
						resolve();
					});
					$(modal).modal("hide");
				});
			};
			
			<!--/* 案件顧客情報エリアの取得ロジック */-->
			function getAnkenCustomerListView() {
				return new Promise((resolve, reject) => {
					$.ajax({
						url : /*[[@{/user/ankenKeijiManagement/{ankenId}/getAnkenCustomerListView(ankenId=${ankenCustomerListViewForm.ankenId.asLong()})}]]*/"",
						type : "GET",
						dataType: 'html',
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 親HTMLのID
							$('#ankenCustomerFragmentWrap').html(data);

							return resolve();
						} else {
							// 処理失敗
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							return reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						
						return reject();
					});
				});
			}
			
			<!--/* 案件顧客情報入力エリアの取得ロジック */-->
			function getAnkenCustomerInputView(customerId) {
				return new Promise((resolve, reject) => {
					const ankenCustomerInputWrap = $("#ankenCustomerInputWrap" + customerId);
					$.ajax({
						url : /*[[@{/user/ankenKeijiManagement/{ankenId}/getAnkenCustomerInputView(ankenId=${ankenCustomerListViewForm.ankenId.asLong()})}]]*/"",
						type : "GET",
						data : {"customerId" : customerId},
						dataType: 'html',
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 親HTMLのID
							$(ankenCustomerInputWrap).html(data);

							return resolve();
						} else {
							// 処理失敗
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						const errorObj = {
							"jqXHR": jqXHR,
							"status": status,
							"errorThrown": errorThrown,
						}
						return reject(errorObj);
					});
				});
			}
		});
	</script>
	
	<section class="section_client_side">
		<div class="section_header">
			<div class="section_header__title">被疑者（顧客）情報</div>
			<div class="section_header__action">
				<!--/* 新規追加 */-->
				<a th:if="${ankenCustomerListViewForm.ankenCustomerDto.size() < T(jp.loioz.common.constant.CommonConstant).CUSTOMER_ADD_LIMIT}"
					href="javascript:void(0);" class="openRegistCustomer fs15">
					<i class="fas fa-plus-square mr-2"></i>顧客を追加
				</a>
			</div>
		</div>
		<div class="section_body">
			<div class="section_body__contents">
				
	<th:block th:if="${ankenCustomerListViewForm.ankenCustomerDto.size() == 0}">
				<div class="no_data_msg">
					<span th:text="#{I00035('被疑者（顧客）情報の登録')}">MSG_I00035</span>
				</div>
	</th:block>
	
	<th:block th:if="${ankenCustomerListViewForm.ankenCustomerDto.size() > 0}">
				<ul class="section_list py-1 px-1">
					<!--/* 顧客一覧表示 */-->
					<li class="customerListRow list_contents" 
						th:each="ankenCustomerDto : ${ankenCustomerListViewForm.ankenCustomerDto}" th:object="${ankenCustomerDto}"
						th:data-customerId="*{customerId.asLong()}">
						<div class="section_list_item_wrap section_split_wrapper">
							<div class="section_split section_keiji">
								<div class="section_split__left">
									<!--/* 名簿 */-->
									<div class="img_info_xs mb-2">
										<!--/* 名簿画像 */-->
										<div class="img_info_xs__image">
											<!--/* 名簿属性ラベル */-->
											<div th:class="|person_image_wrapper*{personAttribute?.cd.getCd()}|">
												<!--/* 個人アイコン */-->
												<img th:if="*{T(jp.loioz.common.constant.CommonConstant$CustomerType).KOJIN.equals(customerType)}" 
													class="img-thumbnail person_image_xs" th:src="@{/img/person_kojin.svg}"
													data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="個人">
													
												<!--/* 企業・団体アイコン */-->
												<img th:if="*{T(jp.loioz.common.constant.CommonConstant$CustomerType).HOJIN.equals(customerType)}"
													class="img-thumbnail person_image_xs" th:src="@{/img/person_hojin.svg}"
													data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="企業・団体">
													
												<!--/* 弁護士アイコン */-->
												<img th:if="*{T(jp.loioz.common.constant.CommonConstant$CustomerType).LAWYER.equals(customerType)}"
													class="img-thumbnail person_image_xs" th:src="@{/img/person_bengoshi.svg}"
													data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="弁護士">
											</div>
										</div>
										<!--/* 名簿画像 end */-->
										
										<!--/* 名前 */-->
										<div class="img_info_xs__info">
											<div class="fw600 fs20 lh1_3 pt-1" th:text="*{customerName}">山田　太郎 </div>
											<div>
												<!-- /* 顧客ID */ -->
												<a class="customerIdLabel app_id_link mr-3 p-1 personPopoverLabel" data-boundary="window" data-container="#ankenCustomerListViewFragment"
													th:data-person-id="*{customerId.asLong()}"
													href="javascript:void(0);" th:text="|名簿ID：*{customerId.asLong()}|">
												</a>
												<!-- /* 契約ステータス */ -->
												<i th:class="|fas fa-circle fa-xs anken_status_*{status?.cd}|"></i>
												<span th:text="*{status?.val}" th:id="'customerStatus_' + *{customerId.asLong()}">進捗</span>
											</div>
										</div>
										<!-- /* ボタンエリア */ -->
										<div class="img_info_xs__btn">
											<button type="button" class="btn btn-light btn_icon_only btn_icon_user_minus deleteAnkenCustomer"
												data-boundary="window" data-container="#ankenCustomerListViewFragment" data-toggle="tooltip" data-trigger="hover" title="案件から外す"
												th:data-customer-id="*{customerId.asLong()}">
													<i class="fas fa-user-minus"></i>
											</button>
										</div>
									</div>
									<!--/* １行目 end */-->
									
									<!--/* データブロック */-->
									<div class="item_content_block">
										<!--/* 入力系 */-->
										<div th:id="|ankenCustomerInputWrap*{customerId.asLong()}|">
											<div th:id="|ankenCustomerInputView*{customerId.asLong()}|">
												<div class="anken_status_view ankenCustomerEdit" data-boundary="window"
													th:data-container="|#ankenCustomerInputView*{customerId.asLong()}|" data-toggle="tooltip" data-trigger="hover" title="編集する"
													th:data-customer-id="*{customerId.asLong()}">
													<!--/* 受任日 */-->
													<div>
														<label class="view_label">受任日</label>
														<div class="view_value">
	<!--/* 入力あり */-->
	<th:block th:unless="${#strings.isEmpty(ankenCustomerDto.juninDate)}">
															<span th:text="*{juninDate}"></span>
	</th:block>
	<!--/* 入力なし */-->
	<th:block th:if="${#strings.isEmpty(ankenCustomerDto.juninDate)}">
															<span th:classappend="*{completed} ? '' : 'sub_text'" th:text="*{completed} ? '-' : '(未入力)'"></span>
	</th:block>
														</div>
													</div>
													
													<!-- /* 事件処理完了日 */ -->
													<div>
														<label class="view_label">事件処理完了日</label>
														<div class="view_value">
	<!--/* 入力あり */-->
	<th:block th:unless="${#strings.isEmpty(ankenCustomerDto.jikenshoriKanryoDate)}">
															<span th:text="*{jikenshoriKanryoDate}"></span>
	</th:block>
	<!--/* 入力なし */-->
	<th:block th:if="${#strings.isEmpty(ankenCustomerDto.jikenshoriKanryoDate)}">
															<span th:classappend="*{completed} ? '' : 'sub_text'" th:text="*{completed} ? '-' : '(未入力)'"></span>
	</th:block>
														</div>
													</div>
													
													<!-- /* 精算完了日 */ -->
													<div>
														<label class="view_label">精算完了日</label>
														<div class="view_value">
	<!--/* 入力あり */-->
	<th:block th:unless="${#strings.isEmpty(ankenCustomerDto.seisanKanryoDate)}">
															<span th:text="*{seisanKanryoDate}"></span>
	</th:block>
	<!--/* 入力なし */-->
	<th:block th:if="${#strings.isEmpty(ankenCustomerDto.seisanKanryoDate)}">
															<span th:classappend="*{completed} ? '' : 'sub_text'" th:text="*{completed} ? '-' : '(未入力)'"></span>
	</th:block>
														</div>
													</div>
													
													<!-- /* 完了チェック */ -->
													<div>
														<label class="view_label" th:text="*{SodanFujyunin} ? '不受任' : '完了' ">完了／不受任</label>
														<div class="view_value">
															<span th:if="*{completed}" class="text-info">
																<i class="fas fa-check-square fs19"></i>
															</span>
															<span class="fc_disabled" th:unless="*{completed}" >
																<i class="far fa-square fs19"></i>
															</span>
														</div>
													</div>
												</div>
											</div>
										</div>
										<!--/* 入力系 end */-->
									</div>
								</div>
								
								<!--/* 事件 col-md-8 */-->
								<div class="section_split__right">
									<div class="d-flex align-items-center under_line_tab ">
										<ul class="nav nav-tabs mb-3" th:id="|jikenTab*{customerId.asLong()}|" role="tablist">
											<li class="nav-item">
												<a class="nav-link active" th:id="|jiken-tab*{customerId.asLong()}|" data-toggle="tab"
													th:href="|#jiken*{customerId.asLong()}|" role="tab" 
													th:aria-controls="|#jiken*{customerId.asLong()}|" aria-selected="true">
													<i class="far fa-address-card mr-2"></i>事件情報
												</a>
											</li>
											<li class="nav-item">
												<a class="nav-link" th:id="|sekken-tab*{customerId.asLong()}|" data-toggle="tab" 
													th:href="|#sekken*{customerId.asLong()}|" role="tab"
													th:aria-controls="|sekken*{customerId.asLong()}|" aria-selected="false">
													<i class="far fa-calendar-check mr-2"></i>接見日
												</a>
											</li>
											<li class="nav-item">
												<a class="nav-link" th:id="|zaikan-tab*{customerId.asLong()}|" data-toggle="tab" 
													th:href="|#zaikan*{customerId.asLong()}|" role="tab"
													th:aria-controls="|zaikan*{customerId.asLong()}|" aria-selected="false">
													<i class="fas fa-map-marked-alt mr-2"></i>在監記録
												</a>
											</li>
										</ul>
										<!--/* 在宅・身柄 */-->
										<div class="ml-5 mb-2">
											<label class="radio_btn" th:each="enum : ${T(jp.loioz.common.constant.CommonConstant.KoryuStatus).values()}">
												<input type="radio" class="radio_input koryuStatus" th:value="${enum.cd}" th:name="|koryuStatus*{customerId.asLong()}|" th:checked="${enum} == *{koryuStatus}">
												<span class="radio_txt" th:text="${enum.val}"></span>
											</label>
										</div>
									</div>
									<!--/* タブの中身 */-->
									<div class="tab-content" th:id="|jikenTabContent*{customerId.asLong()}|">
										<div class="tab-pane fade show active" th:id="|jiken*{customerId.asLong()}|" role="tabpanel" th:aria-labelledby="|jiken-tab*{customerId.asLong()}|">
											<div th:id="|ankenCustomerJikenFragmentWrap*{customerId.asLong()}|" class="tab_inner_list" th:data-jiken-customer-id="*{customerId.asLong()}"
												th:insert="::ankenCustomerJikenListViewFragment(${ankenCustomerDto.ankenCustomerJikenDtoList}, *{customerId.asLong()}, *{Completed})">
											<!--/* 事件情報の表示 */-->
											</div>
										</div>
										<div class="tab-pane fade" th:id="|sekken*{customerId.asLong()}|" role="tabpanel" th:aria-labelledby="|sekken-tab*{customerId.asLong()}|">
											<div th:id="|ankenCustomerSekkenFragmentWrap*{customerId.asLong()}|" class="tab_inner_list" 
												th:insert="::ankenCustomerSekkenListViewFragment(${ankenCustomerDto.ankenCustomerSekkenDtoList}, *{customerId}, *{Completed})">
											<!--/* 接見情報の表示 */-->
											</div>
										</div>
										<div class="tab-pane fade" th:id="|zaikan*{customerId.asLong()}|" role="tabpanel" th:aria-labelledby="|zaikan-tab*{customerId.asLong()}|">
											<div th:id="|ankenCustomerZaikanFragmentWrap*{customerId.asLong()}|" class="tab_inner_list" 
												th:insert="::ankenCustomerZaikanListViewFragment(${ankenCustomerDto.ankenCustomerZaikanDtoList}, *{customerId}, *{Completed})">
											<!--/* 在監情報の表示 */-->
											</div>
										</div>
										<!--/* タブの中身 end */-->
									</div>
									<!--/* 事件 col-md-8 end */-->
								</div>
							</div>
						</div>
					</li>
					<!--/* 顧客一行 end */-->
				</ul>
	</th:block>
			</div>
		</div>
		
		<!--/* 顧客検索モーダル テンプレート */-->
		<div id="customerRegistModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
			<div class="modal-dialog modal-dialog-centered resizeToggleClassTarget" role="document">
				<div class="modal-content">
					<div class="customerRegistModalFragmentWrap" style="display:contents;"></div>
				</div>
			</div>
		</div>
		
	</section>
</div>


<!--/* ネストされるフラグメント（案件顧客入力） */-->
<div th:fragment="ankenCustomerListInputFragment" th:object="${ankenCustomerListInputForm}" th:id="|ankenCustomerListInputFragment*{customerId.asLong()}|">

	<!--/* Script */-->
	<script th:inline="javascript">
		$(function() {
			
			// 共有の要素セットアップ処理
			commonSetUpElement();
			
			let ajaxRunning = false;
			const ankenCustomerListInputFragment = $("#ankenCustomerListInputFragment"+/*[[*{customerId.asLong()}]]*/"");
			
			<!--/* 案件顧客情報の保存処理 */-->
			ankenCustomerListInputFragment.on("click", ".ankenCustomerUpdate", function() {
				if (ajaxRunning) {
					return false;
				}
				
				const ankenId = $(this).data("ankenId");
				const customerId = $(this).data("customerId");
				const form = $("#ankenCustomerListInputForm"+ customerId);
				let param = form.serializeArray();
				param.push({"name" : "customerId", "value" : customerId});
				
				ajaxRunning = true;
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/saveAnkenCustomer(ankenId=*{ankenId.asLong()})}]]*/"",
					type : "POST",
					data : param,
					dataType: 'html',
				}).done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 正常終了は一覧を最新化
						$('#ankenCustomerFragmentWrap').html(data);
						showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR));
						
						<!--/* サイドメニューを再描画（顧客の進捗ステータスの変更を反映するため） */-->
						renderCustomerAnkenMenuView();<!--/* 親HTMLで定義している関数 */-->
					} else {
						// 処理失敗
						if (data) {
							// バリデーションエラーによる失敗の場合
							const ankenCustomerInputWrap = $("#ankenCustomerInputWrap" + customerId);
							$(ankenCustomerInputWrap).html(data);
						}
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
				}).fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
				}).always(function() {
					ajaxRunning = false;
				});
			});
			
			<!--/* 案件顧客編集を閉じる */-->
			ankenCustomerListInputFragment.on("click", ".ankenCustomerClose", function() {
				if (ajaxRunning) {
					return false;
				}
				
				const ankenId = $(this).data("ankenId");
				const customerId = $(this).data("customerId");
				const ankenCustomerRowWrap = $("#ankenCustomerRowWrap" + customerId);

				ajaxRunning = true;
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/getAnkenCustomerListView(ankenId=*{ankenId.asLong()})}]]*/"",
					type : "GET",
					dataType: 'html',
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 親HTMLのID
						$('#ankenCustomerFragmentWrap').html(data);
						
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
					
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				})
				.always(function() {
					ajaxRunning = false;
				});

			});
		});

		</script>
	<form th:id="|ankenCustomerListInputForm*{customerId.asLong()}|">
		
		<!-- /* 案件・顧客入力ブロック */ -->
		<div class="anken_status_edit">
			
			<!-- /* 案件・顧客入力ブロック */ -->
			<div class="row">
				<!-- /* 受任日 */ -->
				<div class="col-md-auto">
					<label class="input_parts_label">受任日</label>
					<input type="text" class="form-control digit8 inputDateSlash" maxlength="10" th:id="|juninDate*{customerId.asLong()}|"
						th:field="*{juninDate}" th:data-click-sync="|[data-target='#juninDate*{customerId.asLong()}']|" />
					<button type="button" class="btn btn_popcal_ls hidden" data-toggle="datepicker"
						th:data-target="|#juninDate*{customerId.asLong()}|">カレンダー
					</button>
				</div>
				<!-- /* 受任日 end */ -->
				
				<!-- /* 事件処理完了日 */ -->
				<div class="col-md-auto">
					<label class="input_parts_label">事件処理完了日</label>
					<input type="text" class="form-control digit8 inputDateSlash" maxlength="10" th:id="|jikenshoriKanryoDate*{customerId.asLong()}|"
						th:field="*{jikenshoriKanryoDate}" th:data-click-sync="|[data-target='#jikenshoriKanryoDate*{customerId.asLong()}']|" />
					<button type="button" class="btn btn_popcal_ls m-0 hidden"
						data-toggle="datepicker"
						th:data-target="|#jikenshoriKanryoDate*{customerId.asLong()}|">カレンダー
					</button>
				</div>
				<!-- /* 事件処理完了日 end */ -->
				
				<!-- /* 精算完了日 */ -->
				<div class="col-md-auto">
					<label class="input_parts_label">精算完了日</label>
					<input type="text" class="form-control digit8 inputDateSlash" maxlength="10" th:id="|seisanKanryoDate*{customerId.asLong()}|"
						th:field="*{seisanKanryoDate}" th:data-click-sync="|[data-target='#seisanKanryoDate*{customerId.asLong()}']|" />
					<button type="button" class="btn btn_popcal_ls m-0 hidden"
						data-toggle="datepicker"
						th:data-target="|#seisanKanryoDate*{customerId.asLong()}|">カレンダー
					</button>
				</div>
				<!-- /* 精算完了日 end */ -->
				
				<!-- /* 完了チェック */ -->
				<div class="col-md-auto">
					<label class="input_parts_label" th:text="*{SodanFujyunin} ? '不受任' : '完了' ">完了／不受任</label>
					<div>
						<label class="checkbox_btn no_text">
							<input type="checkbox" class="checkbox_input completedCheck" th:field="*{Completed}">
							<span class="checkbox_txt"></span>
						</label>
					</div>
					<input type="hidden" th:field="*{versionNo}" />
				</div>
				<!-- /* 完了チェック end */ -->
			</div>
			<div class="pl-3">
				<div th:if="*{#fields.hasErrors('juninDate')}" th:errors="*{juninDate}" class="error_mag_point">error</div>
				<div th:if="*{#fields.hasErrors('jikenshoriKanryoDate')}" th:errors="*{jikenshoriKanryoDate}" class="error_mag_point">error</div>
				<div th:if="*{#fields.hasErrors('seisanKanryoDate')}" th:errors="*{seisanKanryoDate}" class="error_mag_point">error</div>
			</div>
			<!-- /* ボタンブロック */ -->
			<div class="anken_status_edit__btn">
				<!-- /* 保存ボタン */ -->
				<button type="button" class="btn btn-info btn-sm btn_icon_save ankenCustomerUpdate mr-3"
					data-boundary="window" th:data-container="|#ankenCustomerListInputForm*{customerId.asLong()}|"
					data-toggle="tooltip" data-trigger="hover" title="" data-original-title="保存する"
					th:data-anken-id="*{ankenId.asLong()}" th:data-customer-id="*{customerId.asLong()}">
					<i class="fas fa-check"></i>保存
				</button>

				<!-- /* 閉じるボタン */ -->
				<button type="button" class="btn btn-light btn-sm ankenCustomerClose"
					data-boundary="window" th:data-container="|#ankenCustomerListInputForm*{customerId.asLong()}|"
					data-toggle="tooltip" data-trigger="hover" title="" data-original-title="編集モードを閉じる"
					th:data-anken-id="*{ankenId.asLong()}" th:data-customer-id="*{customerId.asLong()}">
					<i class="fas fa-times"></i>閉じる
				</button>
			</div>
			<!-- /* ボタンブロック end */ -->
		</div>
		<!-- /* 案件・顧客入力ブロック end */ -->
	</form>
</div>

	
<!--/* ネストされるフラグメント（顧客-事件一覧） */-->
<div th:fragment="ankenCustomerJikenListViewFragment(ankenCustomerJikenDtoList, customerId, Completed)" th:id="|ankenCustomerJikenListViewFragment*{customerId.asLong()}|">
	<!--/* Script */-->
	<script th:inline="javascript">
		$(function() {
			
			// 共有の要素セットアップ処理
			commonSetUpElement();
			
			<!--/* オブジェクトのプロパティ値を取得 */-->
			const targetAnkenId = /*[[${ankenId}]]*/null;
			const targetCustomerId = /*[[*{customerId.asLong()}]]*/null;

			<!--/* 事件の追加クリック */-->
			<!--/* 再描画を行った後に、追加用のフォームの表示を行う */-->
			$('#ankenCustomerJikenListViewFragment' + targetCustomerId).on('click', '.addAnkenCustomerJiken', function() {
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				
				<!--/* パラメータ設定 */-->
				ajaxRunning = true;
				let dataObj = {
						ankenId: targetAnkenId,
						customerId: targetCustomerId,
						jikenSeq: null
				}
				
				<!--/* 事件情報を再描画し、描画後、登録（追加）フォームを表示する */-->
				Promise.resolve(dataObj)
					.then(renderAnkenCustomerJikenViewFunc)
					.then(renderAnkenCustomerJikenRegistInputFormFunc)
					.catch((errorObj) => {
						<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
						console.log(errorObj);
					})
					.finally(() => {
						ajaxRunning = false;
					})
			})
			
			<!--/* 事件編集ボタンクリック */-->
			<!--/* 再描画を行った後に、編集用のフォームの表示を行う */-->
			$('#ankenCustomerJikenListViewFragment' + targetCustomerId).on('click', '.editAnkenCustomerJiken', function() {
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				
				<!--/* パラメータ設定 */-->
				let dataObj = {
						ankenId: targetAnkenId,
						customerId: targetCustomerId,
						jikenSeq: $(this).data('jiken-seq')
				}
				ajaxRunning = true;
				
				<!--/* 事件情報を再描画し、描画後、対象の編集フォームを表示する */-->
				Promise.resolve(dataObj)
					.then(renderAnkenCustomerJikenViewFunc)
					.then(renderAnkenCustomerJikenEditInputFormFunc)
					.catch((errorObj) => {
						<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
						console.log(errorObj);
					})
					.finally(() => {
						ajaxRunning = false;
					})
			})
			
			<!--/* 事件情報の再表示関数 */-->
			const renderAnkenCustomerJikenViewFunc = (dataObj) => {
				return new Promise((resolve, reject) => {
					
					<!--/* 事件情報の表示領域を再描画 */-->
					<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
					$.ajax({
						url : 'getAnkenCustomerJikenListView',
						type : "GET",
						data : dataObj
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							
							// 再描画
							// 親HTMLのID
							$('#ankenCustomerJikenFragmentWrap' + targetCustomerId).html(data);
							
							<!--/* 引数データは後続処理に渡す */-->
							resolve(dataObj);
						} else {
							// 処理失敗
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						
						reject();
					})
				});
			}
			
			<!--/* 事件の登録（追加）フォームの表示関数 */-->
			const renderAnkenCustomerJikenRegistInputFormFunc = (dataObj) => {
				return new Promise((resolve, reject) => {
					
					<!--/* クリックされた要素の登録（追加）フォームを表示 */-->
					<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
					$.ajax({
						url : 'getAnkenCustomerJikenListInputForm',
						type : "GET",
						data : dataObj
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 新規登録行部分にHTML表示
							let targetObj = '#ankenCustomerJikenFragmentWrap'  + targetCustomerId + ' #ankenCustomerJikenRowForNewRegist' + targetCustomerId;
							$(targetObj).html(data);
							$(targetObj + ' #jikenName').focus();
							
							<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
							resolve();
						} else {
							// 処理失敗
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						
						reject();
					})
				});
			}
			
			<!--/* 事件の編集フォームの表示関数 */-->
			const renderAnkenCustomerJikenEditInputFormFunc = (dataObj) => {
				return new Promise((resolve, reject) => {
					
					<!--/* オブジェクトのプロパティ値を取得 */-->
					const {jikenSeq} = dataObj;
					
					<!--/* クリックされた要素と同じ要素を再取得（前処理でHTMLが再描画されているため、新しいDOMから再取得を行う） */-->
					const clickedElem = $('#ankenCustomerJikenListViewFragment' + targetCustomerId + ' .editAnkenCustomerJiken')
						.filter('[data-jiken-seq=' + jikenSeq + ']');
					
					let requestData = {
							ankenId: targetAnkenId,
							customerId: targetCustomerId,
							jikenSeq: jikenSeq
					}
					
					<!--/* クリックされた要素の編集フォームを表示 */-->
					<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
					$.ajax({
						url : 'getAnkenCustomerJikenListInputForm',
						type : "GET",
						data : requestData
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 対象行部分にHTML表示
							$(clickedElem).closest('.jikenRow').html(data)
							
							<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
							resolve();
						} else {
							// 処理失敗
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						
						reject();
					})
				});
			}
			
			<!--/* 削除ボタンクリック */-->
			$('#ankenCustomerJikenListViewFragment' + targetCustomerId).on('click', '.deleteAnkenCustomerJiken', function() {
				if (!confirm('削除します。よろしいですか？')) {
					return false;
				}
				
				let jikenSeqVal = $(this).data('jikenSeq');
				
				let dataObj = {
					jikenSeq: jikenSeqVal,
					customerId: targetCustomerId,
				}
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					type : "POST",
					url : "deleteAnkenCustomerJiken",
					data : dataObj,
					dataType: 'html',
				}).done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 親HTMLのID
						$('#ankenCustomerJikenFragmentWrap' + targetCustomerId).html(data);
						
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showInfoMessageForJs(errorMsg);
						
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
				}).fail(function() {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				}).always(function(){
					ajaxRunning = false;
				});
			})
			
		});
	</script>

	<!--/* 事件一覧 */-->
	<th:block th:if="*{ankenCustomerJikenDtoList != null}">
		<div class="border-top-0 row row_list list_header" th:if="*{ankenCustomerJikenDtoList.size() > 0}">
			<div class="col-3">被疑事実</div>
			<div class="col-2">逮捕日</div>
			<div class="col-2">勾留請求日</div>
			<div class="col-2">満期日</div>
			<div class="col-3">処分</div>
		</div>
		<div class="row row_list sub_row jikenRow" th:id="|jikenRow*{jikenSeq}|"
			th:each="jikenDto : *{ankenCustomerJikenDtoList}" th:object="${jikenDto}">
			<!--/* 被疑事実 */-->
			<div class="col-3">
				<span th:text="*{jikenName}"></span>
			</div>
			<!--/* 逮捕日 */-->
			<div class="col-2">
				<span th:text="*{taihoDate}"></span>
			</div>
			<!--/* 勾留請求日 */-->
			<div class="col-2">
				<span th:text="*{koryuSeikyuDate}"></span>
			</div>
			<!--/* 満期日 */-->
			<div class="col-2">
				<div>
					<span class="sub_text">①</span><span th:text="*{koryuExpirationDate}"></span>
				</div>
				<div>
					<span class="sub_text">②</span><span th:text="*{koryuExtendedExpirationDate}"></span>
				</div>
			</div>
			<!--/* 処分 */-->
			<div class="col-2">
				<span th:text="*{getShobunLabel()}"></span>
				<div th:text="*{shobunDate}"></div>
			</div>
			<!-- /* 編集ボタン */ -->
			<div class="col-1">
				<div class="d-flex">
					<button type="button" class="btn btn-light btn_icon_only btn_icon_edit btn_no_border editAnkenCustomerJiken"
						data-boundary="window" th:data-container="|#jikenRow*{jikenSeq}|" data-toggle="tooltip" data-trigger="hover" title="編集する" 
						th:data-jiken-seq="*{jikenSeq}">
						<i class="fas fa-edit"></i>
					</button>
					<button type="button" class="btn btn-light btn_icon_only btn_no_border deleteAnkenCustomerJiken"
						data-boundary="window" th:data-container="|#jikenRow*{jikenSeq}|" data-toggle="tooltip" data-trigger="hover" title="削除する" 
						th:data-jiken-seq="*{jikenSeq}">
						<i class="far fa-trash-alt"></i>
					</button>
				</div>
			</div>
		</div>
	</th:block>
	<div th:id="|ankenCustomerJikenRowForNewRegist*{customerId.asLong()}|" class="jikenRow">
	</div>
	<div class="add_row_area" th:unless="*{T(jp.loioz.common.constant.CommonConstant).JIKEN_INFO_ADD_LIMIT <=ankenCustomerJikenDtoList?.size()}">
		<a href="javascript:void(0);" class="addAnkenCustomerJiken">
			<i class="fas fa-plus-square mr-2"></i>事件を追加
		</a>
	</div>
</div>


<!--/* ネストされるフラグメント（顧客-事件入力） */-->
<div th:fragment="ankenCustomerJikenListInputFragment(ankenCustomerJikenListInputForm)" th:object="${ankenCustomerJikenListInputForm}" th:id="|ankenCustomerJikenListInputFragment*{targetCustomerId}|" class="w-100">

	<!--/* Script */-->
	<script th:inline="javascript">
		$(function() {
			
			const $ankenCustomerJikenListInputFragment = $("#ankenCustomerJikenListInputFragment" + /*[[*{targetCustomerId}]]*/"");
			
			// 共有の要素セットアップ処理
			commonSetUpElement();
			
			<!--/* 勾留請求日を設定したときに、満期日①に日付を自動設定する (勾留請求日 +9日) */-->
			$("#koryuSeikyuDate"+/*[[*{targetCustomerId}]]*/"").on("change", function() {
				const koryuSeikyuDate = new Date($(this).val());
				if(Number.isNaN(koryuSeikyuDate.getDate())) {
					return false;
				}
				
				koryuSeikyuDate.setDate(koryuSeikyuDate.getDate() + 9);
				$("#koryuExpirationDate"+/*[[*{targetCustomerId}]]*/"").val(formatDate(koryuSeikyuDate, 'YYYY/MM/DD'));
			});
			
			<!--/* 事件の編集を閉じる（表示モードの表示に切り替える） */-->
			$ankenCustomerJikenListInputFragment.on('click', '.editAnkenCustomerJikenClose', function() {
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				const ankenId = /*[[*{targetAnkenId}]]*/;
				const customerId = /*[[*{targetCustomerId}]]*/;
				let dataObj = {
						ankenId: ankenId,
						customerId: customerId
				}
				ajaxRunning = true;
				$.ajax({
					url : 'getAnkenCustomerJikenListView',
					type : "GET",
					data : dataObj, 
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 親HTMLのID
						$('#ankenCustomerJikenFragmentWrap' + customerId).html(data);
						
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				})
				.always(function(){
					ajaxRunning = false;
				});
				
			});
			
			<!--/* 事件の新規登録 */-->
			$ankenCustomerJikenListInputFragment.on('click', '.ankenCustomerJikenRegist', function() {
				
				const customerId = /*[[*{targetCustomerId}]]*/
				
				<!--/* リクエストパラメータ */-->
				let formData = $(this)
					.closest('.ankenCustomerJikenListInputForm')
					.serializeArray();
				
				formData.push({name: "customerId", value: customerId});
				let $clickedElem = $(this)
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					url : "registAnkenCustomerJiken",
					type : "POST",
					data : formData,
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 処理成功
						
						// 親HTMLのID
						$('#ankenCustomerJikenFragmentWrap' + customerId).html(data);
						
						const msg = getAjaxProcResutlMessage(jqXHR);
						showInfoMessageForJs(msg);
						
					} else {
						// 処理失敗
						if (data) {
							// HTMLのコンテンツが返却されている場合
							// 対象行部分にHTML表示
							$clickedElem.closest('.jikenRow').html(data)
						}
						
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
				})
				.always(function(){
					ajaxRunning = false;
				});
				
			});
			
			<!--/* 事件の更新 */-->
			$ankenCustomerJikenListInputFragment.on('click', '.ankenCustomerJikenUpdate', function() {
				
				const customerId = /*[[*{targetCustomerId}]]*/
					
				<!--/* リクエストパラメータ */-->
				let formData = $(this)
					.closest('.ankenCustomerJikenListInputForm')
					.serializeArray();
				
				formData.push({name: "customerId", value: customerId});
				
				let $clickedElem = $(this)
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				ajaxRunning = true;
				
				$.ajax({
					url : 'updateAnkenCustomerJiken',
					type : "POST",
					data : formData
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 処理成功
						
						// 親HTMLのID
						$('#ankenCustomerJikenFragmentWrap' + customerId).html(data);
						
						const msg = getAjaxProcResutlMessage(jqXHR);
						showInfoMessageForJs(msg);
						
					} else {
						// 処理失敗
						
						if (data) {
							// HTMLのコンテンツが返却されている場合
							// 対象行部分にHTML表示
							$clickedElem.closest('.jikenRow').html(data)
						}
						
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
				})
				.always(function(){
					ajaxRunning = false;
				});
				
			});
		});
	</script>
	<form class="ankenCustomerJikenListInputForm" th:action="@{/user/ankenKeijiManagement/{ankenId}/registAnkenCustomerJiken(ankenId=*{targetAnkenId})}" method="post">
		
		<!--/* hidden値 */-->
		<input type="hidden" th:field="*{jikenSeq}">
		<input type="hidden" th:field="*{targetAnkenId}">
		<input type="hidden" th:field="*{targetCustomerId}">
	
		<!-- /* 事件情報入力 */ -->
		<div class="py-0 block_view_input_row block_view_input">
			<div class="detail_input_area">
				<div class="form-row">
					<div class="form-group col-md-12">
						<label class="input_parts_label">被疑事実</label>
						<input type="text" class="form-control" th:field="*{jikenName}" maxlength="100">
						<div th:if="${#fields.hasErrors('jikenName')}" th:errors="*{jikenName}" class="error_mag_point">error</div>
					</div>
				</div>

				<div class="form-row">
					<div class="form-group col-auto pr-4">
						<label class="input_parts_label">逮捕日</label>
						<input type="text" class="form-control digit7 inputDateSlash" th:id="|taihoDate*{targetCustomerId}|" maxlength="10" th:field="*{taihoDate}" th:data-click-sync="|[data-target='#taihoDate*{targetCustomerId}']|" />
						<button type="button" class="btn btn_popcal_ls m-0 hidden" data-toggle="datepicker" th:data-target="|#taihoDate*{targetCustomerId}|">カレンダー</button>
						<div th:if="${#fields.hasErrors('taihoDate')}" th:errors="*{taihoDate}" class="error_mag_point"></div>
					</div>
					<div class="form-group col-auto px-3">
						<label class="input_parts_label">勾留請求日</label>
						<input type="text" class="form-control digit7 inputDateSlash" th:id="|koryuSeikyuDate*{targetCustomerId}|" maxlength="10" th:field="*{koryuSeikyuDate}" th:data-click-sync="|[data-target='#koryuSeikyuDate*{targetCustomerId}']|" />
						<button type="button" class="btn btn_popcal_ls m-0 hidden" data-toggle="datepicker" th:data-target="|#koryuSeikyuDate*{targetCustomerId}|">カレンダー
						</button>
						<div th:if="${#fields.hasErrors('koryuSeikyuDate')}" th:errors="*{koryuSeikyuDate}" class="error_mag_point"></div>
					</div>
					<div class="form-group col-auto px-3">
						<label class="input_parts_label">満期日①</label>
						<input type="text" class="form-control digit7 inputDateSlash" th:id="|koryuExpirationDate*{targetCustomerId}|" maxlength="10" th:field="*{koryuExpirationDate}" th:data-click-sync="|[data-target='#koryuExpirationDate*{targetCustomerId}']|" />
						<button type="button" class="btn btn_popcal_ls m-0 hidden" data-toggle="datepicker" th:data-target="|#koryuExpirationDate*{targetCustomerId}|">カレンダー
						</button>
						<div th:if="${#fields.hasErrors('koryuExpirationDate')}" th:errors="*{koryuExpirationDate}" class="error_mag_point"></div>
					</div>
					<div class="form-group col-auto px-3">
						<label class="input_parts_label">満期日②</label>
						<input type="text" class="form-control digit7 inputDateSlash" th:id="|koryuExtendedExpirationDate*{targetCustomerId}|" maxlength="10" th:field="*{koryuExtendedExpirationDate}" th:data-click-sync="|[data-target='#koryuExtendedExpirationDate*{targetCustomerId}']|" />
						<button type="button" class="btn btn_popcal_ls m-0 hidden" data-toggle="datepicker" th:data-target="|#koryuExtendedExpirationDate*{targetCustomerId}|">カレンダー
						</button>
						<div th:if="${#fields.hasErrors('koryuExtendedExpirationDate')}" th:errors="*{koryuExtendedExpirationDate}" class="error_mag_point"></div>
					</div>
					<div class="form-group col-auto px-3">
						<label class="input_parts_label">処分</label>
						<select class="form-control ditit12" th:field="*{shobunType}">
							<option value="">-</option>
							<option th:each="option : *{shobunTypeOptions}"
								th:value="${option.value}" th:text="${option.label}"></option>
						</select>
						<div th:if="${#fields.hasErrors('shobunType')}" th:errors="*{shobunType}" class="error_mag_point"></div>
					</div>
					<div class="form-group col-auto px-3">
						<label class="input_parts_label">処分日</label>
						<input type="text" class="form-control digit7 inputDateSlash" th:id="|shobunDate*{targetCustomerId}|" maxlength="10" th:field="*{shobunDate}" th:data-click-sync="|[data-target='#shobunDate*{targetCustomerId}']|" />
						<button type="button" class="btn btn_popcal_ls m-0 hidden" data-toggle="datepicker" th:data-target="|#shobunDate*{targetCustomerId}|">カレンダー</button>
						<div th:if="${#fields.hasErrors('shobunDate')}" th:errors="*{shobunDate}" class="error_mag_point"></div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group col-md-12 text-right">

						<!-- /* 保存ボタン */ -->
						<button type="button" class="btn btn-info btn-sm btn_icon_save mr-4"
							data-boundary="window" th:data-container="|#ankenCustomerJikenListInputFragment*{targetCustomerId}|"
							data-toggle="tooltip" data-trigger="hover" title="保存する" th:classappend="*{jikenSeq} ? 'ankenCustomerJikenUpdate' : 'ankenCustomerJikenRegist'">
							<i class="fas fa-check"></i>保存
						</button>

						<!-- /* 閉じるボタン */ -->
						<button type="button" class="btn btn-light btn-sm editAnkenCustomerJikenClose"
							data-boundary="window" th:data-container="|#ankenCustomerJikenListInputFragment*{targetCustomerId}|"
							data-toggle="tooltip" data-trigger="hover" title="編集モードを閉じる">
							<i class="fas fa-times"></i>閉じる
						</button>

					</div>
				</div>
			</div>
		</div>
		<!-- /* 事件情報入力 end */ -->
	</form>
</div>


<!--/* ネストされるフラグメント（顧客-接見一覧表示） */-->
<div th:fragment="ankenCustomerSekkenListViewFragment(ankenCustomerSekkenDtoList, customerId, Completed)" th:id="|ankenCustomerSekkenListViewFragment${customerId.asLong()}|">
	<!--/* Script */-->
	<script th:inline="javascript">
		$(function() {
			
			// 共有の要素セットアップ処理
			commonSetUpElement();
			
			<!--/* オブジェクトのプロパティ値を取得 */-->
			const targetAnkenId = /*[[${ankenId}]]*/null;
			const targetCustomerId = /*[[${customerId.asLong()}]]*/null;
			
			<!--/* 接見の追加クリック */-->
			<!--/* 再描画を行った後に、追加用のフォームの表示を行う */-->
			$('#ankenCustomerSekkenListViewFragment' + targetCustomerId).on('click', '.addAnkenCustomerSekken', function() {
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				
				<!--/* パラメータ設定 */-->
				ajaxRunning = true;
				let dataObj = {
						ankenId: targetAnkenId,
						customerId: targetCustomerId,
						sekkenSeq: null
				}
				
				<!--/* 接見情報を再描画し、描画後、登録（追加）フォームを表示する */-->
				Promise.resolve(dataObj)
					.then(renderAnkenCustomerSekkenViewFunc)
					.then(renderAnkenCustomerSekkenRegistInputFormFunc)
					.catch((errorObj) => {
						<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
						console.log(errorObj);
					})
					.finally(() => {
						ajaxRunning = false;
					})
			})
			
			<!--/* 接見編集ボタンクリック */-->
			<!--/* 再描画を行った後に、編集用のフォームの表示を行う */-->
			$('#ankenCustomerSekkenListViewFragment' + targetCustomerId).on('click', '.ankenCustomerSekkenEdit', function() {
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				
				<!--/* パラメータ設定 */-->
				let dataObj = {
						ankenId: targetAnkenId,
						customerId: targetCustomerId,
						sekkenSeq: $(this).data('sekkenSeq')
				}
				ajaxRunning = true;
				
				<!--/* 事件情報を再描画し、描画後、対象の編集フォームを表示する */-->
				Promise.resolve(dataObj)
					.then(renderAnkenCustomerSekkenViewFunc)
					.then(renderAnkenCustomerSekkenEditInputFormFunc)
					.catch((errorObj) => {
						<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
						console.log(errorObj);
					})
					.finally(() => {
						ajaxRunning = false;
					})
			})
			
			<!--/* 接見情報の再表示関数 */-->
			const renderAnkenCustomerSekkenViewFunc = (dataObj) => {
				return new Promise((resolve, reject) => {
					
					<!--/* 事件情報の表示領域を再描画 */-->
					<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
					$.ajax({
						url : 'getAnkenCustomerSekkenListView',
						type : "GET",
						data : dataObj
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							
							// 再描画
							// 親HTMLのID
							$('#ankenCustomerSekkenFragmentWrap' + targetCustomerId).html(data);
							
							<!--/* 引数データは後続処理に渡す */-->
							resolve(dataObj);
						} else {
							// 処理失敗
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						
						reject();
					})
				});
			}
			
			<!--/* 接見の登録（追加）フォームの表示関数 */-->
			const renderAnkenCustomerSekkenRegistInputFormFunc = (dataObj) => {
				return new Promise((resolve, reject) => {
					
					<!--/* クリックされた要素の登録（追加）フォームを表示 */-->
					<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
					$.ajax({
						url : 'getAnkenCustomerSekkenListInputForm',
						type : "GET",
						data : dataObj
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 新規登録行部分にHTML表示
							let targetObj = '#ankenCustomerSekkenFragmentWrap' + targetCustomerId + ' #ankenCustomerSekkenRowForNewRegist' + targetCustomerId;
							$(targetObj).html(data);
							$(targetObj + ' #sekkenStartAt' + targetCustomerId).focus();
							
							<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
							resolve();
						} else {
							// 処理失敗
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						
						reject();
					})
				});
			}
			
			<!--/* 事件の編集フォームの表示関数 */-->
			const renderAnkenCustomerSekkenEditInputFormFunc = (dataObj) => {
				return new Promise((resolve, reject) => {
					
					<!--/* オブジェクトのプロパティ値を取得 */-->
					const {sekkenSeq} = dataObj;
					
					<!--/* クリックされた要素と同じ要素を再取得（前処理でHTMLが再描画されているため、新しいDOMから再取得を行う） */-->
					const clickedElem = $('#ankenCustomerSekkenListViewFragment' + targetCustomerId + ' .ankenCustomerSekkenEdit')
						.filter('[data-sekken-seq=' + sekkenSeq + ']');
					
					let requestData = {
							ankenId: targetAnkenId,
							customerId: targetCustomerId,
							sekkenSeq: sekkenSeq
					}
					
					<!--/* クリックされた要素の編集フォームを表示 */-->
					<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
					$.ajax({
						url : 'getAnkenCustomerSekkenListInputForm',
						type : "GET",
						data : requestData
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 対象行部分にHTML表示
							$(clickedElem).closest('.sekkenRow').html(data)
							
							<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
							resolve();
						} else {
							// 処理失敗
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						
						reject();
					})
				});
			}
			
			<!--/* 削除ボタンクリック */-->
			$('#ankenCustomerSekkenListViewFragment' + targetCustomerId).on('click', '.deleteAnkenCustomerSekken', function() {
				if (!confirm('削除します。よろしいですか？')) {
					return false;
				}
				
				let sekkenSeqVal = $(this).data('sekkenSeq');
				
				let dataObj = {
					sekkenSeq: sekkenSeqVal,
					customerId: targetCustomerId,
				}
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					type : "POST",
					url : "deleteAnkenCustomerSekken",
					data : dataObj,
					dataType: 'html',
				}).done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 親HTMLのID
						$('#ankenCustomerSekkenFragmentWrap' + targetCustomerId).html(data);
						
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showInfoMessageForJs(errorMsg);
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
				}).fail(function() {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				}).always(function(){
					ajaxRunning = false;
				});
			})
			
		});
	</script>

	<!--/* 接見一覧 */-->
	<th:block  th:if="*{ankenCustomerSekkenDtoList.size() > 0}">
		<div class="border-top-0 row row_list list_header">
			<div class="col-2">接見開始日</div>
			<div class="col-2">接見終了日</div>
			<div class="col-3">場所</div>
			<div class="col-5">備考</div>
		</div>
		<div class="row row_list sub_row sekkenRow" th:id="|sekkenRow*{sekkenSeq}|"
			th:each="sekkenDto : *{ankenCustomerSekkenDtoList}" th:object="${sekkenDto}">
			<!--/* 接見開始日 */-->
			<div class="col-2">
				<span th:text="*{sekkenStartAt}"></span>
			</div>
			<!--/* 接見終了日 */-->
			<div class="col-2">
				<span th:text="*{sekkenEndAt}"></span>
			</div>
			<!--/* 場所 */-->
			<div class="col-3">
				<span th:text="*{place}"></span>
			</div>
			<!--/* 備考 */-->
			<div class="col-4">
				<span th:text="*{remarks}"></span>
			</div>
			<!-- /* 編集ボタン */ -->
			<div class="col-1">
				<div class="d-flex">
					<button type="button" class="btn btn-light btn_icon_only btn_icon_edit btn_no_border mr-2 ankenCustomerSekkenEdit"
						data-boundary="window" th:data-container="|#sekkenRow*{sekkenSeq}|" data-toggle="tooltip" data-trigger="hover" title="編集する" 
						th:data-sekken-seq="*{sekkenSeq}">
						<i class="fas fa-edit"></i>
					</button>
					<button type="button" class="btn btn-light btn_icon_only btn_no_border deleteAnkenCustomerSekken"
						data-boundary="window" th:data-container="|#sekkenRow*{sekkenSeq}|" data-toggle="tooltip" data-trigger="hover" title="削除する" 
						th:data-sekken-seq="*{sekkenSeq}">
						<i class="far fa-trash-alt"></i>
					</button>
				</div>
			</div>
		</div>
	</th:block>
	<div th:id="|ankenCustomerSekkenRowForNewRegist*{customerId.asLong()}|" class="sekkenRow">
	</div>
	
	<!--/* 接見を追加 */-->
	<div class="add_row_area" th:unless="*{T(jp.loioz.common.constant.CommonConstant).SEKKEN_ADD_LIMIT <= ankenCustomerSekkenDtoList?.size()}">
		<a href="javascript:void(0);" class="addAnkenCustomerSekken">
			<i class="fas fa-plus-square mr-2"></i>接見を追加
		</a>
	</div>
</div>

<!--/* ネストされるフラグメント(顧客-接見入力) */-->
<div th:fragment="ankenCustomerSekkenListInputFragment" th:object="${ankenCustomerSekkenListInputForm}" th:id="|ankenCustomerSekkenListInputFragment*{targetCustomerId}|" class="w-100">
	
	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {
		
		// 共有の要素セットアップ処理
		commonSetUpElement();
		
		// dateTimePicker
		$.datetimepicker.setLocale('ja');
		$(".dateTimePicker").datetimepicker({
			step:15,
		});
		
		const $ankenCustomerSekkenListInputFragment = $("#ankenCustomerSekkenListInputFragment" + /*[[*{targetCustomerId}]]*/"")
		
		<!--/* 接見の編集を閉じる（表示モードの表示に切り替える） */-->
		$ankenCustomerSekkenListInputFragment.on('click', '.editAnkenCustomerSekkenClose', function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			const ankenId = /*[[*{targetAnkenId}]]*/;
			const customerId = /*[[*{targetCustomerId}]]*/;
			let dataObj = {
					ankenId: ankenId,
					customerId: customerId
			}
			ajaxRunning = true;
			$.ajax({
				url : 'getAnkenCustomerSekkenListView',
				type : "GET",
				data : dataObj, 
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 親HTMLのID
					$('#ankenCustomerSekkenFragmentWrap' + customerId).html(data);
					
				} else {
					// 処理失敗
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
			})
			.always(function(){
				ajaxRunning = false;
			});
		});
		
		<!--/* 接見の新規登録 */-->
		$ankenCustomerSekkenListInputFragment.on('click', '.ankenCustomerSekkenRegist', function() {
			
			const customerId = /*[[*{targetCustomerId}]]*/
			
			<!--/* リクエストパラメータ */-->
			let formData = $(this)
				.closest('.ankenCustomerSekkenListInputForm')
				.serializeArray();
			
			formData.push({name: "customerId", value: customerId});
			let $clickedElem = $(this)
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			$.ajax({
				url : "registAnkenCustomerSekken",
				type : "POST",
				data : formData,
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					
					// 親HTMLのID
					$('#ankenCustomerSekkenFragmentWrap' + customerId).html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					// 処理失敗
					if (data) {
						// HTMLのコンテンツが返却されている場合
						// 対象行部分にHTML表示
						$clickedElem.closest('.sekkenRow')
						$clickedElem.closest('.sekkenRow').html(data)
					}
					
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
		});
		
		<!--/* 接見の更新 */-->
		$ankenCustomerSekkenListInputFragment.on('click', '.ankenCustomerSekkenUpdate', function() {
			
			const customerId = /*[[*{targetCustomerId}]]*/
				
			<!--/* リクエストパラメータ */-->
			let formData = $(this)
				.closest('.ankenCustomerSekkenListInputForm')
				.serializeArray();
			
			formData.push({name: "customerId", value: customerId});
			
			let $clickedElem = $(this)
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			$.ajax({
				url : 'updateAnkenCustomerSekken',
				type : "POST",
				data : formData
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					
					// 親HTMLのID
					$('#ankenCustomerSekkenFragmentWrap' + customerId).html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					// 処理失敗
					
					if (data) {
						// HTMLのコンテンツが返却されている場合
						// 対象行部分にHTML表示
						$clickedElem.closest('.sekkenRow').html(data)
					}
					
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
			
		});
	});
	</script>
	
	<form class="ankenCustomerSekkenListInputForm">
	
		<!--/*hidden値*/-->
		<input type="hidden" th:field="*{sekkenSeq}">
		<input type="hidden" th:field="*{targetAnkenId}">
		<input type="hidden" th:field="*{targetCustomerId}">
		
		<!-- /* 接見情報入力 */ -->
		<div class="py-0 block_view_input_row block_view_input">
			<div class="detail_input_area">
				<div class="form-row">
					
					<div class="form-group col-auto pr-4">
						<label class="input_parts_label">接見開始日</label>
						<input type="text" class="form-control digit10 dateTimePicker" th:id="|sekkenStartAt*{targetCustomerId}|" th:field="*{sekkenStartAt}" maxlength="16">
						<div th:if="*{#fields.hasErrors('sekkenStartAt')}" th:errors="*{sekkenStartAt}" class="error_mag_point"></div>
					</div>
					
					<div class="form-group col-auto pr-4">
						<label class="input_parts_label">接見終了日</label>
						<input type="text" class="form-control digit10 dateTimePicker" th:id="|sekkenEndAt*{targetCustomerId}|" th:field="*{sekkenEndAt}" maxlength="16">
						<div th:if="*{#fields.hasErrors('sekkenEndAt')}" th:errors="*{sekkenEndAt}" class="error_mag_point"></div>
					</div>
					
					<div class="form-group col-auto pr-4">
						<label class="input_parts_label">場所</label>
						<input type="text" class="form-control digit20" maxlength="100" th:field="*{place}">
						<div th:if="*{#fields.hasErrors('place')}" th:errors="*{place}" class="error_mag_point"></div>
					</div>
					
					<div class="form-group col-auto pr-4">
						<label class="input_parts_label">備考</label>
						<input type="text" class="form-control digit20" maxlength="100" th:field="*{remarks}">
						<div th:if="*{#fields.hasErrors('remarks')}" th:errors="*{remarks}" class="error_mag_point"></div>
					</div>
					
				</div>
				<div class="form-row">
					<div class="form-group col-12 text-right">
						<!-- /* 保存ボタン */ -->
						<button type="button" class="btn btn-info btn-sm btn_icon_save mr-4"
							data-boundary="window" th:data-container="|#ankenCustomerSekkenListInputFragment*{targetCustomerId}|"
							data-toggle="tooltip" data-trigger="hover" title="保存する" th:classappend="*{sekkenSeq} ? 'ankenCustomerSekkenUpdate' : 'ankenCustomerSekkenRegist'">
							<i class="fas fa-check"></i>保存
						</button>
						<!-- /* 閉じるボタン */ -->
						<button type="button" class="btn btn-light btn-sm editAnkenCustomerSekkenClose"
							data-boundary="window" th:data-container="|#ankenCustomerSekkenListInputFragment*{targetCustomerId}|"
							data-toggle="tooltip" data-trigger="hover" title="閉じる">
							<i class="fas fa-times"></i>閉じる
						</button>
				</div>
			</div>
		</div>
	
	</form>
	
</div>

<!--/* ネストされるフラグメント（顧客-在監一覧） */-->
<div th:fragment="ankenCustomerZaikanListViewFragment(ankenCustomerZaikanDtoList, customerId, Completed)" th:id="|ankenCustomerZaikanListViewFragment${customerId.asLong()}|">
	<script th:inline="javascript">
	$(function() {
		
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();
		
		<!--/* オブジェクトのプロパティ値を取得 */-->
		const targetAnkenId = /*[[${ankenId}]]*/null;
		const targetCustomerId = /*[[${customerId.asLong()}]]*/null;
		
		<!--/* 在監の追加クリック */-->
		<!--/* 再描画を行った後に、追加用のフォームの表示を行う */-->
		$('#ankenCustomerZaikanListViewFragment' + targetCustomerId).on('click', '.addAnkenCustomerZaikan', function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			<!--/* パラメータ設定 */-->
			ajaxRunning = true;
			let dataObj = {
					ankenId: targetAnkenId,
					customerId: targetCustomerId,
					koryuSeq: null
			}
			
			<!--/* 在監情報を再描画し、描画後、登録（追加）フォームを表示する */-->
			Promise.resolve(dataObj)
				.then(renderAnkenCustomerZaikanViewFunc)
				.then(renderAnkenCustomerZaikanRegistInputFormFunc)
				.catch((errorObj) => {
					<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
					console.log(errorObj);
				})
				.finally(() => {
					ajaxRunning = false;
				})
			
		});
		
		<!--/* 在監編集ボタンクリック */-->
		<!--/* 再描画を行った後に、編集用のフォームの表示を行う */-->
		$('#ankenCustomerZaikanListViewFragment' + targetCustomerId).on('click', '.editAnkenCustomerZaikan', function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			<!--/* パラメータ設定 */-->
			let dataObj = {
					ankenId: targetAnkenId,
					customerId: targetCustomerId,
					koryuSeq: $(this).data('koryuSeq')
			}
			ajaxRunning = true;
			
			<!--/* 在監情報を再描画し、描画後、対象の編集フォームを表示する */-->
			Promise.resolve(dataObj)
				.then(renderAnkenCustomerZaikanViewFunc)
				.then(renderAnkenCustomerZaikanEditInputFormFunc)
				.catch((errorObj) => {
					<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
					console.log(errorObj);
				})
				.finally(() => {
					ajaxRunning = false;
				})
			
		});
		
		<!--/* 在監情報の再表示関数 */-->
		const renderAnkenCustomerZaikanViewFunc = (dataObj) => {
			return new Promise((resolve, reject) => {

				<!--/* 在監情報の表示領域を再描画 */-->
				<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
				$.ajax({
					url : 'getAnkenCustomerZaikanListView',
					type : "GET",
					data : dataObj
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						
						<!--/* 再描画 */-->
						<!--/* 親HTMLのID */-->
						$('#ankenCustomerZaikanFragmentWrap' + targetCustomerId).html(data);
						
						<!--/* 引数データは後続処理に渡す */-->
						resolve(dataObj);
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						reject([errorMsg]);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
					reject([jqXHR, status, errorThrown]);
				})
			});
		}
		
		<!--/* 在監の登録（追加）フォームの表示関数 */-->
		const renderAnkenCustomerZaikanRegistInputFormFunc = (dataObj) => {
			return new Promise((resolve, reject) => {
				
				<!--/* クリックされた要素の登録（追加）フォームを表示 */-->
				<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
				$.ajax({
					url : 'getAnkenCustomerZaikanListInputForm',
					type : "GET",
					data : dataObj
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* 新規登録行部分にHTML表示 */-->
						let targetObj = '#ankenCustomerZaikanFragmentWrap'  + targetCustomerId + ' #ankenCustomerZaikanRowForNewRegist' + targetCustomerId;
						$(targetObj).html(data);
						$(targetObj + ' #zaikanDate' + targetCustomerId).focus();
						
						<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
						resolve();
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						reject([errorMsg]);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
					reject([jqXHR, status, errorThrown]);
				})
			});
		}
		
		<!--/* 在監の編集フォームの表示関数 */-->
		const renderAnkenCustomerZaikanEditInputFormFunc = (dataObj) => {
			return new Promise((resolve, reject) => {
				
				<!--/* オブジェクトのプロパティ値を取得 */-->
				const {koryuSeq} = dataObj;
				
				<!--/* クリックされた要素と同じ要素を再取得（前処理でHTMLが再描画されているため、新しいDOMから再取得を行う） */-->
				const clickedElem = $('#ankenCustomerZaikanListViewFragment' + targetCustomerId + ' .editAnkenCustomerZaikan')
					.filter('[data-koryu-seq=' + koryuSeq + ']');
				
				let requestData = {
						ankenId: targetAnkenId,
						customerId: targetCustomerId,
						koryuSeq: koryuSeq
				}
				
				<!--/* クリックされた要素の編集フォームを表示 */-->
				<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
				$.ajax({
					url : 'getAnkenCustomerZaikanListInputForm',
					type : "GET",
					data : requestData
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* 対象行部分にHTML表示 */-->
						$(clickedElem).closest('.zaikanRow').html(data)
						
						<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
						resolve();
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						reject([errorMsg]);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
					reject([jqXHR, status, errorThrown]);
				})
			});
		}
		
		<!--/* 削除ボタンクリック */-->
		$('#ankenCustomerZaikanListViewFragment' + targetCustomerId).on('click', '.deleteAnkenCustomerZaikan', function() {
			if (!confirm('削除します。よろしいですか？')) {
				return false;
			}
			
			let koryuSeqVal = $(this).data("koryuSeq");
			let dataObj = {
				koryuSeq: koryuSeqVal,
				customerId: targetCustomerId,
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			$.ajax({
				type : "POST",
				url : "deleteAnkenCustomerZaikan",
				data : dataObj,
				dataType: 'html',
			}).done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 親HTMLのID */-->
					$('#ankenCustomerZaikanFragmentWrap' + targetCustomerId).html(data);
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(errorMsg);
					
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			}).fail(function() {
				showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
			}).always(function(){
				ajaxRunning = false;
			});
		});

	});
	</script>
	
	<div class="border-top-0 row row_list list_header" th:if="${ankenCustomerZaikanDtoList.size() > 0}">
		<div class="col-2">在監/移送日</div>
		<div class="col-2">保釈/釈放/移送日</div>
		<div class="col-2">在監場所</div>
		<div class="col-2">電話番号</div>
		<div class="col-3">備考</div>
		<div class="col-1"></div>
	</div>
	<div class="row row_list sub_row zaikanRow" th:each="zaikanDto : ${ankenCustomerZaikanDtoList}" th:object="${zaikanDto}"
	 	th:id="|zaikanRow*{koryuSeq}|">
		<!--/* 在監日/移送日 */-->
		<div class="col-2">
			<span th:text="*{getKoryuDateStr()}"></span>
		</div>
		<!--/* 保釈/釈放/移送日 */-->
		<div class="col-2">
			<span th:text="*{getHoshakuDateStr()}"></span>
		</div>
		<!--/* 在監場所 */-->
		<div class="col-2">
			<span th:text="*{koryuPlaceName}"></span>
		</div>
		<!--/* 電話番号 */-->
		<div class="col-2">
			<span th:text="*{sosakikanTelNo}"></span>
		</div>
		<!--/* 備考 */-->
		<div class="col-3">
			<span th:text="*{remarks}"></span>
		</div>
		<!-- /* 編集ボタン */ -->
		<div class="col-1">
			<div class="d-flex">
				<button type="button" class="btn btn-light btn_icon_only btn_icon_edit btn_no_border mr-2 editAnkenCustomerZaikan"
					data-boundary="window" th:data-container="|#zaikanRow*{koryuSeq}|" data-toggle="tooltip" data-trigger="hover" title="編集する" 
					th:data-koryu-seq="*{koryuSeq}">
					<i class="fas fa-edit"></i>
				</button>
				<button type="button" class="btn btn-light btn_icon_only btn_no_border deleteAnkenCustomerZaikan"
					data-boundary="window" th:data-container="|#zaikanRow*{koryuSeq}|" data-toggle="tooltip" data-trigger="hover" title="削除する" 
					th:data-koryu-seq="*{koryuSeq}">
					<i class="far fa-trash-alt"></i>
				</button>
			</div>
		</div>
	</div>
	<div th:id="|ankenCustomerZaikanRowForNewRegist${customerId.asLong()}|" class="zaikanRow">
	</div>
	<div class="add_row_area" th:unless="*{T(jp.loioz.common.constant.CommonConstant).ZAIKAN_ADD_LIMIT <= ankenCustomerZaikanDtoList?.size()}">
		<a href="javascript:void(0);" class="addAnkenCustomerZaikan">
			<i class="fas fa-plus-square mr-2"></i>在監場所を追加
		</a>
	</div>
	
</div>

<!--/* ネストされるフラグメント（顧客-在監入力） */-->
<div th:fragment="ankenCustomerZaikanListInputFragment" th:object="${ankenCustomerZaikanListInputForm}" th:id="|ankenCustomerZaikanListInputFragment*{targetCustomerId}|" class="w-100">
	
	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {

		const $ankenCustomerZaikanListInputFragment = $("#ankenCustomerZaikanListInputFragment"+ /*[[*{targetCustomerId}]]*/"");

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();
		
		<!--/* 捜査機関名 */-->
		$ankenCustomerZaikanListInputFragment.on('change', '.sosakikanName', function() {
			
			const sosakikanNameVal = $(this).val();
			const $option = $ankenCustomerZaikanListInputFragment.find('[id^="sosakikanDatalist"] option[value="'+ sosakikanNameVal +'"]');
			
			if ($option.length) {
				$ankenCustomerZaikanListInputFragment.find('.sosakikanId').val($option.data("id"))
				<!--/* 電話番号の自動反映処理 */-->
				$ankenCustomerZaikanListInputFragment.find('.sosakikanTelNo').val($option.data("tel"))
			} else {
				$ankenCustomerZaikanListInputFragment.find('.sosakikanId').val("");
			}
		});
		
		<!--/* 在監場所編集を閉じる（表示モードの表示に切り替える） */-->
		$ankenCustomerZaikanListInputFragment.on("click", ".editAnkenCustomerZaikanClose", function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			const ankenId = /*[[*{targetAnkenId}]]*/;
			const customerId = /*[[*{targetCustomerId}]]*/;
			let dataObj = {
					ankenId: ankenId,
					customerId: customerId
			}
			ajaxRunning = true;
			$.ajax({
				url : 'getAnkenCustomerZaikanListView',
				type : "GET",
				data : dataObj, 
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 親HTMLのID */-->
					$('#ankenCustomerZaikanFragmentWrap' + customerId).html(data);
					
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
			})
			.always(function(){
				ajaxRunning = false;
			});
		});
		
		<!--/* 在監の新規登録 */-->
		$ankenCustomerZaikanListInputFragment.on("click", ".ankenCustomerZaikanRegist", function() {
			
			const customerId = /*[[*{targetCustomerId}]]*/"";
			
			<!--/* リクエストパラメータ */-->
			let formData = $(this)
				.closest('.ankenCustomerZaikanListInputForm')
				.serializeArray();
			
			formData.push({name: "customerId", value: customerId});
			let $clickedElem = $(this)
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			$.ajax({
				url : "registAnkenCustomerZaikan",
				type : "POST",
				data : formData,
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					
					<!--/* 親HTMLのID */-->
					$('#ankenCustomerZaikanFragmentWrap' + customerId).html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					<!--/* 処理失敗 */-->
					if (data) {
						<!--/* HTMLのコンテンツが返却されている場合 */-->
						<!--/* 対象行部分にHTML表示 */-->
						$clickedElem.closest('.zaikanRow')
						$clickedElem.closest('.zaikanRow').html(data)
					}
					
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
			
		});
		
		<!--/* 在監の更新登録 */-->
		$ankenCustomerZaikanListInputFragment.on("click", ".ankenCustomerZaikanUpdate", function() {
			
			const customerId = /*[[*{targetCustomerId}]]*/"";
			
			<!--/* リクエストパラメータ */-->
			let formData = $(this)
				.closest('.ankenCustomerZaikanListInputForm')
				.serializeArray();
			
			formData.push({name: "customerId", value: customerId});
			let $clickedElem = $(this)
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			$.ajax({
				url : "updateAnkenCustomerZaikan",
				type : "POST",
				data : formData,
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					
					<!--/* 親HTMLのID */-->
					$('#ankenCustomerZaikanFragmentWrap' + customerId).html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					<!--/* 処理失敗 */-->
					if (data) {
						<!--/* HTMLのコンテンツが返却されている場合 */-->
						<!--/* 対象行部分にHTML表示 */-->
						$clickedElem.closest('.zaikanRow')
						$clickedElem.closest('.zaikanRow').html(data)
					}
					
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
			
		});

		<!--/* 在監場所名入力時、datalistを設定する */-->
		<!--/* Chromeでは未入力の状態でdatalistをクリックすると、全件リストを表示しようとするため文字入力時にのみdatalistをセットするようにする */-->
		$ankenCustomerZaikanListInputFragment.on('input', '.sosakikanName', function(){
			if ($(this).val()) {
				$(this).attr('list', 'sosakikanDatalist' + /*[[*{targetCustomerId}]]*/);
			} else {
				<!--/* Safariの場合は、文字入力前にdatalistを設定する必要があるため */-->
				if (isMacSafari()){
					$(this).attr('list', 'sosakikanDatalist' + /*[[*{targetCustomerId}]]*/);
				} else {
					$(this).removeAttr('list');
				}
			}
		});

		<!--/* 在監場所名クリック時、裁判所名が既に入力済の場合はdatalistを設定する */-->
		<!--/* Chromeでは未入力の状態でdatalistをクリックすると、全件リストを表示しようとするため文字入力時にのみdatalistをセットするようにする */-->
		$ankenCustomerZaikanListInputFragment.on('click', '.sosakikanName', function(){
			if ($(this).val()) {
				$(this).attr('list', 'sosakikanDatalist' + /*[[*{targetCustomerId}]]*/);
			} else {
				<!--/* Safariの場合は、文字入力前にdatalistを設定する必要があるためクリック時でもdatalistをセットする */-->
				if (isMacSafari()){
					$(this).attr('list', 'sosakikanDatalist' + /*[[*{targetCustomerId}]]*/);
				}
			}
		});

	});
	</script>
	<form class="ankenCustomerZaikanListInputForm">
	
		<!--/* hidden値 */-->
		<input type="hidden" th:field="*{koryuSeq}">
		<input type="hidden" th:field="*{targetAnkenId}">
		<input type="hidden" th:field="*{targetCustomerId}">
		<input type="hidden" class="sosakikanId" th:field="*{sosakikanId}">
		
		<!-- /* 在監情報入力 */ -->
		<div class="py-0 block_view_input_row block_view_input">
			<div class="detail_input_area">
				<div class="form-row">
					
					<div class="form-group col-auto pr-4">
						<label class="input_parts_label">在監/移送日</label>
						<input type="text" class="form-control digit7 inputDateSlash" th:id="|zaikanDate*{targetCustomerId}|" maxlength="10" th:field="*{zaikanDate}" th:data-click-sync="|[data-target='#zaikanDate*{targetCustomerId}']|">
						<button type="button" class="btn btn_popcal_ls m-0 hidden" data-toggle="datepicker" th:data-target="|#zaikanDate*{targetCustomerId}|">カレンダー</button>
						<div th:if="${#fields.hasErrors('zaikanDate')}" th:errors="*{zaikanDate}" class="error_mag_point"></div>
					</div>
					
					<div class="form-group col-auto pr-4">
						<label class="input_parts_label">保釈/釈放/移送日</label>
						<input type="text" class="form-control digit7 inputDateSlash" th:id="|hoshakuDate*{targetCustomerId}|" maxlength="10" th:field="*{hoshakuDate}" th:data-click-sync="|[data-target='#hoshakuDate*{targetCustomerId}']|">
						<button type="button" class="btn btn_popcal_ls m-0 hidden" data-toggle="datepicker" th:data-target="|#hoshakuDate*{targetCustomerId}|">カレンダー</button>
						<div th:if="${#fields.hasErrors('hoshakuDate')}" th:errors="*{hoshakuDate}" class="error_mag_point"></div>
					</div>
					
					<div class="form-group col-auto pr-4">
						<label class="input_parts_label">在監場所</label>
						<input type="text" class="form-control digit18 sosakikanName" th:field="*{zaikanPlace}" maxlength="100" autocomplete="off">
						<div th:if="${#fields.hasErrors('zaikanPlace')}" th:errors="*{zaikanPlace}" class="error_mag_point"></div>
					</div>
					
					<div class="form-group col-auto pr-4">
						<label class="input_parts_label">電話番号</label>
						<input type="tel" class="form-control input_num_hyphen digit8 sosakikanTelNo" th:field="*{telNo}" maxlength="20">
						<div th:if="${#fields.hasErrors('telNo')}" th:errors="*{telNo}" class="error_mag_point"></div>
					</div>
					
					<div class="form-group col-auto pr-4">
						<label class="input_parts_label">備考</label>
						<input type="text" class="form-control digit18" th:field="*{remarks}" maxlength="100">
						<div th:if="*{#fields.hasErrors('remarks')}" th:errors="*{remarks}" class="error_mag_point"></div>
					</div>
					
				</div>
				<div class="form-row">
					<div class="form-group col-12 text-right">
						<!-- /* 保存ボタン */ -->
						<button type="button" class="btn btn-info btn-sm btn_icon_save mr-4"
							data-boundary="window" th:data-container="|#ankenCustomerZaikanListInputFragment*{targetCustomerId}|"
							data-toggle="tooltip" data-trigger="hover" title="保存する" th:classappend="*{koryuSeq} ? 'ankenCustomerZaikanUpdate' : 'ankenCustomerZaikanRegist'">
							<i class="fas fa-check"></i>保存
						</button>
						<!-- /* 閉じるボタン */ -->
						<button type="button" class="btn btn-light btn-sm editAnkenCustomerZaikanClose"
							data-boundary="window" th:data-container="|#ankenCustomerZaikanListInputFragment*{targetCustomerId}|"
							data-toggle="tooltip" data-trigger="hover" title="閉じる">
							<i class="fas fa-times"></i>閉じる
						</button>
					</div>
				</div>
				
			</div>
		</div>
		
		<datalist th:id="|sosakikanDatalist*{targetCustomerId}|">
			<option th:each="option : *{sosakikanSelectOptionDto}" th:value="${option.sosakikanName}" th:data-id="${option.sosakikanId}"
				th:data-tel="${option.sosakikanTelNo}" th:data-fax="${option.sosakikanFaxNo}"></option>
		</datalist>
	
	</form>
</div>

<!-- /* 捜査機関一覧 */ -->
<div th:fragment="ankenSosakikanListViewFragment(ankenSosakikanListViewForm)" id="ankenSosakikanListViewFragment" th:object="${ankenSosakikanListViewForm}">

	<!--/* Script */-->
	<script th:inline="javascript">
		$(function() {

			<!--/* 共有の要素セットアップ処理 */-->
			commonSetUpElement();
			
			<!--/* 捜査機関の削除処理 */-->
			$('#ankenSosakikanListViewFragment .deleteSosakikan').on('click', function() {
				if (!confirm("捜査機関情報を削除します。よろしいですか？")) {
					return false;
				}
				
				let sosakikanSeqVal = $(this).data('sosakikan-seq');
				
				<!--/* リクエストパラメータ */-->
				let dataObj = {
					sosakikanSeq: sosakikanSeqVal
				}
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteSosakikan(ankenId=${ankenId})}]]*/,
					type : "POST",
					data : dataObj
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* 処理成功 */-->
						
						<!--/* 親HTMLのID */-->
						$('#ankenSosakikanListFragmentWrap').html(data);
						
						const msg = getAjaxProcResutlMessage(jqXHR);
						showInfoMessageForJs(msg);
						
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
				})
				.always(function(){
					ajaxRunning = false;
				});
			});

			<!--/* 捜査機関の追加クリック */-->
			<!--/* 再描画を行った後に、追加用のフォームの表示を行う */-->
			$('#ankenSosakikanListViewFragment .addSosakikan').on('click', function() {
				
				let dataObj = {
						sosakikanSeq: null
				}
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				
				ajaxRunning = true;
				
				<!--/* 捜査機関情報を再描画し、描画後、登録（追加）フォームを表示する */-->
				Promise.resolve(dataObj)
					.then(renderSosakikanViewFunc)
					.then(renderSosakikanRegistInputFormFunc)
					.catch((errorObj) => {
						<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
						console.log(errorObj);
					})
					.finally(() => {
						ajaxRunning = false;
					})
			})
			
			<!--/* 捜査機関編集ボタンクリック */-->
			<!--/* 再描画を行った後に、編集用のフォームの表示を行う */-->
			$('#ankenSosakikanListViewFragment .editSosakikan').on('click', function() {
				
				let sosakikanSeqVal = $(this).data('sosakikan-seq');
				
				let dataObj = {
					sosakikanSeq: sosakikanSeqVal
				}
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				
				ajaxRunning = true;
				
				<!--/* 捜査機関情報を再描画し、描画後、対象の編集フォームを表示する */-->
				Promise.resolve(dataObj)
					.then(renderSosakikanViewFunc)
					.then(renderSosakikanEditInputFormFunc)
					.catch((errorObj) => {
						<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
						console.log(errorObj);
					})
					.finally(() => {
						ajaxRunning = false;
					})
			})
			
			<!--/* 捜査機関情報の再表示関数 */-->
			const renderSosakikanViewFunc = (dataObj) => {
				return new Promise((resolve, reject) => {
					
					<!--/* 捜査機関情報の表示領域を再描画 */-->
					<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
					$.ajax({
						url : 'getAnkenSosakikanListView',
						type : "GET"
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							
							<!--/* 再描画 */-->
							<!--/* 親HTMLのID */-->
							$('#ankenSosakikanListFragmentWrap').html(data);
							
							<!--/* 引数データは後続処理に渡す */-->
							resolve(dataObj);
						} else {
							<!--/* 処理失敗 */-->
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						
						reject();
					})
				});
			}
			
			<!--/* 捜査機関の登録（追加）フォームの表示関数 */-->
			const renderSosakikanRegistInputFormFunc = (dataObj) => {
				return new Promise((resolve, reject) => {
					
					<!--/* オブジェクトのプロパティ値を取得 */-->
					const {sosakikanSeq} = dataObj;
					
					let requestData = {
						sosakikanSeq: sosakikanSeq,
					}
					
					<!--/* クリックされた要素の登録（追加）フォームを表示 */-->
					<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
					$.ajax({
						url : 'getAnkenSosakikanListInputForm',
						type : "GET",
						data : requestData
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 新規登録行部分にHTML表示 */-->
							$('#ankenSosakikanListViewFragment #sosakikanRowForNewRegist').html(data);
							
							<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
							resolve();
						} else {
							<!--/* 処理失敗 */-->
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						
						reject();
					})
				});
			}
			
			<!--/* 捜査機関の編集フォームの表示関数 */-->
			const renderSosakikanEditInputFormFunc = (dataObj) => {
				return new Promise((resolve, reject) => {
					
					<!--/* オブジェクトのプロパティ値を取得 */-->
					const {sosakikanSeq} = dataObj;
					
					<!--/* クリックされた要素と同じ要素を再取得（前処理でHTMLが再描画されているため、新しいDOMから再取得を行う） */-->
					const clickedElem = $('#ankenSosakikanListViewFragment .editSosakikan')
						.filter('[data-sosakikan-seq=' + sosakikanSeq + ']');
					
					let requestData = {
						sosakikanSeq: sosakikanSeq
					}
					
					<!--/* クリックされた要素の編集フォームを表示 */-->
					<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
					$.ajax({
						url : 'getAnkenSosakikanListInputForm',
						type : "GET",
						data : requestData
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 対象行部分にHTML表示 */-->
							$(clickedElem).closest('.sosakikanRow').html(data)
							
							<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
							resolve();
						} else {
							<!--/* 処理失敗 */-->
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							
							reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						
						reject();
					})
				});
			}
			
			<!--/* 捜査機関送付署 */-->
			$('#ankenSosakikanListViewFragment').on('click', '.downloadBtn', function() {
				
				const button = $(this);
				const postUrl = "/user/ankenManagement/souhusho/outputSouhushoSosakikan";
				
				const outPutContainer = $($(this).data("target"));
				const sosakikanSeq = outPutContainer.data("sosakikanSeq");
				const souhushoType = $(this).data("souhushoType");
				const params = [
					{name : "ankenId", value :/*[[${ankenId}]]*/""},
					{name : "souhushoType", value :souhushoType},
					{name : "sosakikanSeq", value :sosakikanSeq}
				];

				<!--/* 送付書出力 */-->
				downloadFileAjax(postUrl, button, params);
				
			});
			
		});
	</script>

	<section class="section_border">
		<div class="section_header">
			<div class="section_header__title">捜査機関</div>
			<div class="section_header__action">
				<!--/* 新規追加 */-->
				<a th:unless="*{T( jp.loioz.common.constant.CommonConstant).KEIJI_SOSAKIKAN_ADD_LIMIT <= ankenSosakikanDtoList?.size()}"
					href="javascript:void(0);" class="addSosakikan fs15">
					<i class="fas fa-plus-square mr-2"></i>捜査機関を追加
				</a>
			</div>
		</div>
		<div class="section_body">
			<div class="section_body__contents p-0">
			
	<th:block th:if="*{#lists.isEmpty(ankenSosakikanDtoList)}">
				<div class="no_data_msg" id="sosakikanRowForNewRegist">
					<div class="sosakikanRow">
						<span th:text="#{I00035('捜査機関情報の登録')}">MSG_I00035</span>
					</div>
				</div>
	</th:block>

	<th:block th:unless="*{#lists.isEmpty(ankenSosakikanDtoList)}">
				<ul class="section_list pt-2">
					<li class="list_haed p-0">
						<div id="sosakikanRowForNewRegist" class="sosakikanRow"></div>
					</li>
					<li class="list_contents sosakikanRow" th:id="|sosakikanRow*{sosakikanSeq}|" th:each="ankenSosakikan : *{ankenSosakikanDtoList}" th:object="${ankenSosakikan}">
						<div class="section_list_item_wrap">
							<div class="section_list_item">
								<div class="item_title_block">
									<!--/* 名前 */-->
									<div>
										<span class="fs19 fw600" th:text="*{sosakikanName}">捜査機関名</span>
										<span th:text="*{sosakikanTantoBu}"></span>
										<span th:text="*{sosakikanRoomNo}"></span>
									</div>
									
									<!-- /* ボタンエリア */ -->
									<div class="item_sub d-flex">
										<!--/* 送付書 ダウンロードボタン */-->
										<div th:id="|sosakikanOutPutContainer*{sosakikanSeq}|" class="d-inline-block stop-events outPutContainerClose" th:data-sosakikan-seq="*{sosakikanSeq}"
											data-offset="-80,0" data-boundary="window" th:data-container="|#sosakikanRow*{sosakikanSeq}|" data-toggle="popover" data-placement="bottom" data-html="true" th:data-content=
											'|<ul class="output_nav_list">
													<li><button class="btn btn-light downloadBtn" data-target="#sosakikanOutPutContainer*{sosakikanSeq}" data-souhusho-type="${T(jp.loioz.common.constant.CommonConstant$SouhushoType).IPPAN.getCd()}"><i class="fas fa-download text-primary mr-3"></i><i class="fas fa-spinner mr-3 text-primary faa-spin animated hidden"></i>一般送付書を出力する</button></li>
													<li><button class="btn btn-light downloadBtn" data-target="#sosakikanOutPutContainer*{sosakikanSeq}" data-souhusho-type="${T(jp.loioz.common.constant.CommonConstant$SouhushoType).FAX_USE.getCd()}"><i class="fas fa-download text-primary mr-3"></i><i class="fas fa-spinner mr-3 text-primary faa-spin animated hidden"></i>FAX送付書を出力する</button></li>
											</ul>|'>
											<button type=button class="btn btn-light btn_icon_arrow mr-3"
												data-boundary="window" th:data-container="|#sosakikanRow*{sosakikanSeq}|" data-toggle="tooltip" data-trigger="hover" title="ダウンロード">
												<i class="far fa-file-alt fa-lg"></i><i class="fas fa-chevron-down mr-0"></i>
											</button>
										</div>
										
										<!--/* 捜査機関 編集ボタン */-->
										<div data-boundary="window" th:data-container="|#sosakikanRow*{sosakikanSeq}|" data-toggle="tooltip" data-trigger="hover" title="編集する">
											<button type="button" class="btn btn-light btn_icon_only mr-3 btn_icon_edit editSosakikan" th:data-sosakikan-seq="*{sosakikanSeq}">
												<i class="fas fa-edit"></i>
											</button>
										</div>
										
										<!--/* 捜査機関 削除ボタン */-->
										<div data-boundary="window" th:data-container="|#sosakikanRow*{sosakikanSeq}|" data-toggle="tooltip" data-trigger="hover" title="削除する">
											<button type="button" class="btn btn-light btn_icon_only deleteSosakikan" th:data-sosakikan-seq="*{sosakikanSeq}">
												<i class="far fa-trash-alt"></i>
												</button>
										</div>
										
									</div>
								</div>
								<!--/* データブロック */-->
								<div class="item_content_block">
									<div class="row">
										<!--/* 担当① */-->
										<div class="data_block col-md-2">
											<label>担当①</label>
											<div class="data_content">
												<span th:text="*{tantosha1Name}"></span>
											</div>
										</div>
										<!--/* 担当② */-->
										<div class="data_block col-md-2">
											<label>担当②</label>
											<div class="data_content">
												<span th:text="*{tantosha2Name}"></span>
											</div>
										</div>
										<!--/* TEL・FAX・備考 */-->
										<div class="data_block col-md-2">
											<label>TEL</label>
											<div class="data_content">
												<span th:text="*{sosakikanTelNo}"></span>
												<span class="d-inline-block sub_text">(内線)</span>
												<span th:text="*{sosakikanExtensionNo}"></span>
											</div>
										</div>
										<!--/* FAX */-->
										<div class="data_block col-md-2">
											<label>FAX</label>
											<div class="data_content">
												<span th:text="*{sosakikanFaxNo}"></span>
											</div>
										</div>
										<!--/* 備考 */-->
										<div class="data_block col-md-4">
											<label>備考</label>
											<div class="data_content">
												<div myth:nl2br="*{remarks}"></div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</li>
				</ul>
			</th:block>
			</div>
		</div>
	</section>

</div>

<!--/* ネストされるフラグメント（捜査機関入力） */-->
<div th:fragment="ankenSosakikanListInputFragment" id="ankenSosakikanListInputFragment" class="w-100"
	th:with="isNew=${ankenSosakikanListInputForm.sosakikanSeq == null}">

	<!--/* Script */-->
	<script th:inline="javascript">
		$(function() {
			<!--/* 共有の要素セットアップ処理 */-->
			commonSetUpElement();
			
			<!--/* 捜査機関名 */-->
			$('#ankenSosakikanListInputFragment .sosakikanName').on('change', function() {
				
				const sosakikanNameVal = $(this).val();
				const $option = $('#ankenSosakikanListInputFragment #sosakikanDataListOption option[value="'+ sosakikanNameVal +'"]');
				
				if ($option.length) {
					$('#ankenSosakikanListInputFragment .sosakikanId').val($option.data("id"))
					<!--/* 電話番号の自動反映処理 */-->
					$('#ankenSosakikanListInputFragment .sosakikanTelNo').val($option.data("tel"))
					$('#ankenSosakikanListInputFragment .sosakikanFaxNo').val($option.data("fax"))
				} else {
					$('#ankenSosakikanListInputFragment .sosakikanId').val("");
				}
				
			});

			<!--/* 捜査機関の編集を閉じる（表示モードの表示に切り替える） */-->
			$('#ankenSosakikanListInputFragment .editSosakikanClose').on('click', function() {
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				
				ajaxRunning = true;
				$.ajax({
					url : 'getAnkenSosakikanListView',
					type : "GET"
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* 親HTMLのID */-->
						$('#ankenSosakikanListFragmentWrap').html(data);
						
					} else {
						<!--/* 処理失敗 */-->
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				})
				.always(function(){
					ajaxRunning = false;
				});
				
			});
			
			<!--/* 捜査機関の新規登録 */-->
			$('#ankenSosakikanListInputFragment .registSosakikan').on('click', function() {
				
				<!--/* リクエストパラメータ */-->
				const formData = $(this)
					.closest('#ankenSosakikanListInputForm')
					.serializeArray();
				
				let $clickedElem = $(this)
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/registSosakikan(ankenId=${ankenId})}]]*/,
					type : "POST",
					data : formData
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* 処理成功 */-->
						
						<!--/* 親HTMLのID */-->
						$('#ankenSosakikanListFragmentWrap').html(data);
						
						const msg = getAjaxProcResutlMessage(jqXHR);
						showInfoMessageForJs(msg);
						
					} else {
						// 処理失敗
						
						if (data) {
							<!--/* HTMLのコンテンツが返却されている場合 */-->
							<!--/* 対象行部分にHTML表示 */-->
							$clickedElem.closest('.sosakikanRow').html(data)
						}
						
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
				})
				.always(function(){
					ajaxRunning = false;
				});
			})
			
			<!--/* 捜査機関の更新 */-->
			$('#ankenSosakikanListInputFragment .updateSosakikan').on('click', function() {
				
				<!--/* リクエストパラメータ */-->
				const formData = $(this)
					.closest('#ankenSosakikanListInputForm')
					.serializeArray();
				
				let $clickedElem = $(this)
				
				<!--/* 2重押下防止 */-->
				if(ajaxRunning){
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/updateSosakikan(ankenId=${ankenId})}]]*/,
					type : "POST",
					data : formData
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* 処理成功 */-->
						
						<!--/* 親HTMLのID */-->
						$('#ankenSosakikanListFragmentWrap').html(data);
						
						const msg = getAjaxProcResutlMessage(jqXHR);
						showInfoMessageForJs(msg);
						
					} else {
						<!--/* 処理失敗 */-->
						
						if (data) {
							// HTMLのコンテンツが返却されている場合
							// 対象行部分にHTML表示
							$clickedElem.closest('.sosakikanRow').html(data)
						}
						
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
				})
				.always(function(){
					ajaxRunning = false;
				});
			});

			<!--/* 捜査機関名入力時、datalistを設定する */-->
			<!--/* Chromeでは未入力の状態でdatalistをクリックすると、全件リストを表示しようとするため文字入力時にのみdatalistをセットするようにする */-->
			$('#ankenSosakikanListInputFragment .sosakikanName').on('input', function() {
				if ($(this).val()) {
					$(this).attr('list', 'sosakikanDataListOption');
				} else {
					<!--/* Safariの場合は、文字入力前にdatalistを設定する必要があるため */-->
				if (isMacSafari()){
						$(this).attr('list', 'sosakikanDataListOption');
					} else {
						$(this).removeAttr('list');
					}
				}
			});

			<!--/* 捜査機関名入力時、datalistを設定する */-->
			<!--/* Chromeでは未入力の状態でdatalistをクリックすると、全件リストを表示しようとするため文字入力時にのみdatalistをセットするようにする */-->
			$('#ankenSosakikanListInputFragment .sosakikanName').on('click', function() {
				if ($(this).val()) {
					$(this).attr('list', 'sosakikanDataListOption');
				} else {
					<!--/* Safariの場合は、文字入力前にdatalistを設定する必要があるためクリック時でもdatalistをセットする */-->
				if (isMacSafari()){
						$(this).attr('list', 'sosakikanDataListOption');
					}
				}
			});

		});

	</script>
	
	<!--/* HTML */-->
	<form id="ankenSosakikanListInputForm" th:action="@{/user/ankenKeijiManagement/{ankenId}/saveSosakikan(ankenId=${ankenId})}"
		 th:object="${ankenSosakikanListInputForm}" method="post" autocomplete="off">
		
		<input type="hidden" class="" th:field="*{sosakikanSeq}">
		<input type="hidden" class="sosakikanId" th:field="*{sosakikanId}">

		<div class="block_view_input block_view_input_row py-0">
			<div class="detail_input_area">
				<div class="form-row">
					<!--/* 名称 */-->
					<div class="form-group col-md-4 pr-4">
						<label class="input_parts_label">名称</label>
						<div class="mb-1">
							<input type="search" class="form-control sosakikanName" th:field="*{sosakikanName}" size="100" maxlength="100" placeholder="警察／検察" autocomplete="off">
							<div th:if="${#fields.hasErrors('sosakikanName')}" th:errors="*{sosakikanName}" class="error_mag_point">error</div>
						</div>
						<div class="row">
							<div class="col-sm-6 mb-1 pr-1">
								<input type="text" class="form-control" th:field="*{sosakikanTantoBu}" size="100" maxlength="100" placeholder="担当部">
								<div th:if="${#fields.hasErrors('sosakikanTantoBu')}" th:errors="*{sosakikanTantoBu}" class="error_mag_point">error</div>
							</div>
							<div class="col-sm-6 mb-1 pl-1">
								<input type="text" class="form-control" th:field="*{sosakikanRoomNo}" size="10" maxlength="10" placeholder="号室">
								<div th:if="${#fields.hasErrors('sosakikanRoomNo')}" th:errors="*{sosakikanRoomNo}" class="error_mag_point">error</div>
							</div>
						</div>
					</div>
					<!--/* 担当 */-->
					<div class="form-group col-md-2 pr-4">
						<label class="input_parts_label">担当</label>
						<div class="mb-1">
							<input type="text" class="form-control" th:field="*{tantosha1Name}" size="20" maxlength="128" placeholder="担当①">
							<div th:if="${#fields.hasErrors('tantosha1Name')}" th:errors="*{tantosha1Name}" class="error_mag_point">error</div>
						</div>
						<div>
							<input type="text" class="form-control" th:field="*{tantosha2Name}" size="20" maxlength="128" placeholder="担当②">
							<div th:if="${#fields.hasErrors('tantosha2Name')}" th:errors="*{tantosha2Name}" class="error_mag_point">error</div>
						</div>
					</div>
					<!--/* 連絡先 */-->
					<div class="form-group col-md-2 pr-4">
						<label class="input_parts_label">連絡先</label>
						<div class="row mb-1">
							<div class="col-8 pr-1">
								<input type="text" class="form-control input_num_hyphen sosakikanTelNo" th:field="*{sosakikanTelNo}" size="20" maxlength="20" placeholder="TEL">
								<div th:if="${#fields.hasErrors('sosakikanTelNo')}" th:errors="*{sosakikanTelNo}" class="error_mag_point">error</div>
							</div>
							<div class="col-4 pl-1">
								<input type="text" class="form-control" th:field="*{sosakikanExtensionNo}" size="20" maxlength="20" placeholder="内線">
								<div th:if="${#fields.hasErrors('sosakikanExtensionNo')}" th:errors="*{sosakikanExtensionNo}" class="error_mag_point">error</div>
							</div>
						</div>
						<div>
							<input type="text" class="form-control input_num_hyphen sosakikanFaxNo" th:field="*{sosakikanFaxNo}" size="20" maxlength="20" placeholder="FAX">
							<div th:if="${#fields.hasErrors('sosakikanFaxNo')}" th:errors="*{sosakikanFaxNo}" class="error_mag_point">error</div>
						</div>
					</div>
					<!--/* 備考 */-->
					<div class="form-group col-md-3 pr-4 pb-3">
						<label class="input_parts_label">備考</label>
						<textarea class="form-control h-75" rows="2" th:field="*{remarks}" placeholder="備考" maxlength="100"></textarea>
						<div th:if="${#fields.hasErrors('remarks')}" th:errors="*{remarks}" class="error_mag_point">error</div>
					</div>
				</div>
				<div class="form-row">
					<!--/* ボタン */-->
					<div class="form-group col-md-12 text-right">
						<!--/* 保存ボタン */-->
						<button type="button" id="sosakikanSave" class="btn btn-info btn-sm btn_icon_save mr-3"
							data-container="#ankenSosakikanListInputFragment" data-toggle="tooltip" data-trigger="hover" title="保存"
							th:classappend="${isNew} ? 'registSosakikan' : 'updateSosakikan'">
							<i class="fas fa-check"></i>保存
						</button>
						<!--/* 閉じるボタン */-->
						<button type="button" class="btn btn-light btn-sm editSosakikanClose"
							data-boundary="window" data-container="#ankenSosakikanListInputFragment" data-toggle="tooltip" data-trigger="hover" title="閉じる">
							<i class="fas fa-times"></i>閉じる
						</button>
					</div>
				</div>
			</div>

		</div>
	</form>
	<datalist id="sosakikanDataListOption">
		<option th:each="option : ${ankenSosakikanListInputForm.sosakikanSelectOptionDto}" th:value="${option.sosakikanName}" th:data-id="${option.sosakikanId}"
			th:data-tel="${option.sosakikanTelNo}" th:data-fax="${option.sosakikanFaxNo}"></option>
	</datalist>

</div>

<!-- /* 共犯者（顧客以外） */ -->
<div th:fragment="ankenKyohanshaListViewFragment(ankenKyohanshaListViewForm)" id="ankenKyohanshaListViewFragment">

	<!--/* 関与者モーダルを扱うので共通JS定義 */-->
	<script type="text/javascript" th:replace="common/mvc/kanyosha/kanyoshaEditModal::kanyoshaEditModalFragmentObjJs"></script>

	<!--/* Script */-->
	<script th:inline="javascript">
		$(function() {
			<!--/* 共有の要素セットアップ処理 */-->
			commonSetUpElement();
			
			let ajaxRunning = false;
			const ankenKyohanshaListFragment = $("#ankenKyohanshaListViewFragment");
			
			<!--/* 名簿ポップオーバー */-->
			benzo.global.fragment.setUpPersonPopover(ankenKyohanshaListFragment.find(".personPopoverLabel"));
			
			<!--/* 共犯者の削除処理 */-->
			$(ankenKyohanshaListFragment).on("click", ".kyohanshaDelete", function() {
				const kyohanshaContainer = $($(this).data("target"));
				const kanyoshaSeq = kyohanshaContainer.data('kyohansha-kanyosha-seq');

				if (!confirm("共犯者から外します。よろしいですか？")) {
					return false;
				}

				if(ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteKyohansha(ankenId=${ankenId})}]]*/"",
					type : "POST",
					data : {
						"kyohanshaKanyoshaSeq" : kanyoshaSeq,
					},
					dataType: 'json',
				})
				.done(function(result) {
					if (result.succeed) {
						showInfoMessageForJs(result.message);
						renderAnkenKyohanshaListView();
					} else {
						showErrorMessageForJs(result.message);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				})
				.always(function() {
					ajaxRunning = false;
				});
			});
			
			<!--/* 弁護人からはずす処理 */-->
			$(ankenKyohanshaListFragment).on("click", ".bengoninDelete", function() {
				const bengoninContainer = $($(this).data("target"));
				const kyohanshaKanyoshaSeq = bengoninContainer.data('kyohansha-kanyosha-seq');
				const bengoninKanyoshaSeq = bengoninContainer.data('bengonin-kanyosha-seq');
				
				if (!confirm("弁護人から外します。よろしいですか？")) {
					return false;
				}
			
				if(!kyohanshaKanyoshaSeq || !bengoninKanyoshaSeq){
					return;
				}
				
				if(ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteKyohanshaBengonin(ankenId=${ankenId})}]]*/"",
					type : "POST",
					data : {
						"kyohanshaKanyoshaSeq" : kyohanshaKanyoshaSeq,
						"bengoninKanyoshaSeq" : bengoninKanyoshaSeq,
					},
					dataType: 'json',
				})
				.done(function(result) {
					if (result.succeed) {
						showInfoMessageForJs(result.message);
						renderAnkenKyohanshaListView();
					} else {
						showErrorMessageForJs(result.message);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				})
				.always(function() {
					ajaxRunning = false;
				});
			});
			<!--/* 案件からはずすボタン（共犯者削除処理） */-->
			$(ankenKyohanshaListFragment).on("click", ".kyohanshaDeleteFromAnken", function() {
				
				const kyohanshaContainer = $($(this).data("target"));
				const kanyoshaSeq = kyohanshaContainer.data('kyohansha-kanyosha-seq');
				if (!confirm("案件から外します。よろしいですか？")) {
					return false;
				}
				if (!kanyoshaSeq) {
					return;
				}
				
				<!--/* リクエストパラメータ */-->
				const param = {
						"kanyoshaSeq": kanyoshaSeq
				}
				
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				
				Promise.resolve()
					.then(() => beforeCheck(param))
					.then(() => deleteAction(param))
					.then(() => renderAnkenKyohanshaListView())
					.catch((errorObj) => console.log(errorObj))
					.finally(() => ajaxRunning = false);
				
				function beforeCheck(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteKanyoshaFromAnkenBeforeCheck(ankenId=${ankenId})}]]*/"",
							data : param,
							dataType : "json",
						}).done(function(data) {
							if (data.needConfirm && !confirm(data.message)) {
								return reject();
							} else {
								return resolve();
							}
						}).fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showInfoMessageForJs(errorMsg);
							return reject();
						});
					});
				}
				
				function deleteAction(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteKanyoshaFromAnken(ankenId=${ankenId})}]]*/"",
							data : param,
							dataType : "html",
						})
						.done(function(data, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								<!--/* 処理成功 */-->
								showInfoMessageForJs(/*[[#{I00028('共犯者情報')}]]*/'');
								return resolve();
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessageForJs(errorMsg);
								return reject();
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showErrorMessageForJs(errorMsg);
							return reject();
						});
					});
				}
			});
			<!--/* 案件からはずすボタン（弁護人削除処理） */-->
			$(ankenKyohanshaListFragment).on("click", ".bengoninDeleteFromAnken", function() {
				
				const kyohanshaContainer = $($(this).data("target"));
				const kanyoshaSeq = kyohanshaContainer.data('bengonin-kanyosha-seq');
				if (!confirm("案件から外します。よろしいですか？")) {
					return false;
				}
				if (!kanyoshaSeq) {
					return;
				}
				
				<!--/* リクエストパラメータ */-->
				const param = {
						"kanyoshaSeq": kanyoshaSeq
				}
				
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				
				Promise.resolve()
					.then(() => beforeCheck(param))
					.then(() => deleteAction(param))
					.then(() => renderAnkenKyohanshaListView())
					.catch((errorObj) => console.log(errorObj))
					.finally(() => ajaxRunning = false);
				
				function beforeCheck(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteKanyoshaFromAnkenBeforeCheck(ankenId=${ankenId})}]]*/"",
							data : param,
							dataType : "json",
						}).done(function(data) {
							if (data.needConfirm && !confirm(data.message)) {
								return reject();
							} else {
								return resolve();
							}
						}).fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showInfoMessageForJs(errorMsg);
							return reject();
						});
					});
				}
				
				function deleteAction(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteKanyoshaFromAnken(ankenId=${ankenId})}]]*/"",
							data : param,
							dataType : "html",
						})
						.done(function(data, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								<!--/* 処理成功 */-->
								showInfoMessageForJs(/*[[#{I00028('弁護人情報')}]]*/'');
								return resolve();
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessageForJs(errorMsg);
								return reject();
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showErrorMessageForJs(errorMsg);
							return reject();
						});
					});
				}
			});
			<!--/* 共犯者モーダル処理の定義 */-->
			const $kanyoshaKyohanshaModal = $(ankenKyohanshaListFragment).find("#kanyoshaEditKyohanshaModal");
			$kanyoshaKyohanshaModal.on("show.bs.modal", function() {
				
				<!--/* モーダル表示名 */-->
				benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.modalNameLabel = '共犯者';
				
				<!--/* 選択できない顧客種別 */-->
				benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.excludeCustomerType = ["2"];
				
				<!--/* 登録処理 */-->
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.registAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaModal);
					let url = /*[[@{/common/mvc/kanyosha/registKanyoshaForAnkenKyohansha}]]*/"";
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 処理成功 */-->
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaKyohanshaModal))
								.then(() => renderAnkenKyohanshaListView())
								.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
						} else {
							if (data) {
								$kanyoshaKyohanshaModal.find(".kanyoshaEditModalFragmentWrap").html(data);
							}
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				<!--/* 更新処理 */-->
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.updateAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaModal);
					let url = /*[[@{/common/mvc/kanyosha/updateKanyosha}]]*/"";
					
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;

					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 処理成功 */-->
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaKyohanshaModal))
								.then(() => renderAnkenKyohanshaListView())
								.then(() => showInfoMessageForJs(/*[[#{I00023('共犯者情報')}]]*/''))
						} else {
							if (data) {
								$kanyoshaKyohanshaModal.find(".kanyoshaEditModalFragmentWrap").html(data);
							}
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				<!--/* 削除処理 */-->
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.deleteAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaModal);

					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;

					Promise.resolve()
						.then(() => beforeCheck(param))
						.then(() => deleteAction(param))
						.then(() => modalHidePromise($kanyoshaKyohanshaModal))
						.then(() => renderAnkenKyohanshaListView())
						.catch((errorObj) => console.log(errorObj))
						.finally(() => ajaxRunning = false);
					
					function beforeCheck(param) {
						return new Promise((resolve, reject) => {
							$.ajax({
								type : "POST",
								url : /*[[@{/common/mvc/kanyosha/deleteKanyoshaBeforeCheck}]]*/,
								data : param,
								dataType : "json",
							}).done(function(data) {
								if (data.needConfirm && !confirm(data.message)) {
									return reject();
								} else {
									return resolve([data]);
								}
							}).fail(function(jqXHR, status, errorThrown) {
								const errorMsg = /*[[#{E00091}]]*/ "error";
								showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
								return reject(jqXHR, status, errorThrown);
							});
						});
					}
					
					function deleteAction(param) {
						return new Promise((resolve, reject) => {
							$.ajax({
								type : "POST",
								url : /*[[@{/common/mvc/kanyosha/deleteKanyosha}]]*/,
								data : param,
								dataType : "html",
							})
							.done(function(data, status, jqXHR) {
								if (isAjaxProcSuccess(jqXHR)) {
									<!--/* 処理成功 */-->
									showInfoMessageForJs(/*[[#{I00028('共犯者情報')}]]*/'')
									return resolve()
								} else {
									const errorMsg = getAjaxProcResutlMessage(jqXHR);
									showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
									return reject([errorMsg]);
								}
							})
							.fail(function(jqXHR, status, errorThrown) {
								const errorMsg = /*[[#{E00091}]]*/ "error";
								showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
								return reject([jqXHR, status, errorThrown]);
							});
						});
					}
				};
				
				// 登録・編集エリアの初期レンダリング（再レンダリングも含む）
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderEditViewAction = function(triggerBtn) {
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					Promise.resolve()
						.then(() => initRenderKyohanshaEditViewAction())
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
				};
				
				// 検索エリアの登録処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRegistAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchResultFormParams($kanyoshaKyohanshaModal);
					const url = /*[[@{/common/mvc/kanyosha/searchResultRegistKanyoshaForAnkenKyohansha}]]*/"";
					
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaKyohanshaModal))
								.then(() => renderAnkenKyohanshaListView())
								.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				// 検索エリアの検索処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRenderPromise = function() {
					return new Promise((resolve, reject) => {
						const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/anken/kyohansha}]]*/"";
						let optionParam = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchFormParams($kanyoshaKyohanshaModal);
						$.ajax({
							type : "GET",
							url : url,
							data : optionParam,
							dataType : "html"
						})
						.done(function(result, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								// 処理成功
								$kanyoshaKyohanshaModal.find(".kanyoshaEditModalFragmentWrap").html(result);
								return resolve();
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
								return reject(errorMsg)
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
							return reject([jqXHR, status, errorThrown]);
						});
					});
				};
				
				// 検索エリアの初期表示処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderSearchViewAction = function() {
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					Promise.resolve()
						.then(() => initRenderKyohanshaSearchViewAction())
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
				};
				
			});
			
			<!--/* 共犯者編集モーダルの初期レンダリング関数 */-->
			function initRenderKyohanshaEditViewAction() {
				return new Promise((resolve, reject) => {
					let initRenderKyohanshaEditViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaEditViewParams);
					const ankenId = initRenderKyohanshaEditViewParams["ankenId"];
					const kanyoshaSeq =initRenderKyohanshaEditViewParams["kanyoshaSeq"];
					
					let url = /*[[@{/common/mvc/kanyosha/getKanyoshaEditModalFragment}]]*/"";
					let param = {} ;
					if (kanyoshaSeq) {
						url += `/${kanyoshaSeq}`;
					} else {
						url += "/create";
						param = {
							"ankenId" : ankenId,
							"initCustomerType" : "0",
						};
					};

					$.ajax({
						type : "GET",
						url : url,
						data : param,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 処理成功 */-->
							$kanyoshaKyohanshaModal.find(".kanyoshaEditModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject([jqXHR, status, errorThrown]);
					});
				});
			};
			
			<!--/* 共犯者検索モーダルの初期レンダリング関数 */-->
			function initRenderKyohanshaSearchViewAction() {
				return new Promise((resolve, reject) => {
					let initRenderKyohanshaSearchViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaSearchViewParams);
					const ankenId = initRenderKyohanshaSearchViewParams["ankenId"];
					let param = [{name:"ankenId", value: ankenId}];
					
					const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/anken/kyohansha}]]*/"";
					$.ajax({
						type : "GET",
						url : url,
						data : param,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 処理成功 */-->
							$kanyoshaKyohanshaModal.find(".kanyoshaEditModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject(jqXHR, status, errorThrown)
					});
				});
			};
			
			<!--/* 共犯者モーダルの表示処理 */-->
			$(ankenKyohanshaListFragment).on("click", ".openKanyoshaKyohanshaModal", function() {
				if (ajaxRunning) {
					return false;
				}
				
				const ankenId = /*[[${ankenId}]]*/"";
				const kanyoshaSeq =$(this).data("kanyoshaSeq");
				
				// 登録・編集初期表示で必要なパラメータをメモリに保持しておく
				benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaEditViewParams = {
						"ankenId": ankenId,
						"kanyoshaSeq": kanyoshaSeq,
				};
				
				// 検索初期表示で必要なパラメータをメモリに保持しておく
				benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaSearchViewParams = {
						"ankenId": ankenId,
				}
				
				ajaxRunning = true;
				Promise.resolve()
					.then(() => initRenderKyohanshaEditViewAction())
					.then(() => $kanyoshaKyohanshaModal.modal("show"))
					.catch((errors) => console.log(errors))
					.finally(() => ajaxRunning = false);
			});
			
			<!--/* 共犯者弁護人モーダル処理の定義 */-->
			const $kanyoshaKyohanshaBengoninModal = $(ankenKyohanshaListFragment).find("#kanyoshaEditKyohanshaBengoninModal");
			$kanyoshaKyohanshaBengoninModal.on("show.bs.modal", function() {
				
				<!--/* モーダル表示名 */-->
				benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.modalNameLabel = '共犯者弁護人';
				
				<!--/* 選択できない顧客種別 */-->
				benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.excludeCustomerType = ["0", "1"];
				
				<!--/* 登録処理 */-->
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.registAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaBengoninModal);
					let kyohanshaBengoninWithInParam = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaBengoninWithInParam);
					
					param.push({
						name : "kyohanshaKanyoshaSeq",
						value : kyohanshaBengoninWithInParam.kyohanshaKanyoshaSeq
					});
					
					let url = /*[[@{/common/mvc/kanyosha/registKanyoshaForAnkenKyohanshaBengonin}]]*/"";
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 処理成功 */-->
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaKyohanshaBengoninModal))
								.then(renderAnkenKyohanshaListView)
								.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
						} else {
							if (data) {
								$kanyoshaKyohanshaBengoninModal.find(".kanyoshaEditModalFragmentWrap").html(data);
							}
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				<!--/* 更新処理 */-->
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.updateAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaBengoninModal);
					let url = /*[[@{/common/mvc/kanyosha/updateKanyosha}]]*/"";
					
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;

					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 処理成功 */-->
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaKyohanshaBengoninModal))
								.then(() => renderAnkenKyohanshaListView())
								.then(() => showInfoMessageForJs(/*[[#{I00023('共犯者弁護人情報')}]]*/''))
						} else {
							if (data) {
								$kanyoshaKyohanshaBengoninModal.find(".kanyoshaEditModalFragmentWrap").html(data);
							}
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				<!--/* 削除処理 */-->
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.deleteAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaBengoninModal);

					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;

					Promise.resolve()
						.then(() => beforeCheck(param))
						.then(() => deleteAction(param))
						.then(() => modalHidePromise($kanyoshaKyohanshaBengoninModal))
						.then(() => renderAnkenKyohanshaListView())
						.catch((errorObj) => console.log(errorObj))
						.finally(() => ajaxRunning = false);
					
					function beforeCheck(param) {
						return new Promise((resolve, reject) => {
							$.ajax({
								type : "POST",
								url : /*[[@{/common/mvc/kanyosha/deleteKanyoshaBeforeCheck}]]*/,
								data : param,
								dataType : "json",
							}).done(function(data) {
								if (data.needConfirm && !confirm(data.message)) {
									return reject();
								} else {
									return resolve([data]);
								}
							}).fail(function(jqXHR, status, errorThrown) {
								const errorMsg = /*[[#{E00091}]]*/ "error";
								showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
								return reject(jqXHR, status, errorThrown);
							});
						});
					}
					
					function deleteAction(param) {
						return new Promise((resolve, reject) => {
							$.ajax({
								type : "POST",
								url : /*[[@{/common/mvc/kanyosha/deleteKanyosha}]]*/,
								data : param,
								dataType : "html",
							})
							.done(function(data, status, jqXHR) {
								if (isAjaxProcSuccess(jqXHR)) {
									<!--/* 処理成功 */-->
									showInfoMessageForJs(/*[[#{I00028('共犯者弁護人情報')}]]*/'')
									return resolve()
								} else {
									const errorMsg = getAjaxProcResutlMessage(jqXHR);
									showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
									return reject([errorMsg]);
								}
							})
							.fail(function(jqXHR, status, errorThrown) {
								const errorMsg = /*[[#{E00091}]]*/ "error";
								showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
								return reject([jqXHR, status, errorThrown]);
							});
						});
					}
				};
				
				// 登録・編集エリアの初期レンダリング（再レンダリングも含む）
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderEditViewAction = function(triggerBtn) {
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					Promise.resolve()
						.then(() => initRenderKyohanshaBengoninEditViewAction())
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
				};
				
				// 検索エリアの登録処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRegistAction = function(triggerBtn) {
					if (ajaxRunning) {
						return false;
					}
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchResultFormParams($kanyoshaKyohanshaBengoninModal);
					let kyohanshaBengoninWithInParam = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaBengoninWithInParam);
					
					param.push({
						name : "kyohanshaKanyoshaSeq",
						value : kyohanshaBengoninWithInParam.kyohanshaKanyoshaSeq
					});
					
					const url = /*[[@{/common/mvc/kanyosha/searchResultRegistKanyoshaForAnkenKyohanshaBengonin}]]*/"";
					ajaxRunning = true;
					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaKyohanshaBengoninModal))
								.then(() => renderAnkenKyohanshaListView())
								.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				// 検索エリアの検索処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRenderPromise = function() {
					return new Promise((resolve, reject) => {
						const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/anken/kyohanshaBengonin}]]*/"";
						let optionParam = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchFormParams($kanyoshaKyohanshaBengoninModal);
						$.ajax({
							type : "GET",
							url : url,
							data : optionParam,
							dataType : "html"
						})
						.done(function(result, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								// 処理成功
								$kanyoshaKyohanshaBengoninModal.find(".kanyoshaEditModalFragmentWrap").html(result);
								return resolve();
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
								return reject(errorMsg);
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
							return reject([jqXHR, status, errorThrown]);
						});
					});
				};
				
				// 検索エリアの初期表示処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderSearchViewAction = function() {
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					Promise.resolve()
						.then(() => initRenderKyohanshaBengoninSearchViewAction())
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
				};
				
			});
			
			<!--/* 共犯者弁護人編集モーダルの初期レンダリング関数 */-->
			function initRenderKyohanshaBengoninEditViewAction() {
				return new Promise((resolve, reject) => {

					let initRenderKyohanshaBengoninEditViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaBengoninEditViewParams);
					const ankenId = initRenderKyohanshaBengoninEditViewParams["ankenId"];
					const kanyoshaSeq = initRenderKyohanshaBengoninEditViewParams["kanyoshaSeq"];
					
					let url = /*[[@{/common/mvc/kanyosha/getKanyoshaEditModalFragment}]]*/"";
					let param = {} ;
					if (kanyoshaSeq) {
						url += `/${kanyoshaSeq}`;
					} else {
						url += "/create";
						param = {
							"ankenId" : ankenId,
							"initCustomerType" : "2",
						};
					};

					$.ajax({
						type : "GET",
						url : url,
						data : param,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							<!--/* 処理成功 */-->
							$kanyoshaKyohanshaBengoninModal.find(".kanyoshaEditModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject([jqXHR, status, errorThrown]);
					});
				});
			};
			
			<!--/* 共犯者弁護人検索モーダルの初期レンダリング関数 */-->
			function initRenderKyohanshaBengoninSearchViewAction() {
				return new Promise((resolve, reject) => {
					let initRenderKyohanshaBengoninSearchViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaBengoninSearchViewParams);
					const ankenId = initRenderKyohanshaBengoninSearchViewParams["ankenId"];
					let param = [
						{name:"ankenId", value: ankenId},
						{name:"customerType", value: "2"},
					];
					
					const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/anken/kyohanshaBengonin}]]*/"";
					$.ajax({
						type : "GET",
						url : url,
						data : param,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							$kanyoshaKyohanshaBengoninModal.find(".kanyoshaEditModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject(jqXHR, status, errorThrown)
					});
				});
			};
			
			<!--/* 共犯者モーダルの表示処理 */-->
			$(ankenKyohanshaListFragment).on("click", ".openKanyoshaKyohanshaBengoninModal", function() {
				if (ajaxRunning) {
					return false;
				}
				
				const ankenId = /*[[${ankenId}]]*/"";
				const kanyoshaSeq =$(this).data("kanyoshaSeq");
				
				// 登録・編集初期表示で必要なパラメータをメモリに保持しておく
				benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaBengoninEditViewParams = {
						"ankenId": ankenId,
						"kanyoshaSeq": kanyoshaSeq,
				}
				
				// 検索初期表示で必要なパラメータをメモリに保持しておく
				benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaBengoninSearchViewParams = {
						"ankenId": ankenId,
				};
				
				<!--/* モーダルの保存処理等で使用するパラメータをGlobal領域に保持させておく */-->
				const kyohanshaKanyoshaSeq = $(this).data("kyohanshaKanyoshaSeq");
				benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaBengoninWithInParam = {
					"kyohanshaKanyoshaSeq": kyohanshaKanyoshaSeq,
				}
				
				ajaxRunning = true;
				Promise.resolve()
					.then(() => initRenderKyohanshaBengoninEditViewAction())
					.then(() => $kanyoshaKyohanshaBengoninModal.modal("show"))
					.catch((errors) => console.log(errors))
					.finally(() => ajaxRunning = false);
			});
			
			<!--/* モーダル閉じる処理をPromise化 */-->
			function modalHidePromise(modal){
				return new Promise((resolve) => {
					$(modal).one('hidden.bs.modal', function() {
						resolve();
					});
					$(modal).modal("hide");
				});
			};
			
	});
	</script>
	
	<section class="section_client_side">
		<div class="section_header">
			<div class="section_header__title">共犯者（顧客以外）</div>
			<div class="section_header__action">
				<!--/* 新規追加 */-->
				<a href="javascript:void(0);" class="openKanyoshaKyohanshaModal fs15">
					<i class="fas fa-plus-square mr-2"></i>共犯者を追加
				</a>
			</div>
		</div>
		<div class="section_body">
			<div class="section_body__contents p-0">
			
	<!--/*/		<th:block th:if="${ankenKyohanshaListViewForm.ankenKanyoshaViewDtoList.size() == 0}"> /*/-->
				<div class="no_data_msg">
					<span th:text="#{I00035('共犯者情報の登録')}">MSG_I00035</span>
				</div>
	<!--/*/		</th:block> /*/-->
	
	<!--/*/		<th:block th:if="${ankenKyohanshaListViewForm.ankenKanyoshaViewDtoList.size() > 0}"> /*/-->
				<div class="section_split_wrapper pb-0">
					<div class="section_split">
						<div class="section_split__left">
							<span class="badge badge-pill badge_square mnw70 badge_blue px-1"><i class="fas fa-user mr-2"></i>共犯者</span>
							<hr class="mt-3 m-0">
						</div>
						<div class="section_split__right">
							<span class="badge badge-pill badge_square mnw70 badge_purple px-1"><i class="fas fa-user-tie mr-2"></i>弁護人</span>
							<hr class="mt-3 m-0">
						</div>
					</div>
				</div>
				<ul class="section_list px-3">
					<li class="list_contents" th:each="kyohanshaKanyosha, i : ${ankenKyohanshaListViewForm.ankenKanyoshaViewDtoList}"
						th:id="|kyohanshaRowView*{kanyoshaSeq}|" th:object="${kyohanshaKanyosha}">
						<div class="section_list_item_wrap section_split_wrapper">
							<div class="section_split">
								<!--/* 共犯者エリア */-->
								<div class="section_split__left">
									<div class="section_list_item pl-1">
										<!--/* 名簿 */-->
										<div class="img_info_xs mb-2">
											<!--/* 名簿画像 */-->
											<div class="img_info_xs__image">
												<!--/* 名簿属性ラベル */-->
												<div th:class="|person_image_wrapper*{personAttribute?.cd.getCd()}|">
													<!--/* 個人アイコン */-->
													<img th:if="*{T(jp.loioz.common.constant.CommonConstant$CustomerType).KOJIN.equals(customerType)}" 
														class="img-thumbnail person_image_xs" th:src="@{/img/person_kojin.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="個人">
														
													<!--/* 企業・団体アイコン */-->
													<img th:if="*{T(jp.loioz.common.constant.CommonConstant$CustomerType).HOJIN.equals(customerType)}"
														class="img-thumbnail person_image_xs" th:src="@{/img/person_hojin.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="企業・団体">
														
													<!--/* 弁護士アイコン */-->
													<img th:if="*{T(jp.loioz.common.constant.CommonConstant$CustomerType).LAWYER.equals(customerType)}"
														class="img-thumbnail person_image_xs" th:src="@{/img/person_bengoshi.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="弁護士">
												</div>
											</div>
											<!--/* 名簿画像 end */-->
											
											<!--/* 名前 */-->
											<div class="img_info_xs__info">
												<div class="fw600 fs20 lh1_3 pt-1" th:text="*{kanyoshaName}">山田　太郎 </div>
												<div>
													<!-- /* 名簿ID */ -->
													<a href="javascript:void(0);"  class="app_id_link p-1 personPopoverLabel" th:text="|名簿ID：*{personId}|" 
														data-boundary="window" data-container="#ankenKyohanshaListViewFragment" th:data-person-id="*{personId}">
														名簿ID：100
													</a>
												</div>
											</div>
											<!-- /* ボタンエリア */ -->
											<div class="img_info_xs__btn">
												<div class="item_sub px-0">
													<!--/* 共犯者から外す選択 */-->
													<div th:id="|kyohanshaContainer${i.index}|" class="d-inline-block stop-events outPutContainerClose" data-offset="-80,0" data-boundary="window" data-container="#ankenKyohanshaListViewFragment" th:data-kyohansha-kanyosha-seq="*{kanyoshaSeq}" data-toggle="popover" data-placement="bottom" data-html="true" th:data-content=
															'|<ul class="output_nav_list">
																<li><button class="btn btn-light kyohanshaDelete" data-target="#kyohanshaContainer${i.index}"><i class="fas fa-minus-circle"></i>共犯者から外す</button></li>
																<li><button class="btn btn-light kyohanshaDeleteFromAnken" data-target="#kyohanshaContainer${i.index}"><i class="fas fa-user-minus"></i>案件から外す</button></li>
															</ul>|'>
														<button type="button" class="btn btn-light btn_icon_only btn_icon_ellipsis_v " data-boundary="window" data-container="#ankenKyohanshaListViewFragment">
															<i class="fas fa-ellipsis-v"></i>
														</button>
													</div>
												</div>
											</div>
										</div>
										<!--/* １行目 end */-->
										
										<!--/* データブロック */-->
										<div class="item_content_block">
											<div class="kankei_remarks_view openKanyoshaKyohanshaModal" data-boundary="window"
												data-container="#ankenKyohanshaListViewFragment" data-toggle="tooltip" data-trigger="hover" title="編集する"
												th:data-kanyosha-seq="*{kanyoshaSeq}">
												<div class="mb-3">
													<label class="view_label">関係</label>
													<div class="view_value fs15">
														<div th:classappend="${#strings.isEmpty(kyohanshaKanyosha.kankei)} ? 'sub_text'"
															myth:nl2br="${#strings.isEmpty(kyohanshaKanyosha.kankei)} ? '-' : *{kankei}">関係
														</div>
													</div> 
												</div>
												<div>
													<label class="view_label">備考</label>
													<div class="view_value fs15">
														<div th:classappend="${#strings.isEmpty(kyohanshaKanyosha.remarks)} ? 'sub_text'"
															myth:nl2br="${#strings.isEmpty(kyohanshaKanyosha.remarks)} ? '-' : *{remarks}">備考
														</div>
													</div>
												</div> 
											</div>
										</div>
									</div>
								</div>
								<!--/* 共犯者エリア end */-->
								
								<!--/* 共犯者-弁護人エリア */-->
								<div class="section_split__right">
								
		<!--/* 代理人設定【あり】の場合 */-->
		<th:block th:if="${kyohanshaKanyosha.ankenKanyoshaDairininViewDto != null}"
			 th:with="dairininPersonId=${kyohanshaKanyosha.ankenKanyoshaDairininViewDto.personId}">
									
									<div class="section_list_item pl-1">
										<!--/* 名簿 */-->
										<div class="img_info_xs mb-2">
											<!--/* 名簿画像 */-->
											<div class="img_info_xs__image">
												<!--/* 名簿属性ラベル */-->
												<div th:class="|person_image_wrapper${kyohanshaKanyosha.ankenKanyoshaDairininViewDto.personAttribute?.cd.getCd()}|">
													<!--/* 個人アイコン */-->
													<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).KOJIN.equals(kyohanshaKanyosha.ankenKanyoshaDairininViewDto.customerType)}" 
														class="img-thumbnail person_image_xs" th:src="@{/img/person_kojin.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="個人">
														
													<!--/* 企業・団体アイコン */-->
													<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).HOJIN.equals(kyohanshaKanyosha.ankenKanyoshaDairininViewDto.customerType)}"
														class="img-thumbnail person_image_xs" th:src="@{/img/person_hojin.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="企業・団体">
														
													<!--/* 弁護士アイコン */-->
													<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).LAWYER.equals(kyohanshaKanyosha.ankenKanyoshaDairininViewDto.customerType)}"
														class="img-thumbnail person_image_xs" th:src="@{/img/person_bengoshi.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="弁護士">
												</div>
											</div>
											<!--/* 名簿画像 end */-->
	
											<!--/* 名前 */-->
											<div class="img_info_xs__info">
												<div class="fw600 fs20 lh1_3 pt-1" th:text="${kyohanshaKanyosha.ankenKanyoshaDairininViewDto.kanyoshaName}">山田　太郎 </div>
												<div class="d-flex flex-wrap cg10 rg5">
													<!-- /* 名簿ID */ -->
													<div>
														<a href="javascript:void(0);" class="app_id_link p-1 personPopoverLabel" th:text="|名簿ID：${dairininPersonId.asLong()}|"
															data-boundary="window" data-container="#ankenKyohanshaListViewFragment" th:data-person-id="${dairininPersonId.asLong()}">
															名-100
														</a> 
													</div>
			<th:block th:if="${!#strings.isEmpty(kyohanshaKanyosha.ankenKanyoshaDairininViewDto.jimushoName)}">
													<div class="jimusho_name fc_sub fs13">
														<i class="far fa-building fs12"></i>
														<span th:text="${kyohanshaKanyosha.ankenKanyoshaDairininViewDto.jimushoName}"></span>
													</div>
			</th:block>
												</div>
											</div>
											<!-- /* ボタンエリア */ -->
											<div class="img_info_xs__btn">
												<!-- /* ボタンエリア */ -->
												<div class="item_sub px-0">
													<!--/* 共犯者弁護人から外す選択 */-->
													<div th:id="|bengoninContainer${i.index}|" class="d-inline-block stop-events outPutContainerClose" data-offset="-80,0" data-boundary="window" data-container="#ankenKyohanshaListViewFragment" th:data-kyohansha-kanyosha-seq="*{kanyoshaSeq}" th:data-bengonin-kanyosha-seq="${kyohanshaKanyosha.ankenKanyoshaDairininViewDto.kanyoshaSeq}" data-toggle="popover" data-placement="bottom" data-html="true" th:data-content=
															'|<ul class="output_nav_list">
																<li><button class="btn btn-light bengoninDelete" data-target="#bengoninContainer${i.index}"><i class="fas fa-minus-circle"></i>弁護人から外す</button></li>
																<li><button class="btn btn-light bengoninDeleteFromAnken" data-target="#bengoninContainer${i.index}"><i class="fas fa-user-minus"></i>案件から外す</button></li>
															</ul>|'>
														<button type="button" class="btn btn-light btn_icon_only btn_icon_ellipsis_v " data-boundary="window" data-container="#ankenKyohanshaListViewFragment">
															<i class="fas fa-ellipsis-v"></i>
														</button>
													</div>
												</div>
											</div>
										</div>
										<!--/* １行目 end */-->
										
										<!--/* データブロック */-->
										<div class="item_content_block">
											<div class="kankei_remarks_view openKanyoshaKyohanshaBengoninModal" data-boundary="window"
												th:data-kanyosha-seq="${kyohanshaKanyosha.ankenKanyoshaDairininViewDto.kanyoshaSeq}"
												data-container="#ankenKyohanshaListViewFragment" data-toggle="tooltip" data-trigger="hover" title="編集する">
												<div class="mb-3">
													<label class="view_label">関係</label>
													<div class="view_value fs15">
														<div th:classappend="${#strings.isEmpty(kyohanshaKanyosha.ankenKanyoshaDairininViewDto.kankei)} ? 'sub_text'"
															myth:nl2br="${#strings.isEmpty(kyohanshaKanyosha.ankenKanyoshaDairininViewDto.kankei)} ? '-' : ${kyohanshaKanyosha.ankenKanyoshaDairininViewDto.kankei}">関係
														</div>
													</div>
												</div> 
												<div>
													<label class="view_label">備考</label>
													<div class="view_value fs15">
														<div th:classappend="${#strings.isEmpty(kyohanshaKanyosha.ankenKanyoshaDairininViewDto.remarks)} ? 'sub_text'"
															myth:nl2br="${#strings.isEmpty(kyohanshaKanyosha.ankenKanyoshaDairininViewDto.remarks)} ? '-' : ${kyohanshaKanyosha.ankenKanyoshaDairininViewDto.remarks}">備考
														</div>
													</div>
												</div> 
											</div>
										</div>
									</div>
		</th:block>
		
		<!--/* 代理人設定【なし】の場合 */-->
		<th:block th:if="${kyohanshaKanyosha.ankenKanyoshaDairininViewDto == null}">
									<div class="select_dairinin">
										<div>
											<a href="javascript:void(0);" class="openKanyoshaKyohanshaBengoninModal" th:data-kyohansha-kanyosha-seq="*{kanyoshaSeq}">
												<i class="fas fa-plus-square mr-2"></i>弁護人を追加
											</a>
										</div>
									</div>
		</th:block>
		<!--/* 代理人未設定の場合 end */-->
								
								</div>
								<!--/* 共犯者-弁護人エリア end */-->
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
		
		<!--/* 共犯者(顧客以外)モーダル */-->
		<div id="kanyoshaEditKyohanshaModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
			<div class="modal-dialog modal-dialog-centered modal_kanyosha_customer_select" role="document">
				<div class="modal-content">
					<div class="kanyoshaEditModalFragmentWrap">
						<!--/* 関与者情報 */-->
					</div>
				</div>
			</div>
		</div>
		
		<!--/* 共犯者弁護人(顧客以外)モーダル */-->
		<div id="kanyoshaEditKyohanshaBengoninModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
			<div class="modal-dialog modal-dialog-centered modal_kanyosha_customer_select" role="document">
				<div class="modal-content">
					<div class="kanyoshaEditModalFragmentWrap">
						<!--/* 関与者情報 */-->
					</div>
				</div>
			</div>
		</div>
		
	</section>
</div>

<!-- /* 被害者一覧 */ -->
<div th:fragment="ankenHigaishaListViewFragment(ankenHigaishaListViewForm)" id="ankenHigaishaListViewFragment">

	<!--/* 関与者モーダルを扱うので共通JS定義 */-->
	<script type="text/javascript" th:replace="common/mvc/kanyosha/kanyoshaEditModal::kanyoshaEditModalFragmentObjJs"></script>

	<!--/* Script */-->
	<script th:inline="javascript">
		$(function() {
			// 共有の要素セットアップ処理
			commonSetUpElement();
			
			let ajaxRunning = false;
			const ankenHigaishaListFragment = $("#ankenHigaishaListViewFragment");
			
			<!--/* 名簿ポップオーバー */-->
			benzo.global.fragment.setUpPersonPopover(ankenHigaishaListFragment.find(".personPopoverLabel"));
			
			<!--/* 被害者の削除処理 */-->
			$(ankenHigaishaListFragment).on("click", ".higaishaDelete", function() {
				const higaishaContainer = $($(this).data("target"));
				const higaishaKanyoshaSeq = higaishaContainer.data('higaisha-kanyosha-seq');
				
				if (!confirm("被害者から外します。よろしいですか？")) {
					return false;
				}

				if(ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteHigaisha(ankenId=${ankenId})}]]*/"",
					type : "POST",
					data : {
						"higaishaKanyoshaSeq" : higaishaKanyoshaSeq,
					},
					dataType: 'json',
				})
				.done(function(result) {
					if (result.succeed) {
						showInfoMessageForJs(result.message);
						renderAnkenHigaishaListView();
					} else {
						showErrorMessageForJs(result.message);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				})
				.always(function() {
					ajaxRunning = false;
				});
			});
			<!--/* 案件からはずすボタン（被害者削除処理） */-->
			$(ankenHigaishaListFragment).on("click", ".higaishaDeleteFromAnken", function() {
				
				const higaishaContainer = $($(this).data("target"));
				const higaishaKanyoshaSeq = higaishaContainer.data('higaisha-kanyosha-seq');
				
				if (!confirm("案件から外します。よろしいですか？")) {
					return false;
				}
				if (!higaishaKanyoshaSeq) {
					return;
				}
				
				<!--/* リクエストパラメータ */-->
				const param = {
					"kanyoshaSeq": higaishaKanyoshaSeq
				}

				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				
				Promise.resolve()
					.then(() => beforeCheck(param))
					.then(() => deleteAction(param))
					.then(() => renderAnkenHigaishaListView())
					.catch((errorObj) => console.log(errorObj))
					.finally(() => ajaxRunning = false);
				
				function beforeCheck(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteKanyoshaFromAnkenBeforeCheck(ankenId=${ankenId})}]]*/"",
							data : param,
							dataType : "json",
						}).done(function(data) {
							if (data.needConfirm && !confirm(data.message)) {
								return reject();
							} else {
								return resolve();
							}
						}).fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showErrorMessageForJs(errorMsg);
							return reject();
						});
					});
				}
				
				function deleteAction(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteKanyoshaFromAnken(ankenId=${ankenId})}]]*/"",
							data : param,
							dataType : "html",
						})
						.done(function(data, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								<!--/* 処理成功 */-->
								showInfoMessageForJs(/*[[#{I00028('被害者情報')}]]*/'');
								return resolve();
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessageForJs(errorMsg);
								return reject();
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showErrorMessageForJs(errorMsg);
							return reject();
						});
					});
				}
			});
			<!--/* 被害者-代理人の削除処理 */-->
			$(ankenHigaishaListFragment).on("click", ".higaishaDairininDelete", function() {
				
				const dairininContainer = $($(this).data("target"));
				const higaishaKanyoshaSeq = dairininContainer.data('higaisha-kanyosha-seq');
				const dairininKanyoshaSeq = dairininContainer.data('dairinin-kanyosha-seq');
				
				if (!confirm("代理人から外します。よろしいですか？")) {
					return false;
				}

				if(!higaishaKanyoshaSeq || !dairininKanyoshaSeq){
					return;
				}

				if(ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteHigaishaDairinin(ankenId=${ankenId})}]]*/"",
					type : "POST",
					data : {
						"higaishaKanyoshaSeq" : higaishaKanyoshaSeq,
						"dairininKanyoshaSeq" : dairininKanyoshaSeq,
					},
					dataType: 'json',
				})
				.done(function(result) {
					if (result.succeed) {
						showInfoMessageForJs(result.message);
						renderAnkenHigaishaListView();
					} else {
						showErrorMessageForJs(result.message);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
				})
				.always(function() {
					ajaxRunning = false;
				});
			});

			<!--/* 案件からはずすボタン（被害者代理人削除処理） */-->
			$(ankenHigaishaListFragment).on("click", ".higaishaDairininDeleteFromAnken", function() {
				
				const dairininContainer = $($(this).data("target"));
				const dairininKanyoshaSeq = dairininContainer.data('dairinin-kanyosha-seq');
				
				if (!confirm("案件から外します。よろしいですか？")) {
					return false;
				}
				if (!dairininKanyoshaSeq) {
					return;
				}
				
				<!--/* リクエストパラメータ */-->
				const param = {
					"kanyoshaSeq": dairininKanyoshaSeq
				}

				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				
				Promise.resolve()
					.then(() => beforeCheck(param))
					.then(() => deleteAction(param))
					.then(() => renderAnkenHigaishaListView())
					.catch((errorObj) => console.log(errorObj))
					.finally(() => ajaxRunning = false);
				
				function beforeCheck(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteKanyoshaFromAnkenBeforeCheck(ankenId=${ankenId})}]]*/"",
							data : param,
							dataType : "json",
						}).done(function(data) {
							if (data.needConfirm && !confirm(data.message)) {
								return reject();
							} else {
								return resolve();
							}
						}).fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showErrorMessageForJs(errorMsg);
							return reject();
						});
					});
				}
				
				function deleteAction(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/user/ankenKeijiManagement/{ankenId}/deleteKanyoshaFromAnken(ankenId=${ankenId})}]]*/"",
							data : param,
							dataType : "html",
						})
						.done(function(data, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								<!--/* 処理成功 */-->
								showInfoMessageForJs(/*[[#{I00028('代理人情報')}]]*/'');
								return resolve();
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessageForJs(errorMsg);
								return reject();
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showErrorMessageForJs(errorMsg);
							return reject();
						});
					});
				}
			});

			<!--/* 被害者モーダル処理の定義 */-->
			const $kanyoshaEditHigaishaModal = $(ankenHigaishaListFragment).find("#kanyoshaEditHigaishaModal");
			$kanyoshaEditHigaishaModal.on("show.bs.modal", function() {
				
				// モーダル表示名
				benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.modalNameLabel = '被害者';
				
				// 選択できない顧客種別
				benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.excludeCustomerType = ["2"]; 
				
				// 登録処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.registAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaEditHigaishaModal);
					let url = /*[[@{/common/mvc/kanyosha/registKanyoshaForAnkenHigaisha}]]*/"";
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaEditHigaishaModal))
								.then(renderAnkenHigaishaListView)
								.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
						} else {
							if (data) {
								$kanyoshaEditHigaishaModal.find(".kanyoshaEditModalFragmentWrap").html(data);
							}
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaEditHigaishaModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaEditHigaishaModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				// 更新処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.updateAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaEditHigaishaModal);
					let url = /*[[@{/common/mvc/kanyosha/updateKanyosha}]]*/"";
					
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;

					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaEditHigaishaModal))
								.then(() => renderAnkenHigaishaListView())
								.then(() => showInfoMessageForJs(/*[[#{I00023('被害者情報')}]]*/''))
						} else {
							if (data) {
								$kanyoshaEditHigaishaModal.find(".kanyoshaEditModalFragmentWrap").html(data);
							}
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaEditHigaishaModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaEditHigaishaModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				// 削除処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.deleteAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaEditHigaishaModal);

					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;

					Promise.resolve()
						.then(() => beforeCheck(param))
						.then(() => deleteAction(param))
						.then(() => modalHidePromise($kanyoshaEditHigaishaModal))
						.then(() => renderAnkenHigaishaListView())
						.catch((errorObj) => console.log(errorObj))
						.finally(() => ajaxRunning = false);
					
					function beforeCheck(param) {
						return new Promise((resolve, reject) => {
							$.ajax({
								type : "POST",
								url : /*[[@{/common/mvc/kanyosha/deleteKanyoshaBeforeCheck}]]*/,
								data : param,
								dataType : "json",
							}).done(function(data) {
								if (data.needConfirm && !confirm(data.message)) {
									return reject();
								} else {
									return resolve([data]);
								}
							}).fail(function(jqXHR, status, errorThrown) {
								const errorMsg = /*[[#{E00091}]]*/ "error";
								showErrorMessage(errorMsg, $kanyoshaEditHigaishaModal);
								return reject(jqXHR, status, errorThrown);
							});
						});
					}
					
					function deleteAction(param) {
						return new Promise((resolve, reject) => {
							$.ajax({
								type : "POST",
								url : /*[[@{/common/mvc/kanyosha/deleteKanyosha}]]*/,
								data : param,
								dataType : "html",
							})
							.done(function(data, status, jqXHR) {
								if (isAjaxProcSuccess(jqXHR)) {
									// 処理成功
									showInfoMessageForJs(/*[[#{I00028('被害者情報')}]]*/'')
									return resolve()
								} else {
									const errorMsg = getAjaxProcResutlMessage(jqXHR);
									showErrorMessage(errorMsg, $kanyoshaEditHigaishaModal);
									return reject([errorMsg]);
								}
							})
							.fail(function(jqXHR, status, errorThrown) {
								const errorMsg = /*[[#{E00091}]]*/ "error";
								showErrorMessage(errorMsg, $kanyoshaEditHigaishaModal);
								return reject([jqXHR, status, errorThrown]);
							});
						});
					}
				};
				
				// 登録・編集エリアの初期レンダリング（再レンダリングも含む）
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderEditViewAction = function(triggerBtn) {
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					Promise.resolve()
						.then(() => initRenderHigaishaEditViewAction())
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
				};
				
				// 検索エリアの登録処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRegistAction = function(triggerBtn) {
					if (ajaxRunning) {
						return false;
					}
					
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchResultFormParams($kanyoshaEditHigaishaModal);
					const url = /*[[@{/common/mvc/kanyosha/searchResultRegistKanyoshaForAnkenHigaisha}]]*/"";
					
					ajaxRunning = true;
					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaEditHigaishaModal))
								.then(() => renderAnkenHigaishaListView())
								.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaEditHigaishaModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaEditHigaishaModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				// 検索エリアの検索処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRenderPromise = function() {
					return new Promise((resolve, reject) => {
						const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/anken/higaisha}]]*/"";
						let optionParam = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchFormParams($kanyoshaEditHigaishaModal);
						$.ajax({
							type : "GET",
							url : url,
							data : optionParam,
							dataType : "html"
						})
						.done(function(result, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								// 処理成功
								$kanyoshaEditHigaishaModal.find(".kanyoshaEditModalFragmentWrap").html(result);
								return resolve();
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessage(errorMsg, $kanyoshaEditHigaishaModal);
								return reject(errorMsg)
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
							return reject([jqXHR, status, errorThrown]);
						});
					});
				};
				
				// 検索エリアの初期表示処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderSearchViewAction = function() {
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					Promise.resolve()
						.then(() => initRenderHigaishaSearchViewAction())
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
				};
				
			});
			
			<!--/* 被害者編集モーダルの初期レンダリング関数 */-->
			function initRenderHigaishaEditViewAction() {
				return new Promise((resolve, reject) => {
					let initRenderHigaishaEditViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderHigaishaEditViewParams);
					const ankenId = initRenderHigaishaEditViewParams["ankenId"];
					const kanyoshaSeq = initRenderHigaishaEditViewParams["kanyoshaSeq"];
					
					let url = /*[[@{/common/mvc/kanyosha/getKanyoshaEditModalFragment}]]*/"";
					let param = {} ;
					if (kanyoshaSeq) {
						url += `/${kanyoshaSeq}`;
					} else {
						url += "/create";
						param = {
							"ankenId" : ankenId,
							"initCustomerType" : "0",
						};
					};
					
					$.ajax({
						type : "GET",
						url : url,
						data : param,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							$kanyoshaEditHigaishaModal.find(".kanyoshaEditModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject([jqXHR, status, errorThrown]);
					});

				});
			};
			
			<!--/* 被害者検索モーダルの初期レンダリング関数 */-->
			function initRenderHigaishaSearchViewAction() {
				return new Promise((resolve, reject) => {
					let initRenderHigaishaSearchViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderHigaishaSearchViewParams);
					const ankenId = initRenderHigaishaSearchViewParams["ankenId"];
					let param = [{name:"ankenId", value: ankenId}];
					
					const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/anken/higaisha}]]*/"";
					$.ajax({
						type : "GET",
						url : url,
						data : param,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							$kanyoshaEditHigaishaModal.find(".kanyoshaEditModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject(jqXHR, status, errorThrown);
					});
				});
			};
			
			<!--/* 被害者モーダルの表示処理 */-->
			$(ankenHigaishaListFragment).on("click", ".openKanyoshaHigaishaModal", function() {
				if (ajaxRunning) {
					return false;
				}
				
				const ankenId = /*[[${ankenId}]]*/"";
				const kanyoshaSeq =$(this).data("kanyoshaSeq");
				
				// 登録・編集初期表示で必要なパラメータをメモリに保持しておく
				benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderHigaishaEditViewParams = {
						"ankenId": ankenId,
						"kanyoshaSeq": kanyoshaSeq,
				};
				
				// 検索初期表示で必要なパラメータをメモリに保持しておく
				benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderHigaishaSearchViewParams = {
						"ankenId": ankenId,
				}

				ajaxRunning = true;
				Promise.resolve()
					.then(() => initRenderHigaishaEditViewAction())
					.then(() => $kanyoshaEditHigaishaModal.modal("show"))
					.catch((errors) => console.log(errors))
					.finally(() => ajaxRunning = false);
			});
			
			<!--/* 被害者代理人モーダル処理の定義 */-->
			const $kanyoshaEditHigaishaDairininModal = $(ankenHigaishaListFragment).find("#kanyoshaEditHigaishaDairininModal");
			$kanyoshaEditHigaishaDairininModal.on("show.bs.modal", function() {
				
				// モーダル表示名
				benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.modalNameLabel = '被害者代理人';
				
				// 選択できない顧客種別
				benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.excludeCustomerType = ["0", "1"];
				
				// 登録処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.registAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaEditHigaishaDairininModal);
					let higaishaDairininWithInParam = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.higaishaDairininWithInParam);
					
					param.push({
						name : "higaishaKanyoshaSeq",
						value : higaishaDairininWithInParam.higaishaKanyoshaSeq
					});
					
					let url = /*[[@{/common/mvc/kanyosha/registKanyoshaForAnkenHigaishaDairinin}]]*/"";
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaEditHigaishaDairininModal))
								.then(renderAnkenHigaishaListView)
								.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
						} else {
							if (data) {
								$kanyoshaEditHigaishaDairininModal.find(".kanyoshaEditModalFragmentWrap").html(data);
							}
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaEditHigaishaDairininModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaEditHigaishaDairininModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				// 更新処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.updateAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaEditHigaishaDairininModal);
					let url = /*[[@{/common/mvc/kanyosha/updateKanyosha}]]*/"";
					
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;

					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaEditHigaishaDairininModal))
								.then(() => renderAnkenHigaishaListView())
								.then(() => showInfoMessageForJs(/*[[#{I00023('被害者代理人情報')}]]*/''))
						} else {
							if (data) {
								$kanyoshaEditHigaishaDairininModal.find(".kanyoshaEditModalFragmentWrap").html(data);
							}
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaEditHigaishaDairininModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaEditHigaishaDairininModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				// 削除処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.deleteAction = function(triggerBtn) {
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaEditHigaishaDairininModal);

					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;

					Promise.resolve()
						.then(() => beforeCheck(param))
						.then(() => deleteAction(param))
						.then(() => modalHidePromise($kanyoshaEditHigaishaDairininModal))
						.then(() => renderAnkenHigaishaListView())
						.catch((errorObj) => console.log(errorObj))
						.finally(() => ajaxRunning = false);
					
					function beforeCheck(param) {
						return new Promise((resolve, reject) => {
							$.ajax({
								type : "POST",
								url : /*[[@{/common/mvc/kanyosha/deleteKanyoshaBeforeCheck}]]*/,
								data : param,
								dataType : "json",
							}).done(function(data) {
								if (data.needConfirm && !confirm(data.message)) {
									return reject();
								} else {
									return resolve([data]);
								}
							}).fail(function(jqXHR, status, errorThrown) {
								const errorMsg = /*[[#{E00091}]]*/ "error";
								showErrorMessage(errorMsg, $kanyoshaEditHigaishaDairininModal);
								return reject(jqXHR, status, errorThrown);
							});
						});
					}
					
					function deleteAction(param) {
						return new Promise((resolve, reject) => {
							$.ajax({
								type : "POST",
								url : /*[[@{/common/mvc/kanyosha/deleteKanyosha}]]*/,
								data : param,
								dataType : "html",
							})
							.done(function(data, status, jqXHR) {
								if (isAjaxProcSuccess(jqXHR)) {
									// 処理成功
									showInfoMessageForJs(/*[[#{I00028('被害者代理人情報')}]]*/'')
									return resolve()
								} else {
									const errorMsg = getAjaxProcResutlMessage(jqXHR);
									showErrorMessage(errorMsg, $kanyoshaEditHigaishaDairininModal);
									return reject([errorMsg]);
								}
							})
							.fail(function(jqXHR, status, errorThrown) {
								const errorMsg = /*[[#{E00091}]]*/ "error";
								showErrorMessage(errorMsg, $kanyoshaEditHigaishaDairininModal);
								return reject([jqXHR, status, errorThrown]);
							});
						});
					}
				};
				
				// 登録・編集エリアの初期レンダリング（再レンダリングも含む）
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderEditViewAction = function(triggerBtn) {
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					Promise.resolve()
						.then(() => initRenderHigaishaDairininEditViewAction())
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
				};
				
				// 検索エリアの登録処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRegistAction = function(triggerBtn) {
					if (ajaxRunning) {
						return false;
					}
					
					let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchResultFormParams($kanyoshaEditHigaishaDairininModal);
					let higaishaDairininWithInParam = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.higaishaDairininWithInParam);
					
					param.push({
						name : "higaishaKanyoshaSeq",
						value : higaishaDairininWithInParam.higaishaKanyoshaSeq
					});
					
					const url = /*[[@{/common/mvc/kanyosha/searchResultRegistKanyoshaForAnkenHigaishaDairinin}]]*/"";
					ajaxRunning = true;
					$.ajax({
						type : "POST",
						url : url,
						data : param,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							Promise.resolve()
								.then(() => modalHidePromise($kanyoshaEditHigaishaDairininModal))
								.then(() => renderAnkenHigaishaListView())
								.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaEditHigaishaDairininModal);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessage(errorMsg, $kanyoshaEditHigaishaDairininModal);
					})
					.always(function(){
						ajaxRunning = false;
					});
				};
				
				// 検索エリアの検索処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRenderPromise = function() {
					return new Promise((resolve, reject) => {
						const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/anken/higaishaDairinin}]]*/"";
						let optionParam = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchFormParams($kanyoshaEditHigaishaDairininModal);
						$.ajax({
							type : "GET",
							url : url,
							data : optionParam,
							dataType : "html"
						})
						.done(function(result, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								// 処理成功
								$kanyoshaEditHigaishaDairininModal.find(".kanyoshaEditModalFragmentWrap").html(result);
								return resolve();
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessage(errorMsg, $kanyoshaEditHigaishaDairininModal);
								return reject(errorMsg);
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
							return reject([jqXHR, status, errorThrown]);
						});
					});
				};
				
				// 検索エリアの初期表示処理
				benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderSearchViewAction = function() {
					if (ajaxRunning) {
						return false;
					}
					ajaxRunning = true;
					Promise.resolve()
						.then(() => initRenderHigaishaDairininSearchViewAction())
						.catch((errors) => console.log(errors))
						.finally(() => ajaxRunning = false);
				};
				
			});
			
			<!--/* 被害者代理人編集モーダルの初期レンダリング関数 */-->
			function initRenderHigaishaDairininEditViewAction() {
				return new Promise((resolve, reject) => {
					let initRenderHigaishaDairininEditViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderHigaishaDairininEditViewParams);
					const ankenId = initRenderHigaishaDairininEditViewParams["ankenId"];
					const kanyoshaSeq = initRenderHigaishaDairininEditViewParams["kanyoshaSeq"];
					
					let url = /*[[@{/common/mvc/kanyosha/getKanyoshaEditModalFragment}]]*/"";
					let param = {} ;
					if (kanyoshaSeq) {
						url += `/${kanyoshaSeq}`;
					} else {
						url += "/create";
						param = {
							"ankenId" : ankenId,
							"initCustomerType" : "2",
						};
					};
					
					$.ajax({
						type : "GET",
						url : url,
						data : param,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							$kanyoshaEditHigaishaDairininModal.find(".kanyoshaEditModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject([jqXHR, status, errorThrown]);
					});
				});
			};
			
			<!--/* 被害者代理人検索モーダルの初期レンダリング関数 */-->
			function initRenderHigaishaDairininSearchViewAction() {
				return new Promise((resolve, reject) => {
					let initRenderHigaishaDairininSearchViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderHigaishaDairininSearchViewParams);
					const ankenId = initRenderHigaishaDairininSearchViewParams["ankenId"];
					let param = [
						{name:"ankenId", value: ankenId},
						{name:"customerType", value: "2"},
					];
					
					const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/anken/higaishaDairinin}]]*/"";
					$.ajax({
						type : "GET",
						url : url,
						data : param,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							$kanyoshaEditHigaishaDairininModal.find(".kanyoshaEditModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject(jqXHR, status, errorThrown)
					});
				});
			};
			
			<!--/* 被害者代理人モーダルの表示処理 */-->
			$(ankenHigaishaListFragment).on("click", ".openKanyoshaHigaishaDairininModal", function() {
				if (ajaxRunning) {
					return false;
				}
				
				const ankenId = /*[[${ankenId}]]*/"";
				const kanyoshaSeq =$(this).data("kanyoshaSeq");
				
				// 登録・編集初期表示で必要なパラメータをメモリに保持しておく
				benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderHigaishaDairininEditViewParams = {
						"ankenId": ankenId,
						"kanyoshaSeq": kanyoshaSeq,
				}
				
				// 検索初期表示で必要なパラメータをメモリに保持しておく
				benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderHigaishaDairininSearchViewParams = {
						"ankenId": ankenId,
				};
				
				<!--/* モーダルの保存処理等で使用するパラメータをGlobal領域に保持させておく */-->
				const higaishaKanyoshaSeq = $(this).data("higaishaKanyoshaSeq");
				benzo.global.fragment.kanyoshaEditModalFragmentObj.higaishaDairininWithInParam = {
					"higaishaKanyoshaSeq": higaishaKanyoshaSeq,
				}
				
				ajaxRunning = true;
				Promise.resolve()
					.then(() => initRenderHigaishaDairininEditViewAction())
					.then(() => $kanyoshaEditHigaishaDairininModal.modal("show"))
					.catch((errors) => console.log(errors))
					.finally(() => ajaxRunning = false);
			});
			
			<!--/* モーダル閉じる処理をPromise化 */-->
			function modalHidePromise(modal){
				return new Promise((resolve) => {
					$(modal).one('hidden.bs.modal', function() {
						resolve();
					});
					$(modal).modal("hide");
				});
			};
			
	});
	</script>

	<section class="section_higaisha section_person">
		<div class="section_header">
			<div class="section_header__title">被害者</div>
			<div class="section_header__action">
				<!--/* 新規追加 */-->
				<a href="javascript:void(0);" class="openKanyoshaHigaishaModal fs15">
					<i class="fas fa-plus-square mr-2"></i>被害者を追加
				</a>
			</div>
		</div>
		<div class="section_body">
			<div class="section_body__contents p-0">
				
	<th:block th:if="${ankenHigaishaListViewForm.ankenKanyoshaViewDtoList.size() == 0}">
				<div class="no_data_msg px-4">
					<span th:text="#{I00035('被害者情報の登録')}">MSG_I00035</span>
				</div>
	</th:block>
				
	<th:block th:if="${ankenHigaishaListViewForm.ankenKanyoshaViewDtoList.size() > 0}">
				<div class="section_split_wrapper pb-0">
					<div class="section_split">
						<div class="section_split__left">
							<span class="badge badge-pill badge_square mnw70 badge_green px-1"><i class="fas fa-user mr-2"></i>被害者</span>
							<hr class="mt-3 m-0">
						</div>
						<div class="section_split__right">
							<span class="badge badge-pill badge_square mnw70 badge_purple px-1"><i class="fas fa-user-tie mr-2"></i>代理人</span>
							<hr class="mt-3 m-0">
						</div>
					</div>
				</div>
				<ul class="section_list px-3">
					<li class="list_contents" th:each="higaishaKanyosha, i : ${ankenHigaishaListViewForm.ankenKanyoshaViewDtoList}" 
						th:id="|higaishaRowView*{kanyoshaSeq}|" th:object="${higaishaKanyosha}">
						<div class="section_list_item_wrap section_split_wrapper">
							<div class="section_split">
								<!--/* 被害者エリア */-->
								<div class="section_split__left">
									<div class="section_list_item pl-1">
										<!--/* 名簿 */-->
										<div class="img_info_xs mb-2">
											<!--/* 名簿画像 */-->
											<div class="img_info_xs__image">
												<!--/* 名簿属性ラベル */-->
												<div th:class="|person_image_wrapper*{personAttribute?.cd.getCd()}|">
													<!--/* 個人アイコン */-->
													<img th:if="*{T(jp.loioz.common.constant.CommonConstant$CustomerType).KOJIN.equals(customerType)}" 
														class="img-thumbnail person_image_xs" th:src="@{/img/person_kojin.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="個人">
														
													<!--/* 企業・団体アイコン */-->
													<img th:if="*{T(jp.loioz.common.constant.CommonConstant$CustomerType).HOJIN.equals(customerType)}"
														class="img-thumbnail person_image_xs" th:src="@{/img/person_hojin.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="企業・団体">
														
													<!--/* 弁護士アイコン */-->
													<img th:if="*{T(jp.loioz.common.constant.CommonConstant$CustomerType).LAWYER.equals(customerType)}"
														class="img-thumbnail person_image_xs" th:src="@{/img/person_bengoshi.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="弁護士">
												</div>
											</div>
											<!--/* 名簿画像 end */-->
	
											<!--/* 名前 */-->
											<div class="img_info_xs__info">
												<div class="fw600 fs20 lh1_3 pt-1" th:text="*{kanyoshaName}">山田　太郎 </div>
												<div>
													<!-- /* 名簿ID */ -->
													<a href="javascript:void(0);" class="app_id_link p-1 personPopoverLabel"
														data-boundary="window" data-container="#ankenHigaishaListViewFragment" th:data-person-id="*{personId}"
														th:text="|名簿ID：*{personId}|">名簿ID：100
													</a>
												</div>
											</div>
											<!-- /* ボタンエリア */ -->
											<div class="img_info_xs__btn">
												<!-- /* ボタンエリア */ -->
												<div class="item_sub px-0">
													<!--/* 被害者から外す選択 */-->
													<div th:id="|higaishaContainer${i.index}|" class="d-inline-block stop-events outPutContainerClose" data-offset="-80,0" data-boundary="window" data-container="#ankenHigaishaListViewFragment" th:data-higaisha-kanyosha-seq="*{kanyoshaSeq}" data-toggle="popover" data-placement="bottom" data-html="true" th:data-content=
															'|<ul class="output_nav_list">
																<li><button class="btn btn-light higaishaDelete" data-target="#higaishaContainer${i.index}"><i class="fas fa-minus-circle"></i>被害者から外す</button></li>
																<li><button class="btn btn-light higaishaDeleteFromAnken" data-target="#higaishaContainer${i.index}"><i class="fas fa-user-minus"></i>案件から外す</button></li>
															</ul>|'>
														<button type="button" class="btn btn-light btn_icon_only btn_icon_ellipsis_v " data-boundary="window" data-container="#ankenHigaishaListViewFragment">
															<i class="fas fa-ellipsis-v"></i>
														</button>
													</div>
												</div>
											</div>
										</div>
									</div>
									<!--/* １行目 end */-->
								
									<!--/* データブロック */-->
									<div class="item_content_block">
										<div class="kankei_remarks_view openKanyoshaHigaishaModal" data-boundary="window"
											th:data-kanyosha-seq="*{kanyoshaSeq}" data-container="#ankenHigaishaListViewFragment"
											data-toggle="tooltip" data-trigger="hover" title="編集する">
											<div class="mb-3">
												<label class="view_label">関係</label>
												<div class="view_value fs15">
													<div th:classappend="${#strings.isEmpty(higaishaKanyosha.kankei)} ? 'sub_text'"
														myth:nl2br="${#strings.isEmpty(higaishaKanyosha.kankei)} ? '-' : *{kankei}">関係
													</div>
												</div>
											</div>
											<div>
												<label class="view_label">備考</label>
												<div class="view_value fs15">
													<div th:classappend="${#strings.isEmpty(higaishaKanyosha.remarks)} ? 'sub_text'"
														myth:nl2br="${#strings.isEmpty(higaishaKanyosha.remarks)} ? '-' : *{remarks}">備考
													</div>
												</div>
											</div> 
										</div>
									</div>
								</div>
								<!--/* 被害者エリア end */-->
								
								<!--/* 代理人エリア */-->
								<div class="section_split__right">
									<th:block th:if="${higaishaKanyosha.ankenKanyoshaDairininViewDto != null}"
										th:with="dairininPersonId=${higaishaKanyosha.ankenKanyoshaDairininViewDto.personId}">
									<div class="section_list_item pl-1">
										<!--/* 名簿 */-->
										<div class="img_info_xs mb-2">
											<!--/* 名簿画像 */-->
											<div class="img_info_xs__image">
												<!--/* 名簿属性ラベル */-->
												<div th:class="|person_image_wrapper${higaishaKanyosha.ankenKanyoshaDairininViewDto.personAttribute?.cd.getCd()}|">
													<!--/* 個人アイコン */-->
													<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).KOJIN.equals(higaishaKanyosha.ankenKanyoshaDairininViewDto.customerType)}" 
														class="img-thumbnail person_image_xs" th:src="@{/img/person_kojin.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="個人">
														
													<!--/* 企業・団体アイコン */-->
													<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).HOJIN.equals(higaishaKanyosha.ankenKanyoshaDairininViewDto.customerType)}"
														class="img-thumbnail person_image_xs" th:src="@{/img/person_hojin.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="企業・団体">
														
													<!--/* 弁護士アイコン */-->
													<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).LAWYER.equals(higaishaKanyosha.ankenKanyoshaDairininViewDto.customerType)}"
														class="img-thumbnail person_image_xs" th:src="@{/img/person_bengoshi.svg}"
														data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="弁護士">
												</div>
											</div>
											<!--/* 名簿画像 end */-->
	
											<!--/* 名前 */-->
											<div class="img_info_xs__info">
												<div class="fw600 fs20 lh1_3 pt-1" th:text="${higaishaKanyosha.ankenKanyoshaDairininViewDto.kanyoshaName}">山田　太郎 </div>
												<div class="d-flex flex-wrap cg10 rg5">
													<!-- /* 名簿ID */ -->
													<div>
													<a href="javascript:void(0);" 
														class="app_id_link p-1 personPopoverLabel" th:text="|名簿ID：${dairininPersonId.asLong()}|" 
														data-boundary="window" data-container="#ankenHigaishaListViewFragment" th:data-person-id="${dairininPersonId.asLong()}">
														名簿ID：100
													</a>
													</div>
			<th:block th:if="${!#strings.isEmpty(higaishaKanyosha.ankenKanyoshaDairininViewDto.jimushoName)}">
													<div class="jimusho_name fc_sub fs13">
														<i class="far fa-building fs12"></i>
														<span th:text="${higaishaKanyosha.ankenKanyoshaDairininViewDto.jimushoName}"></span>
													</div>
			 </th:block>
												</div>
											</div>
											<!-- /* ボタンエリア */ -->
											<div class="img_info_xs__btn">
												<!-- /* ボタンエリア */ -->
												<div class="item_sub px-0">
													<!--/* 代理人から外す選択 */-->
													<div th:id="|dairininContainer${i.index}|" class="d-inline-block stop-events outPutContainerClose" data-offset="-80,0" data-boundary="window" data-container="#ankenHigaishaListViewFragment" th:data-higaisha-kanyosha-seq="*{kanyoshaSeq}" th:data-dairinin-kanyosha-seq="${higaishaKanyosha.ankenKanyoshaDairininViewDto.kanyoshaSeq}" data-toggle="popover" data-placement="bottom" data-html="true" th:data-content=
															'|<ul class="output_nav_list">
																<li><button class="btn btn-light higaishaDairininDelete" data-target="#dairininContainer${i.index}"><i class="fas fa-minus-circle"></i>代理人から外す</button></li>
																<li><button class="btn btn-light higaishaDairininDeleteFromAnken" data-target="#dairininContainer${i.index}"><i class="fas fa-user-minus"></i>案件から外す</button></li>
															</ul>|'>
														<button type="button" class="btn btn-light btn_icon_only btn_icon_ellipsis_v " data-boundary="window" data-container="#ankenHigaishaListViewFragment">
															<i class="fas fa-ellipsis-v"></i>
														</button>
													</div>
												</div>
											</div>
										</div>
										<!--/* １行目 end */-->
										
										<!--/* データブロック */-->
										<div class="item_content_block">
											<div class="kankei_remarks_view openKanyoshaHigaishaDairininModal" data-boundary="window"
												th:data-kanyosha-seq="${higaishaKanyosha.ankenKanyoshaDairininViewDto.kanyoshaSeq}"
												data-container="#ankenHigaishaListViewFragment" data-toggle="tooltip" data-trigger="hover" title="編集する">
												<div class="mb-3">
													<label class="view_label">関係</label>
													<div class="view_value fs15">
														<div th:classappend="${#strings.isEmpty(higaishaKanyosha.ankenKanyoshaDairininViewDto.kankei)} ? 'sub_text'"
															myth:nl2br="${#strings.isEmpty(higaishaKanyosha.ankenKanyoshaDairininViewDto.kankei)} ? '-' : ${higaishaKanyosha.ankenKanyoshaDairininViewDto.kankei}">関係
														</div>
													</div>
												</div> 
												<div>
													<label class="view_label">備考</label>
													<div class="view_value fs15">
														<div th:classappend="${#strings.isEmpty(higaishaKanyosha.ankenKanyoshaDairininViewDto.remarks)} ? 'sub_text'"
															myth:nl2br="${#strings.isEmpty(higaishaKanyosha.ankenKanyoshaDairininViewDto.remarks)} ? '-' : ${higaishaKanyosha.ankenKanyoshaDairininViewDto.remarks}">備考
														</div>
													</div>
												</div> 
											</div>
										</div>
									</div>
		</th:block>
		<!--/* 代理人が存在する場合 end */-->
									
		<!--/* 代理人未設定の場合 */-->
		<th:block th:if="${higaishaKanyosha.ankenKanyoshaDairininViewDto == null}">
										<div class="select_dairinin">
											<div>
												<a href="javascript:void(0);" class="openKanyoshaHigaishaDairininModal" th:data-higaisha-kanyosha-seq="*{kanyoshaSeq}">
													<i class="fas fa-plus-square mr-2"></i>代理人を追加
												</a>
											</div>
										</div>
		</th:block>
								</div>
								<!--/* 代理人エリア end */-->
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>

		<!--/* 被害者モーダル */-->
		<div id="kanyoshaEditHigaishaModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
			<div class="modal-dialog modal-dialog-centered modal_kanyosha_customer_select" role="document">
				<div class="modal-content">
					<div class="kanyoshaEditModalFragmentWrap">
						<!--/* 関与者情報 */-->
					</div>
				</div>
			</div>
		</div>
	
		<!--/* 被害者代理人モーダル */-->
		<div id="kanyoshaEditHigaishaDairininModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
			<div class="modal-dialog modal-dialog-centered modal_kanyosha_customer_select" role="document">
				<div class="modal-content">
					<div class="kanyoshaEditModalFragmentWrap">
						<!--/* 関与者情報 */-->
					</div>
				</div>
			</div>
		</div>
		
	</section>
</div>

</body>
</html>
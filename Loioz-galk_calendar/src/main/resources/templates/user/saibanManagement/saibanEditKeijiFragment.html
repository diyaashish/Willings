<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8" />
</head>
<body>


<!--/* 裁判-基本情報表示ブロック */-->
<div th:fragment="saibanBasicViewFragment(saibanBasicViewForm)" id="saibanBasicViewFragment">

	<!--/* スクリプト */-->
	<script th:inline="javascript">
	$(function() {
		
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();
		
		<!--/* 裁判情報の詳細の編集をクリックで編集フォームを表示 */-->
		$(".saibanEdit").on("click", function(){
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			$.ajax({
				url : "getSaibanBasicInputForm",
				type : "GET"
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					<!--/* 処理成功 */-->
					<!--/* 親HTMLのID */-->
					$('#saibanBasicFragmentWrap').html(data);
					
				} else {
					<!--/* 処理失敗 */-->
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
			})
			.always(function(){
				ajaxRunning = false;
			});
	
		});
		
		<!--/* 削除ボタン押下時 */-->
		$("#deleteSaiban").on('click', function() {
			if (!confirm('裁判を削除します。よろしいですか?')) {
				return false;
			}
			if (ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			$.ajax({
				type : "POST",
				url : 'deleteSaiban'
			})
			.done(function(result) {
				if(result.succeeded){
					alert(result.message);
					const deleteAnkenId = result.ankenId;
					window.location.href = "/user/ankenManagement/edit/" + deleteAnkenId + '/';
				} else {
					showErrorMessage(result.message, modal, result.errors);
				}
			})
			.fail(function() {
				showErrorMessage(/*[[#{E00013}]]*/ "error", modal);
			})
			.always(function(){
				ajaxRunning = false;
			});
		});
		
		<!--/* 追記起訴 登録モーダル */-->
		$('.registTsuikisoModal').on('click', function(){
			const saibanSeq = /*[[${saibanBasicViewForm.SaibanSeq}]]*/;
			$.ajax({
				url : '/user/saibanKeijiManagement/createTsuikisoModal',
				type : "POST",
				data : {"saibanSeq" : saibanSeq},
			}).done(function(val) {
				// モーダルの表示
				$('#registTsuikisoModal .editTsuikisoBody').html(val);
			}).fail(function(jqXHR, textStatus, errorThrown) {
			}).always(function() {
			});
		});

		<!--/* 刑事裁判 新規追加 */-->
		$('.addSaiban').on('click', function(){
			window.location.href = "/user/saibanManagement/" + ankenId + '/new/';
		});
		
		<!--/* 追記起訴 編集モーダル */-->
		$('.editTsuikisoModal').on('click', function(){
			const jikenSeq = $(this).data('jikenseq');
			$.ajax({
				url : '/user/saibanKeijiManagement/editTsuikisoModal',
				type : "POST",
				data : {"jikenSeq" : jikenSeq},
			}).done(function(val) {
				// モーダルの表示
				$('#editTsuikisoModal .editTsuikisoBody').html(val);
			}).fail(function(jqXHR, textStatus, errorThrown) {
			}).always(function() {
			});
		});
		
		<!-- /** 事件番号コピー */ -->
		$('#saibanBasicViewFragment').on('click', '.jikenNoCopy', function() {
			const copyInput = $("<input type='text' value='" + $(this).data("jiken-no") + "'/>")
			$("body").append(copyInput);
			copyInput.select();
			const result = document.execCommand("copy");
			if (!result) {
				showErrorMessageForJs("非対応ブラウザのため、コピーできません");
			} else {
				showInfoMessageForJs("コピーしました");
			}
			copyInput.remove();
		});

	})
	</script>

	<!--/* HTML */-->
	<th:block th:object="${saibanBasicViewForm}">
		
		<div class="case_edit_top">
			<div class="case_edit_top__info">
				<span class="main_view_title">裁判管理</span>
			</div>
			<div class="case_edit_top__btn">
				
				<!--/* 編集ボタン */-->
				<span>
					<button type="button" class="btn btn-primary btn_icon_only saibanEdit"
						 data-boundary="window" data-container="#saibanBasicViewFragment" data-toggle="tooltip" data-trigger="hover" title="裁判情報を編集">
						 <i class="fas fa-edit"></i> 編集
					</button>
				</span>
				
				<!--/* 裁判削除ボタン */-->
				<span th:if="${saibanBasicViewForm.saibanStartDate == null}">
					<button type="button" id="deleteSaiban" class="btn btn-light btn_icon_only"
						data-boundary="window" data-container="#saibanBasicViewFragment" data-toggle="tooltip" data-trigger="hover" title="裁判情報を削除">
						<i class="far fa-trash-alt"></i>
					</button>
				</span>
				
				<!--/* 裁判追加 */-->
				<a th:if="*{addSaiban}" href="javascript:void(0);" class="btn btn-sm btn-primary pr-3 ml-5" th:href="@{/user/saibanManagement/{ankenId}/new/(ankenId=*{ankenId.asLong()})}">
					<i class="fas fa-plus"></i>裁判（刑事）追加
				</a>
				<span th:unless="*{addSaiban}" class="warning_label">
					<i class="fas fa-exclamation-triangle mr-2"></i>裁判は登録上限に達したため、追加できません。
				</span>
			</div>
		</div>
		<div class="case_edit_court">
			<div class="case_detail">
				<div class="case_detail__image">
					<div th:class="|case_image_wrapper${saibanBasicViewForm.ankenType?.cd}|">
						<!--/* 案件区分 */-->
						<img class="img-thumbnail case_judgment_img" th:src="@{/img/saiban.svg?{ver}(ver=${@environment.getProperty('app.version')})}">
					</div>
				</div>
				<div class="case_detail__case_name">
					<div class="fs13">
						
	<!--/* 案件区分 */-->
	<!--/* 事務所 */-->
	<th:block th:if="${T(jp.loioz.common.constant.CommonConstant$AnkenType).JIMUSHO.equals(saibanBasicViewForm.ankenType)}">
						<i class="far fa-building"></i>
	</th:block>
	<!--/* 個人 */-->
	<th:block th:if="${T(jp.loioz.common.constant.CommonConstant$AnkenType).KOJIN.equals(saibanBasicViewForm.ankenType)}">
						<i class="fas fa-briefcase"></i>
	</th:block>
						<!--/* 案件種別 */-->
						<span th:text="${saibanBasicViewForm.ankenType?.val}"></span>
						<span>／</span>
						<span th:text="*{bunyaName}">分野</span>
	<th:block th:if="${!#strings.isEmpty(saibanBasicViewForm.getBengoTypeVal())}">
						<span>／</span>
						<span th:text="${saibanBasicViewForm.getBengoTypeVal()}">私選・国選</span>
	</th:block>
					</div>
					<!--/* 事件名 */-->
					<span class="fs30 fw600 lh1_4" th:text="${#strings.isEmpty(saibanBasicViewForm.jikenName)} ? '(事件名未入力)' : ${saibanBasicViewForm.jikenName}">事件名</span>
					<div>
						<!--/* 案件ID */-->
						<span class="app_id_link case_link mr-3" th:text="|案件ID：*{ankenId.asLong()}|">案件ID</span>
						
						<!--/* 裁判ステータス */-->
						<i th:class="|fas fa-circle fa-xs anken_status_*{saibanStatus.getCd()}|"></i>
						<span class="mr-3" th:text="*{saibanStatus.getVal()}"></span>
						
					</div>
				</div>
			</div>
			<div class="case_detail__court_other">
				<div class="court_info">
					<div class="mb-3">
						<!--/* 事件No */-->
						<span class="badge badge-pill data_label badge_gray badge_square px-3">事件番号</span>
						<div class="data_label_value">
							<span class="mr-3 fs15" th:text="*{caseNumber.toString()}"></span>
							<button th:if="*{caseNumber.toString() != ''}" type="button" class="btn btn-light btn_icon_only btn_case_no_cp jikenNoCopy" data-boundary="window" 
								data-container="#saibanBasicViewFragment" data-toggle="tooltip" data-trigger="hover" th:title="事件番号コピー" th:data-jiken-no="*{caseNumber.toString()}">
								<i class="far fa-copy mr-0"></i>
							</button>
						</div>
					</div>
					<span class="badge badge-pill data_label badge_gray badge_square px-3">裁判所</span>
					<div class="data_label_value">
						<div>
							<div class="fs14" th:text="*{#strings.isEmpty(saibanshoName)} ?  '(裁判所が設定されていません)'  : *{saibanshoName} "></div>
							<span th:text="*{keizokuBuName}"></span>
							<span th:text="*{keizokuKakariName}"></span>
						</div>
						<div class="court_info__contact">
							<div class="contact_data">
								<span class="fc_sub">電話：</span><span class="contact_value" th:text="*{#strings.isEmpty(keizokuBuTelNo)} ?  '-'  : *{keizokuBuTelNo}"></span>
							</div>
							<div class="contact_data">
								<span class="fc_sub">FAX：</span><span class="contact_value" th:text="*{#strings.isEmpty(keizokuBuFaxNo)} ?  '-'  : *{keizokuBuFaxNo}"></span>
							</div>
						</div>
						<div class="mt-2">
							<!--/* 裁判官・書記官 */-->
							<span class="fc_sub"><i class="fas fa-user-tie mr-3"></i>裁判官：</span>
							<span id="saibanBasicViewSaibankanFragmentWrap" th:insert="user/saibanManagement/saibanCommonFragment::saibanBasicViewSaibankanFragment(${saibanBasicViewForm.saibankanDtoList})">
								<!-- 裁判官情報の表示 -->
							</span>
						</div>
						<div class="mt-1">
							<span class="fc_sub"><i class="fas fa-user-edit mr-2"></i>書記官：</span>
							<span th:text="*{#strings.isEmpty(tantoShoki)} ?  '-'  : *{tantoShoki}"></span>
						</div>
					</div>
				</div>
				<div class="court_other">
					<!--/* 担当情報 */-->
					<div class="case_person_contact mb-4">
						
						<!--/* 弁護士 */-->
						<div class="case_person_contact__lawyer">
							<span class="badge badge-pill data_label badge_gray badge_square">弁護士</span>
							<div class="data_label_value">
		<!--/* 担当弁護士が0件の場合 */-->
		<th:block th:if="*{tantoBengoshiList.size() == 0}">
								<div>(未設定)</div>
		</th:block>
								<div class="case_person_contact__data">
		<!--/* 担当弁護士を設定している場合 */-->
		<th:block th:each="bengoshi : *{tantoBengoshiList}" th:object="${bengoshi}">
									<div class="case_account">
										<i class="fas fa-user-circle" th:style="|color : *{accountColor};|"></i>
										<div class="person_contact_wrapper mr-3">
											<div class="person_contact__name">
												<span class="fs12 fc_sub"
													th:if="*{T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_ON.equalsByCode(mainTantoFlg)}">(主担当)</span>
												<span th:text="*{tantoName}"></span>
											</div>
										</div>
									</div>
		</th:block>
								</div>
							</div>
						</div>
						<!--/* 弁護士 end */-->
							
						<!--/* 事務職員 */-->
						<div class="case_person_contact__jimu">
							<span class="badge badge-pill data_label badge_gray badge_square">事務職員</span>
							<div class="data_label_value">
		<!--/* 担当事務職員が0件の場合 */-->
		<th:block th:if="*{tantoJimuList.size() == 0}">
								<div>(未設定)</div>
		</th:block>
								
								<div class="case_person_contact__data">
		<!--/* 担当事務職員を設定している場合 */-->
		<th:block th:each="jimu : *{tantoJimuList}" th:object="${jimu}">
									<div class="case_account">
										<i class="fas fa-user-circle" th:style="|color : *{accountColor};|"></i>
										<div class="person_contact_wrapper mr-3">
											<div class="person_contact__name">
												<span class="fs12 fc_sub"
													th:if="*{T(jp.loioz.common.constant.CommonConstant$SystemFlg).FLG_ON.equalsByCode(mainTantoFlg)}">(主担当)</span>
												<span th:text="*{tantoName}"></span>
											</div>
										</div>
									</div>
		</th:block>
								</div>
							</div>
						</div>
						<!--/* 事務職員 end */-->
						
					</div>
					<!--/* 担当情報 end*/-->
					
					<div class="court_date">
						<div class="court_date__left">
							<span class="badge badge-pill data_label badge_gray badge_square px-3">起訴日／上訴日</span>
							<div class="data_label_value fs15" th:text="*{#strings.isEmpty(saibanStartDate)} ?  '-'  : *{saibanStartDate}"></div>
						</div>
						<div class="court_date__right">
							<span class="badge badge-pill data_label badge_gray badge_square px-3">判決日</span>
							<div class="data_label_value fs15" th:text="*{#strings.isEmpty(saibanEndDate)} ?  '-'  : *{saibanEndDate}"></div>
						</div>
					</div>
				</div>
				
				<div class="court_judgment court_criminal">
					<span class="badge badge-pill data_label badge_gray badge_square">裁判結果</span>
					<div class="biko_detail data_label_value mt-0"
						myth:nl2br="${#strings.isEmpty(saibanBasicViewForm.saibanResult)} ? '(記載なし)' : ${saibanBasicViewForm.saibanResult}">
					</div>
				</div>
				<!--/* 裁判情報（詳細）3行目 */-->
				<div class="court_add_prosecution">
					<!--/* 追起訴 */-->
					<span class="badge badge-pill data_label badge_gray badge_square">追起訴</span>
					<a href="javascript:void(0);" class="registTsuikisoModal fs14 pt-1 ml-3" data-toggle="modal" data-target="#registTsuikisoModal">
						<i class="fas fa-plus-square mr-2"></i>事件を追加
					</a>
					
		<!--/* 追起訴事件 */-->
		<th:block  th:if="*{saibanTsuikisoJikenDtoList.size() > 0}" >
					<div class="data_label_value mxw300 mb-1 char_ellipsis mr-4" th:id="|tsuikiso*{jikenSeq}|"
						th:each="tsuikiso : *{saibanTsuikisoJikenDtoList}" th:object="${tsuikiso}">
						<span data-boundary="window" th:data-container="|#tsuikiso*{jikenSeq}|" data-toggle="tooltip" data-trigger="hover" title="編集">
							<a href="javascript:void(0);" class="editTsuikisoModal" data-toggle="modal" data-target="#editTsuikisoModal" th:data-jikenSeq="*{jikenSeq}" th:data-saibanSeq="*{saibanSeq}">
								<i class="fas fa-gavel fa-flip-horizontal mr-2"></i><span th:text="*{jikenName} == '' ?  '(事件名未入力)' : *{jikenName}">事件名</span>
							</a>
						</span>
						<div class="sub_text ml-4 pl-1">
							<span th:text="*{jikenNo}"></span>
						</div>
					</div>
		</th:block>
				</div>
			</div>
		</div>
		
		<!-- 追起訴（事件情報の登録）モーダル テンプレート -->
		<div id="registTsuikisoModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
			<div class="modal-dialog modal-dialog-centered" role="document">
				<div class="modal-content">
					<div class="editTsuikisoBody"></div>
				</div>
			</div>
		</div>
		<!-- 追起訴（事件情報の登録）モーダル テンプレート end -->

		<!-- 追起訴（事件情報の編集）モーダル テンプレート -->
		<div id="editTsuikisoModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
			<div class="modal-dialog modal-dialog-centered" role="document">
				<div class="modal-content">
					<div class="editTsuikisoBody"></div>
				</div>
			</div>
		</div>
		<!-- 追起訴（事件情報の編集）モーダル テンプレート end -->
		
	</th:block>
	
</div>

<!--/* 裁判基本情報編集ブロック */-->
<div th:fragment="saibanBasicInputFragment" id="saibanBasicInputFragment">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();
		
		<!--/* 裁判情報の詳細の編集を閉じる（表示モードの表示に切り替える） */-->
		$('#saibanBasicInputForm .saibanClose').on('click', function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			$.ajax({
				url : "getSaibanBasicViewForm",
				type : "GET"
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 親HTMLのID
					$('#saibanBasicFragmentWrap').html(data);
					
				} else {
					// 処理失敗
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
			})
			.always(function(){
				ajaxRunning = false;
			});
			
		});
		
		<!--/* 裁判基本情報の保存 */-->
		$('#saibanBasicSave').on('click', function() {

			<!--/* リクエストURL */-->
			let requestUrl = 'saveSaibanBasic';

			<!--/* リクエストパラメータ */-->
			let formData = $('#saibanBasicInputForm').find('input, select, textArea').serializeArray();

			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}

			ajaxRunning = true;
			$.ajax({
				url : requestUrl,
				type : "POST",
				data : formData
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					Promise.resolve()
						.then(() => $('#saibanBasicFragmentWrap').html(data))
						.then(() => renderAnkenMenuView())
						.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))

					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					// 処理失敗
					if (data) {
						// HTMLのコンテンツが返却されている場合
						// 親HTMLのID
						$('#saibanBasicFragmentWrap').html(data);
					}

					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
		})
		
		<!--/* 係属部選択肢キャッシュ */-->
		let keizokuBuCache = {};

		<!--/* 係属部選択肢を変更 */-->
		function changeKeizokuBuList(saibanshoId){
			let orgKeizokuBuName = $("#keizokuBuSelect").find("[name='keizokuBuName']").val();
			const inputKeizokuBu = '<div id="keizokuBuNameInputText">' +
														'<input type="text" class="form-control" name="keizokuBuName">' +
													'</div>';
			if (!saibanshoId) {
				<!--/* 裁判所IDなし：係属部をテキスト入力に変更 */-->
				$("#keizokuBuSelect").html(inputKeizokuBu);
				setKeizokuBuName(orgKeizokuBuName);

			} else if (keizokuBuCache[saibanshoId]) {
				<!--/* 裁判所の係属部選択肢を取得済み：キャッシュから係属部選択肢を設定 */-->
				$("#keizokuBuSelect").html(keizokuBuCache[saibanshoId]);
				setKeizokuBuName(orgKeizokuBuName);

			} else {
				<!--/* 裁判所の係属部選択肢が未取得：Ajaxで係属部選択肢を取得 */-->
				$.ajax({
					type : "POST",
					url : /*[[(@{/user/saibanManagement/getKeizokuBuForKeiji})]]*/ "/",
					data : {"saibanshoId": saibanshoId},
					dataType : "html"
				})
				.done(function(result) {
					keizokuBuCache[saibanshoId] = result;
					$("#keizokuBuSelect").html(result);
					setKeizokuBuName(orgKeizokuBuName);
				})
				.fail(function() {
					$("#keizokuBuSelect").html(inputKeizokuBu);
					setKeizokuBuName(orgKeizokuBuName);
				});
			}
		}

		<!--/* 係属部を設定 */-->
		function setKeizokuBuName(keizokuBuName){
			let keizokuBuNameInput = $("#keizokuBuSelect").find("[name='keizokuBuName']");
			keizokuBuNameInput.val(keizokuBuName);
		}

		<!--/* 裁判所変更時に係属部選択肢を変更 */-->
		$("#saibanshoName").on("change", function(){
			let selectedSaibansho = $("#saibanshoList").find("[value='"+$(this).val()+"']");
			if (selectedSaibansho.length) {
				<!--/* 裁判所が存在する */-->
				let saibanshoId = selectedSaibansho.data("id");
				$("#saibanshoId").val(saibanshoId);
				changeKeizokuBuList(saibanshoId);

			} else {
				<!--/* 裁判所が存在しない */-->
				$("#saibanshoId").val("");
				changeKeizokuBuList("");
			}
		});

		<!--/* 係属部選択時に電話番号・FAX番号を反映 */-->
		$("#keizokuBuSelect").on("change", "#keizokubuSearch", function(){
			let selectedOption = $("#keizokuBuList").find("[value='"+$(this).val()+"']");
			<!--/* ハイフン以外を選択した場合のみ反映 */-->
			if(selectedOption.val()){
				$("#keizokuBuTelNo").val(selectedOption.data("telNo"));
				$("#keizokuBuFaxNo").val(selectedOption.data("faxNo"));
			}
		});

		<!--/* 裁判所初期表示 */-->
		if($("#saibanshoId").val()){
			let saibanshoName = $("#saibanshoList").find("[data-id='"+$("#saibanshoId").val()+"']").val();
			$("#saibanshoName").val(saibanshoName);
		}

		<!--/* 係属部初期表示 */-->
		changeKeizokuBuList($("#saibanshoId").val());

		<!--/* 追記起訴編集モーダル */-->
		$('.editTsuikiso').on('click', function(){
			// [追起訴]ボタン クリック時

			let action = "/user/saibanKeijiManagement/createTsuikisoModal";
			let saibanSeq = $(this).attr('data-saibanSeq');
			let jikenSeq = $(this).attr('data-jikenSeq');
			if (jikenSeq) {
				action = "/user/saibanKeijiManagement/editTsuikisoModal"
			}

			$.ajax({
				url : action,
				type : "POST",
				data : {"saibanSeq" : saibanSeq,
							"jikenSeq" : jikenSeq},
			}).done(function(val) {
				// モーダルの表示
				$('.editTsuikisoBody').html(val);
			}).fail(function(jqXHR, textStatus, errorThrown) {
			}).always(function() {
			});
			
		});

		<!--/* 裁判所名入力時、datalistを設定する */-->
		$('#saibanBasicInputFragment .saibanshoList').on('input', function(){
			if ($(this).val()) {
				$(this).attr('list', 'saibanshoList');
			} else {
				// Safariの場合は、文字入力前にdatalistを設定する必要があるため
				if (isMacSafari()){
					$(this).attr('list', 'saibanshoList');
				} else {
					$(this).removeAttr('list');
				}
			}
		});

		<!--/* 裁判所名クリック時、裁判所名が既に入力済の場合はdatalistを設定する */-->
		$('#saibanBasicInputFragment .saibanshoList').on('click', function(){
			if ($(this).val()) {
				$(this).attr('list', 'saibanshoList');
			} else {
				// Safariの場合は、文字入力前にdatalistを設定する必要があるためクリック時でもdatalistをセットする
				if (isMacSafari()){
					$(this).attr('list', 'saibanshoList');
				}
			}
		});

	});
	</script>

	<div class="main_edit">
		<!--/* HTML */-->
		<form id="saibanBasicInputForm" th:action="@{/user/saibanKeijiManagement/{saibanSeq}/save(saibanSeq=*{saibanSeq})}"
			th:object="${saibanBasicInputForm}">
			
			<!--/* 事件SEQ */-->
			<input type="hidden" th:field="*{jikenSeq}">
			
			<!--/* 入力 */-->
			<div class="row">
				
				<!--/* 左側 */-->
				<div class="col-md-6">
					<div class="detail_input_area">
						<!--/* 事件名 */-->
						<div class="mb-2">
							<label class="input_parts_label">事件名</label>
							<input type="text" class="form-control" th:field="*{jikenName}" maxlength="100" placeholder="事件名を入力してください">
							<div th:if="${#fields.hasErrors('jikenName')}" th:errors="*{jikenName}" class="error_mag_point">error</div>
						</div>
						<!--/* 事件番号 */-->
						<div class="mb-2">
							<label class="input_parts_label">事件番号</label>
							<div class="d-flex align-items-center justify-content-xl-start">
								<select class="form-control digit4" th:field="*{jikenGengo}">
									<option th:each="option : *{jikenGengoOptionList}"
										th:value="${option.value}" th:text="${option.label}"></option>
								</select>
								<input type="text" class="form-control digit2 input_number_only mx-1" th:field="*{jikenYear}" maxlength="2">
								<span class="fs13">年</span>
								<span class="fs13">(</span>
								<input type="text" class="form-control digit3 ml-2" th:field="*{jikenMark}" placeholder="符号" maxlength="2">
								<span class="fs13 ml-2">)</span>
								<span class="fs13">第</span>
								<input type="text" class="form-control digit5 input_number_only ml-1" th:field="*{jikenNo}" placeholder="番号" maxlength="7" >
								<span class="fs13 ml-1">号</span>
							</div>
							<div th:if="${#fields.hasErrors('jikenGengo')}" th:errors="*{jikenGengo}" class="error_mag_point">error</div>
							<div th:if="${#fields.hasErrors('jikenYear')}" th:errors="*{jikenYear}" class="error_mag_point">error</div>
							<div th:if="${#fields.hasErrors('jikenMark')}" th:errors="*{jikenMark}" class="error_mag_point">error</div>
							<div th:if="${#fields.hasErrors('jikenNo')}" th:errors="*{jikenNo}" class="error_mag_point">error</div>
						</div>
						
						<!--/* 裁判所名 */-->
						<div class="mb-2">
							<label class="input_parts_label">裁判所</label>
							<input type="search" class="form-control saibanshoList" autocomplete="off" th:field="*{saibanshoName}" maxlength="100">
							<datalist id="saibanshoList">
								<option th:each="option : *{saibanshoOptionList}"
									th:value="${option.label}" th:data-id="${option.value}"></option>
							</datalist>
							<input type="hidden" th:field="*{saibanshoId}">
							<div th:if="${#fields.hasErrors('saibanshoName')}" th:errors="*{saibanshoName}" class="error_mag_point">error</div>
						</div>
							
						<div class="form-row">
							<!--/* 係属部 */-->
							<div class="form-group col-sm-6">
								<label class="input_parts_label">係属部</label>
								<span id="keizokuBuSelect">
									<input type="text" class="form-control" th:field="*{keizokuBuName}" maxlength="20" tabindex="2">
								</span>
								<div th:if="${#fields.hasErrors('keizokuBuName')}" th:errors="*{keizokuBuName}" class="error_mag_point">error</div>
							</div>
							<!--/* 係属係 */-->
							<div class="form-group col-sm-6">
								<label class="input_parts_label">係属係</label>
								<input type="text" class="form-control" th:field="*{keizokuKakariName}" maxlength="20" tabindex="3">
								<div th:if="${#fields.hasErrors('keizokuKakariName')}" th:errors="*{keizokuKakariName}" class="error_mag_point">error</div>
							</div>
						</div>
						
						
						<!--/* その他 */-->
						<div class="form-row">
							<div class="form-group col-sm-6">
								<div class="jiken_edit_row">
									<!--/* 電話番号 */-->
									<div>
										<label class="input_parts_label">電話番号</label>
										<input type="tel" class="form-control input_num_hyphen" th:field="*{keizokuBuTelNo}" maxlength="13" tabindex="4">
										<div th:if="${#fields.hasErrors('keizokuBuTelNo')}" th:errors="*{keizokuBuTelNo}" class="error_mag_point">error</div>
									</div>
									<!--/* FAX番号 */-->
									<div>
										<label class="input_parts_label">FAX番号</label>
										<input type="tel" class="form-control input_num_hyphen" th:field="*{keizokuBuFaxNo}" maxlength="13" tabindex="5">
										<div th:if="${#fields.hasErrors('keizokuBuFaxNo')}" th:errors="*{keizokuBuFaxNo}" class="error_mag_point">error</div>
									</div>
								</div>
							</div>
							<div class="form-group col-sm-6">
								<div class="jiken_edit_row">
									<!--/* 裁判官 */-->
									<div id="saibanBasicInputSaibankanFragmentWrap" th:insert="user/saibanManagement/saibanCommonFragment::saibanBasicInputSaibankanFragment(*{saibankanInputFormList})">
										<!-- 裁判官情報（入力）の表示 -->
									</div>
									<!--/* 担当書記官 */-->
									<div>
										<label class="input_parts_label">担当書記官</label>
										<input type="text" class="form-control" th:field="*{tantoShoki}" maxlength="128" tabindex="6">
										<div th:if="${#fields.hasErrors('tantoShoki')}" th:errors="*{tantoShoki}" class="error_mag_point">error</div>
									</div>
								</div>
							</div>
						</div>
						<!--/* その他 end */-->
						
					</div>
				</div>
				<!--/* 左側入力エリア end */-->
				
				<!--/* 裁判情報（入力）右側 */-->
				<div class="col-md-6">
					
					<!--/* 右側入力エリア */-->
					<div class="detail_input_area">
						
						<!--/* 担当情報 */-->
						<div class="form-row">
							<div class="input_parts form-group col-sm-6">
								<div
									th:replace="::tantoTemplate(
									itemName='tantoLawyer',
									itemLabel='担当弁護士',
									optionList=*{ankenTantoBengoshiOptionList},
									dispMainTanto=true)">
								</div>
							</div>
							<div class="input_parts form-group col-sm-6">
								<div
									th:replace="::tantoTemplate(
									itemName='tantoJimu',
									itemLabel='担当事務',
									optionList=*{ankenTantoJimuOptionList},
									dispMainTanto=true)">
								</div>
							</div>
						</div>
						<!--/* 担当情報 end */-->
						
						<div class="form-row">
							<!--/* 起訴日 / 上訴日 */-->
							<div class="form-group col-sm-auto">
								<label class="input_parts_label">起訴日／上訴日</label>
								<input type="text" class="form-control modal_date digit7 inputDateSlash" th:field="*{saibanStartDate}" data-click-sync="[data-target-name='saibanStartDate']">
								<button type="button" class="btn btn_popcal hidden" data-toggle="datepicker" data-target-name="saibanStartDate">カレンダー</button>
								<div th:if="${#fields.hasErrors('saibanStartDate')}" th:errors="*{saibanStartDate}" class="error_mag_point">error</div>
							</div>
							<!--/* 判決日 */-->
							<div class="form-group col-sm-auto">
								<label class="input_parts_label">判決日</label>
								<input type="text" class="form-control modal_date digit7 inputDateSlash" th:field="*{saibanEndDate}" data-click-sync="[data-target-name='saibanEndDate']">
								<button type="button" class="btn btn_popcal hidden" data-toggle="datepicker" data-target-name="saibanEndDate">カレンダー</button>
								<div th:if="${#fields.hasErrors('saibanEndDate')}" th:errors="*{saibanEndDate}" class="error_mag_point">error</div>
							</div>
						</div>
						
						<!--/* 裁判結果 */-->
						<div class="form-row">
							<div class="form-group col-sm-12">
								<label class="input_parts_label">裁判結果</label>
								<textarea rows="5" class="form-control" th:field="*{saibanResult}" maxlength="10000"></textarea>
								<div th:if="${#fields.hasErrors('saibanResult')}" th:errors="*{saibanResult}" class="error_mag_point">error</div>
							</div>
						</div>
						
					</div>
					<!--/* 右側入力エリア end */-->
					
					<!--/* ボタン */-->
					<div class="text-right mt-4">
						<!--/* 保存ボタン */-->
						<button type="button" id="saibanBasicSave" class="btn btn-info">
							<i class="fas fa-check"></i>保存
						</button>
						
						<!--/* 閉じるボタン */-->
						<button type="button" class="btn btn-light saibanClose ml-3"
							data-boundary="window" data-container="#saibanBasicInputFragment" data-toggle="tooltip" data-trigger="hover" title="編集モードを閉じる">
							<i class="fas fa-times mr-2"></i>閉じる
						</button>
						
					</div>
				</div>
				<!--/* 裁判情報（入力）右側 end */-->
			</div>
		</form>
	</div>
</div>

<!--/* 担当弁護士・担当事務 入力項目 */-->
<div th:id="|${itemName}Container|" th:fragment="tantoTemplate(itemName, itemLabel, optionList)" th:with="dispMainTanto=${dispMainTanto}?: false">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {
		const $container = $(/*[[|#${itemName}Container|]]*/"");
		
		<!--/* レンダリング時に選択アカウントの表示非表示切り替えを発火 */-->
		hiddenIfSelect();
		
		<!--/* 選択アカウントの表示非表示設定を最新化 */-->
		function hiddenIfSelect() {
			const seletedAccount = getSelectedAccountSeq();
			$container.find(".selectArea button").removeClass("hidden");
			$container.find(".selectArea button").filter((idx, elem) => {
				return seletedAccount.includes($(elem).data("seq"));
			}).addClass("hidden");
			if (canAddUser()) {
				$container.find(".showSelectArea").removeClass("hidden");
			}
		};
		
		<!--/* 選択中のアカウントSEQをArray型で取得 */-->
		function getSelectedAccountSeq() {
			return $.map($container.find("input[name*='accountSeq']"), (elem, idx) => {
				if (elem.value) {
					return Number(elem.value);
				}
			});
		};
		
		<!--/* アカウントが追加可能かどうか */-->
		function canAddUser() {
			return  $container.find("."+ [[${itemName}]] + ".hidden").length > 0;
		}
		
		<!--/* removeした際にパラメータの中抜けが発生するため、パラメータを詰める */-->
		function sortParam() {
			const paramContents = $container.find("."+ [[${itemName}]]);
			const paramJson = $.map(paramContents, (elem, ids) => {
				if($(elem).find("input[name*='accountSeq']").val()) {
					return {
						"seq": $(elem).find("input[name*='accountSeq']").val(),
						"mainTanto": $(elem).find("input[name*='mainTanto']").val() === "true",
						"name":$(elem).find(".accountName").text(),
					};
				} 
			});
			
			paramContents.addClass("hidden")
			paramContents.each((idx, elem) => {
				const params = paramJson[idx];
				if (params) {
					$(elem).find("input[name*='accountSeq']").val(params.seq);
					$(elem).find(".accountName").text(params.name);
					$(elem).removeClass("hidden");

					if (params.mainTanto) {
						$(elem).find(".star_btn_main").addClass("btn_checked");
						$(elem).find("input[name*='mainTanto']").val(true);
					} else {
						$(elem).find(".star_btn_main").removeClass("btn_checked");
						$(elem).find("input[name*='mainTanto']").val(false);
					}
				} else {
					$(elem).find("input[name*='accountSeq']").val("");
					$(elem).find(".star_btn_main").removeClass("btn_checked");
					$(elem).find("input[name*='mainTanto']").val(false);
					$(elem).find(".accountName").text("");
				}
			});
		}
		
		<!--/* 独自popperの表示処理 */-->
		$container.on("click", ".showSelectArea", function() {
			$(".selectArea").addClass("hidden");
			$container.find(".selectArea").removeClass("hidden");
		});
		
		<!--/* 独自popperの閉じる処理 */-->
		$container.on("click", ".closeSelectArea", function() {
			$container.find(".selectArea").addClass("hidden");
		});
		
		<!--/* ここだけdocumentにアクションを追加する*/-->
		const itemName = /*[[${itemName}]]*/"";
		$(document).off("click."+itemName);
		$(document).on("click."+itemName, function(e) {
			if ($(e.target).is(".showSelectArea")) {
				return false;
			}
			if (!$(e.target).closest('.tanto_select').length && !$container.find(".selectArea").hasClass("hidden")) {
				$container.find(".selectArea").toggleClass("hidden");
			}
		});
		
		<!--/* ユーザーの選択処理 */-->
		$container.on("click",".addInputUser", function() {
			const accountSeq = $(this).data("seq");
			const accountName = $(this).text();
			
			const nextContent = $container.find("."+ [[${itemName}]] + ".hidden:first");
			if (!nextContent.length) {
				alert("追加できる上限追加できません")
			}
			
			nextContent.removeClass("hidden");
			nextContent.find("input[name*='accountSeq']").val(accountSeq);
			nextContent.find(".accountName").text(accountName);
			
			// 選択肢の表示非表示切り替え
			hiddenIfSelect();
			
			if(!canAddUser()) {
				$container.find(".selectArea").addClass("hidden");
				$container.find(".showSelectArea").addClass("hidden");
			}
		});
		
		<!--/* ユーザーの選択解除処理 */-->
		$container.on("click",".removeInputUser", function() {
			const refleshContent = $(this).closest("."+ [[${itemName}]]);
			refleshContent.addClass("hidden");
			refleshContent.find(".star_btn_main").removeClass("btn_checked");
			refleshContent.find("input[name*='mainTanto']").val(false);
			refleshContent.find("input[name*='accountSeq']").val("");
			refleshContent.find(".accountName").text("");
			
			hiddenIfSelect();
			sortParam();
			
			// 追加可能の場合
			if(canAddUser()) {
				$container.find(".showSelectArea").removeClass("hidden");
			}
		});
		
	});
	</script>

	<div class="hoverTooltip tanto_block">
		<div class="d-flex align-items-center">
			<div>
				<label th:text="${itemLabel}">担当弁護士</label>
			</div>
			<div class="ml-auto pt-1 mr-3">
				<a href="javascript:void(0);" class="showSelectArea hidden"><i class="fas fa-user-plus mr-2"></i>選択</a>
				
				<!--/* 選択候補のアカウントエリア */-->
				<div class="position-relative">
					<div class="position-absolute tanto_select selectArea hidden">
					
					<!--/* 選択候補が存在する */-->
<!--/*/			<th:block th:if="${!optionList.isEmpty()}"> /*/-->
						<div class="tanto_select_title">担当を選択してください。</div>
						<ul>
							<!--/* 選択候補のアカウント */-->
							<li th:each="option : ${optionList}">
								<button type="button" class="btn btn-light addInputUser" th:data-seq="${option.value}">
									<i class="fas fa-user-check mr-3"></i><span class="tanto_select__account_label" th:text="${option.label}"></span>
								</button>
							</li>
						</ul>
						<div class="tanto_select_footer">
							<button type="button" class="btn btn-light btn_icon_only ml-3 closeSelectArea" title="閉じる">
								<i class="fas fa-times"></i>
							</button>
						</div>
<!--/*/			</th:block> /*/-->
					<!--/* 選択候補が存在する end */-->
					
					</div>
				</div>
				<!--/* 選択候補のアカウントエリア end */-->
				
			</div>
		</div>
		
		<!--/* 選択済みのアカウントエリア */-->
		<div class="row row_list">
			<!--/* 選択候補が存在しない場合 */-->
			<div class="tanto_select_no_data" th:if="${optionList.isEmpty()}">
				<div class="d-flex">
					<div><i class="fas fa-exclamation-triangle mr-2"></i></div>
					<div>
						<p>案件情報で<span th:text="${itemLabel}"></span>（有効なアカウント）を設定してください。</p>
					</div>
				</div>
			</div>
			<!--/* 選択候補が存在しない場合 end */-->
			
<!--/*/		<th:block th:if="${!optionList.isEmpty()}" th:each="i : ${#numbers.sequence(0, T(java.lang.Math).min(optionList.size(), T(jp.loioz.common.constant.CommonConstant).ANKEN_TANTO_ADD_LIMIT) - 1)}"> /*/-->
			<div th:class="|col-auto mw-100 ${itemName} pl-0|" th:object="${saibanBasicInputForm.__${itemName}__[__${i}__]}"
				th:classappend="*{isEmpty()} ? 'hidden'">
				<div class="d-flex align-items-center" th:id="|${itemName}${i}|">
					<input type="button" th:if="${dispMainTanto}" class="star_btn_main" th:classappend="*{mainTanto} ? 'btn_checked': ''"
						data-boundary="window" th:data-container="|#${itemName}${i}|" data-toggle="tooltip" data-trigger="hover" title="主担当">
					<input type="hidden" th:if="${dispMainTanto}" th:field="*{mainTanto}" th:value="*{mainTanto}">
					<input type="hidden" th:field="*{accountSeq}" th:value="*{accountSeq}">
					<th:block th:with="accountSeq=*{accountSeq}">
						<button type="button" class="btn tanto_selected_btn accountName removeInputUser"
							th:text="${saibanBasicInputForm.getAccountName(accountSeq)}"></button>
					</th:block>
				</div>
				<div th:if="${#fields.hasErrors('${saibanBasicInputForm.__${itemName}__[__${i}__]}')}" class="error_mag_point m-2"
					th:errors="${saibanBasicInputForm.__${itemName}__[__${i}__]}">
				</div>
			</div>
<!--/*/		</th:block> /*/-->
		</div>
		<!--/* 選択済みのアカウントエリア end */-->
		
	</div>
</div>

<!--/* 期日一覧 */-->
<div th:fragment="saibanKijitsuViewFragment(saibanKijitsuViewForm)" id="saibanKijitsuViewFragment">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {
		
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		let modal = benzo.global.scheduleModal.modal;
		let scheduleCache = {};

		// 画面読み込み時に予定データを取得
		const isAllTimeKijitsuList = /*[[${saibanKijitsuViewForm.AllTimeKijitsuList}]]*/false;
		const scheduleListSize = /*[[${saibanKijitsuViewForm.saibanKijitsuDtoList.size()}]]*/0;
		if (scheduleListSize) {
			$.ajax({
				type : "GET",
				url : /*[[(@{getSaibanKijitsuDetails})]]*/ "/",
				data : {
					"isAllTimeKijitsuList": isAllTimeKijitsuList
				},
				dataType : "json"
			}).done(function(result) {
				<!--/* 予定キャッシュに予定データを追加 */-->
				$.extend(scheduleCache, result);
				<!--/* 予定登録モーダル表示ボタンの設定 */-->
				setupModalButton();
			}).fail(function() {
			});
		} else {
			<!--/* 予定登録モーダル表示ボタンの設定 */-->
			setupModalButton();
		}
		
		<!--/* 予定モーダルのセットアップ */-->
		function setupModalButton() {
			<!--/* モーダルを開く */-->
			$(".openScheduleModal").on("click", function(){
				<!--/* 保存処理を上書き */-->
				setupSaveAction()

				<!--/* 予定表データを取得 */-->
				let scheduleData = {};
				let scheduleSeq = $(this).data("scheduleSeq");
				let isCreate = $(this).is(".createSaibanLimit");
				let modalConfig = {};
	
				if (isCreate) {
					<!--/* 新規追加モード */-->
					modalConfig.isCreate = true;
					scheduleData = defaultScheduleData();
					
					<!--/* 新規登録時にログインユーザーが弁護士の場合、参加者に追加 */--> 
					const isLawyer =/*[[${T(jp.loioz.common.utility.SessionUtils).isLawyer()}]]*/false;
					if (isLawyer) {
						const myAccountSeq = /*[[${T(jp.loioz.common.utility.SessionUtils).getLoginAccountSeq()}]]*/null;
						scheduleData.member.push(myAccountSeq);
						scheduleData.member = scheduleData.member.filter(function (x, i, self) {
							return self.indexOf(x) === i;
						});
					}
	
				} else {
					<!--/* 編集モード */-->
					modalConfig.isUpdate = true;
					scheduleData = $.extend(true, {}, benzo.global.scheduleModal.emptyScheduleData, scheduleCache[scheduleSeq]);
					let row = $(this).closest(".saibanLimitRow");
					
					const roomIdVal = row.find('.roomIdVal').text();
					if (roomIdVal === '') {
						scheduleData.place = row.find('.placeNameVal').text();
					}
				}
				<!--/* 不要な項目を非表示 */-->
				modal.find("[data-contains='shutteiType']").addClass("hidden");
				
				<!--/* モーダルを表示 */-->
				benzo.global.scheduleModal.openModal(scheduleData, modalConfig);
				<!--/* 裁判主担当の設定 */-->
				benzo.global.scheduleModal.setSaibanMain(scheduleData.saibanSeq);
				<!--/* 裁判担当者プルダウンを設定 */-->
				benzo.global.scheduleModal.setUpSaibanTantoOption(scheduleData.saibanSeq);
	
				<!--/* 裁判期日の作成は無効アカウントを選択肢から外し、hidden化 */-->
				if (isCreate) {
					modal.find(".memberList .member[data-enabled=false]").addClass("hidden");
					modal.find(".memberList .member[data-enabled=false]").trigger("click");
				}
			});
		}
		
		<!--/* 新規の際に使用するデータ */-->
		function defaultScheduleData(saibanLimitCount) {
	
			let scheduleData = $.extend(true, {}, benzo.global.scheduleModal.emptyScheduleData);
	
			let defDateSetting = benzo.global.scheduleModal.getDefaultDateForOther();
			scheduleData.dateFrom = defDateSetting.dateFrom;
			scheduleData.hourFrom = defDateSetting.hourFrom;
			scheduleData.timeFrom = defDateSetting.timeFrom;
			scheduleData.hourTo = defDateSetting.hourTo;
			scheduleData.timeTo = defDateSetting.timeTo;
			let caseNumber = $('#caseNumberVal').text();
			let count = saibanLimitCount ? saibanLimitCount : /*[[${saibanKijitsuViewForm.nextSaibanKijitsuCount}]]*/ null;
			scheduleData.subject = caseNumber + " 第" + count + "回";
			let accoutList = $(".tantoBengoshiView").map(function(){
				return $(this).data('account-seq');
			}).get();
			scheduleData.member = accoutList;
			scheduleData.saibanLimit = true;
			scheduleData.ankenId = ankenId;
			scheduleData.ankenIdDisp = ankenIdDisp;
			scheduleData.ankenName = $('#jikenName').text();
			scheduleData.saibanSeq = saibanSeq;
			scheduleData.saibanId = null;
			scheduleData.caseNumber = caseNumber;
			scheduleData.roomSelected = false;
	
			return scheduleData;
		}
		
		<!--/* 登録・更新・削除ボタン */-->
		function setupSaveAction() {
			benzo.global.scheduleModal.saveAction = function(triggerBtn) {
				if(benzo.global.scheduleModal.ajaxRunning){
					return false;
				}
				let button = $(triggerBtn);
				if (button.is(".deleteButton")) {
					if(!confirm("この予定を削除します。よろしいですか？")){
						return false;
					}
				}
				let params = benzo.global.scheduleModal.getModalFormParams();
				if (button.is(".createButton")) {
					params.saibanLimitCount = /*[[${saibanKijitsuViewForm.nextSaibanKijitsuCount}]]*/ 0;
				}
				benzo.global.scheduleModal.ajaxRunning = true;
				$.ajax({
					type : "POST",
					url : /*[[(@{/user/schedule/needConfirm})]]*/ "/",
					data : params,
					dataType : "json"
				})
				.done(function(checked) {
					if(!button.is(".deleteButton")){
						if(checked.needConfirm &&!confirm(checked.message)){
							ajaxRunning = false;
							return false;
						}
					}
					$.ajax({
						type : "POST",
						url : button.data("url"),
						data : params,
						dataType: 'json',
					})
					.done(function(result) {
						if(result.succeeded){
							modal.modal("hide");
							showInfoMessageForJs(result.message);
							
							// 一覧の再読み込み
							Promise.resolve()
								.then(getSaibanKijitsuView)<!--/* 親HTMLで定義している関数 */-->
								.catch((errors) => {console.log(errors);});
						} else {
							showErrorMessage(result.message, modal,result.errors);
						}
					})
					.fail(function() {
						showErrorMessage(/*[[#{E00013}]]*/ "error", modal);
					})
					.always(function(){
						benzo.global.scheduleModal.ajaxRunning = false;
					});
				}).always(function(){
					benzo.global.scheduleModal.ajaxRunning = false;
				});
			}
		}
		
		<!--/* 「過去の期日も表示」チェックの切り替え */-->
		$('#saibanKijitsuViewFragment #viewAllKijitsuListCheck').on('change', function() {
			// 一覧の再読み込み
			Promise.resolve()
				.then(getSaibanKijitsuView)<!--/* 親HTMLで定義している関数 */-->
				.catch((errors) => {console.log(errors);});
		});
		
		<!--/* 公判期日請書出力 */-->
		$(document).on('click', '.downloadKohanKijitsu', function() {
			let formData = [];
			const scheduleSeq = $(this).data('schedule-seq');
			formData.push(
					{name : "scheduleSeq", value :scheduleSeq},
			);
			const button = $(this);
			const url = "outputKohanKijitsu";
			
			// ダウンロード処理
			downloadFileAjax(url, button, formData);
		});
		
		<!--/* 手続き すべて見る */-->
		$('#saibanKijitsuViewFragment .showAllKijitsuContent').on('click', function() {
			const saibanLimitSeq = $(this).data('saiban-limit-seq');
			showAllKijitsuContent(saibanLimitSeq);
		})
		
		<!--/* 期日結果 すべて見る */-->
		$('#saibanKijitsuViewFragment .showAllKijitsuResult').on('click', function() {
			const saibanLimitSeq = $(this).data('saiban-limit-seq');
			showAllKijitsuResult(saibanLimitSeq);
		})
		
		<!--/* 期日結果 入力フォームポップアップ表示 */-->
		$('#saibanKijitsuViewFragment .kijitsuResultInputOpenLink').on('click', function() {
			
			<!--/* すべての期日結果入力ポップアップを閉じる */-->
			$('#saibanKijitsuViewFragment .kijitsuResultInputFragmentWrap').html('');
			
			const saibanLimitSeq = $(this).data('saiban-limit-seq');
			let dataObj = {
				saibanLimitSeq : saibanLimitSeq
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			<!--/* 期日結果入力フォームを表示 */-->
			Promise.resolve(dataObj)
				.then(renderKijitsuResultInputFormFunc)
				.catch((errorObj) => {
					<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
					console.log(errorObj);
				})
				.finally(() => {
					ajaxRunning = false;
				})
		})
		
		<!--/* 手続き すべて見る */-->
		function showAllKijitsuContent(saibanLimitSeq) {
			changeShowCloseKijitsuContent(saibanLimitSeq, true);
		}
		
		<!--/* -->
		/**
		 * 手続きの表示、閉じるを切り替える
		 * 
		 * @param {number} saibanLimitSeq - 表示を切り替える期日のSEQ
		 * @param {boolean} toShow - true : 表示する false : 閉じる
		 */
		 <!-- */-->
		function changeShowCloseKijitsuContent(saibanLimitSeq, toShow) {
			
			if (toShow) {
				<!--/* 表示 */-->
				
				<!--/* 「すべて見る」部分のコンテンツを非表示 */-->
				$('#showAllKijitsuContentWrap_' + saibanLimitSeq).addClass('hidden');
				
				<!--/* すべての手続き部分のコンテンツを表示 */-->
				$('#allKijitsuContentWrap_' + saibanLimitSeq).removeClass('hidden');
				
			} else {
				<!--/* 閉じる */-->
				<!--/* 閉じる操作は存在しない */-->
			}
		}
		
		<!--/* 期日結果 すべて見る */-->
		function showAllKijitsuResult(saibanLimitSeq) {
			changeShowCloseKijitsuResult(saibanLimitSeq, true);
		}
		
		<!--/* -->
		/**
		 * 期日結果の表示、閉じるを切り替える
		 * 
		 * @param {number} saibanLimitSeq - 表示を切り替える期日のSEQ
		 * @param {boolean} toShow - true : 表示する false : 閉じる
		 */
		 <!-- */-->
		function changeShowCloseKijitsuResult(saibanLimitSeq, toShow) {
			
			if (toShow) {
				<!--/* 表示 */-->
				
				<!--/* 「すべて見る」部分のコンテンツを非表示 */-->
				$('#showAllKijitsuResultWrap_' + saibanLimitSeq).addClass('hidden');
				
				<!--/* すべての期日結果部分のコンテンツを表示 */-->
				$('#allKijitsuResultWrap_' + saibanLimitSeq).removeClass('hidden');
				<!--/* 期日結果の入力ポップアップ部分のコンテンツを表示 */-->
				$('#kijitsuResultInputPopoverBoxWrap_' + saibanLimitSeq).removeClass('hidden');
				<!--/* 閉じる部分のコンテンツを表示 */-->
				$('#closekijitsuResultWrap_' + saibanLimitSeq).removeClass('hidden');
				
			} else {
				<!--/* 閉じる */-->
				<!--/* 閉じる操作は存在しない */-->
			}
		}
		
		<!--/* 期日結果入力フォームの表示関数 */-->
		const renderKijitsuResultInputFormFunc = (dataObj) => {
			return new Promise((resolve, reject) => {
				
				<!--/* オブジェクトのプロパティ値を取得 */-->
				const {saibanLimitSeq} = dataObj;
				
				<!--/* リクエストパラメータ */-->
				const requestData = {
					saibanLimitSeq: saibanLimitSeq
				}
				
				<!--/* クリックされた要素の入力フォームを表示 */-->
				<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
				$.ajax({
					url : 'getSaibanKijitsuResultInputForm',
					type : "GET",
					data : requestData
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// HTML表示
						let fragmentWrapDomId = "kijitsuResultInputFragmentWrap_" + saibanLimitSeq;
						$('#saibanKijitsuViewFragment ' + '#' + fragmentWrapDomId).html(data);
						
						<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
						resolve();
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
					reject();
				})
			});
		}

	});
	</script>
	
	<!--/* HTML */-->
	<th:block th:object="${saibanKijitsuViewForm}">
	
		<section class="section_border section_kijitsu">
			<div class="section_header">
				<div class="section_header__title">期日一覧
					<label class="ml-5 check_area checkbox_btn fs14 fc_sub fw0">
						<input type="checkbox" id="viewAllKijitsuListCheck" class="checkbox_input" th:checked="*{allTimeKijitsuList}">
						<span class="checkbox_txt">過去の予定を全て表示</span>
					</label>
				</div>
				<div class="section_header__action">
					<!--/* 新規追加 */-->
					<a href="javascript:void(0);" class="openScheduleModal createSaibanLimit fs15">
						<i class="fas fa-plus-square mr-2"></i>期日を追加
					</a>
				</div>
			</div>
			<div class="section_body">
				<div class="section_body__contents p-0">
	<!--/*/		<th:block th:if="*{saibanKijitsuDtoList.size() == 0}"> /*/-->
					<div class="no_data_msg">
						<span th:text="#{I00035('期日情報の登録')}">MSG_I00035</span>
					</div>
	<!--/*/		</th:block> /*/-->
	
	<!--/*/		<th:block th:if="*{saibanKijitsuDtoList.size() > 0}"> /*/-->
					<ul class="section_list">
						<!--/* 期日一覧表示 */-->
						<li class="list_contents saibanLimitRow" th:each="dto : *{saibanKijitsuDtoList}">
							<div class="section_list_item_wrap">
								<div class="row">
									<!--/* 期日カレンダー情報 */-->
									<div class="col-md-7">
										<div class="section_list_item">
											<div class="item_title_block">
												<div class="item_title" th:classappend="${dto.isKakoKijitsu()} ? 'fc_disabled' : ''">
													<div class="info_name">
														<i th:unless="${dto.isKakoKijitsu()}" class="fas fa-user-clock text-danger"></i>
														<i th:if="${dto.isKakoKijitsu()}" class="fas fa-user-check"></i>
														<span th:text="${dto.subject}">口頭弁論期日</span>
													</div>
												</div>	
												<!-- /* ボタンエリア */ -->
												<div class="item_sub d-flex">
													<div class="d-flex justify-content-end align-items-center" th:id="|kensatsukanEditContainer${dto.saibanLimitSeq}|">
														<!--/* 期日請書を出力ボタン */-->
														<div> 
															<button type=button class="btn btn-light btn_icon_only downloadKohanKijitsu" th:data-schedule-seq="${dto.scheduleSeq}"
																data-boundary="window" th:data-container="|#kensatsukanEditContainer${dto.saibanLimitSeq}|" data-toggle="tooltip" data-trigger="hover" title="公判期日請書を出力する">
																<i class="fas fa-download text-primary mr-0"></i>
																<i class="fas fa-spinner mr-0 text-primary faa-spin animated hidden"></i>
															</button>
														</div>
														<!--/* 編集ボタン */-->
														<div class="ml-3">
															<button class="btn btn-light btn_icon_only btn_icon_edit openScheduleModal"
																data-boundary="window" th:data-container="|#kensatsukanEditContainer${dto.saibanLimitSeq}|" data-toggle="tooltip" data-trigger="hover" title="期日を編集する"
																th:data-schedule-seq="${dto.scheduleSeq}"
																th:data-saiban-limit-seq="${dto.saibanLimitSeq}"
																th:data-limit-at="${{dto.limitAt}}"
																th:data-count="${dto.limitDateCount}"><i class="fas fa-edit"></i>
															</button>
														</div>
														<span class="roomIdVal hidden" th:text="${dto.roomId}"></span>
													</div>
												</div>
											</div>
												
											<!--/* データブロック */-->
											<div class="item_content_block">
												<div class="item_content__info">
													<!-- /* 期日回数・予定 */ -->
													<span class="badge badge-pill badge_blue" th:text="|第${dto.limitDateCount}回|">第1回</span>
													<div class="kijitsu_time"  th:classappend="${dto.isKakoKijitsu()} ? 'kijitsu_close' : ''">
														<i class="far fa-calendar-check mr-2"></i>
														<span th:text="${#temporals.format(dto.limitAt, 'M月d日')}"></span>
														<span th:text="| (${#temporals.format(dto.limitAt, 'E')})|"></span>
														<span th:text="${#temporals.format(dto.limitAt, 'H:mm')}"></span>
														<span> ～ </span>
														<span th:text="${#temporals.format(dto.timeTo, 'H:mm')}"></span>
													</div>
													<!-- /* 出廷要否 */ -->
													<div>
														<select class="form-control digit7" disabled="disabled">
															<th:block th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$ShutteiType).values()}">
																<option th:value="${enum.cd}" th:text="${enum.val}" th:selected="${enum.equalsByCode(dto.shutteiType)}"></option>
															</th:block>
														</select>
													</div>
												</div>
												
												<!--/* 場所 */-->
												<div class="px-3 mt-1 mb-2">
													<label class="view_label">場所</label>
													<div class="view_value fs15">
														<span class="placeNameVal" th:text="${dto.placeName}"></span>
														<span th:if="${#strings.isEmpty(dto.placeName)}" class="sub_text">(指定なし)</span>
													</div>
												</div>
												<!--/* 手続き */-->
												<div class="px-3 mb-2">
													<label class="view_label">手続き</label>
													<div class="view_value fs15">
														<span th:if="${#strings.isEmpty(dto.content)}" class="sub_text">(記載なし)</span>
														<!--/* 手続きの表示 */-->
														<div th:unless="${#strings.isEmpty(dto.content)}"
															class="kijitsu_result"
															th:with="
																initShowMaxCharCountKijitsuContent=*{INIT_SHOW_MAX_CHAR_COUNT_KIJITSU_CONTENT},
																isOverCharCount=(${initShowMaxCharCountKijitsuContent} < ${#strings.length(dto.content)})">
																
															<!-- 文字数が多い場合の表示 -->
															<th:block th:if="${isOverCharCount}">
																<!-- 一部の本文文字のみ表示（すべて見るリンク） -->
																<div th:id="|showAllKijitsuContentWrap_${dto.saibanLimitSeq}|">
																	<!-- 本文 -->
																	<span myth:nl2br="|${#strings.substring(dto.content,0,initShowMaxCharCountKijitsuContent)}|"></span>
																	<!-- すべて見るリンク -->
																	<p class="mb-0 text-left">
																		<a href="javascirpt:void(0);" onClick="return false;">
																			<span class="showAllKijitsuContent" th:data-saiban-limit-seq="${dto.saibanLimitSeq}">
																				...すべて見る
																			</span>
																		</a>
																	</p>
																</div>
																<!-- 全ての手続き文字を表示（すべて見るリンククリックで表示する） -->
																<div th:id="|allKijitsuContentWrap_${dto.saibanLimitSeq}|" class="hidden">
																	<!-- 備考 -->
																	<div>
																		<span myth:nl2br="${dto.content}"></span>
																	</div>
																</div>
															</th:block>
															
															<!-- 文字数が多くない場合の表示 -->
															<th:block th:unless="${isOverCharCount}">
																<!--  全ての手続き文字を表示 -->
																<div>
																	<!-- 手続き -->
																	<span myth:nl2br="${dto.content}"></span>
																</div>
															</th:block>
														</div>
													<!--/* 手続きデータ end */-->
													</div>
													<!--/* 手続き end */-->
												</div>
											</div>
										</div>
									</div>
									<!--/* 期日カレンダー情報 end */-->
									
									<!-- 期日結果エリア -->
									<div class="col-md-5">
										<div class="section_list_item">
											<div class="item_content_block pt-0">
												<!--/* 期日結果 */-->
												<div>
													<label class="view_label">期日結果</label>
													<div class="view_value fs15">
															<!-- 期日結果が未登録の場合 -->
															<div th:if="${#strings.isEmpty(dto.result)}"
																class="kijitsu_result">
															
																<!-- 期日結果情報は表示しない -->
															
																<!-- 期日結果の入力ポップアップ -->
																<div class="popover_box_wrap">
																	<div class="mt-2">
																		<!--/* 顧客追加 */-->
																		<button type="button" class="btn btn-sm btn-light text-info kijitsuResultInputOpenLink" th:data-saiban-limit-seq="${dto.saibanLimitSeq}">
																			<i class="fas fa-edit mr-2"></i>期日結果を入力
																		</button>
																	</div>
																	<div th:id="|kijitsuResultInputFragmentWrap_${dto.saibanLimitSeq}|" class="kijitsuResultInputFragmentWrap">
																		<!--/* 期日結果入力フォーム */-->
																	</div>
																</div>
															</div>
															
															<!-- 期日結果が登録済みの場合 -->
															<div th:unless="${#strings.isEmpty(dto.result)}"
																class="kijitsu_result fs15"
																th:with="
																	initShowMaxCharCountKijitsuResult=*{INIT_SHOW_MAX_CHAR_COUNT_KIJITSU_RESULT},
																	isOverCharCount=(${initShowMaxCharCountKijitsuResult} < ${#strings.length(dto.result)})">
																
																<!-- 文字数が多い場合 期日結果情報 -->
																<th:block th:if="${isOverCharCount}">
																	<!-- 一部の期日結果み表示（すべて見るリンク） -->
																	<div th:id="|showAllKijitsuResultWrap_${dto.saibanLimitSeq}|">
																	<span myth:nl2br="|${#strings.substring(dto.result,0,initShowMaxCharCountKijitsuResult)}|"></span>
																	<p class="m-0 text-left">
																		<a href="javascirpt:void(0);" onClick="return false;">
																			<span class="showAllKijitsuResult" th:data-saiban-limit-seq="${dto.saibanLimitSeq}">
																				...すべて見る
																			</span>
																		</a>
																	</p>
																</div>
																<!-- すべて見るリンククリックで表示する -->
																<div th:id="|allKijitsuResultWrap_${dto.saibanLimitSeq}|" class="hidden">
																	<span myth:nl2br="${dto.result}"></span>
																</div>
															</th:block>
															
															<!-- 文字数が多くない場合 期日結果情報 -->
															<th:block th:unless="${isOverCharCount}">
																<!--  全ての期日結果を表示 -->
																<div>
																	<span myth:nl2br="${dto.result}"></span>
																</div>
															</th:block>
															
															<div class="d-flex">
																<!-- 期日結果の入力ポップアップ -->
																<div th:id="|kijitsuResultInputPopoverBoxWrap_${dto.saibanLimitSeq}|" class="popover_box_wrap" th:classAppend="${isOverCharCount} ? 'hidden'">
																	<div class="mt-2">
																			<!--/* 顧客追加 */-->
																			<a href="javascirpt:void(0);" onClick="return false;">
																			<button type="button" class="btn btn-sm btn-light kijitsuResultInputOpenLink" th:data-saiban-limit-seq="${dto.saibanLimitSeq}">
																				<i class="fas fa-edit mr-2"></i>編集
																			</button>
																		</a>
																	</div>
																	<div th:id="|kijitsuResultInputFragmentWrap_${dto.saibanLimitSeq}|" class="kijitsuResultInputFragmentWrap">
																		<!--/* 期日結果入力フォーム */-->
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</li>
						<!--/* 期日一覧 end */-->
					</ul>
				</div>
			</div>
		</section>

	</th:block>
	
</div>

<!--/* 期日結果入力 */-->
<div th:fragment="saibanKijitsuResultInputFragment" id="saibanKijitsuResultInputFragment">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();
		
		<!--/* 期日結果の保存 */-->
		$('#saibanKijitsuResultInputFragment #saveSaibanKijitsuResult').on('click', function() {
			
			let formData = $('#saibanKijitsuResultInputFragment .saibanKijitsuResultInputForm').serializeArray();
			let saibanLimitSeq = $('#saibanKijitsuResultInputFragment .saibanKijitsuResultInputForm #saibanLimitSeq').val();
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			$.ajax({
				url : 'saveSaibanKijitsuResult',
				type : "POST",
				data : formData
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
					// 期日一覧の再読み込み
					Promise.resolve()
						.then(getSaibanKijitsuView)<!--/* 親HTMLで定義している関数 */-->
						.catch((errors) => {console.log(errors);});
					
				} else {
					// 処理失敗
					
					if (data) {
						// HTMLのコンテンツが返却されている場合
						
						// HTML表示（親HTMLのID）
						let fragmentWrapDomId = "kijitsuResultInputFragmentWrap_" + saibanLimitSeq;
						$('#saibanKijitsuViewFragment ' + '#' + fragmentWrapDomId).html(data);
					}
					
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
			
		})
		
	});
	</script>
	
	<!--/* HTML */-->
	<form th:object="${saibanKijitsuResultInputForm}" class="saibanKijitsuResultInputForm">
		<div class="popover_box position_right notAutoClose w_xlarge h_medium popover_arrow popoverBox px-4">
			<div class="popover_box_header pt-4 pl-0">
				<div class="popover_box_header_title">期日結果を入力してください。</div>
			</div>
			<div class="popover_box_body border-0">
				<div class="popover_box_content pl-0 m-0">
					<textarea th:field="*{kijitsuResult}" rows="5" class="form-control" maxlength="5000"></textarea>
					<input type="hidden" th:field="*{saibanLimitSeq}">
				</div>
				<div th:if="${#fields.hasErrors('kijitsuResult')}" th:errors="*{kijitsuResult}" class="error_mag_point">error</div>
				
				<div class="popover_box_command_area border-0">
					<!--/* 保存ボタン */-->
					<button type="button" id="saveSaibanKijitsuResult" class="btn btn-info btn-sm btn_icon_save">
						<i class="fas fa-check mr-2"></i>保存
					</button>
					
					<!--/* 閉じるボタン */-->
					<button type="button" class="btn btn-light btn-sm ml-3 closePopoverBox" title="閉じる">
						<i class="fas fa-times"></i>閉じる
					</button>
				</div>
			</div>
		</div>
	</form>
</div>

<!--/* 顧客一覧 */-->
<div th:fragment="saibanCustomerViewFragment(saibanCustomerViewForm)" id="saibanCustomerViewFragment">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();
		
		<!--/* 名簿ポップオーバー */-->
		benzo.global.fragment.setUpPersonPopover($("#saibanCustomerViewFragment .personPopoverLabel"));
		
		<!--/* 顧客：【筆頭】切り替え処理 */-->
		$('#saibanCustomerViewFragment .hittou_btn').on('click', function () {
			
			<!--/* 対象顧客 */-->
			const customerId = $(this).data('customer-id')
			
			<!--/* 筆頭かどうか */-->
			let toHittou = false;
			
			const isSelected = $(this).hasClass('selected')
			if (isSelected) {
				<!--/* 「筆頭」状態のものがクリックされた */-->
				<!--/* 自身を「筆頭」ではない状態にする */-->
				toHittou = false;
			} else {
				<!--/* 「筆頭」状態ではないものがクリックされた */-->
				<!--/* 自身を「筆頭」にする */-->
				toHittou = true;
			}
			
			let dataObj = {
				customerId: customerId,
				toHittou: toHittou
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			<!--/* 筆頭情報の更新と顧客情報の再描画を行ったのち、共犯者の再描画を行う */-->
			Promise.resolve(dataObj)
				.then(updateHittouAndRenderSaibanCustomerViewFormFunc)
				.then(renderSaibanOtherViewFormFunc)<!--/* 親HTMLで定義している関数 */-->
				.catch((errorObj) => {
					<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
					console.log(errorObj);
				})
				.finally(() => {
					ajaxRunning = false;
				})
		})

		<!--/* 顧客：【当事者表記】切り替え処理 */-->
		$('#saibanCustomerViewFragment .tojishaHyokiSelect').on('change', function() {
			
			const customerId = $(this).data('customer-id');
			const selectedVal = $(this).val();
			
			<!--/* リクエストパラメータ */-->
			const requestData = {
				customerId: customerId,
				tojishaHyoki: selectedVal
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			$.ajax({
				url : /*[[@{/user/saibanKeijiManagement/{saibanSeq}/{ankenId}/saveCustomerTojishaHyoki(saibanSeq=*{saibanSeq}, ankenId=*{ankenId})}]]*/"",
				type : "POST",
				data : requestData
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					
					// 親HTMLのID
					$('#saibanCustomerViewFragmentWrap').html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					// 処理失敗
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
		})

		<!--/* 顧客追加リンクのクリック */-->
		$('#saibanCustomerViewFragment #customerAddButton').on('click', function() {
			
			<!--/* 特にデータは必要ないので空とする */-->
			let dataObj = {}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			<!--/* 顧客追加フォームを表示 */-->
			Promise.resolve(dataObj)
				.then(renderCustomerAddInputFormFunc)
				.catch((errorObj) => {
					<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
					console.log(errorObj);
				})
				.finally(() => {
					ajaxRunning = false;
				})
		})
		
		<!--/* 被告人から外すボタンのクリック */-->
		$('#saibanCustomerViewFragment .removeSaibanCustomer').on('click', function() {

			if (!confirm('被告人から外します。よろしいですか?')) {
				return false;
			}

			const customerId = $(this).data('customer-id');
			if (!customerId) {
				return;
			}
			
			<!--/* リクエストパラメータ */-->
			const formData = {
				customerId: customerId
			}
			
			let $clickedElem = $(this)
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			$.ajax({
				url : 'removeSaibanCustomer',
				type : "POST",
				data : formData
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					
					// 被告人から外した後の顧客情報再描画
					$('#saibanCustomerViewFragmentWrap').html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					// 処理失敗
					
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
		})
		
		<!--/* 当事者の筆頭情報の更新関数（更新後、顧客情報部分を再描画） */-->
		const updateHittouAndRenderSaibanCustomerViewFormFunc = (dataObj) => {
			return new Promise((resolve, reject) => {
				
				<!--/* オブジェクトのプロパティ値を取得 */-->
				const {customerId, toHittou} = dataObj;
				
				let requestData = {
					customerId: customerId,
					toHittou: toHittou
				}
				
				<!--/* 当事者の筆頭情報の更新 */-->
				<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
				$.ajax({
					url : 'saveTojishaHittou',
					type : "POST",
					data : requestData
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 顧客の筆頭更新後の顧客情報再描画
						$('#saibanCustomerViewFragmentWrap').html(data);
						
						<!--/* 成功メッセージを後続処理へ渡す */-->
						dataObj.successMessage = getAjaxProcResutlMessage(jqXHR);
						
						resolve(dataObj);
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
					reject();
				})
			});
		}
		
		<!--/* 顧客追加フォームの表示関数 */-->
		const renderCustomerAddInputFormFunc = (dataObj) => {
			return new Promise((resolve, reject) => {
				
				<!--/* クリックされた要素の登録（追加）フォームを表示 */-->
				<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
				$.ajax({
					url : 'getSaibanCustomerAddInputForm',
					type : "GET"
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// HTML表示
						$('#saibanCustomerViewFragment #saibanCustomerAddInputFragmentWrap').html(data);
						
						<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
						resolve();
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
					reject();
				})
			});
		}
	});
	</script>

	<!--/* HTML */-->
	<th:block th:object="${saibanCustomerViewForm}">

		<section class="section_client_side">
			<div class="section_header">
				<div class="section_header__title">顧客（被告人）情報</div>
				<div class="section_header__action">
					<div class="customer_add_wrap popover_box_wrap">
						<!--/* 顧客（被告人）追加 */-->
						<a href="javascirpt:void(0);" onClick="return false;" class="fs15">
							<span id="customerAddButton">
								<i class="fas fa-plus-square mr-2"></i>顧客（被告人）を追加
							</span>
						</a>
						<div id="saibanCustomerAddInputFragmentWrap">
							<!--/* 顧客（被告人）追加フォーム */-->
						</div>
					</div>
				</div>
			</div>
			<div class="section_body">
				<div class="section_body__contents p-0">
					
	<th:block th:if="${#lists.isEmpty(saibanCustomerViewForm.saibanCustomerDtoList)}">
					<div class="no_data_msg px-4">
						<span th:text="#{I00035('顧客（被告人）')}">MSG_I00035</span>
					</div>
	</th:block>
					
	<th:block th:unless="${#lists.isEmpty(saibanCustomerViewForm.saibanCustomerDtoList)}">
					<ul class="section_list p-2">
						<!--/* 顧客一覧表示 */-->
						<li class="list_contents" th:each="customer : *{saibanCustomerDtoList}">
							<div class="section_list_item_wrap">
								<div class="section_list_item">
									<!--/* 名簿 */-->
									<div class="img_info_xs mb-2">
										<!--/* 名簿画像 */-->
										<div class="img_info_xs__image">
											<!--/* 名簿属性ラベル */-->
											<div th:class="|person_image_wrapper${customer.personAttribute?.cd.getCd()}|">
												<!--/* 個人アイコン */-->
												<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).KOJIN.equals(customer.customerType)}" 
													class="img-thumbnail person_image_xs" th:src="@{/img/person_kojin.svg}"
													data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="個人">
													
												<!--/* 企業・団体アイコン */-->
												<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).HOJIN.equals(customer.customerType)}"
													class="img-thumbnail person_image_xs" th:src="@{/img/person_hojin.svg}"
													data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="企業・団体">
													
												<!--/* 弁護士アイコン */-->
												<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).LAWYER.equals(customer.customerType)}"
													class="img-thumbnail person_image_xs" th:src="@{/img/person_bengoshi.svg}"
													data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="弁護士">
											</div>
										</div>
										<!--/* 名簿画像 end */-->
										
										<!--/* 名前 */-->
										<div class="img_info_xs__info">
											<div class="fw600 fs20 lh1_3 pt-1" th:text="${customer.customerName}">山田　太郎 </div>
											<div>
												<!-- /* 名簿ID */ -->
												<a href="javascript:void(0);" class="app_id_link p-1 personPopoverLabel" th:text="|名簿ID：${customer.personId.asLong()}|"
													data-boundary="window" data-container="#saibanCustomerViewFragment" th:data-person-id="${customer.personId.asLong()}">
												</a>
											</div>
										</div>
										<!-- /* ボタンエリア */ -->
										<div class="img_info_xs__btn">
											<div class="item_sub">
												<!--/* 当事者から外すボタン */-->
												<button type="button" class="btn btn-light btn_icon_only btn_icon_user_minus removeSaibanCustomer"
													th:data-customer-id="${customer.customerId.asLong()}"
													data-boundary="window" data-container="#saibanCustomerViewFragment" data-toggle="tooltip"
													data-trigger="hover" title="被告人から外す">
													<i class="fas fa-user-minus"></i>
												</button>
											</div>
										</div>
										<!--/* 名前 end */-->
									</div>
									<!--/* データブロック */-->
									<div class="item_content_block">
										<!--/* 筆頭エリア */-->
										<div class="hittou_select_area pl-1">
											<div class="mb-1">
												<a href="javascript:void(0);" class="btn hittou_btn px-3"
													th:classAppend="${customer.mainFlg} ? 'selected'" th:data-customer-id="${customer.customerId.asLong()}">筆頭</a>
											</div>
											<div>
												<select class="form-control hyoki_select tojishaHyokiSelect"
													th:data-customer-id="${customer.customerId.asLong()}">
													<option value="">-</option>
													<th:block th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$TojishaHyoki).values()}">
														<option th:value="${enum.cd}" th:text="${enum.val}" th:selected="${enum.cd.equals(customer.saibanTojishaHyoki)}"></option>
													</th:block>
												</select>
											</div>
										</div>
									</div>
								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</section>
	</th:block>

</div>

<!--/* 顧客（被告人）追加 */-->
<div th:fragment="saibanCustomerAddInputFragment" id="saibanCustomerAddInputFragment">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {

		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();

		<!--/* 顧客（被告人）追加の保存 */-->
		$('#saibanCustomerAddInputFragment #registSaibanCustomerAdd').on('click', function () {
			
			let formData = $('#saibanCustomerAddInputFragment .saibanCustomerAddInputForm').serializeArray();

			if(!formData.find((v) => v.value === "true")) {
				alert("被告人を選択してください。");
				return false;
			}

			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			$.ajax({
				url : 'registSaibanCustomerAdd',
				type : "POST",
				data : formData
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					
					// 顧客情報表示部のID
					$('#saibanCustomerViewFragmentWrap').html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					// 処理失敗
					
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
			
		})
		
	});
	</script>
	
	<!--/* HTML */-->
	<form th:object="${saibanCustomerAddInputForm}" class="saibanCustomerAddInputForm">
		<div class="popover_box position_right w_small h_medium popover_arrow popoverBox">
			<div class="popover_box_header">
				<div class="popover_box_header_title">被告人を追加</div>
			</div>
			<div class="popover_box_body">
				<div class="popover_box_content">
					<th:block th:if="*{addCustomerCandidateList.size() != 0}">
						<th:block th:each="candidate, candidateStat : *{addCustomerCandidateList}">
							<p class="m-0">
								<label class="checkbox_btn">
									<input type="checkbox" class="checkbox_input" th:field="*{addCustomerCandidateList[__${candidateStat.index}__].toAdd}">
									<span class="checkbox_txt" th:text="*{addCustomerCandidateList[__${candidateStat.index}__].title}">顧客　太郎</span>
								</label>
							</p>
							<input type="hidden" th:field="*{addCustomerCandidateList[__${candidateStat.index}__].seq}">
						</th:block>
					</th:block>
					<th:block th:unless="*{addCustomerCandidateList.size() != 0}">
						<i class="fas fa-exclamation-circle mr-2"></i>選択できる顧客情報がありません。
					</th:block>
				</div>
				<th:block th:if="*{addCustomerCandidateList.size() != 0}">
					<div class="popover_box_command_area">
						<!--/* 保存ボタン */-->
						<button type="button" id="registSaibanCustomerAdd" class="btn btn-info btn_icon_only btn_icon_save">
							<i class="fas fa-check m-0"></i>
						</button>
						
						<!--/* 閉じるボタン */-->
						<button type="button" class="btn btn-light btn_icon_only ml-3 closePopoverBox" title="閉じる">
							<i class="fas fa-times"></i>
						</button>
					</div>
				</th:block>
			</div>
		</div>
	</form>
</div>

<!--/* 共犯者一覧 */-->
<div th:fragment="saibanOtherViewFragment(saibanOtherViewForm)" id="saibanOtherViewFragment">

	<!--/* 関与者モーダルを扱うので共通JS定義 */-->
	<script type="text/javascript" th:replace="common/mvc/kanyosha/kanyoshaEditModal::kanyoshaEditModalFragmentObjJs"></script>

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {
		
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();
		
		<!--/* 名簿ポップオーバー */-->
		benzo.global.fragment.setUpPersonPopover($("#saibanOtherViewFragment .personPopoverLabel"));

		<!--/* 共犯者：【筆頭】切り替え処理 */-->
		$('#saibanOtherViewFragment .hittou_btn').on('click', function () {
			
			<!--/* 対象関与者 */-->
			const kanyoshaSeq = $(this).data('kanyosha-seq')
			
			<!--/* 筆頭かどうか */-->
			let toHittou = false;
			
			const isSelected = $(this).hasClass('selected')
			if (isSelected) {
				<!--/* 「筆頭」状態のものがクリックされた */-->
				<!--/* 自身を「筆頭」ではない状態にする */-->
				toHittou = false;
			} else {
				<!--/* 「筆頭」状態ではないものがクリックされた */-->
				<!--/* 自身を「筆頭」にする */-->
				toHittou = true;
			}
			
			let dataObj = {
				kanyoshaSeq: kanyoshaSeq,
				toHittou: toHittou
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			<!--/* 筆頭情報の更新と顧客情報の再描画を行ったのち、共犯者の再描画を行う */-->
			Promise.resolve(dataObj)
				.then(updateHittouAndRenderSaibanCustomerViewFormFunc)
				.then(renderSaibanOtherViewFormFunc)<!--/* 親HTMLで定義している関数 */-->
				.catch((errorObj) => {
					<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
					console.log(errorObj);
				})
				.finally(() => {
					ajaxRunning = false;
				})
		})
		
		<!--/* 当事者の筆頭情報の更新関数（更新後、顧客情報部分を再描画） */-->
		const updateHittouAndRenderSaibanCustomerViewFormFunc = (dataObj) => {
			return new Promise((resolve, reject) => {
				
				<!--/* オブジェクトのプロパティ値を取得 */-->
				const {kanyoshaSeq, toHittou} = dataObj;
				
				let requestData = {
					kanyoshaSeq: kanyoshaSeq,
					toHittou: toHittou
				}
				
				<!--/* 当事者の筆頭情報の更新 */-->
				<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
				$.ajax({
					url : 'saveTojishaHittou',
					type : "POST",
					data : requestData
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 親HTMLのID表示
						$('#saibanCustomerViewFragmentWrap').html(data);
						
						<!--/* 成功メッセージを後続処理へ渡す */-->
						dataObj.successMessage = getAjaxProcResutlMessage(jqXHR);
						
						resolve(dataObj);
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
					reject();
				})
			});
		}

		<!--/* 顧客・共犯者：【当事者表記】切り替え処理 */-->
		$('#saibanOtherViewFragment .tojishaHyokiSelect').on('change', function() {

			const kanyoshaSeq = $(this).data('kanyosha-seq');
			const selectedVal = $(this).val();
			
			<!--/* リクエストパラメータ */-->
			const requestData = {
				kanyoshaSeq: kanyoshaSeq,
				tojishaHyoki: selectedVal
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			$.ajax({
				url : 'saveKanyoshaTojishaHyoki',
				type : "POST",
				data : requestData
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					
					// 親HTMLのID
					$('#saibanOtherViewFragmentWrap').html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					// 処理失敗
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
		})

		<!--/* 共犯者から外すボタンのクリック*/-->
		$('#saibanOtherViewFragment').on('click', '.removeSaibanKanyosha', function() {
			const kyohanshaContainer = $($(this).data('target'));
			const kanyoshaSeq = kyohanshaContainer.data('kanyosha-seq');

			if (!confirm('共犯者から外します。よろしいですか?')) {
				return false;
			}

			if (!kanyoshaSeq) {
				return;
			}
			
			<!--/* リクエストパラメータ */-->
			const formData = {
					kanyoshaSeq: kanyoshaSeq
			}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			$.ajax({
				url : /*[[@{/user/saibanKeijiManagement/{saibanSeq}/{ankenId}/removeSaibanKanyosha(saibanSeq=*{saibanSeq}, ankenId=*{ankenId})}]]*/"",
				url : 'removeSaibanKanyosha',
				type : "POST",
				data : formData
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					
					// 親HTMLのID
					$('#saibanOtherViewFragmentWrap').html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					// 処理失敗
					
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
		})
		
		<!--/* 案件から外す（共犯者）ボタンのクリック(関与者モーダルと同じ動作)*/-->
		$('#saibanOtherViewFragment').on('click', '.removeSaibanKanyoshaFromAnken', function() {
			const kyohanshaContainer = $($(this).data('target'));
			const kanyoshaSeq = kyohanshaContainer.data('kanyosha-seq');
			
			if (!confirm('案件から外します。よろしいですか?')) {
				return false;
			}
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			<!--/* リクエストパラメータ */-->
			const formData = {
					kanyoshaSeq: kanyoshaSeq
			}
			Promise.resolve()
			.then(() => deleteKanyoshaFromAnkenbeforeCheck(formData))
			.then(() => deleteKanyoshaFromAnken(formData))
			.then(() => getSaibanOtherView())
			.catch((errorObj) => console.log(errorObj))
			.finally(() => ajaxRunning = false);
			
			function deleteKanyoshaFromAnkenbeforeCheck(formData) {
				return new Promise((resolve, reject) => {
					$.ajax({
						type : "POST",
						url : /*[[@{/user/saibanKeijiManagement/{saibanSeq}/{ankenId}/removeSaibanKanyoshaFromAnkenBeforeCheck(saibanSeq=*{saibanSeq}, ankenId=*{ankenId})}]]*/"",
						url : 'removeSaibanKanyoshaFromAnkenBeforeCheck',
						data : formData
					}).done(function(data) {
						if (data.needConfirm && !confirm(data.message)) {
							return reject();
						} else {
							return resolve();
						}
					}).fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessageForJs(errorMsg);
						return reject();
					});
				});
			}
			
			function deleteKanyoshaFromAnken(formData) {
				return new Promise((resolve, reject) => {
					$.ajax({
						type : "POST",
						url : /*[[@{/user/saibanKeijiManagement/{saibanSeq}/{ankenId}/removeSaibanKanyoshaFromAnken(saibanSeq=*{saibanSeq}, ankenId=*{ankenId})}]]*/"",
						url : 'removeSaibanKanyoshaFromAnken',
						data : formData,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							showInfoMessageForJs(/*[[#{I00028('共犯者情報')}]]*/'')
							return resolve()
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessageForJs(errorMsg);
						return reject();
					});
				});
			}
		})

		<!--/* 弁護人から外すボタンのクリック */-->
		$('#saibanOtherViewFragment').on('click','.removeSaibanRelatedKanyosha', function() {
			const bengoninContainer = $($(this).data('target'));
			const kanyoshaSeq = bengoninContainer.data('kanyosha-seq');
			if (!confirm('弁護人から外します。よろしいですか?')) {
				return false;
			}

			if (!kanyoshaSeq) {
				return;
			}
			
			<!--/* リクエストパラメータ */-->
			const formData = {
					kanyoshaSeq: kanyoshaSeq
			}
			
			let $clickedElem = $(this)
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			
			$.ajax({
				url : /*[[@{/user/saibanKeijiManagement/{saibanSeq}/{ankenId}/removeSaibanRelatedKanyosha(saibanSeq=*{saibanSeq}, ankenId=*{ankenId})}]]*/"",
				type : "POST",
				data : formData
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					
					// 親HTMLのID
					$('#saibanOtherViewFragmentWrap').html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					// 処理失敗
					
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
		})
		<!--/* 弁護人の「案件から外す」ボタンのクリック */-->
		$('#saibanOtherViewFragment').on('click','.removeSaibanRelatedKanyoshaFromAnken', function() {
			const bengoninContainer = $($(this).data('target'));
			const bengoninSeq = bengoninContainer.data('bengonin-kanyosha-seq');

			if (!confirm('案件から外します。よろしいですか?')) {
				return false;
			}

			if (!bengoninSeq) {
				return;
			}

			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			ajaxRunning = true;
			<!--/* リクエストパラメータ */-->
			const formData = {
					kanyoshaSeq: bengoninSeq
			}
			Promise.resolve()
			.then(() => deleteKanyoshaFromAnkenbeforeCheck(formData))
			.then(() => deleteKanyoshaFromAnken(formData))
			.then(() => getSaibanOtherView())
			.catch((errorObj) => console.log(errorObj))
			.finally(() => ajaxRunning = false);
			
			function deleteKanyoshaFromAnkenbeforeCheck(formData) {
				return new Promise((resolve, reject) => {
					$.ajax({
						type : "POST",
						url : /*[[@{/user/saibanKeijiManagement/{saibanSeq}/{ankenId}/removeSaibanKanyoshaFromAnkenBeforeCheck(saibanSeq=*{saibanSeq}, ankenId=*{ankenId})}]]*/"",
						url : 'removeSaibanKanyoshaFromAnkenBeforeCheck',
						data : formData
					}).done(function(data) {
						if (data.needConfirm && !confirm(data.message)) {
							return reject();
						} else {
							return resolve();
						}
					}).fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessageForJs(errorMsg);
						return reject();
					});
				});
			}
			
			function deleteKanyoshaFromAnken(formData) {
				return new Promise((resolve, reject) => {
					$.ajax({
						type : "POST",
						url : /*[[@{/user/saibanKeijiManagement/{saibanSeq}/{ankenId}/removeSaibanKanyoshaFromAnken(saibanSeq=*{saibanSeq}, ankenId=*{ankenId})}]]*/"",
						url : 'removeSaibanKanyoshaFromAnken',
						data : formData,
						dataType : "html",
					})
					.done(function(data, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							showInfoMessageForJs(/*[[#{I00028('弁護人情報')}]]*/'')
							return resolve()
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessageForJs(errorMsg);
							return reject();
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						const errorMsg = /*[[#{E00091}]]*/ "error";
						showErrorMessageForJs(errorMsg);
						return reject();
					});
				});
			}
		})

		<!--/* 共犯者のモーダル */-->
		const $kanyoshaKyohanshaModal = $("#saibanOtherViewFragment").find("#kanyoshaKyohanshaModal");
		$kanyoshaKyohanshaModal.on("show.bs.modal", function(e) {
			
			// モーダル表示名
			benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.modalNameLabel = '共犯者';
			
			// 選択できない顧客種別
			benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.excludeCustomerType = ["2"];
			
			// 登録処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.registAction = function(triggerBtn) {

				let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaModal);
				let kyohanshaWithInParam = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaWithInParam);
				
				param.push({
					name : "saibanSeq",
					value : kyohanshaWithInParam.saibanSeq
				});
				
				let url = /*[[@{/common/mvc/kanyosha/registKanyoshaForSaibanKyohansha}]]*/"";
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					type : "POST",
					url : url,
					data : param,
					dataType : "html",
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 処理成功
						Promise.resolve()
							.then(() => modalHidePromise($kanyoshaKyohanshaModal))
							.then(() => getSaibanOtherView())
							.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
					} else {
						if (data) {
							$kanyoshaKyohanshaModal.find(".kanyoshaEditModalFragmentWrap").html(data);
						}
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					const errorMsg = /*[[#{E00091}]]*/ "error";
					showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
				})
				.always(function(){
					ajaxRunning = false;
				});
			};
			
			// 更新処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.updateAction = function(triggerBtn) {

				let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaModal);
				let url = /*[[@{/common/mvc/kanyosha/updateKanyosha}]]*/"";
				
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;

				$.ajax({
					type : "POST",
					url : url,
					data : param,
					dataType : "html",
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 処理成功
						Promise.resolve()
							.then(() => modalHidePromise($kanyoshaKyohanshaModal))
							.then(() => getSaibanOtherView())
							.then(() => showInfoMessageForJs(/*[[#{I00023('共犯者情報')}]]*/''))
					} else {
						if (data) {
							$kanyoshaKyohanshaModal.find(".kanyoshaEditModalFragmentWrap").html(data);
						}
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					const errorMsg = /*[[#{E00091}]]*/ "error";
					showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
				})
				.always(function(){
					ajaxRunning = false;
				});
			};
			
			// 削除処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.deleteAction = function(triggerBtn) {
				
				let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaModal);

				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;

				Promise.resolve()
					.then(() => beforeCheck(param))
					.then(() => deleteAction(param))
					.then(() => modalHidePromise($kanyoshaKyohanshaModal))
					.then(() => getSaibanOtherView())
					.catch((errorObj) => console.log(errorObj))
					.finally(() => ajaxRunning = false);
				
				function beforeCheck(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/common/mvc/kanyosha/deleteKanyoshaBeforeCheck}]]*/,
							data : param,
							dataType : "json",
						}).done(function(data) {
							if (data.needConfirm && !confirm(data.message)) {
								return reject();
							} else {
								return resolve([data]);
							}
						}).fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
							return reject(jqXHR, status, errorThrown);
						});
					});
				}
				
				function deleteAction(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/common/mvc/kanyosha/deleteKanyosha}]]*/,
							data : param,
							dataType : "html",
						})
						.done(function(data, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								// 処理成功
								showInfoMessageForJs(/*[[#{I00028('共犯者情報')}]]*/'')
								return resolve()
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
								return reject([errorMsg]);
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
							return reject([jqXHR, status, errorThrown]);
						});
					});
				}
			};
			
			// 登録・編集エリアの初期レンダリング（再レンダリングも含む）
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderEditViewAction = function(triggerBtn) {
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				Promise.resolve()
					.then(() => initRenderKyohanshaEditViewAction())
					.catch((errors) => console.log(errors))
					.finally(() => ajaxRunning = false);
			};
			
			// 検索エリアの登録処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRegistAction = function(triggerBtn) {
				if (ajaxRunning) {
					return false;
				}
				let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchResultFormParams($kanyoshaKyohanshaModal);
				let kyohanshaWithInParam = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaWithInParam);
				param.push({
					name : "saibanSeq",
					value : kyohanshaWithInParam.saibanSeq
				});
				const url = /*[[@{/common/mvc/kanyosha/searchResultRegistKanyoshaForSaibanKyohansha}]]*/"";
				ajaxRunning = true;
				$.ajax({
					type : "POST",
					url : url,
					data : param,
					dataType : "html",
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 処理成功
						Promise.resolve()
							.then(() => modalHidePromise($kanyoshaKyohanshaModal))
							.then(() => getSaibanOtherView())
							.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
					} else {
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					const errorMsg = /*[[#{E00091}]]*/ "error";
					showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
				})
				.always(function(){
					ajaxRunning = false;
				});
			};

			// 検索エリアの検索処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRenderPromise = function() {
				return new Promise((resolve, reject) => {
					const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/saiban/kyohansha}]]*/"";
					let optionParam = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchFormParams($kanyoshaKyohanshaModal);
					let kyohanshaWithInParam = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaWithInParam);
					
					optionParam.push({
						name : "saibanSeq",
						value : kyohanshaWithInParam.saibanSeq
					});
					$.ajax({
						type : "GET",
						url : url,
						data : optionParam,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							$kanyoshaKyohanshaModal.find(".kanyoshaEditModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaKyohanshaModal);
							return reject(errorMsg)
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject([jqXHR, status, errorThrown]);
					});
				});
			};
			
			// 検索エリアの初期表示処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderSearchViewAction = function() {
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				Promise.resolve()
					.then(() => initRenderKyohanshaSearchViewAction())
					.catch((errors) => console.log(errors))
					.finally(() => ajaxRunning = false);
			};
			
		});
		
		<!--/* 共犯者編集モーダルの初期レンダリング関数 */-->
		function initRenderKyohanshaEditViewAction() {
			return new Promise((resolve, reject) => {
				let initRenderKyohanshaEditViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaEditViewParams);
				const ankenId = initRenderKyohanshaEditViewParams["ankenId"];
				const kanyoshaSeq =initRenderKyohanshaEditViewParams["kanyoshaSeq"];
				
				let url = /*[[@{/common/mvc/kanyosha/getKanyoshaEditModalFragment}]]*/"";
				let param = {} ;
				if (kanyoshaSeq) {
					url += `/${kanyoshaSeq}`;
				} else {
					url += "/create";
					param = {
						"ankenId" : ankenId,
						"initCustomerType" : "0",
					};
				};

				$.ajax({
					type : "GET",
					url : url,
					data : param,
					dataType : "html"
				})
				.done(function(result, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* 処理成功 */-->
						$kanyoshaKyohanshaModal.find(".kanyoshaEditModalFragmentWrap").html(result);
						return resolve();
					} else {
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						return reject(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					return reject([jqXHR, status, errorThrown]);
				});
			});
		};
		
		<!--/* 共犯者検索モーダルの初期レンダリング関数 */-->
		function initRenderKyohanshaSearchViewAction() {
			return new Promise((resolve, reject) => {
				let initRenderKyohanshaSearchViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaSearchViewParams);
				const ankenId = initRenderKyohanshaSearchViewParams["ankenId"];
				const saibanSeq = initRenderKyohanshaSearchViewParams["saibanSeq"];
				let param = [
					{name:"ankenId", value: ankenId},
					{name:"saibanSeq", value: saibanSeq},
				];
				const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/saiban/kyohansha}]]*/"";
				$.ajax({
					type : "GET",
					url : url,
					data : param,
					dataType : "html"
				})
				.done(function(result, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* 処理成功 */-->
						$kanyoshaKyohanshaModal.find(".kanyoshaEditModalFragmentWrap").html(result);
						return resolve();
					} else {
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						return reject(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					return reject(jqXHR, status, errorThrown)
				});
			});
		};
		
		<!--/* 共犯者のモーダル表示処理 */-->
		$("#saibanOtherViewFragment").on("click", ".openKanyoshaOtherModal", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			
			const ankenId = /*[[${ankenId}]]*/"";
			const saibanSeq = /*[[${saibanSeq}]]*/"";
			const kanyoshaSeq =$(this).data("kanyoshaSeq");
			
			// 登録・編集初期表示で必要なパラメータをメモリに保持しておく
			benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaEditViewParams = {
					"ankenId": ankenId,
					"kanyoshaSeq": kanyoshaSeq,
			};
			
			// 検索初期表示で必要なパラメータをメモリに保持しておく
			benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaSearchViewParams = {
					"ankenId": ankenId,
					"saibanSeq": saibanSeq,
			}

			<!--/* モーダルの保存処理等で使用するパラメータをGlobal領域に保持させておく */-->
			benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaWithInParam = {
				"saibanSeq": saibanSeq,
			}
			
			ajaxRunning = true;
			Promise.resolve()
				.then(() => initRenderKyohanshaEditViewAction())
				.then(() => $kanyoshaKyohanshaModal.modal("show"))
				.catch((errors) => console.log(errors))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* 共犯者の弁護人モーダル */-->
		const $kanyoshaKyohanshaBengoninModal = $("#saibanOtherViewFragment").find("#kanyoshaKyohanshaBengoninModal");
		$kanyoshaKyohanshaBengoninModal.on("show.bs.modal", function(e) {
			
			// モーダル表示名
			benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.modalNameLabel = '共犯者弁護人';
			
			// 選択できない顧客種別
			benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.excludeCustomerType = ["0", "1"];
			
			// 登録処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.registAction = function(triggerBtn) {

				let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaBengoninModal);
				let kyohanshaBengoninWithInParam = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaBengoninWithInParam);
				
				param.push({
					name : "saibanSeq",
					value : kyohanshaBengoninWithInParam.saibanSeq
				});

				param.push({
					name : "kyohanshaKanyoshaSeq",
					value : kyohanshaBengoninWithInParam.kyohanshaKanyoshaSeq
				});
				
				let url = /*[[@{/common/mvc/kanyosha/registKanyoshaForSaibanKyohanshaBengonin}]]*/"";
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				$.ajax({
					type : "POST",
					url : url,
					data : param,
					dataType : "html",
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 処理成功
						Promise.resolve()
							.then(() => modalHidePromise($kanyoshaKyohanshaBengoninModal))
							.then(() => getSaibanOtherView())
							.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
					} else {
						if (data) {
							$kanyoshaKyohanshaBengoninModal.find(".kanyoshaEditModalFragmentWrap").html(data);
						}
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					const errorMsg = /*[[#{E00091}]]*/ "error";
					showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
				})
				.always(function(){
					ajaxRunning = false;
				});
			};
			
			// 更新処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.updateAction = function(triggerBtn) {

				let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaBengoninModal);
				let url = /*[[@{/common/mvc/kanyosha/updateKanyosha}]]*/"";
				
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;

				$.ajax({
					type : "POST",
					url : url,
					data : param,
					dataType : "html",
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 処理成功
						Promise.resolve()
							.then(() => modalHidePromise($kanyoshaKyohanshaBengoninModal))
							.then(() => getSaibanOtherView())
							.then(() => showInfoMessageForJs(/*[[#{I00023('共犯者弁護人情報')}]]*/''))
					} else {
						if (data) {
							$kanyoshaKyohanshaBengoninModal.find(".kanyoshaEditModalFragmentWrap").html(data);
						}
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					const errorMsg = /*[[#{E00091}]]*/ "error";
					showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
				})
				.always(function(){
					ajaxRunning = false;
				});
			};
			
			// 削除処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.deleteAction = function(triggerBtn) {

				let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getFormParams($kanyoshaKyohanshaBengoninModal);

				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				
				Promise.resolve()
					.then(() => beforeCheck(param))
					.then(() => deleteAction(param))
					.then(() => modalHidePromise($kanyoshaKyohanshaBengoninModal))
					.then(() => getSaibanOtherView())
					.catch((errorObj) => console.log(errorObj))
					.finally(() => ajaxRunning = false);
				
				function beforeCheck(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/common/mvc/kanyosha/deleteKanyoshaBeforeCheck}]]*/,
							data : param,
							dataType : "json",
						}).done(function(data) {
							if (data.needConfirm && !confirm(data.message)) {
								return reject();
							} else {
								return resolve([data]);
							}
						}).fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
							return reject(jqXHR, status, errorThrown);
						});
					});
				}
				
				function deleteAction(param) {
					return new Promise((resolve, reject) => {
						$.ajax({
							type : "POST",
							url : /*[[@{/common/mvc/kanyosha/deleteKanyosha}]]*/,
							data : param,
							dataType : "html",
						})
						.done(function(data, status, jqXHR) {
							if (isAjaxProcSuccess(jqXHR)) {
								// 処理成功
								showInfoMessageForJs(/*[[#{I00028('共犯者弁護人情報')}]]*/'')
								return resolve()
							} else {
								const errorMsg = getAjaxProcResutlMessage(jqXHR);
								showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
								return reject([errorMsg]);
							}
						})
						.fail(function(jqXHR, status, errorThrown) {
							const errorMsg = /*[[#{E00091}]]*/ "error";
							showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
							return reject([jqXHR, status, errorThrown]);
						});
					});
				}
			};
			
			// 登録・編集エリアの初期レンダリング（再レンダリングも含む）
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderEditViewAction = function(triggerBtn) {
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				Promise.resolve()
					.then(() => initRenderKyohanshaBengoninEditViewAction())
					.catch((errors) => console.log(errors))
					.finally(() => ajaxRunning = false);
			};
			
			// 検索エリアの登録処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRegistAction = function(triggerBtn) {
				if (ajaxRunning) {
					return false;
				}
				let param = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchResultFormParams($kanyoshaKyohanshaBengoninModal);
				let kyohanshaBengoninWithInParam = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaBengoninWithInParam);
				param.push({
					name : "saibanSeq",
					value : kyohanshaBengoninWithInParam.saibanSeq
				});
				
				param.push({
					name : "kyohanshaKanyoshaSeq",
					value : kyohanshaBengoninWithInParam.kyohanshaKanyoshaSeq
				});
				
				const url = /*[[@{/common/mvc/kanyosha/searchResultRegistKanyoshaForSaibanKyohanshaBengonin}]]*/"";
				ajaxRunning = true;
				$.ajax({
					type : "POST",
					url : url,
					data : param,
					dataType : "html",
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 処理成功
						Promise.resolve()
							.then(() => modalHidePromise($kanyoshaKyohanshaBengoninModal))
							.then(() => getSaibanOtherView())
							.then(() => showInfoMessageForJs(getAjaxProcResutlMessage(jqXHR)))
					} else {
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					const errorMsg = /*[[#{E00091}]]*/ "error";
					showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
				})
				.always(function(){
					ajaxRunning = false;
				});
				
			};
			
			// 検索エリアの検索処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.searchRenderPromise = function() {
				return new Promise((resolve, reject) => {
					const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/saiban/kyohanshaBengonin}]]*/"";
					let optionParam = benzo.global.fragment.kanyoshaEditModalFragmentObj.paramObj.getSearchFormParams($kanyoshaKyohanshaBengoninModal);
					let kyohanshaBengoninWithInParam = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaBengoninWithInParam);
					optionParam.push({
						name : "saibanSeq",
						value : kyohanshaBengoninWithInParam.saibanSeq
					});
					$.ajax({
						type : "GET",
						url : url,
						data : optionParam,
						dataType : "html"
					})
					.done(function(result, status, jqXHR) {
						if (isAjaxProcSuccess(jqXHR)) {
							// 処理成功
							$kanyoshaKyohanshaBengoninModal.find(".kanyoshaEditModalFragmentWrap").html(result);
							return resolve();
						} else {
							const errorMsg = getAjaxProcResutlMessage(jqXHR);
							showErrorMessage(errorMsg, $kanyoshaKyohanshaBengoninModal);
							return reject(errorMsg);
						}
					})
					.fail(function(jqXHR, status, errorThrown) {
						showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
						return reject([jqXHR, status, errorThrown]);
					});
				});
			};
			
			// 検索エリアの初期表示処理
			benzo.global.fragment.kanyoshaEditModalFragmentObj.setUpObj.initRenderSearchViewAction = function() {
				if (ajaxRunning) {
					return false;
				}
				ajaxRunning = true;
				Promise.resolve()
					.then(() => initRenderKyohanshaBengoninSearchViewAction())
					.catch((errors) => console.log(errors))
					.finally(() => ajaxRunning = false);
			};
			
		});
		
		<!--/* 共犯者弁護人編集モーダルの初期レンダリング関数 */-->
		function initRenderKyohanshaBengoninEditViewAction() {
			return new Promise((resolve, reject) => {
				let initRenderKyohanshaBengoninEditViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaBengoninEditViewParams);
				const ankenId = initRenderKyohanshaBengoninEditViewParams["ankenId"];
				const kanyoshaSeq = initRenderKyohanshaBengoninEditViewParams["kanyoshaSeq"];
				
				let url = /*[[@{/common/mvc/kanyosha/getKanyoshaEditModalFragment}]]*/"";
				let param = {} ;
				if (kanyoshaSeq) {
					url += `/${kanyoshaSeq}`;
				} else {
					url += "/create";
					param = {
						"ankenId" : ankenId,
						"initCustomerType" : "2",
					};
				};

				$.ajax({
					type : "GET",
					url : url,
					data : param,
					dataType : "html"
				})
				.done(function(result, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						<!--/* 処理成功 */-->
						$kanyoshaKyohanshaBengoninModal.find(".kanyoshaEditModalFragmentWrap").html(result);
						return resolve();
					} else {
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						return reject(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					return reject([jqXHR, status, errorThrown]);
				});

			});
		};
		
		<!--/* 共犯者弁護人検索モーダルの初期レンダリング関数 */-->
		function initRenderKyohanshaBengoninSearchViewAction() {
			return new Promise((resolve, reject) => {
				let initRenderKyohanshaBengoninSearchViewParams = Object.assign({}, benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaBengoninSearchViewParams);
				const ankenId = initRenderKyohanshaBengoninSearchViewParams["ankenId"];
				const saibanSeq = initRenderKyohanshaBengoninSearchViewParams["saibanSeq"];
				let param = [
					{name:"ankenId", value: ankenId},
					{name:"customerType", value: "2"},
					{name:"saibanSeq", value: saibanSeq},
				];
				
				const url = /*[[@{/common/mvc/kanyosha/getKanyoshaSearchModalFragment/saiban/kyohanshaBengonin}]]*/"";
				$.ajax({
					type : "GET",
					url : url,
					data : param,
					dataType : "html"
				})
				.done(function(result, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 処理成功
						$kanyoshaKyohanshaBengoninModal.find(".kanyoshaEditModalFragmentWrap").html(result);
						return resolve();
					} else {
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						return reject(errorMsg);
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					return reject(jqXHR, status, errorThrown)
				});
			});
		};
		
		<!--/* 共犯者の弁護人モーダル表示処理 */-->
		$("#saibanOtherViewFragment").on("click", ".openKanyoshaOtherDairininModal", function() {
			if (ajaxRunning) {
				return false;
			}
			ajaxRunning = true;
			
			const ankenId = /*[[${ankenId}]]*/"";
			const saibanSeq = $(this).data("saibanSeq");
			const kanyoshaSeq =$(this).data("kanyoshaSeq");

			// 登録・編集初期表示で必要なパラメータをメモリに保持しておく
			benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaBengoninEditViewParams = {
					"ankenId": ankenId,
					"kanyoshaSeq": kanyoshaSeq,
			}
			
			// 検索初期表示で必要なパラメータをメモリに保持しておく
			benzo.global.fragment.kanyoshaEditModalFragmentObj.initRenderKyohanshaBengoninSearchViewParams = {
					"ankenId": ankenId,
					"saibanSeq": saibanSeq,
			};
			
			<!--/* モーダルの保存処理等で使用するパラメータをGlobal領域に保持させておく */-->
			const kyohanshaKanyoshaSeq = $(this).data("otherKanyoshaSeq");
			benzo.global.fragment.kanyoshaEditModalFragmentObj.kyohanshaBengoninWithInParam = {
				"saibanSeq": saibanSeq,
				"kyohanshaKanyoshaSeq": kyohanshaKanyoshaSeq,
			}
			
			ajaxRunning = true;
			Promise.resolve()
				.then(() => initRenderKyohanshaBengoninEditViewAction())
				.then(() => $kanyoshaKyohanshaBengoninModal.modal("show"))
				.catch((errors) => console.log(errors))
				.finally(() => ajaxRunning = false);
		});
		
		<!--/* モーダル閉じる処理をPromise化 */-->
		function modalHidePromise(modal){
			return new Promise((resolve) => {
				$(modal).one('hidden.bs.modal', function() {
					resolve();
				});
				$(modal).modal("hide");
			});
		};
		
	});
	</script>

	<!--/* HTML */-->
	<th:block th:object="${saibanOtherViewForm}">
	
	<section class="section_client_side mt-5">
		<div class="section_header">
			<div class="section_header__title">共犯者</div>
			<div class="section_header__action">
				<a href="javascript:void(0);" class="openKanyoshaOtherModal fs15">
					<i class="fas fa-plus-square mr-2"></i>共犯者を追加
				</a>
			</div>
		</div>
		<div class="section_body">
			<div class="section_body__contents p-0">
	<th:block th:if="${#lists.isEmpty(saibanOtherViewForm.saibanKyohanshaDtoList)}">
				<div class="no_data_msg px-4">
					<span th:text="#{I00035('共犯者情報の登録')}">MSG_I00035</span>
				</div>
	</th:block>
	
	<th:block th:unless="${#lists.isEmpty(saibanOtherViewForm.saibanKyohanshaDtoList)}">
				<div class="section_split_wrapper pb-0">
					<div class="section_split">
						<div class="section_split__left">
							<span class="badge badge-pill badge_square mnw70 badge_green px-2"><i class="fas fa-user mr-2"></i>共犯者</span>
							<hr class="mt-3 m-0">
						</div>
						<div class="section_split__right">
							<span class="badge badge-pill badge_square mnw70 badge_purple px-1"><i class="fas fa-user-tie mr-2"></i>弁護人</span>
							<hr class="mt-3 m-0">
						</div>
					</div>
				</div>
				<ul class="section_list px-3">
					<li class="list_contents" th:each="otherKanyosha, i : *{saibanKyohanshaDtoList}">
						<div class="section_list_item_wrap section_split_wrapper">
							
							<div class="section_split">
								<!--/* 共犯者 */-->
									<div class="section_split__left">
										<div class="section_list_item pl-1">
											<!--/* 名簿 */-->
											<div class="img_info_xs mb-2">
												<!--/* 名簿画像 */-->
												<div class="img_info_xs__image">
													<!--/* 名簿属性ラベル */-->
													<div th:class="|person_image_wrapper${otherKanyosha.personAttribute?.cd.getCd()}|">
														<!--/* 個人アイコン */-->
														<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).KOJIN.equals(otherKanyosha.customerType)}" 
															class="img-thumbnail person_image_xs" th:src="@{/img/person_kojin.svg}"
															data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="個人">
															
														<!--/* 企業・団体アイコン */-->
														<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).HOJIN.equals(otherKanyosha.customerType)}"
															class="img-thumbnail person_image_xs" th:src="@{/img/person_hojin.svg}"
															data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="企業・団体">
															
														<!--/* 弁護士アイコン */-->
														<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).LAWYER.equals(otherKanyosha.customerType)}"
															class="img-thumbnail person_image_xs" th:src="@{/img/person_bengoshi.svg}"
															data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="弁護士">
													</div>
												</div>
												<!--/* 名簿画像 end */-->
												
												<!--/* 名前 */-->
												<div class="img_info_xs__info">
													<div class="fw600 fs20 lh1_3 pt-1" th:text="${otherKanyosha.kanyoshaName}">山田　太郎 </div>
													<div>
														<a href="javascript:void(0);" class="app_id_link p-1 personPopoverLabel" th:text="|名簿ID：${otherKanyosha.personId.asLong()}|" 
															data-boundary="window" data-container="#saibanOtherViewFragment" th:data-person-id="${otherKanyosha.personId.asLong()}">
														</a>
													</div>
												</div>
												<!-- /* ボタンエリア */ -->
												<div class="img_info_xs__btn">
													<div class="item_sub px-0">
														<!--/* 共犯者から外す選択 */-->
														<div th:id="|kyohanshaContainer${i.index}|" class="d-inline-block stop-events outPutContainerClose" data-offset="-80,0"
															data-boundary="window" data-container="#saibanOtherViewFragment" th:data-kanyosha-seq="${otherKanyosha.kanyoshaSeq}" data-toggle="popover" data-placement="bottom" data-html="true" th:data-content=
																'|<ul class="output_nav_list">
																	<li><button class="btn btn-light removeSaibanKanyosha" data-target="#kyohanshaContainer${i.index}"><i class="fas fa-minus-circle"></i>共犯者から外す</button></li>
																	<li><button class="btn btn-light removeSaibanKanyoshaFromAnken" data-target="#kyohanshaContainer${i.index}"><i class="fas fa-user-minus"></i>案件から外す</button></li>
																</ul>|'>
															<button type="button" class="btn btn-light btn_icon_only btn_icon_ellipsis_v " data-boundary="window" data-container="#saibanOtherViewFragment">
																<i class="fas fa-ellipsis-v"></i>
															</button>
														</div>
													</div>
												</div>
											</div>
											<!--/* １行目 end */-->
											
											<!--/* 筆頭エリア */-->
											<div class="hittou_select_area pl-1">
												<div>
													<a href="javascript:void(0);" class="btn hittou_btn px-3"
														th:classAppend="${otherKanyosha.mainFlg} ? 'selected'" th:data-kanyosha-seq="${otherKanyosha.kanyoshaSeq}">筆頭</a>
												</div>
												<div>
													<select class="form-control hyoki_select tojishaHyokiSelect"
															th:data-kanyosha-seq="${otherKanyosha.kanyoshaSeq}">
														<option value="">-</option>
														<th:block th:each="enum : ${T(jp.loioz.common.constant.CommonConstant$TojishaHyoki).values()}">
															<option th:value="${enum.cd}" th:text="${enum.val}" th:selected="${enum.cd.equals(otherKanyosha.saibanTojishaHyoki)}"></option>
														</th:block>
													</select>
												</div>
											</div>
											
											<!--/* 関係・備考エリア */-->
											<div class="kankei_remarks_view openKanyoshaOtherModal" data-boundary="window"
												th:data-kanyosha-seq="${otherKanyosha.kanyoshaSeq}"
												data-container="#saibanOtherViewFragment" data-toggle="tooltip" data-trigger="hover" title="編集する">
												<div class="mb-3">
													<label class="view_label">関係</label>
													<div class="view_value fs15">
														<div th:classappend="${#strings.isEmpty(otherKanyosha.kankei)} ? 'sub_text'"
															myth:nl2br="${#strings.isEmpty(otherKanyosha.kankei)} ? '-' : ${otherKanyosha.kankei}">関係
														</div>
													</div> 
												</div>
												<div>
													<label class="view_label">備考</label>
													<div class="view_value fs15">
														<div th:classappend="${#strings.isEmpty(otherKanyosha.remarks)} ? 'sub_text'"
															myth:nl2br="${#strings.isEmpty(otherKanyosha.remarks)} ? '-' : ${otherKanyosha.remarks}">備考
														</div>
													</div>
												</div> 
											</div>
										</div>
									</div>
									<!--/* 共犯者エリア end */-->
									
									<!--/* 共犯者-弁護人エリア */-->
									<div class="section_split__right">
									
			<!--/* 代理人設定【あり】の場合 */-->
			<th:block th:if="${otherKanyosha.saibanKanyoshaDairininViewDto != null}"
				th:with="dairininPersonId=${otherKanyosha.saibanKanyoshaDairininViewDto.personId}">

										<div class="section_list_item pl-1">
											<!--/* 名簿 */-->
											<div class="img_info_xs mb-2">
												<!--/* 名簿画像 */-->
												<div class="img_info_xs__image">
													<!--/* 名簿属性ラベル */-->
													<div th:class="|person_image_wrapper${otherKanyosha.saibanKanyoshaDairininViewDto.personAttribute?.cd.getCd()}|">
														<!--/* 個人アイコン */-->
														<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).KOJIN.equals(otherKanyosha.saibanKanyoshaDairininViewDto.customerType)}" 
															class="img-thumbnail person_image_xs" th:src="@{/img/person_kojin.svg}"
															data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="個人">
															
														<!--/* 企業・団体アイコン */-->
														<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).HOJIN.equals(otherKanyosha.saibanKanyoshaDairininViewDto.customerType)}"
															class="img-thumbnail person_image_xs" th:src="@{/img/person_hojin.svg}"
															data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="企業・団体">
															
														<!--/* 弁護士アイコン */-->
														<img th:if="${T(jp.loioz.common.constant.CommonConstant$CustomerType).LAWYER.equals(otherKanyosha.saibanKanyoshaDairininViewDto.customerType)}"
															class="img-thumbnail person_image_xs" th:src="@{/img/person_bengoshi.svg}"
															data-boundary="window" data-container="body" data-toggle="tooltip" data-trigger="hover" th:title="弁護士">
													</div>
												</div>
												<!--/* 名簿画像 end */-->
												
												<!--/* 名前 */-->
												<div class="img_info_xs__info">
													<div class="fw600 fs20 lh1_3 pt-1" th:text="${otherKanyosha.saibanKanyoshaDairininViewDto.kanyoshaName}">山田　太郎 </div>
													<div class="d-flex flex-wrap cg10 rg5">
														<!-- /* 名簿ID */ -->
														<div>
															<a href="javascript:void(0);" class="app_id_link p-1 personPopoverLabel" th:text="|名簿ID：${dairininPersonId.asLong()}|" 
																data-boundary="window" data-container="#saibanOtherViewFragment" th:data-person-id="${dairininPersonId.asLong()}">
																名-100
															</a>
														</div>
			<th:block th:if="${!#strings.isEmpty(otherKanyosha.saibanKanyoshaDairininViewDto.jimushoName)}">
														<div class="jimusho_name fc_sub fs13">
															<i class="far fa-building fs12"></i>
															<span th:text="${otherKanyosha.saibanKanyoshaDairininViewDto.jimushoName}"></span>
														</div>
			</th:block>
													</div>
												</div>
												<!-- /* ボタンエリア */ -->
												<div class="img_info_xs__btn">
													<div class="item_sub">
														<!--/* 弁護人から外す選択 */-->
														<div th:id="|bengomninContainer${i.index}|" class="d-inline-block stop-events outPutContainerClose" data-offset="-80,0" data-boundary="window"
															data-container="#saibanOtherViewFragment" th:data-kanyosha-seq="${otherKanyosha.kanyoshaSeq}"th:data-bengonin-kanyosha-seq="${otherKanyosha.saibanKanyoshaDairininViewDto.kanyoshaSeq}" data-toggle="popover" data-placement="bottom" data-html="true" th:data-content=
																'|<ul class="output_nav_list">
																	<li><button class="btn btn-light removeSaibanRelatedKanyosha" data-target="#bengomninContainer${i.index}"><i class="fas fa-minus-circle"></i>弁護人から外す</button></li>
																	<li><button class="btn btn-light removeSaibanRelatedKanyoshaFromAnken" data-target="#bengomninContainer${i.index}"><i class="fas fa-user-minus"></i>案件から外す</button></li>
																</ul>|'>
															<button type="button" class="btn btn-light btn_icon_only btn_icon_ellipsis_v " data-boundary="window" data-container="#saibanOtherViewFragment">
																<i class="fas fa-ellipsis-v"></i>
															</button>
														</div>
													</div>
												</div>
											</div>
											<!--/* １行目 end */-->
											
											<!--/* データブロック */-->
											<div class="item_content_block">
												<div class="kankei_remarks_view openKanyoshaOtherDairininModal" data-boundary="window"
													th:data-kanyosha-seq="${otherKanyosha.saibanKanyoshaDairininViewDto.kanyoshaSeq}"
													data-container="#saibanOtherViewFragment" data-toggle="tooltip" data-trigger="hover" title="編集する">
													<div class="mb-3">
														<label class="view_label">関係</label>
														<div class="view_value fs15">
															<div th:classappend="${#strings.isEmpty(otherKanyosha.saibanKanyoshaDairininViewDto.kankei)} ? 'sub_text'"
																myth:nl2br="${#strings.isEmpty(otherKanyosha.saibanKanyoshaDairininViewDto.kankei)} ? '-' : ${otherKanyosha.saibanKanyoshaDairininViewDto.kankei}">関係
															</div>
														</div>
													</div> 
													<div>
														<label class="view_label">備考</label>
														<div class="view_value fs15">
															<div th:classappend="${#strings.isEmpty(otherKanyosha.saibanKanyoshaDairininViewDto.remarks)} ? 'sub_text'"
																myth:nl2br="${#strings.isEmpty(otherKanyosha.saibanKanyoshaDairininViewDto.remarks)} ? '-' : ${otherKanyosha.saibanKanyoshaDairininViewDto.remarks}">関係
															</div>
														</div>
													</div>
												</div>
											</div> 
										</div>
			</th:block>
			
			<!--/* 代理人未設定の場合 */-->
			<th:block th:if="${otherKanyosha.saibanKanyoshaDairininViewDto == null}">
										<div class="select_dairinin">
											<div>
												<a href="javascript:void(0);"
														class="openKanyoshaOtherDairininModal"
														th:data-other-kanyosha-seq="${otherKanyosha.kanyoshaSeq}"
														th:data-saiban-seq="${otherKanyosha.saibanSeq}">
													<i class="fas fa-plus-square mr-2"></i>弁護人を追加
												</a>
											</div>
										</div>
			</th:block>
								</div>
								<!--/* 代理人エリア end */-->
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</section>

	<!--/* 共犯者モーダル */-->
	<div id="kanyoshaKyohanshaModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
		<div
			class="modal-dialog modal-dialog-centered modal_kanyosha_customer_select"
			role="document">
			<div class="modal-content">
				<div class="kanyoshaEditModalFragmentWrap">
					<!--/* 関与者情報 */-->
				</div>
			</div>
		</div>
	</div>
	
	<!--/* 共犯者(検索)モーダル */-->
	<div id="kanyoshaSearchKyohanshaModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
		<div
			class="modal-dialog modal-dialog-centered modal_kanyosha_customer_select"
			role="document">
			<div class="modal-content">
				<div class="kanyoshaSearchModalFragmentWrap">
					<!--/* 関与者情報 */-->
				</div>
			</div>
		</div>
	</div>
	
	<!--/* 共犯者弁護人モーダル */-->
	<div id="kanyoshaKyohanshaBengoninModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
		<div
			class="modal-dialog modal-dialog-centered modal_kanyosha_customer_select"
			role="document">
			<div class="modal-content">
				<div class="kanyoshaEditModalFragmentWrap">
					<!--/* 関与者情報 */-->
				</div>
			</div>
		</div>
	</div>
	
	<!--/* 共犯者弁護人(検索)モーダル */-->
	<div id="kanyoshaSearchKyohanshaBengoninModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
		<div
			class="modal-dialog modal-dialog-centered modal_kanyosha_customer_select"
			role="document">
			<div class="modal-content">
				<div class="kanyoshaSearchModalFragmentWrap">
					<!--/* 関与者情報 */-->
				</div>
			</div>
		</div>
	</div>
	</th:block>
</div>

<!--/* 公判担当検察官 表示 */-->
<div th:fragment="saibanKensatsukanViewFragment(saibanKensatsukanViewForm)" id="saibanKensatsukanViewFragment">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {
		
		<!--/* 共有の要素セットアップ処理 */-->
		commonSetUpElement();
		
		<!--/* 検察官追加のクリック */-->
		<!--/* 再描画を行った後に、追加用のフォームの表示を行う */-->
		$('#saibanKensatsukanViewFragment #addKensatsukan').on('click', function() {
			
			<!--/* 口座情報の再表示、追加フォーム表示では、特にデータは必要ないので空とする */-->
			let dataObj = {}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			<!--/* 検察官を再描画し、描画後、登録（追加）フォームを表示する */-->
			Promise.resolve(dataObj)
				.then(renderKensatsukanViewFunc)
				.then(renderKensatsukanRegistInputFormFunc)
				.catch((errorObj) => {
					<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
					console.log(errorObj);
				})
				.finally(() => {
					ajaxRunning = false;
				})
		})
		
		<!--/* 検察官編集ボタンクリック */-->
		<!--/* 再描画を行った後に、編集用のフォームの表示を行う */-->
		$('#saibanKensatsukanViewFragment .editKensatsukan').on('click', function() {
			
			<!--/* 検察官の再表示、編集フォーム表示では、特にデータは必要ないので空とする */-->
			let dataObj = {}
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			<!--/* 検察官を再描画し、描画後、対象の編集フォームを表示する */-->
			Promise.resolve(dataObj)
				.then(renderKensatsukanViewFunc)
				.then(renderKensatsukanEditInputFormFunc)
				.catch((errorObj) => {
					<!--/* 異常系の対応は各処理側で行っており、全体共通での異常系の処理は現状ない */-->
					console.log(errorObj);
				})
				.finally(() => {
					ajaxRunning = false;
				})
		})
		
		<!--/* 検察官の再表示関数 */-->
		const renderKensatsukanViewFunc = (dataObj) => {
			return new Promise((resolve, reject) => {
				
				<!--/* 検察官の表示領域を再描画 */-->
				<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
				$.ajax({
					url : 'getSaibanKensatsukanView',
					type : "GET"
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						
						// 再描画
						// 親HTMLのID
						$('#saibanKensatsukanViewFragmentWrap').html(data);
						
						<!--/* 引数データは後続処理に渡す */-->
						resolve(dataObj);
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
					reject();
				})
			});
		}
		
		<!--/* 検察官の登録（追加）フォームの表示関数 */-->
		const renderKensatsukanRegistInputFormFunc = (dataObj) => {
			return new Promise((resolve, reject) => {
				
				let requestData = {
					isNewRegist: true
				}
				
				<!--/* クリックされた要素の登録（追加）フォームを表示 */-->
				<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
				$.ajax({
					url : 'getSaibanKensatsukanInputForm',
					type : "GET",
					data : requestData
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 新規登録行部分にHTML表示
						$('#saibanKensatsukanViewFragment #kensatsukanForNewRegist .kensatsukanRow').html(data);
						
						<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
						resolve();
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
					reject();
				})
			});
		}
		
		<!--/* 検察官の編集フォームの表示関数 */-->
		const renderKensatsukanEditInputFormFunc = (dataObj) => {
			return new Promise((resolve, reject) => {
				
				<!--/* クリックされた要素と同じ要素を再取得（前処理でHTMLが再描画されているため、新しいDOMから再取得を行う） */-->
				<!--/* 現状、検察官は1つしか登録できないので、取得される要素は必ず1つとなる*/-->
				const $clickedElem = $('#saibanKensatsukanViewFragment .editKensatsukan')
				
				<!--/* クリックされた要素の編集フォームを表示 */-->
				<!--/* 2重押下防止対応はPromiseチェーンのルートで処理するため、チェーン内では行わない */-->
				$.ajax({
					url : 'getSaibanKensatsukanInputForm',
					type : "GET"
				})
				.done(function(data, status, jqXHR) {
					if (isAjaxProcSuccess(jqXHR)) {
						// 対象行部分にHTML表示
						$clickedElem.closest('.kensatsukanRow').html(data)
						
						<!--/* Promiseチェーンの最後の処理となるため、引数データは渡さない */-->
						resolve();
					} else {
						// 処理失敗
						const errorMsg = getAjaxProcResutlMessage(jqXHR);
						showErrorMessageForJs(errorMsg);
						
						reject();
					}
				})
				.fail(function(jqXHR, status, errorThrown) {
					showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
					
					reject();
				})
			});
		}

		<!--/* 公判担当検察官 送付書出力 */-->
		$(document).on('click', '.downloadKensatsukan', function() {
			let formData = [];
			const souhushoType = $(this).data('souhusho-type');
			formData.push(
					{name : "souhushoType", value :souhushoType},
			);
			const button = $(this);
			const url = "outputSouhushoKensatsukan";
			
			// ダウンロード処理
			downloadFileAjax(url, button, formData);
		});
		
	});
	</script>

	<!--/* HTML */-->
	<th:block th:object="${saibanKensatsukanViewForm}">

		<section class="section_border">
			<div class="section_header">
				<div class="section_header__title">公判担当検察官</div>
				<div class="section_header__action">
					<a href="javascript:void(0);" class="fs15" id="addKensatsukan" th:if="!*{saibanKensatsukanDto.isRegist()}">
						<i class="fas fa-plus-square mr-2"></i>公判担当検察官を追加
					</a>
				</div>
			</div>
			<div class="section_body">
				<div class="section_body__contents p-0">
	<!--/*/		<th:block th:if="!*{saibanKensatsukanDto.isRegist()}"> /*/-->
					<div class="no_data_msg px-4" id="kensatsukanForNewRegist">
						<div class="kensatsukanRow">
							<span th:text="#{I00035('公判担当検察官情報の登録')}">MSG_I00035</span>
						</div>
					</div>
	<!--/*/		</th:block> /*/-->
	
	<!--/*/		<th:block th:if="*{saibanKensatsukanDto.isRegist()}"> /*/-->
					<ul class="section_list kensatsukanRow">
						<li class="list_contents">
							<div class="section_list_item_wrap">
								<div class="section_list_item">
									<div class="item_title_block">
										<div class="item_title pt-2 lh1_2 fc_sub fw600">
											<span class="fs19 fw600" th:text="*{saibanKensatsukanDto.kensatsuchoName}">旭川地方検察庁留萌支部</span>
											<div class="fs14 fw0 mt-1">
												<span th:text="*{saibanKensatsukanDto.kensatsuchoTantoBuName}">〇〇部</span>
												<span th:text="*{saibanKensatsukanDto.kensatsuRoomNo}">301号室</span>
											</div>
										</div>
										<div class="item_sub d-flex"  id="kensatsukanEditContainer">
											<div th:id="outPutContainer" class="d-inline-block stop-events outPutContainerClose" data-loading-target=".loadingTarget"
												data-offset="-60,0" data-boundary="window" data-container="#kensatsukanEditContainer" data-toggle="popover" data-placement="bottom" data-html="true" th:data-content=
												'|<ul class="output_nav_list">
														<li><button class="btn btn-light downloadKensatsukan" data-target="#outPutContainer" data-souhusho-type="${T(jp.loioz.common.constant.CommonConstant$SouhushoType).IPPAN.getCd()}"><i class="fas fa-download text-primary mr-3"></i><i class="fas fa-spinner mr-3 text-primary faa-spin animated hidden"></i>一般用を出力する</button></li>
														<li><button class="btn btn-light downloadKensatsukan" data-target="#outPutContainer" data-souhusho-type="${T(jp.loioz.common.constant.CommonConstant$SouhushoType).FAX_USE.getCd()}"><i class="fas fa-download text-primary mr-3"></i><i class="fas fa-spinner mr-3 text-primary faa-spin animated hidden"></i>FAX用を出力する</button></li>
												</ul>|'>
												<button type=button class="btn btn-light btn_icon_arrow"
													data-boundary="window" data-container="#kensatsukanEditContainer" data-toggle="tooltip" data-trigger="hover" title="ダウンロード">
													<i class="far fa-file-alt fa-lg"></i><i class="fas fa-chevron-down mr-0"></i>
												</button>
											</div>
											<div class="ml-3">
												<button class="btn btn-light btn_icon_only btn_icon_edit editKensatsukan"
													data-boundary="window" data-container="#kensatsukanEditContainer" data-toggle="tooltip" data-trigger="hover" title="編集する">
													<i class="fas fa-edit"></i>
												</button>
											</div>
										</div>
									</div>
									<div class="item_content_block mt-3">
										<div class="d-flex cg20 rb10 mb-3">
											<!--/* 電話番号 */-->
											<div class="flx_1_50per">
												<label class="view_label">TEL</label>
												<div class="view_value">
													<span th:text="*{!#strings.isEmpty(saibanKensatsukanDto.kensatsuTelNo)} ? *{saibanKensatsukanDto.kensatsuTelNo} : '-' ">03-2222-5555</span>
													<th:block th:if="${!#strings.isEmpty(saibanKensatsukanViewForm.saibanKensatsukanDto.kensatsuExtensionNo)}">
														<span class="sub_text">(内線)</span>
														<span th:text="*{saibanKensatsukanDto.kensatsuExtensionNo}"></span>
													</th:block>
												</div>
											</div>
											<!--/* 電話番号 */-->
											<div class="flx_1_50per">
												<label class="view_label">FAX</label>
												<div class="view_value">
													<span th:text="*{!#strings.isEmpty(saibanKensatsukanDto.kensatsuFaxNo)} ? *{saibanKensatsukanDto.kensatsuFaxNo} : '-' ">03-2222-5555</span>
												</div>
											</div>
										</div>
										<div class="d-flex cg20 rb10 mb-3">
											<!--/* 担当検察官 */-->
											<div class="flx_1_50per">
												<label class="view_label">担当検察官</label>
												<div class="view_value">
													<span class="ruby" th:text="*{saibanKensatsukanDto.kensatsukanNameKana}">検察官かな</span>
													<span th:text="*{!#strings.isEmpty(saibanKensatsukanDto.kensatsukanName)} ? *{saibanKensatsukanDto.kensatsukanName} : '-' ">検察官</span>
												</div>
											</div>
											<!--/* 担当事務官 */-->
											<div class="flx_1_50per">
												<label class="view_label">担当事務官</label>
												<div class="view_value">
													<span class="ruby" th:text="*{saibanKensatsukanDto.jimukanNameKana}">事務官かな</span>
													<span th:text="*{!#strings.isEmpty(saibanKensatsukanDto.jimukanName)} ? *{saibanKensatsukanDto.jimukanName} : '-' ">事務官</span>
												</div>
											</div>
										</div>
										<!--/* 備考 */-->
										<div class="mt-3">
											<label class="view_label">備考</label>
											<div class="view_value">
												<span th:text="*{!#strings.isEmpty(saibanKensatsukanDto.kensatsuRemarks)} ? *{saibanKensatsukanDto.kensatsuRemarks} : '-' ">備考</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>
			<!-- /* 公判担当モーダルテンプレート */ -->
			<div th:fragment="saibanManagementSouhushoSelectTemplate(target)" id="souhushoSelectModalKohan" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
				<div class="modal-dialog modal-dialog-centered modal_souhushoSelect_simple" role="document">
					<div class="modal-content">
						<div th:class="${target}"></div>
					</div>
				</div>
			</div>
			<!-- /* 公判担当モーダルテンプレート end */ -->
		</section>
	</th:block>

</div>

<!--/* 公判担当検察官 入力 */-->
<div th:fragment="saibanKensatsukanInputFragment" id="saibanKensatsukanInputFragment">

	<!--/* Script */-->
	<script th:inline="javascript">
	$(function() {
		
		// 共有の要素セットアップ処理
		commonSetUpElement();
		
		<!--/* 検察官の編集を閉じる（表示モードの表示に切り替える） */-->
		$('#saibanKensatsukanInputFragment .closeKensatsukan').on('click', function() {
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			
			$.ajax({
				url : 'getSaibanKensatsukanView',
				type : "GET"
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 親HTMLのID
					$('#saibanKensatsukanViewFragmentWrap').html(data);
					
				} else {
					// 処理失敗
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00091}]]*/ "error");
			})
			.always(function(){
				ajaxRunning = false;
			});
		})
		
		<!--/* 検察官の保存 */-->
		$('#saibanKensatsukanInputFragment .saveKensatsukan').on('click', function() {
			
			<!--/* リクエストパラメータ */-->
			const formData = $(this)
				.closest('.saibanKensatsukanInputForm')
				.serializeArray();
			
			let $clickedElem = $(this)
			
			<!--/* 2重押下防止 */-->
			if(ajaxRunning){
				return false;
			}
			
			ajaxRunning = true;
			$.ajax({
				url : 'saveKensatsukan',
				type : "POST",
				data : formData
			})
			.done(function(data, status, jqXHR) {
				if (isAjaxProcSuccess(jqXHR)) {
					// 処理成功
					
					// 親HTMLのID
					$('#saibanKensatsukanViewFragmentWrap').html(data);
					
					const msg = getAjaxProcResutlMessage(jqXHR);
					showInfoMessageForJs(msg);
					
				} else {
					// 処理失敗
					
					if (data) {
						// HTMLのコンテンツが返却されている場合
						// 対象行部分にHTML表示
						$clickedElem.closest('.kensatsukanRow').html(data)
					}
					
					const errorMsg = getAjaxProcResutlMessage(jqXHR);
					showErrorMessageForJs(errorMsg);
				}
			})
			.fail(function(jqXHR, status, errorThrown) {
				showErrorMessageForJs(/*[[#{E00013}]]*/ "保存に失敗しました。");
			})
			.always(function(){
				ajaxRunning = false;
			});
		});
		
		<!--/* 検察庁の選択肢キャッシュ */-->
		let kensatsuchoCache = {};
		<!--/* 検察を変更 */-->
		function changeKensatsucho(kensatsuchoId){
			let orgKensatsuchoName = $("#keizokuBuSelect").find("[name='keizokuBuName']").val();
			
			if (kensatsuchoId) {
				if (kensatsuchoCache[kensatsuchoId]) {
					<!--/* 検察庁情報を取得済 = キャッシュから設定 */-->
					$.each(kensatsuchoCache[kensatsuchoId], function(i, e) {
						if( i == "telNo") {
							$("#kensatsuTelNo").val(e);
						} else if( i == "faxNo") {
							$("#kensatsuFaxNo").val(e);
						}
					});

				} else {
					<!--/* 検察庁情報が未取得 = Ajaxで検察庁情報を取得 */-->
					$.ajax({
						type : "POST",
						url : /*[[(@{/user/saibanManagement/getKensatsuchoInfo})]]*/ "/",
						data : {"kensatsuchoId": kensatsuchoId},
						dataType : "json"

					}).done(function(data) {
						kensatsuchoCache[kensatsuchoId] = data["kensatsucho"];
						$.each(data["kensatsucho"], function(i, e) {
							if (i == "telNo") {
								$("#kensatsuTelNo").val(e);
							} else if(i == "faxNo") {
								$("#kensatsuFaxNo").val(e);
							}
						});
					}).fail(function() {
					}).always(function() {
					});
				}
			}
		}

		<!--/* 検察庁の選択 */-->
		$("#kensatsucho").on("change", function(){
			<!--/* 検察庁選択時に、電話番号・FAX番号を反映 */-->
			let selectedKensatsucho = $("#kensatsuchoList").find("[value='"+$(this).val()+"']");
			if (selectedKensatsucho.length > 0) {
				<!--/* 検察庁が存在する場合 */-->
				let kensatsuchoId = selectedKensatsucho.data("id");
				$("#kensatsuchoId").val(kensatsuchoId);
				changeKensatsucho(kensatsuchoId);
			} else {
				<!--/* 検察庁が存在しない場合 */-->
				$("#kensatsuchoId").val("");
			}
		});

		<!--/* 公判担当検察官入力時、datalistを設定する */-->
		<!--/* Chromeでは未入力の状態でdatalistをクリックすると、全件リストを表示しようとするため文字入力時にのみdatalistをセットするようにする */-->
		$('#saibanKensatsukanInputFragment .kensatsucho').on('input', function() {
			if ($(this).val()) {
				$(this).attr('list', 'kensatsuchoList');
			} else {
				// Safariの場合は、文字入力前にdatalistを設定する必要があるため
				if (isMacSafari()){
					$(this).attr('list', 'kensatsuchoList');
				} else {
					$(this).removeAttr('list');
				}
			}
		});

		<!--/* 公判担当検察官入力時、datalistを設定する */-->
		<!--/* Chromeでは未入力の状態でdatalistをクリックすると、全件リストを表示しようとするため文字入力時にのみdatalistをセットするようにする */-->
		$('#saibanKensatsukanInputFragment .kensatsucho').on('click', function() {
			if ($(this).val()) {
				$(this).attr('list', 'kensatsuchoList');
			} else {
				// Safariの場合は、文字入力前にdatalistを設定する必要があるためクリック時でもdatalistをセットする
				if (isMacSafari()){
					$(this).attr('list', 'kensatsuchoList');
				}
			}
		});

	});
	</script>

	<!--/* HTML */-->
	<form class="saibanKensatsukanInputForm" th:object="${saibanKensatsukanInputForm}" th:autocomplete="off">
		
		<div class="block_view_input">
			
			<!--/* 公判担当者検察官 */-->
			<div class="detail_input_area">
				<div class="form-row">
					<!--/* 検察庁 */-->
					<div class="input_parts form-group col-md-6">
						<label>検察庁</label>
						<input type="search" id="kensatsucho" class="form-control kensatsucho" th:field="*{kensatsuchoName}" placeholder="検察庁名を入力してください..." maxlength="100" autocomplete="off">
						<datalist id="kensatsuchoList">
							<option th:each="option : *{kensatsuchoOptions}"
								th:value="${option.label}" th:data-id="${option.value}"></option>
						</datalist>
						<input type="hidden" id="kensatsuchoId" th:field="*{sosakikanId}">
						<div th:if="*{#fields.hasErrors('kensatsuchoName')}" th:errors="*{kensatsuchoName}" class="error_mag_point">error</div>
					</div>
					<!--/* 担当部 */-->
					<div class="input_parts form-group col-md-3">
						<label>担当部</label>
						<input type="text" class="form-control" th:field="*{kensatsuchoTantoBuName}" maxlength="100">
						<div th:if="*{#fields.hasErrors('kensatsuchoTantoBuName')}" th:errors="*{kensatsuchoTantoBuName}" class="error_mag_point">error</div>
					</div>
					<!--/* 号室 */-->
					<div class="input_parts form-group col-md-2">
						<label>号室</label>
						<input type="text" id="kensatsuRoomNo" class="form-control input_number_only" th:field="*{kensatsuRoomNo}" maxlength="10">
						<div th:if="*{#fields.hasErrors('kensatsuRoomNo')}" th:errors="*{kensatsuRoomNo}" class="error_mag_point">error</div>
					</div>
				</div>
				<div class="form-row">
					<!--/* 電話番号 */-->
					<div class="input_parts form-group col-md-3">
						<label>TEL</label>
						<input type="tel" id="kensatsuTelNo" class="form-control input_num_hyphen" th:field="*{kensatsuTelNo}" maxlength="13" autocomplete="kensatsuTelNo">
						<div th:if="*{#fields.hasErrors('kensatsuTelNo')}" th:errors="*{kensatsuTelNo}" class="error_mag_point">error</div>
					</div>
					<!--/* 内線 */-->
					<div class="input_parts form-group col-md-3">
						<label>内線</label>
						<input type="text" id="kensatsuExtensionNo" class="form-control input_num_hyphen digit6" th:field="*{kensatsuExtensionNo}" maxlength="5">
						<div th:if="*{#fields.hasErrors('kensatsuExtensionNo')}" th:errors="*{kensatsuExtensionNo}" class="error_mag_point">error</div>
					</div>
					<!--/* FAX番号 */-->
					<div class="input_parts form-group col-md-3">
						<label>FAX</label>
						<input type="tel" id="kensatsuFaxNo" class="form-control input_num_hyphen" th:field="*{kensatsuFaxNo}" maxlength="13">
						<div th:if="*{#fields.hasErrors('kensatsuFaxNo')}" th:errors="*{kensatsuFaxNo}" class="error_mag_point">error</div>
					</div>
				</div>
				<div class="form-row">
					<!--/* 検察官 */-->
					<div class="input_parts form-group col-md-3">
						<label>検察官</label>
						<input type="text" class="form-control" th:field="*{kensatsukanName}" maxlength="100">
						<div th:if="*{#fields.hasErrors('kensatsukanName')}" th:errors="*{kensatsukanName}" class="error_mag_point">error</div>
					</div>
					<!--/* 担当事務官 */-->
					<div class="input_parts form-group col-md-3">
						<label>担当事務官</label>
						<input type="text" class="form-control" th:field="*{jimukanName}" maxlength="100">
						<div th:if="*{#fields.hasErrors('jimukanName')}" th:errors="*{jimukanName}" class="error_mag_point">error</div>
					</div>
					<!--/* 備考 */-->
					<div class="input_parts form-group col-md-6">
						<label>備考</label>
						<input type="text" class="form-control" th:field="*{kensatsuRemarks}" maxlength="100">
						<div th:if="*{#fields.hasErrors('kensatsuRemarks')}" th:errors="*{kensatsuRemarks}" class="error_mag_point">error</div>
					</div>
				</div>
			</div>
			<!--/* ボタン */-->
			<div class="text-right">
				<!--/* 保存ボタン */-->
				<button type="button" class="btn btn-info btn-sm saveKensatsukan mr-3"
					data-boundary="window" data-container="#saibanKensatsukanInputFragment" data-toggle="tooltip" data-trigger="hover" title="保存する">
					<i class="fas fa-check"></i>保存
				</button>
				<!--/* 閉じるボタン */-->
				<button type="button" class="closeKensatsukan btn btn-light btn-sm"
					data-boundary="window" data-container="#saibanKensatsukanInputFragment" data-toggle="tooltip" data-trigger="hover" title="閉じる">
					<i class="fas fa-times"></i>閉じる
				</button>
			</div>
		</div>
	</form>
	
</div>


</body>
</html>